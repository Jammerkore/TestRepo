using System;
using System.Drawing;
using System.Collections;
using System.Globalization;
using System.Collections.Specialized;
using System.ComponentModel;
using System.Windows.Forms;
using System.Data;
using System.Text;
using System.IO;
using System.Configuration;
using System.Collections.Generic;
using System.Security.Principal;

using Infragistics.Win.UltraWinGrid;
using Infragistics.Shared;
using Infragistics.Win;
using Infragistics.Win.UltraWinListBar;
using Infragistics.Win.UltraWinTree;
using Infragistics.Win.UltraWinMaskedEdit;

using MIDRetail.Business;
using MIDRetail.Common;
using MIDRetail.Data;
using MIDRetail.DataCommon;
using MIDRetail.Windows.Controls;
using System.Text.RegularExpressions;   //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties



namespace MIDRetail.Windows
{
	/// <summary>
	/// Summary description for Properties.
	/// </summary>
	public partial class frmNodeProperties : MIDFormBase
	{
		// add event to update explorer when node is changed
		public delegate void NodePropertyChangeEventHandler(object source, NodePropertyChangeEventArgs e);
		public event NodePropertyChangeEventHandler OnNodePropertyChangeHandler;

		private DateTime _start;
		private DateTime _time;
		private string _currentModelID = null;
		private string _lblApply = null;
		private string _txtMultipleSimilarStores = "(multiple stores)";
		private string _txtInheritedFrom = "Inherited from ";
		private SessionAddressBlock _SAB;
		private bool _profileChangesMade = false;
		private bool _OTSTypeChangesMade = false;
		private bool _OTSLevelChangesMade = false;
		private bool _productTypeChangesMade = false;
        private bool _itemMaxEntryError = false; // TT#2092 - gtaylor - Item Max Node Properties Issue
        private bool _fwosMaxEntryError = false; // TT#2225 - gtaylor - ANF VSW
		private bool _nameChanged = false;
		private bool _cancelUpdate = false;
		private bool _eligibilityIsCopied = false;
		private bool _eligibilityChangesMade = false;
		private bool _storeGradesChangesMade = false;
        // Begin TT#1399
        private bool _hierarchyChangesMade = false;
        // End TT#1399
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private bool _sizeCurvesSimilarStoreIsCopied = false;
		private bool _sizeCurvesCriteriaChangesMade = false;
		private bool _sizeCurvesMinAvgToleranceChangesMade = false;
		private bool _sizeCurvesHighLevelToleranceChangesMade = false;
		private bool _sizeCurvesSalesToleranceChangesMade = false;
		private bool _sizeCurvesIndexToleranceChangesMade = false;
		private bool _sizeCurvesMinPctToleranceChangesMade = false;
		private bool _sizeCurvesMaxPctToleranceChangesMade = false;
		private bool _sizeCurvesSimilarStoreChangesMade = false;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _sizeOutOfStockSizeGroupChangesMade = false;
		private bool _sizeOutOfStockStoreGroupChangesMade = false;
		private bool _sizeOutOfStockQuantityChangesMade = false;
		private bool _sizeSellThruChangesMade = false;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _stockMinMaxChangesMade = false;
		private bool _minMaxesChangesMade = false;
		private bool _storeCapacityChangesMade = false;
		private bool _velocityGradesChangesMade = false;
		//Begin TT#505 - JScott - Velocity - Apply Min/Max
		private bool _velocityMinMaxesChangesMade = false;
		//End TT#505 - JScott - Velocity - Apply Min/Max
		private bool _sellThruPctsChangesMade = false;
		private bool _dailyPercentagesChangesMade = false;
		private bool _dailyPurgeCriteriaChangesMade = false;
		private bool _weeklyPurgeCriteriaChangesMade = false;
		private bool _OTSPurgeCriteriaChangesMade = false;
        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        //private bool _headersPurgeCriteriaChangesMade = false;
        private bool _asnHTPurgeCriteriaChangesMade = false;   
        private bool _dropShipHTPurgeCriteriaChangesMade = false; 
        private bool _dummyHTPurgeCriteriaChangesMade = false;
        private bool _receiptHTPurgeCriteriaChangesMade = false;
        private bool _purchaseOrderHTPurgeCriteriaChangesMade = false;
        private bool _reserveHTPurgeCriteriaChangesMade = false;
        private bool _vswHTPurgeCriteriaChangesMade = false;
        private bool _workUpTotHTPurgeCriteriaChangesMade = false;
        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        private bool _characteristicsChangesMade = false;
        //Begin TT#1401 - GRT - Reservation Stores
        private bool _reservationChangesMade = false;
        //End TT#1401 - GRT - Reservation Stores
		private bool _newNode = false;
		private bool _IDSameAsName = false;
		private bool _DescriptionSameAsName = false;
		private bool _loadingWindow = false;
		private bool _eligibilityIsPopulated = false;
		private bool _storeGradesIsPopulated = false;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private bool _sizeCurvesInheritedCriteriaIsPopulated = false;
		private bool _sizeCurvesCriteriaIsPopulated = false;
		private bool _sizeCurvesToleranceIsPopulated = false;
		private bool _sizeCurvesSimilarStoreIsPopulated = false;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _sizeOutOfStockIsPopulated = false;
		private bool _sizeSellThruIsPopulated = false;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _stockMinMaxIsPopulated = false;
		private bool _storeCapacityIsPopulated = false;
		private bool _velocityGradesIsPopulated = false;
		private bool _sellThruPctsIsPopulated = false;
		private bool _purgeCriteriaIsPopulated = false;
		private bool _dailyPercentagesIsPopulated = false;
		private bool _characteristicsIsPopulated = false;
		// Begin TT#1401 - Reservation Stores
        private bool _reservationIsPopulated = false;
        // End TT#1401 - Reservation Stores
        private bool _changeEventThrown = false;
		private bool _colorFound = false;
		private bool _sizeFound = false;
		private	bool _eligibilityGridBuilt = false;
		private	bool _storeGradesGridBuilt = false;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private bool _sizeCurvesInheritedCriteriaGridBuilt = false;
		private bool _sizeCurvesCriteriaGridBuilt = false;
		private bool _sizeCurvesSimilarStoreGridBuilt = false;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _sizeOutOfStockGridBuilt = false;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _StockMinMaxGridBuilt = false;
		private	bool _storeCapacityGridBuilt = false;
		private	bool _velocityGradesGridBuilt = false;
		private	bool _sellThruPctsGridBuilt = false;
		private	bool _dailyPercentagesGridBuilt = false;
        //Begin TT#1401 - GRT - Reservation Stores
        private bool _reservationGridBuilt = false;
        //End TT#1401 - GRT - Reservation Stores
        private bool _characteristicsBuilt = false;
		private	bool _displayDeletePrompt = true;
		private bool _setRowPosition = true;
		private bool _progressVisible = false;
		private bool _OKButtonClicked = false;
		private bool _storeGradesInherited = false;
		private bool _minMaxesInherited = false;
		private bool _velocityGradesInherited = false;
		//Begin TT#505 - JScott - Velocity - Apply Min/Max
		private bool _velocityMinMaxesInherited = false;
		//End TT#505 - JScott - Velocity - Apply Min/Max
		private bool _sellThruPctsInherited = false;
		private bool _needsValidated = false;
		private bool _storeAttributeIsChanged = false;
		private bool _promptAttributeChange = true;
		private bool _rebuildScreen = false;
		private bool _processingSave = false;
		private HierarchyNodeSecurityProfile _nodeSecurity; 
		private bool _checkBoxChanging;
		private bool _deletingValueWhileListOpen = false;
		private bool _cellListOpen = false;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private bool _comboBoxChanging;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private int _nextSizeCurveCriteriaSequence = -1;
		private int _nextSizeCurveCriteriaKey = -1;
		private bool _updatingDefaultInd = false;
		private SizeGroup _sizeGroupData;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
        //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
        private bool _loadingSizeCurvesToleranceTab = false;
        //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
        //BEGIN TT#2015 - gtaylor - Apply Changes To Lower Levels
        private string _purgeDailyHistoryPreviousValue = "";
        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        //private string _purgeHeadersPreviousValue = "";
        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        private string _purgePlansPreviousValue = "";
        private string _purgeWeeklyHistoryPreviousValue = "";
        //END TT#2015 - gtaylor - Apply Changes To Lower Levels        
        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
	    private string _purgeHeaderTypeASN = "";
	    private string _purgeHeaderTypeDropShip = "";
	    private string _purgeHeaderTypeDummy = "";
	    private string _purgeHeaderTypeReceipt = "";
	    private string _purgeHeaderTypePurchase = "";
	    private string _purgeHeaderTypeReserve = "";
	    private string _purgeHeaderTypeVSW = "";
	    private string _purgeHeaderTypeWorkupTotBuy = "";
        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        //Begin TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3
        private bool _chainSetPercentIsPopulated = false;
        private bool _chainSetPercentGridBuilt = false;
        private DateRangeProfile Begdr = null;
        private DateRangeProfile _origBegdr = null;
        private Hashtable _CSPGroupHash = null;
        private int _Begin_CDR_RID;
        private object _priorPercentageValue = null;
        private bool _chainSetPercentChangesMade = false;
        private bool _chainSetPercentNewGroup = false;
        private int _chainSetPercentPreviousIndex = 0;
        private bool _chainSetPercentNewWeeks = false;
        private int _orgNodeId = Include.NoRID;
        private List<Label> _isCSPInhLabelList;
        // Begin TT#2138 - JSmith - Open Node Properties Read Only
        private bool _allowEdit = false;
        private bool _editEnabled = false;
        // End TT#2138
        // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
        private bool _processAfterCellUpdate = true;
        // End TT#2611 - JSmith - Clearing daily %s leaves a value

        //End TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3

		private object _priorCapacityValue = null;
        private MIDHierarchyNode _node;

		private FunctionSecurityProfile _securityNodes;
		private FunctionSecurityProfile _securityNodeProperties;
		private FunctionSecurityProfile _securityProfile;
		private FunctionSecurityProfile _securityEligibility;
		private FunctionSecurityProfile _securityStoreGrades;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private FunctionSecurityProfile _securitySizeCurves;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private FunctionSecurityProfile _securitySizeOutOfStock;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private FunctionSecurityProfile _securityStockMinMax;
		private FunctionSecurityProfile _securityVelocity;
		private FunctionSecurityProfile _securityCapacity;
		private FunctionSecurityProfile _securityDailyPcts;
		private FunctionSecurityProfile _securityPurge;
		private FunctionSecurityProfile _securityCharacteristics;
		private FunctionSecurityProfile _securityEligibilityModels;
		private FunctionSecurityProfile _securitySalesModifierModels;
		private FunctionSecurityProfile _securityStockModifierModels;
		private FunctionSecurityProfile _securityFWOSModifierModels;
        private FunctionSecurityProfile _securityFWOSMaxModels; //TT#108 - MD - DOConnell - FWOS Max Model
        private FunctionSecurityProfile _storeUserAttrSecLvl;
        //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
        private FunctionSecurityProfile _securityChainSetPercent;
        //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
        // BEGIN TT#1401 - GTaylor - Reservation Stores
        private FunctionSecurityProfile _securityIMO;
        //  private FunctionSecurityProfile _securityIMOModels;   // TT#203 - MD - Remove duplicate Enums entry 810660 - rbeck
        // END TT#1401 - GTaylor - Reservation Stores
		private string _errors = null;
		private HierarchyProfile _hp;
		private HierarchyProfile _hpHome;
		private HierarchyNodeProfile _hnp;
		private HierarchyNodeProfile _parent;
		private HierarchyMaintenance _hm;
        private eProfileType _nodeType;
		private int _buttonWidth = 25, _buttonHeight = 25;
		private int _defaultImageIndex; 
		private string _defaultImageFileName;
		private ProfileList _storeProfiles;
		private ProfileList _storeEligibilityGroupList;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private ProfileList _sizeCurvesSimilarStoreGroupList;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#1076 - JScott - Size Curves by Set
		private ProfileList _sizeCurvesCriteriaStoreGroupList;
		//End TT#1076 - JScott - Size Curves by Set
		private ProfileList _storeCapacityGroupList;
		private ProfileList _dailyPercentagesGroupList;
		private ProfileList _stockMinMaxGroupList;
        // BEGIN TT#1401 - gtaylor - Reservation Stores
        private ProfileList _imoGroupList;
        // END TT#1401 - gtaylor - Reservation Stores
		private System.Data.DataSet _storeEligibilityDataSet;
		private System.Data.DataTable _storeGradesDataTable;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private System.Data.DataTable _sizeCurvesInheritedCriteriaDataTable;
		private System.Data.DataTable _sizeCurvesCriteriaDataTable;
		private System.Data.DataTable _sizeCurvesToleranceDataTable;
		private System.Data.DataSet _sizeCurvesSimilarStoreDataSet;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private System.Data.DataSet _sizeOutOfStockDataSet;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private System.Data.DataSet _stockMinMaxDataSet;
		private System.Data.DataSet _storeCapacityDataSet;
		private System.Data.DataSet _characteristicsDataSet;
        //Begin TT#1401 - GRT - Reservation Stores
        private System.Data.DataSet _imoDataSet;
        private IMOProfileList _imoProfileList;
        //End TT#1401 - GRT - Reservation Stores
		private System.Data.DataTable _velocityGradesDataTable;
		private System.Data.DataTable _sellThruPctsDataTable;
        //Begin TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3
        private System.Data.DataSet _chainSetPercentDataSet;
        private ProfileList _chainSetPercentGroupList;
        private ProfileList _CSPStoreGroupLevelList;
        private ChainSetPercentList _chainSetPercentList;
        private ProfileList _CSPweeks;
        private SortedList _ChainSetPercentTotal;
        //End TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3
		private ProfileList _eligibilityModelProfileList;
		private ProfileList _stockModifierProfileList;
		private ProfileList _salesModifierProfileList;
		private ProfileList _FWOSModifierProfileList;
        private ProfileList _FWOSMaxProfileList; //TT#108 - MD - DOConnell - FWOS Max Model
		private System.Data.DataSet _dailyPercentagesDataSet;
		private StoreEligibilityList _storeEligList;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private SizeCurveCriteriaList _sizeCurvesCriteriaList;
		private SizeCurveDefaultCriteriaProfile _sizeCurveDefaultCriteriaProfile;
		private SizeCurveToleranceProfile _sizeCurveToleranceProfile;
		private SizeCurveSimilarStoreList _sizeCurveSimilarStoreList;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private SizeOutOfStockProfile _sizeOutOfStockProfile;
		private SizeSellThruProfile _sizeSellThruProfile;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private StoreGradeList _storeGradeList;
		private NodeStockMinMaxesProfile _nodeStockMinMaxesProfile;
		private StoreCapacityList _storeCapacityList;
		private VelocityGradeList _velocityGradeList;
		private SellThruPctList _sellThruPctList;
		private StoreDailyPercentagesList _storeDailyPercentagesList;
		private NodeCharProfileList _nodeCharProfileList;
		private ProfileList _storeList;
		private ProfileList _storeEligibilityGroupLevelList;
		private ProfileList _storeCapacityGroupLevelList;
		private ProfileList _dailyPercentagesGroupLevelList;
        //Begin TT#1401 - GRT - Reservation Stores
        private ProfileList _imoGroupLevelList;
        //End TT#1401 - GRT - Reservation Stores
        //BEGIN TT#2015 - gtaylor - apply changes to lower levels
        private NodeChangeProfile _nodeChangeProfile;
        //END TT#2015 - gtaylor - apply changes to lower levels
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private ProfileList _sizeCurvesSimilarStoreGroupLevelList;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		private int _nodeRID = Include.NoRID;
		private int _groupRID = Include.NoRID;
		private MenuItem _mnuItemOpenModel = new MenuItem("&Open");
		private MenuItem _mnuItemNewModel = new MenuItem("&New");
		private MenuItem _mnuItemSeparator = new MenuItem("-");
		private eModelType _modelType = eModelType.None;
		private frmUltraGridSearchReplace _frmUltraGridSearchReplace;
		private UltraGridColumn _gridCol;
		private UltraGridBand _gridBand;
        // Begin TT#2610 - JSmith - Daily %s delete date range
        private UltraGridRow _gridRow;
        // End TT#2610 - JSmith - Daily %s delete date range
		private Infragistics.Win.UltraWinGrid.UltraGridCell _gridCell;
		private Infragistics.Win.UltraWinGrid.UltraGridCell _focusCell = null;
		private Infragistics.Win.UltraWinGrid.UltraGridRow _dropdownRow;
		private frmProgress _progress;
		private DateTime _nullDate = new DateTime(1,1,1);
		private TabPage _currentTabPage = null;
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private TabPage _currentSizeCurveTabPage = null;
		private Hashtable _inheritedLevelListHash;
		private ArrayList _sizeCurveCriteriaLevelList;
		private ArrayList _sizeCurveToleranceLevelList;
		private SizeGroupList _sizeCurveCriteriaGroupList;
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private TabPage _currentSizeOutOfStockTabPage = null;
		private SizeGroupList _sizeOutOfStockGroupList;
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private Hashtable _hnpHash = new Hashtable();
		private CustomWindowsRoutines _customWindowsRoutines;
        //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
        private Hashtable _htChainSetPercentInheritance;
        //End TT#1699
        //BEGIN TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
        private ArrayList _ridList;
        private bool _display;
        private eProfileType etype;
        private bool _skipInUse;
        //END   TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties


		/// <summary>
		/// Gets the id of the node.
		/// </summary>
		public int NodeRID 
		{
			get { return _nodeRID ; }
		}
		
		// BEGIN TT#2092 - gtaylor - Item Max Node Properties Issue
        /// <summary>
        /// Gets a boolean identifying if an error was encountered during Item Max Value entry
        /// </summary>
        public bool ItemMaxEntryError
        {
            get { return _itemMaxEntryError; }
            set { _itemMaxEntryError = value; }
        }
        // END TT#2092 - gtaylor
        // BEGIN TT#2225 - gtaylor - ANF VSW
        /// <summary>
        /// Gets a boolean identifying if an error was encountered during FWOS Max Value entry
        /// </summary>
        public bool FWOSMaxEntryError
        {
            get { return _fwosMaxEntryError; }
            set { _fwosMaxEntryError = value; }
        }
        // END TT#2225 - gtaylor
        //BEGIN TT#2015 - gtaylor - Apply Changes To Lower Levels
        //  gather all the radio button checks
        public bool applyChangesToLowerLevelsSelected
        {
            get
            {
                return
                    (rbApplyChangesToLowerLevelsChainSet.Checked ||
                    rbApplyChangesToLowerLevelsChar.Checked ||
                    rbApplyChangesToLowerLevelsDailyPct.Checked ||
                    rbApplyChangesToLowerLevelsElig.Checked ||
                    rbApplyChangesToLowerLevelsIMO.Checked ||
                    rbApplyChangesToLowerLevelsPurge.Checked ||
                    rbApplyChangesToLowerLevelsSC.Checked);
            }
        }
        //END TT#2015 - gtaylor - Apply Changes To Lower Levels
        // BEGIN TT#1399
        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the hierarchy data.
        /// </summary>
        public bool HierarchyChangesMade
        {
            get { return _hierarchyChangesMade; }
            set
            {
                _hierarchyChangesMade = value;
                // if true, turn on master flag
                if (HierarchyChangesMade)
                {
                    if (FormLoaded && !_loadingWindow)
                    {
                        ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
                    }
                }
            }
        }
        // END TT#1399

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the profile data.
		/// </summary>
		public bool ProfileChangesMade
		{
			get	{return _profileChangesMade;}
			set	
			{
				_profileChangesMade = value;
				// if true, turn on master flag
				if (ProfileChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the OTS Type value.
		/// </summary>
		public bool OTSTypeChangesMade
		{
			get	{return _OTSTypeChangesMade;}
			set	
			{
				_OTSTypeChangesMade = value;
				// if true, turn on master flag
				if (OTSTypeChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the OTS Level value.
		/// </summary>
		public bool OTSLevelChangesMade
		{
			get	{return _OTSLevelChangesMade;}
			set	
			{
				_OTSLevelChangesMade = value;
				// if true, turn on master flag
				if (OTSLevelChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the profile data.
		/// </summary>
		public bool ProductTypeChangesMade
		{
			get	{return _productTypeChangesMade;}
			set	
			{
				_productTypeChangesMade = value;
				// if true, turn on master flag
				if (ProductTypeChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the eligibility data.
		/// </summary>
		public bool EligibilityChangesMade
		{
			get	{return _eligibilityChangesMade;}
			set	
			{
				_eligibilityChangesMade = value;
				// if true, turn on master flag
				if (_eligibilityChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the store grades data.
		/// </summary>
		public bool StoreGradesChangesMade
		{
			get	{return _storeGradesChangesMade;}
			set	
			{
				_storeGradesChangesMade = value;
				// if true, turn on master flag
				if (_storeGradesChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves criteria data.
		/// </summary>
		public bool SizeCurvesCriteriaChangesMade
		{
			get { return _sizeCurvesCriteriaChangesMade; }
			set
			{
				_sizeCurvesCriteriaChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesCriteriaChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance max avg data.
		/// </summary>
		public bool SizeCurvesMinAvgToleranceChangesMade
		{
			get { return _sizeCurvesMinAvgToleranceChangesMade; }
			set
			{
				_sizeCurvesMinAvgToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesMinAvgToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance high level data.
		/// </summary>
		public bool SizeCurvesHighLevelToleranceChangesMade
		{
			get { return _sizeCurvesHighLevelToleranceChangesMade; }
			set
			{
				_sizeCurvesHighLevelToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesHighLevelToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance sales data.
		/// </summary>
		public bool SizeCurvesSalesToleranceChangesMade
		{
			get { return _sizeCurvesSalesToleranceChangesMade; }
			set
			{
				_sizeCurvesSalesToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesSalesToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance index data.
		/// </summary>
		public bool SizeCurvesIndexToleranceChangesMade
		{
			get { return _sizeCurvesIndexToleranceChangesMade; }
			set
			{
				_sizeCurvesIndexToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesIndexToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance min pct data.
		/// </summary>
		public bool SizeCurvesMinPctToleranceChangesMade
		{
			get { return _sizeCurvesMinPctToleranceChangesMade; }
			set
			{
				_sizeCurvesMinPctToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesMinPctToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves tolerance max pct data.
		/// </summary>
		public bool SizeCurvesMaxPctToleranceChangesMade
		{
			get { return _sizeCurvesMaxPctToleranceChangesMade; }
			set
			{
				_sizeCurvesMaxPctToleranceChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesMaxPctToleranceChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets a boolean identifying if any purge criteria changes have been made.
		/// </summary>
		public bool SizeCurvesToleranceChangesMade
		{
			get
			{
				if (SizeCurvesMinAvgToleranceChangesMade ||
					SizeCurvesHighLevelToleranceChangesMade ||
					SizeCurvesSalesToleranceChangesMade ||
					SizeCurvesIndexToleranceChangesMade ||
					SizeCurvesMinPctToleranceChangesMade ||
					SizeCurvesMaxPctToleranceChangesMade)
				{
					return true;
				}
				else
				{
					return false;
				}
			}

		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size curves similar store data.
		/// </summary>
		public bool SizeCurvesSimilarStoreChangesMade
		{
			get { return _sizeCurvesSimilarStoreChangesMade; }
			set
			{
				_sizeCurvesSimilarStoreChangesMade = value;
				// if true, turn on master flag
				if (_sizeCurvesSimilarStoreChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size out of stock data.
		/// </summary>
		public bool SizeOutOfStockSizeGroupChangesMade
		{
			get { return _sizeOutOfStockSizeGroupChangesMade; }
			set
			{
				_sizeOutOfStockSizeGroupChangesMade = value;
				// if true, turn on master flag
				if (_sizeOutOfStockSizeGroupChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size out of stock data.
		/// </summary>
		public bool SizeOutOfStockStoreGroupChangesMade
		{
			get { return _sizeOutOfStockStoreGroupChangesMade; }
			set
			{
				_sizeOutOfStockStoreGroupChangesMade = value;
				// if true, turn on master flag
				if (_sizeOutOfStockStoreGroupChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size out of stock data.
		/// </summary>
		public bool SizeOutOfStockQuantityChangesMade
		{
			get { return _sizeOutOfStockQuantityChangesMade; }
			set
			{
				_sizeOutOfStockQuantityChangesMade = value;
				// if true, turn on master flag
				if (_sizeOutOfStockQuantityChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		/// <summary>
		/// Gets a boolean identifying if any purge criteria changes have been made.
		/// </summary>
		public bool SizeOutOfStockChangesMade
		{
			get
			{
				if (SizeOutOfStockSizeGroupChangesMade ||
					SizeOutOfStockStoreGroupChangesMade ||
					SizeOutOfStockQuantityChangesMade)
				{
					return true;
				}
				else
				{
					return false;
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the size sell thru data.
		/// </summary>
		public bool SizeSellThruChangesMade
		{
			get { return _sizeSellThruChangesMade; }
			set
			{
				_sizeSellThruChangesMade = value;
				// if true, turn on master flag
				if (_sizeSellThruChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the stock min/max data.
		/// </summary>
		public bool StockMinMaxChangesMade
		{
			get	{return _stockMinMaxChangesMade;}
			set	
			{
				_stockMinMaxChangesMade = value;
				// if true, turn on master flag
				if (_stockMinMaxChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the min max data.
		/// </summary>
		public bool MinMaxesChangesMade
		{
			get	{return _minMaxesChangesMade;}
			set	
			{
				_minMaxesChangesMade = value;
				// if true, turn on master flag
				if (_minMaxesChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the store capacity data.
		/// </summary>
		public bool StoreCapacityChangesMade
		{
			get	{return _storeCapacityChangesMade;}
			set	
			{
				_storeCapacityChangesMade = value;
				// if true, turn on master flag
				if (_storeCapacityChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the velocity grade data.
		/// </summary>
		public bool VelocityGradesChangesMade
		{
			get	{return _velocityGradesChangesMade;}
			set	
			{
				_velocityGradesChangesMade = value;
				// if true, turn on master flag
				if (_velocityGradesChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		//Begin TT#505 - JScott - Velocity - Apply Min/Max
		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the velocity min max data.
		/// </summary>
		public bool VelocityMinMaxesChangesMade
		{
			get { return _velocityMinMaxesChangesMade; }
			set
			{
				_velocityMinMaxesChangesMade = value;
				// if true, turn on master flag
				if (_velocityMinMaxesChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
						if (!_newNode)
						{
							btnApply.Enabled = true;
						}
					}
				}
			}
		}

		//End TT#505 - JScott - Velocity - Apply Min/Max
		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the sell thru pcts data.
		/// </summary>
		public bool SellThruPctsChangesMade
		{
			get	{return _sellThruPctsChangesMade;}
			set	
			{
				_sellThruPctsChangesMade = value;
				// if true, turn on master flag
				if (_sellThruPctsChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the daily percentages data.
		/// </summary>
		public bool DailyPercentagesChangesMade
		{
			get	{return _dailyPercentagesChangesMade;}
			set	
			{
				_dailyPercentagesChangesMade = value;
				// if true, turn on master flag
				if (_dailyPercentagesChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets a boolean identifying if any purge criteria changes have been made.
		/// </summary>
		public bool PurgeChangesMade
		{
			get	
			{
				if (DailyPurgeCriteriaChangesMade ||
					WeeklyPurgeCriteriaChangesMade ||
					OTSPurgeCriteriaChangesMade ||
                    //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                    //HeadersPurgeCriteriaChangesMade ||
                    ASNHTPurgeCriteriaChangesMade ||
                    DropShipHTPurgeCriteriaChangesMade ||
                    DummyHTPurgeCriteriaChangesMade ||
                    ReceiptHTPurgeCriteriaChangesMade ||
                    PurchaseOrderHTPurgeCriteriaChangesMade ||
                    ReserveHTPurgeCriteriaChangesMade ||
                    VSWHTPurgeCriteriaChangesMade ||
                    WorkUpTotHTPurgeCriteriaChangesMade)
                    //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
				{
					return true;
				}
				else
				{
					return false;
				}
			}

		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the daily purge criteria data.
		/// </summary>
		public bool DailyPurgeCriteriaChangesMade
		{
			get	{return _dailyPurgeCriteriaChangesMade;}
			set	
			{
				_dailyPurgeCriteriaChangesMade = value;
				// if true, turn on master flag
				if (_dailyPurgeCriteriaChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the weekly purge criteria data.
		/// </summary>
		public bool WeeklyPurgeCriteriaChangesMade
		{
			get	{return _weeklyPurgeCriteriaChangesMade;}
			set	
			{
				_weeklyPurgeCriteriaChangesMade = value;
				// if true, turn on master flag
				if (_weeklyPurgeCriteriaChangesMade)
				{
					ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
				}
			}
		}

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the OTS purge criteria data.
		/// </summary>
		public bool OTSPurgeCriteriaChangesMade
		{
			get	{return _OTSPurgeCriteriaChangesMade;}
			set	
			{
				_OTSPurgeCriteriaChangesMade = value;
				// if true, turn on master flag
				if (_OTSPurgeCriteriaChangesMade)
				{
					ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
				}
			}
		}

        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        ///// <summary>
        ///// Gets or sets a boolean identifying if changes have been made to the headers purge criteria data.
        ///// </summary>
        //public bool HeadersPurgeCriteriaChangesMade
        //{
        //    get	{return _headersPurgeCriteriaChangesMade;}
        //    set	
        //    {
        //        _headersPurgeCriteriaChangesMade = value;
        //        // if true, turn on master flag
        //        if (_headersPurgeCriteriaChangesMade)
        //        {
        //            ChangePending = true;
        //            if (!_newNode)
        //            {
        //                btnApply.Enabled = true;
        //            }
        //        }
        //    }
        //}

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the ASN header type purge criteria data.
        /// </summary>
        public bool ASNHTPurgeCriteriaChangesMade
        {
            get { return _asnHTPurgeCriteriaChangesMade; }
            set
            {
                _asnHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_asnHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the Drop Ship header type purge criteria data.
        /// </summary>
        public bool DropShipHTPurgeCriteriaChangesMade
        {
            get { return _dropShipHTPurgeCriteriaChangesMade; }
            set
            {
                _dropShipHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_dropShipHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the Dummy header type purge criteria data.
        /// </summary>
        public bool DummyHTPurgeCriteriaChangesMade
        {
            get { return _dummyHTPurgeCriteriaChangesMade; }
            set
            {
                _dummyHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_dummyHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the Receipt header type purge criteria data.
        /// </summary>
        public bool ReceiptHTPurgeCriteriaChangesMade
        {
            get { return _receiptHTPurgeCriteriaChangesMade; }
            set
            {
                _receiptHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_receiptHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the PurchaseOrder header type purge criteria data.
        /// </summary>
        public bool PurchaseOrderHTPurgeCriteriaChangesMade
        {
            get { return _purchaseOrderHTPurgeCriteriaChangesMade; }
            set
            {
                _purchaseOrderHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_purchaseOrderHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the Reserve header type purge criteria data.
        /// </summary>
        public bool ReserveHTPurgeCriteriaChangesMade
        {
            get { return _reserveHTPurgeCriteriaChangesMade; }
            set
            {
                _reserveHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_reserveHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the VSW header type purge criteria data.
        /// </summary>
        public bool VSWHTPurgeCriteriaChangesMade
        {
            get { return _vswHTPurgeCriteriaChangesMade; }
            set
            {
                _vswHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_vswHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }

        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the VSW header type purge criteria data.
        /// </summary>
        public bool WorkUpTotHTPurgeCriteriaChangesMade
        {
            get { return _workUpTotHTPurgeCriteriaChangesMade; }
            set
            {
                _workUpTotHTPurgeCriteriaChangesMade = value;
                // if true, turn on master flag
                if (_workUpTotHTPurgeCriteriaChangesMade)
                {
                    ChangePending = true;
                    if (!_newNode)
                    {
                        btnApply.Enabled = true;
                    }
                }
            }
        }
        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type

		/// <summary>
		/// Gets or sets a boolean identifying if changes have been made to the characteristics data.
		/// </summary>
		public bool CharacteristicsChangesMade
		{
			get { return _characteristicsChangesMade; }
			set
			{
				_characteristicsChangesMade = value;
				// if true, turn on master flag
				if (_characteristicsChangesMade)
				{
					if (FormLoaded && !_loadingWindow)
					{
						ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
					}
				}
			}
		}

        //Begin TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3
        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the characteristics data.
        /// </summary>
        public bool ChainSetPercentChangesMade
        {
            get { return _chainSetPercentChangesMade; }
            set
            {
                _chainSetPercentChangesMade = value;
                // if true, turn on master flag
                if (_chainSetPercentChangesMade)
                {
                    if (FormLoaded && !_loadingWindow)
                    {
                        ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
                    }
                }
            }
        }
        /// <summary>
        /// Gets the id of the calendar date range.
        /// </summary>
        public int CDR_RID
        {
            get { return _Begin_CDR_RID; }
        }
        //End TT#1498 -DOConnell - Chain Plan - Set Percentages - Phase 3

        //Begin TT#1401 - GRT - Reservation Stores
        /// <summary>
        /// Gets or sets a boolean identifying if changes have been made to the characteristics data.
        /// </summary>
        public bool ReservationChangesMade
        {
            get { return _reservationChangesMade; }
            set
            {
                _reservationChangesMade = value;
                // if true, turn on master flag
                if (_reservationChangesMade)
                {
                    if (FormLoaded && !_loadingWindow)
                    {
                        ChangePending = true;
                        if (!_newNode)
                        {
                            btnApply.Enabled = true;
                        }
                    }
                }
            }
        }
        //End TT#1401 - GRT - Reservation Stores

        //BEGIN TT#4984 - BVaughan - Change Hierarchy in Organizational Hierarchy to be an Alternte.  If focus on a different node the Alternate Hierarhcy will appear even though nothing was changed.
        /// <summary>
        /// Clear the controls on the Profile tab.
        /// </summary>
        private void ClearProfileTabControls()
        {
            this.txtNodeID.Text = String.Empty;
            this.txtColorGroup.Text = String.Empty;
            this.txtDescription.Text = String.Empty;
            this.radTypeUndefined.Checked = false;
            this.radTypeHardline.Checked = false;
            this.radTypeSoftline.Checked = false;
            this.txtOTSAnchorNode.Text = String.Empty;
            this.radActiveNo.Checked = false;
            this.radActiveYes.Checked = false;
            this.txtApplyNodePropsFrom.Text = String.Empty;
            this.radOTSLevel.Checked = false;
            this.radOTSNode.Checked = false;
            this.radBasicReplenishmentNo.Checked = false;
            this.radBasicReplenishmentYes.Checked = false;
            this.chkOTSTypeOverrideRegular.Checked = false;
            this.chkOTSTypeOverrideTotal.Checked = false;
        }
        //END TT#4984

		public frmNodeProperties(SessionAddressBlock aSAB) : base (aSAB)
		{
            //  BEGIN TT#1399
            FunctionSecurity = new FunctionSecurityProfile(Include.NoRID);
            FunctionSecurity.SetAllowUpdate();
            //  END TT#1399

            eStoreGroupSelectType storeGroupSelectType;
			//Begin TT#2130 - DOConnell - Chain Set Percent Question
            eStoreGroupSelectType CSPStoreGroupSelectType;
			//End TT#2130 - DOConnell - Chain Set Percent Question

			AllowDragDrop = true;
			_start = DateTime.Now;
			_time = DateTime.Now;
			_SAB = aSAB;
			_customWindowsRoutines = new CustomWindowsRoutines(aSAB);
			//
			// Required for Windows Form Designer support
			//
			InitializeComponent();

			_mnuItemNewModel.Click += new System.EventHandler(this.mnuModelNew_Click);
			_mnuItemNewModel.Shortcut = Shortcut.CtrlN;
			_mnuItemOpenModel.Click += new System.EventHandler(this.mnuModelEdit_Click);
			_mnuItemOpenModel.Shortcut = Shortcut.CtrlO;

            _storeList = StoreMgmt.StoreProfiles_GetActiveStoresList(); //_SAB.StoreServerSession.GetActiveStoresList();
			_hm = new HierarchyMaintenance(_SAB);
			
			_defaultImageFileName = GraphicsDirectory + "\\" + MIDGraphics.DefaultClosedFolder;
			_defaultImageIndex = MIDGraphics.ImageIndex(MIDGraphics.DefaultClosedFolder);
            _storeUserAttrSecLvl = SAB.ClientServerSession.GetMyUserFunctionSecurityAssignment(eSecurityFunctions.AdminStoreAttributesUser);
            if (_storeUserAttrSecLvl.AccessDenied)
            {
                storeGroupSelectType = eStoreGroupSelectType.GlobalOnly;
            }
            else
            {
                storeGroupSelectType = eStoreGroupSelectType.All;
            }
            _storeEligibilityGroupList = StoreMgmt.StoreGroup_GetListViewList(storeGroupSelectType, storeGroupSelectType != eStoreGroupSelectType.GlobalOnly); //_SAB.StoreServerSession.GetStoreGroupListViewList(storeGroupSelectType, storeGroupSelectType != eStoreGroupSelectType.GlobalOnly);
            _storeCapacityGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
            _dailyPercentagesGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
            // BEGIN TT#1401 - gtaylor - Reservation Stores
            _imoGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
            // END TT#1401 - gtaylor - Reservation Stores
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			_sizeCurvesSimilarStoreGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#1076 - JScott - Size Curves by Set
			_sizeCurvesCriteriaStoreGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
			//End TT#1076 - JScott - Size Curves by Set
			_stockMinMaxGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
			SetText();
			_currentTabPage = this.tabProfile;
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			_currentSizeCurveTabPage = this.tabSizeCurvesCriteria;
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			_currentSizeOutOfStockTabPage = this.tabSizeOutOfStockParms;
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
            _storeProfiles = StoreMgmt.StoreProfiles_GetActiveStoresList(); //_SAB.StoreServerSession.GetActiveStoresList();
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			_sizeGroupData = new SizeGroup();
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			DisplayPictureBoxImage(picSZOOSSizeGroupFilter);
			SetMaskedComboBoxesEnabled();
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
            //Begin TT#1498 - DOConnell - Chain Plan Set Percentages Phase 3
            //Begin TT#2130 - DOConnell - Chain Set Percent Question -  CSP feature only available for Global Store Attributes
            //_chainSetPercentGroupList = (ProfileList)_storeEligibilityGroupList.Clone();
            CSPStoreGroupSelectType = eStoreGroupSelectType.GlobalOnly;
            _chainSetPercentGroupList = StoreMgmt.StoreGroup_GetListViewList(CSPStoreGroupSelectType, CSPStoreGroupSelectType != eStoreGroupSelectType.GlobalOnly); //_SAB.StoreServerSession.GetStoreGroupListViewList(CSPStoreGroupSelectType, CSPStoreGroupSelectType != eStoreGroupSelectType.GlobalOnly);
            //End TT#2130 - DOConnell - Chain Set Percent Question
            //End TT#1498 - DOConnell - Chain Plan Set Percentages Phase 3
		}

		private void SetText()
		{
			this.lblNodeName.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Node_Name);
			this.tabProfile.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Profile);
			this.gbxBasicReplenishment.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Basic_Replenishment);
			this.radBasicReplenishmentNo.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_No);
			this.radBasicReplenishmentYes.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Yes);
			this.lblColorGroup.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Color_Group);
			this.gbxOTSPlanLevelOverride.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Override_gbx);
			this.gbxOTSType.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Node_Type);
			this.chkOTSTypeOverrideTotal.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Total);
			this.chkOTSTypeOverrideRegular.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Regular);
			this.lblOTSHierarchy.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Hierarchy) + ":";
			this.radOTSLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Node_Level) + ":";
			this.gbxOTSNode.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Node);
			this.radOTSContainsID.Text = MIDText.GetTextOnly(Convert.ToInt32(eHierarchyDisplayOptions.IdOnly));
			this.radOTSContainsName.Text = MIDText.GetTextOnly(Convert.ToInt32(eHierarchyDisplayOptions.NameOnly));
			this.radOTSContainsDescription.Text = MIDText.GetTextOnly(Convert.ToInt32(eHierarchyDisplayOptions.DescriptionOnly));
			this.lblOTSLevelStartsWith.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OTS_Starts_With) + ":";
			this.gbxProductType.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Product_Type_gbx);
			this.radTypeSoftline.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Softline);
			this.radTypeHardline.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Hardline);
			this.radTypeUndefined.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Undefined);
			this.lblNodeID.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Node_ID);
			this.lblDescription.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Node_Description);
			this.tabStoreEligibility.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Eligibility);
			this.lblSEAttribute.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
			this.ugStoreEligibility.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Eligibility);
			this.ugCharacteristics.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Characteristics);
			this.tabStoreGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Grades);
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			this.lblSZAttribute.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
			this.tabSizeCurves.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves);
			this.tabSizeCurvesCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Criteria);
			this.tabSizeCurvesTolerance.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Tolerance);
			this.tabSizeCurvesSimilarStore.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
			this.ugSizeCurvesInheritedCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Inherited_Criteria);
			this.ugSizeCurvesCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Criteria);
			this.ugSizeCurvesSimilarStore.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Similar_Store);
			this.gbxSCTHigherLevelSalesTolerance.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_HigherLevelSalesTolerance);
			this.lblSCTMinimumAvgPerSize.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_MinimumAvgPerSize);
			this.lblSCTHighestLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_HighestLevel);
			this.gbxSCTApplyChainSales.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyChainSales);
			this.lblSCTSalesTolerance.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SalesTolerance);
			this.rdoSCTIndexToAverage.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_IndexToAverage);
			this.rdoSCTUnits.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SalesToleranceUnits);
			this.gbxSCTMinMaxTolerancePct.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_MinMaxTolerancePct);
			this.lblSCTMinimumPct.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_MinTolerancePct);
			this.lblSCTMaximumPct.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_MaxTolerancePct);
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			this.tabSizeOutOfStock.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OutOfStock);
			this.tabSizeOutOfStockParms.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OutOfStock);
			this.tabSizeSellThru.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SellThru);
			this.lblSZOOSSizeGroup.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SizeGroup);
            // Begin TT#234 MD - JSmith - Node Properties Out of Stock Tab appearance not as expected, save and hieracey service not available, tab says read only but security is full control, able to make changes when tab is read only.
            this.lblSZOOSAttributeSet.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
            // End TT#234 MD
			this.lblSizeSellThruLimit.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SellThruLimit);
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
			this.tabStockMinMax.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_MinMax);
			this.ugStockMinMax.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_MinMax);
			this.ugStoreGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Grades);
			this.tabStoreCapacity.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Capacity);
			this.ugStoreCapacity.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Capacity);
			this.lblSCAttribute.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
			this.tabVelocityGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Velocity_Grades);
			this.ugVelocityGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Velocity_Grades);
            this.ugSellThruPcts.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Sell_Thru_Pct);
			this.tabPurgeCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Criteria);
			this.lblPurgeDailyHistory.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Daily_History);
			this.lblPurgeDailyHistoryTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
			this.lblPurgeWeeklyHistory.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Weekly_History);
			this.lblPurgeWeeklyHistoryTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
			this.lblPurgePlans.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Plans);
			this.lblPurgePlansTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
            //this.lblPurgeHeaders.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Headers);
            //this.lblPurgeHeadersTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtASNTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtDropShipTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtDummyTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtReceiptTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtPurchaseOrderTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtReserveTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtVSWTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            lblHtWorkUpTotTimeframe.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Weeks);
            //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
			this.btnHelp.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Help);
			this.btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);
			this.btnOK.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_OK);
			this.btnCancel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Cancel);
			this.mnuSortAsc.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Sort_Ascending);
			this.mnuSortDesc.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Sort_Descending);
			this.mnuFind.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Search);
			this.lblDPAttribute.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
			_lblApply = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);
			this.btnAddDateRange.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Add_Date_Range);
			this.btnDeleteDateRange.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Delete_Date_Range);
			this.cbxSEApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxSGApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxVGApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxSCApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxPCApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxDPApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxCHApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			this.cbxSZCriteriaApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxSZToleranceApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxSZSimilarStoreApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			this.cbxSZOOSApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			this.cbxSZSellThruApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
            //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
            this.cbxCSPApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);
            //End TT#1671 - DOConnell - Chain Set Percent Node Properties
			this.cbxSEInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxSGInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxVGInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxSCInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxPCInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxDPInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
            this.cbxCHInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			this.cbxSZCriteriaInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxSZToleranceInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxSZSimilarStoreInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			this.cbxSZOOSInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			this.cbxSZSellThruInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
            //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
            this.cbxCSPInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);
            //End TT#1671 - DOConnell - Chain Set Percent Node Properties

			_txtMultipleSimilarStores = MIDText.GetTextOnly(eMIDTextCode.lbl_Multiple_Similar_Stores);
			_txtInheritedFrom = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherited_From);
			this.lblSMMAttribute.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);
			this.lblSMMAttributeSet.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);

            // Begin TT#988 - JSmith - Add Active Only indicator to Override Low Level Model
            gbxActive.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Active);
            radActiveYes.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Yes);
            radActiveNo.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_No);
            // End TT#988
            // Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
            this.cbxApplyMinToZeroTolerance.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyMinToZeroTolerance);
            // End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
			
            // Begin TT#1399 - GTaylor - Alternate Hierarchy Inherit Node Properties
            gbxApplyNodeProperties.Text = MIDText.GetTextOnly(eMIDTextCode.msg_gbxApplyNodeProperties);
            lblApplyNodePropsFrom.Text = MIDText.GetTextOnly(eMIDTextCode.msg_lblApplyNodePropsFrom);
            // End TT#1399 - GTaylor - Alternate Hierarchy Inherit Node Properties

            this.cbxRsrvInheritFromHigherLevel.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Inherit_From_Higher_Level);  // BEGIN TT#1401 - Reservaton Stores - gtaylor
            this.cbxApplyToLowerLevels.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Apply_To_Lower_Levels);  // BEGIN TT#1401 - Reservaton Stores - gtaylor
            this.tabReservation.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_Tab);  // BEGIN TT#1401 - Reservaton Stores - gtaylor
            this.lblRsrvStrAtt.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Attribute);  // BEGIN TT#1401 - Reservaton Stores - gtaylor

            // BEGIN TT#2015 - gtaylor - apply changes to lower levels
            //  using an existing text constant
            this.rbNoActionChar.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionCSP.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionDP.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionIMO.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionPC.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionSC.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            this.rbNoActionSE.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ACLL_DefaultAction);
            // END TT#2015 - gtaylor - apply changes to lower levels
        }

		/// <summary>
		/// The main entry point for the application.
		/// </summary>
        public void InitializeForm(MIDHierarchyNode aNode, int aParentRID)
        {
            InitializeForm(aNode.HierarchyRID, aParentRID, aNode.Profile.Key, aNode.Profile.ProfileType);
            _node = aNode;
        }

        public void InitializeForm(int hierarchyRID, int parentRID, int nodeRID, eProfileType nodeType)
		{
			try
			{
                //Begin TT#297  MD - DOConnell - Daily %'s can be updated in Read Only mode
                int oldNodeRID = Include.NoRID;
                if (_hnp != null)
                {
                    oldNodeRID = _hnp.Key;
                }
                //End TT#297  MD - DOConnell - Daily %'s can be updated in Read Only mode

                //BEGIN TT#2015 - gtaylor - Apply Changes to Lower Levels
                //  initialize the NodeChangeProfile here
                _nodeChangeProfile = new NodeChangeProfile(nodeRID, SAB.ClientServerSession.UserRID, DateTime.Now, new Dictionary<int, Dictionary<long, object>>());
                //END TT#2015 - gtaylor - Apply Changes to Lower Levels

				_IDSameAsName = false;
				_DescriptionSameAsName = false;

				CheckForPendingChanges();

				// release prior node
				if (_hnp != null && 
					_hnp.NodeLockStatus == eLockStatus.Locked && 
					nodeRID != _hnp.Key)
				{
					_SAB.HierarchyServerSession.DequeueNode(_hnp.Key);
				}

				if (nodeRID != Include.NoRID)
				{
					_newNode = false;
				}

                _nodeSecurity = _SAB.ClientServerSession.GetMyUserNodeSecurityAssignment(nodeRID, (int)eSecurityTypes.All);
				DoValueByValueEdits = false;
				_loadingWindow = true;
				_colorFound = false;
				_sizeFound = false;
				_nodeRID = nodeRID;
				_nodeType = nodeType;
				_hp = _SAB.HierarchyServerSession.GetHierarchyData(hierarchyRID);
				_parent = _SAB.HierarchyServerSession.GetNodeData(parentRID);
				if (_nodeSecurity.AllowUpdate)
				{
                    // Begin TT#2138 - JSmith - Open Node Properties Read Only
                    //// don't lock hierarchy if already locked
                    //if (_hnp == null || 
                    //    nodeRID != _hp.Key ||
                    //    _hnp.NodeLockStatus != eLockStatus.Locked)
                    //{
                    //    _hnp = _SAB.HierarchyServerSession.GetNodeDataForUpdate(nodeRID, true);
                    //    if (_hnp.NodeLockStatus == eLockStatus.ReadOnly)
                    //    {
                    //        _nodeSecurity.SetReadOnly();
                    //    }
                    //    else
                    //        if (_hnp.NodeLockStatus == eLockStatus.Cancel)
                    //    {
                    //        throw new HierarchyNodeConflictException();
                    //    }
                    //}
                    _hnp = _SAB.HierarchyServerSession.GetNodeData(nodeRID);
                    _allowEdit = true;
                    _nodeSecurity.SetReadOnly();
                    // End TT#2138
				}
				else
				{
					_hnp = _SAB.HierarchyServerSession.GetNodeData(nodeRID);
				}
				_hpHome = _SAB.HierarchyServerSession.GetHierarchyData(_hnp.HomeHierarchyRID);
				_hnp.HierarchyRID = hierarchyRID;
				_hnp.HomeHierarchyParentRID = parentRID;
				if (!_hnp.Parents.Contains(parentRID))
				{
					_hnp.Parents.Add(parentRID);
				}

                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                //Begin TT#297  MD - DOConnell - Daily %'s can be updated in Read Only mode
                //LoadCommon();
                //LoadCommon(false);
                if (_hnp != null && oldNodeRID != Include.NoRID)
                {
                    if (oldNodeRID != _hnp.Key)
                    {
                        LoadCommon(true);
                    }
                    else
                    {
                        LoadCommon(false);
                    }
                }
                else
                {
                    LoadCommon(false);
                }
                //End TT#297  MD - DOConnell - Daily %'s can be updated in Read Only mode
                _allowEdit = false;
                _editEnabled = false;
                // End TT#2138
				ProfileTab_Load();
				PurgeCriteriaTab_Load();
				if (_hnp.NodeLevel == 0)  // hierarchy so don't allow changing name, ID, or description here
				{
					this.txtNodeName.Enabled = false;
					this.txtDescription.Enabled = false;
					this.txtNodeID.Enabled = false;
					this.lblColorGroup.Hide();
					this.txtColorGroup.Hide();
				}
				else
					if (_hnp.LevelType == eHierarchyLevelType.Color)
				{
                    if (_securityNodes.AllowUpdate)
                    {
                        this.txtDescription.Enabled = true;
                    }
					this.txtNodeID.Enabled = false;
					this.lblColorGroup.Show();
					this.txtColorGroup.Show();
					ColorCodeProfile ccp = _SAB.HierarchyServerSession.GetColorCodeProfile(_hnp.ColorOrSizeCodeRID);
					if (ccp.Key == Include.NoRID)
					{
						this.txtColorGroup.Text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_AppErrorColorNotFound);
					}
					else
					{
						_colorFound = true;
						this.txtNodeName.Text = ccp.ColorCodeName;
						this.txtColorGroup.Text = ccp.ColorCodeGroup;
						this.txtColorGroup.Enabled = false;
						this.txtNodeName.Enabled = false;
					}
				}
				else
					if (_hnp.LevelType == eHierarchyLevelType.Size)
				{
                    if (_securityNodes.AllowUpdate)
                    {
                        this.txtDescription.Enabled = true;
                    }
					this.txtNodeID.Enabled = false;
					this.lblColorGroup.Hide();
					this.txtColorGroup.Hide();
					this.txtNodeName.Enabled = false;
					SizeCodeProfile scp = _SAB.HierarchyServerSession.GetSizeCodeProfile(_hnp.ColorOrSizeCodeRID);
					if (scp.Key != Include.NoRID)
					{
						_sizeFound = true;
						this.txtNodeName.Text = scp.SizeCodeName;
					}
				}
				else
				{
                    if (_securityNodes.AllowUpdate)
                    {
                        this.txtDescription.Enabled = true;
                        this.txtNodeID.Enabled = true;
                    }
					this.lblColorGroup.Hide();
					this.txtColorGroup.Hide();
				}
				_newNode = false;

				if (FormLoaded)
				{
					_eligibilityIsPopulated = false;
					_storeGradesIsPopulated = false;
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_sizeCurvesInheritedCriteriaIsPopulated = false;
					_sizeCurvesCriteriaIsPopulated = false;
					_sizeCurvesToleranceIsPopulated = false;
					_sizeCurvesSimilarStoreIsPopulated = false;
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_sizeOutOfStockIsPopulated = false;
					_sizeSellThruIsPopulated = false;
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_storeCapacityIsPopulated = false;
					_velocityGradesIsPopulated = false;
					_sellThruPctsIsPopulated = false;
					_dailyPercentagesIsPopulated = false;
					_stockMinMaxIsPopulated = false;
					if (ugStoreEligibility.Visible == true)
					{
						_storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, _hnp.Key, true, false);
						StoreEligibility_Populate(false);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildStoreEligibilityContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_eligibilityIsPopulated = true;
					}
					else
						if (ugStoreGrades.Visible == true)
					{
						StoreGrades_Populate(_hnp.Key, true);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildStoreGradesContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_storeGradesIsPopulated = true;
					}
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					else
						if (ugSizeCurvesCriteria.Visible == true)
					{
						SizeCurvesCriteria_Populate(true);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildSizeCurvesCriteriaContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_sizeCurvesInheritedCriteriaIsPopulated = true;
						_sizeCurvesCriteriaIsPopulated = true;
					}
					else
						if (cboSCTHighestLevel.Visible == true)
					{
						SizeCurvesTolerance_Populate(true);
						_sizeCurvesToleranceIsPopulated = true;
					}
					else
						if (ugSizeCurvesSimilarStore.Visible == true)
					{
						_sizeCurveSimilarStoreList = _SAB.HierarchyServerSession.GetSizeCurveSimilarStoreList(_storeList, _hnp.Key, true, false);
						SizeCurvesSimilarStore_Populate(true);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildSizeCurvesSimilarStoreContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode

                        _sizeCurvesSimilarStoreIsPopulated = true;
					}
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					else
						if (mcColorSizeByAttribute.Visible == true)
					{
						SizeOutOfStock_Populate(true, Include.NoRID, Include.NoRID);
						_sizeOutOfStockIsPopulated = true;
					}
					else
						if (txtSSTLimit.Visible == true)
					{
						SizeSellThru_Populate(true);
						_sizeSellThruIsPopulated = true;
					}
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					else
						if (ugStockMinMax.Visible == true)
					{
						_promptAttributeChange = false;
						StockMinMax_Populate(_hnp.Key, false, false);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildStockMinMaxContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_stockMinMaxIsPopulated = true;
						_promptAttributeChange = true;
					}
					else
						if (ugStoreCapacity.Visible == true)
					{
						_storeCapacityList = _SAB.HierarchyServerSession.GetStoreCapacityList(_storeList, _hnp.Key, false, false);
						StoreCapacity_Populate(false);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildStoreCapacityContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_storeCapacityIsPopulated = true;
					}
					else
						if (ugVelocityGrades.Visible == true)
					{
						TabVelocityGrades_Populate(_hnp.Key);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildVelocityGradesContextmenu();
                            BuildSellThruPctsContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						_velocityGradesIsPopulated = true;
						_sellThruPctsIsPopulated = true;
					}
					else
						if (ugDailyPercentages.Visible == true)
					{
						_storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, _hnp.Key);
						DailyPercentages_Populate(false);
                        //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                        if (oldNodeRID != _hnp.Key)
                        {
                            BuildDailyPercentagesContextmenu();
                        }
                        //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
						AddReoccurringImage();
						_dailyPercentagesIsPopulated = true;
					}
					else
						if (ugCharacteristics.Visible == true)
						{
							_nodeCharProfileList = SAB.HierarchyServerSession.GetProductCharacteristics(_hnp.Key, true);
							Characteristics_Populate(false);
                            //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                            if (oldNodeRID != _hnp.Key)
                            {
                                BuildCharacteristicsContextmenu();
                            }
                            //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
							_characteristicsIsPopulated = true;
						}
                    else
                        if (ugChainSetPercent.Visible == true)
                        {
                            //_chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(_storeList, _hnp.Key, false, false, _CSPweeks);
                            ChainSetPercent_GetUserSettings();
                            ChainSetPercent_Populate(false);
                            //Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                            if (oldNodeRID != _hnp.Key)
                            {
                                BuildChainSetPercentContextmenu();
                            }
                            //End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                            _chainSetPercentIsPopulated = true;
                        }
                    //  Begin TT#1401 - GRT - Reservation Stores
                    else
                        if (ugReservation.Visible == true)
                        {
                            //_storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, _hnp.Key, true, false);
                            _imoProfileList = _SAB.HierarchyServerSession.GetNodeIMOList(_storeList, _hnp.Key);
                            //StoreCapacity_Populate(false);
                            Reservation_Populate(false);
                            _reservationIsPopulated = true;
                        }
                    //  End TT#1401 - GRT - Reservation Stores
                }
				displayNodeFolderColor(_hnp.NodeColor, MIDGraphics.ClosedFolder);
				eDataState dataState;
				if (_nodeSecurity.AllowUpdate)
				{
					dataState = eDataState.Updatable;
				}
				else
				{
					dataState = eDataState.ReadOnly;
				}
				Format_Title(dataState, eMIDTextCode.frm_NodeProperties, _hnp.Text);
				_loadingWindow = false;
			}
			catch (HierarchyNodeConflictException)
			{
				throw;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        public void NewNode(MIDHierarchyNode aNode)
		{
			try
			{
				string nodeColor;
                _node = aNode;
                _nodeRID = aNode.Profile.Key;
				_loadingWindow = true;
				_nodeSecurity = new HierarchyNodeSecurityProfile(Include.NoRID);
				_nodeSecurity.SetFullControl();
				_IDSameAsName = true;
				_DescriptionSameAsName = true;
				DoValueByValueEdits = false;
                _parent = _SAB.HierarchyServerSession.GetNodeData(aNode.Profile.Key);
                _hp = _SAB.HierarchyServerSession.GetHierarchyData(aNode.HierarchyRID);
                _hpHome = _SAB.HierarchyServerSession.GetHierarchyData(_parent.HomeHierarchyRID);
                _hnp = new HierarchyNodeProfile(Include.NoRID);
                _hnp.HierarchyRID = aNode.HierarchyRID;
                _hnp.HomeHierarchyParentRID = aNode.Profile.Key;
                if (!_hnp.Parents.Contains(aNode.Profile.Key))
                {
                    _hnp.Parents.Add(aNode.Profile.Key);
                }
				_newNode = true;
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                //LoadCommon();
                LoadCommon(true);
                _allowEdit = false;
                _editEnabled = true;
                // End TT#2138
				_colorFound = false;
				_sizeFound = false;
				if (_hp.HierarchyType == eHierarchyType.alternate)
				{
					_hnp.NodeName = "New Node";
					this.txtDescription.Enabled = true;
					this.txtNodeID.Enabled = true;
					_hnp.LevelType = eHierarchyLevelType.Undefined;
					nodeColor = Include.MIDDefaultColor;
					this.lblColorGroup.Hide();
					this.txtColorGroup.Hide();
				}
				else
				{
					HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hp.HierarchyLevels[_parent.HomeHierarchyLevel + 1];
					_hnp.DisplayOption = hlp.LevelDisplayOption;
					nodeColor = hlp.LevelColor;
					if (hlp.LevelType == eHierarchyLevelType.Color)
					{
						_hnp.NodeName = MIDText.GetTextOnly(eMIDTextCode.lbl_ColorCode);
						this.txtDescription.Enabled = true;
						this.txtNodeID.Enabled = true;
						this.ActiveControl = this.txtNodeID;
						this.lblColorGroup.Show();
						this.txtColorGroup.Show();
					}
					else if (hlp.LevelType == eHierarchyLevelType.Size)
					{
						_hnp.NodeName = MIDText.GetTextOnly(eMIDTextCode.lbl_SizeCode);
						this.txtDescription.Enabled = true;
						this.txtNodeID.Enabled = true;
						this.txtNodeName.Enabled = false;
						this.ActiveControl = this.txtNodeID;
						this.lblColorGroup.Hide();
						this.txtColorGroup.Hide();
					}
					else
					{
						_hnp.NodeName = MIDText.GetTextOnly(eMIDTextCode.lbl_NewNode);
						this.txtDescription.Enabled = true;
						this.txtNodeID.Enabled = true;
						this.ActiveControl = this.txtNodeName;
						this.lblColorGroup.Hide();
						this.txtColorGroup.Hide();
					}
					_hnp.LevelType = hlp.LevelType;
				}
				_hnp.ProductType = eProductType.Undefined;
				this.radTypeUndefined.Checked = true;
				this.radBasicReplenishmentNo.Checked = true;
                // Begin TT#988 - JSmith - Add Active Only indicator to Override Low Level Model
                radActiveYes.Checked = true;
                // End TT#988
				ProfileTab_Load();
				displayNodeFolderColor(nodeColor, MIDGraphics.ClosedFolder);
				Format_Title(eDataState.New, eMIDTextCode.frm_NodeProperties ,null);
				ChangePending = true;
                btnApply.Enabled = false;
				_loadingWindow = false;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        // Begin TT#2138 - JSmith - Open Node Properties Read Only
        //private void LoadCommon()
        private void LoadCommon(bool aNewNode)
        // End TT#2138
		{
			try
			{
				ChangePending = false;
				btnApply.Enabled = false;
				ProfileChangesMade = false;
				OTSTypeChangesMade = false;
				OTSLevelChangesMade = false;
				ProductTypeChangesMade = false;
				_nameChanged = false;
				EligibilityChangesMade = false;
				StoreGradesChangesMade = false;
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				SizeCurvesCriteriaChangesMade = false;
				SizeCurvesMinAvgToleranceChangesMade = false;
				SizeCurvesHighLevelToleranceChangesMade = false;
				SizeCurvesSalesToleranceChangesMade = false;
				SizeCurvesIndexToleranceChangesMade = false;
				SizeCurvesMinPctToleranceChangesMade = false;
				SizeCurvesMaxPctToleranceChangesMade = false;
				SizeCurvesSimilarStoreChangesMade = false;
                //Begin TT#1401 - GRT - Reservation Stores
                ReservationChangesMade = false;
                //End TT#1401 - GRT - Reservation Stores
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				SizeOutOfStockSizeGroupChangesMade = false;
				SizeOutOfStockStoreGroupChangesMade = false;
				SizeOutOfStockQuantityChangesMade = false;
				SizeSellThruChangesMade = false;
				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				MinMaxesChangesMade = false;
				StoreCapacityChangesMade = false;
				VelocityGradesChangesMade = false;
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				VelocityMinMaxesChangesMade = false;
				//End TT#505 - JScott - Velocity - Apply Min/Max
				SellThruPctsChangesMade = false;
				DailyPercentagesChangesMade = false;
				DailyPurgeCriteriaChangesMade = false;
				WeeklyPurgeCriteriaChangesMade = false;
				OTSPurgeCriteriaChangesMade = false;
                //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                //HeadersPurgeCriteriaChangesMade = false;
                ASNHTPurgeCriteriaChangesMade = false; 
                DropShipHTPurgeCriteriaChangesMade = false;
                DummyHTPurgeCriteriaChangesMade = false; 
                ReceiptHTPurgeCriteriaChangesMade = false;
                PurchaseOrderHTPurgeCriteriaChangesMade = false;
                ReserveHTPurgeCriteriaChangesMade = false;
                VSWHTPurgeCriteriaChangesMade = false;
                WorkUpTotHTPurgeCriteriaChangesMade = false;
                //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                // set form form node maintenance level
				SetReadOnly(_nodeSecurity.AllowUpdate);

				int securityRID;
				if (_newNode)
				{
					securityRID = _hnp.HomeHierarchyParentRID;
				}
				else
				{
					securityRID =_hnp.Key;
				}

                if (_hpHome.HierarchyType == eHierarchyType.organizational)
				{
					_securityNodes = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodes, (int)eSecurityTypes.All);
					_securityNodeProperties = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodeProperty, (int)eSecurityTypes.All);
					_securityProfile = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyProfile, (int)eSecurityTypes.All);
					_securityEligibility = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyEligibility, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityStoreGrades = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyStoreGrades, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_securitySizeCurves = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertySizeCurves, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securitySizeOutOfStock = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertySizeOutOfStock, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securityStockMinMax = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyStockMinMax, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityVelocity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyVelocity, (int)eSecurityTypes.Allocation);
					_securityCapacity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyCapacity, (int)eSecurityTypes.Allocation);
					_securityDailyPcts = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyDailyPcts, (int)eSecurityTypes.Allocation);
					_securityPurge = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyPurge, (int)eSecurityTypes.All);
					_securityCharacteristics = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyCharacteristic, (int)eSecurityTypes.All);
                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    _securityChainSetPercent = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyChainSetPcts, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                    //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    // Begin TT#1401 - Reservation Stores - gtaylor
                    _securityIMO = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesOrgNodePropertyVSW, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                    // ENUMS need updating
                    // End TT#1401 - Reservation Stores - gtaylor
                }
                else if (_hpHome.Owner != Include.GlobalUserRID)
				{
					_securityNodes = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					_securityNodeProperties = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					_securityProfile = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					_securityEligibility = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityStoreGrades = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_securitySizeCurves = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securitySizeOutOfStock = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securityStockMinMax = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityVelocity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation);
					_securityCapacity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation);
					_securityDailyPcts = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation);
					_securityPurge = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
					_securityCharacteristics = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.All);
                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    _securityChainSetPercent = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                    //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    // Begin TT#1401 - Reservation Stores - gtaylor
                    _securityIMO = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltUser, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                    // End TT#1401 - Reservation Stores - gtaylor
				}
				else 
				{
					_securityNodes = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltNodes, (int)eSecurityTypes.All);
					_securityNodeProperties = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodeProperty, (int)eSecurityTypes.All);
					_securityProfile = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyProfile, (int)eSecurityTypes.All);
					_securityEligibility = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyEligibility, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityStoreGrades = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyStoreGrades, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_securitySizeCurves = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertySizeCurves, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securitySizeOutOfStock = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertySizeOutOfStock, (int)eSecurityTypes.All);
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securityStockMinMax = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyStockMinMax, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
					_securityVelocity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyVelocity, (int)eSecurityTypes.Allocation);
					_securityCapacity = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyCapacity, (int)eSecurityTypes.Allocation);
					_securityDailyPcts = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyDailyPcts, (int)eSecurityTypes.Allocation);
					_securityPurge = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyPurge, (int)eSecurityTypes.All);
					_securityCharacteristics = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyCharacteristic, (int)eSecurityTypes.All);
                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    _securityChainSetPercent = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyChainSetPcts, (int)eSecurityTypes.Allocation);
                    //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    // Begin TT#1401 - Reservation Stores - gtaylor
                    _securityIMO = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminHierarchiesAltGlobalNodePropertyVSW, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                    // End TT#1401 - Reservation Stores - gtaylor
                }

                //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
                _securityPurge.AddSecurityAction(eSecurityActions.ApplyChangesToLowerLevels);
                _securityPurge.SetDeny(eSecurityActions.ApplyChangesToLowerLevels);
                _securityCharacteristics.AddSecurityAction(eSecurityActions.ApplyChangesToLowerLevels);
                _securityCharacteristics.SetDeny(eSecurityActions.ApplyChangesToLowerLevels);
                //  END TT#2015 - gtaylor - apply changes to lower levels

                cbSEStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbSEStoreAttribute, _securityEligibility, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
                cbSCStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbSCStoreAttribute, _securityCapacity, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
                cbDPStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbDPStoreAttribute, _securityDailyPcts, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
                cbSMMStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbSMMStoreAttribute, _securityStockMinMax, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				cbSZStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbSZStoreAttribute, _securitySizeCurves, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
				//End TT#155 - JScott - Add Size Curve info to Node Properties
                //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                cbCSPStoreAttribute.Tag = new MIDStoreAttributeComboBoxTag(SAB, cbSCStoreAttribute, _securityCapacity, _hnp.HomeHierarchyOwner == SAB.ClientServerSession.UserRID);
                //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3

				_securityEligibilityModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminModelsEligibility, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
				_securitySalesModifierModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminModelsSalesModifier, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
				_securityStockModifierModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminModelsStockModifier, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
				_securityFWOSModifierModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminModelsFWOSModifier, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);

                //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                _securityFWOSMaxModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminFWOSMax, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);
                //END TT#108 - MD - DOConnell - FWOS Max Model

                // Begin TT#1401 - Reservation Stores - gtaylor
                // _securityIMOModels = _SAB.ClientServerSession.GetMyUserNodeFunctionSecurityAssignment(securityRID, eSecurityFunctions.AdminModelsVSW, (int)eSecurityTypes.Allocation | (int)eSecurityTypes.Store);// TT#203 - MD - Remove duplicate Enums entry 810660 - rbeck
                // End TT#1401 - Reservation Stores - gtaylor

				if (!_newNode &&
					_hnp.NodeLockStatus != eLockStatus.Locked)
				{
					_securityNodes.SetReadOnly();
					_securityNodeProperties.SetReadOnly();
					_securityProfile.SetReadOnly();
					_securityEligibility.SetReadOnly();
                    // Begin TT#1401 - Reservation Stores - gtaylor
                    _securityIMO.SetReadOnly();
                    // End TT#1401 - Reservation Stores - gtaylor
					_securityStoreGrades.SetReadOnly();
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_securitySizeCurves.SetReadOnly();
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securitySizeOutOfStock.SetReadOnly();
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securityVelocity.SetReadOnly();
					_securityCapacity.SetReadOnly();
					_securityDailyPcts.SetReadOnly();
					_securityPurge.SetReadOnly();
					_securityCharacteristics.SetReadOnly();
					_securityEligibilityModels.SetReadOnly();
					_securitySalesModifierModels.SetReadOnly();
					_securityStockModifierModels.SetReadOnly();
					_securityStockMinMax.SetReadOnly();
                    _securityChainSetPercent.SetReadOnly();
				}

				// set profile tab
				SetControlReadOnly(this.tabProfile, !_securityProfile.AllowUpdate);

                if (_securityNodes.AllowUpdate)
                {
                    txtNodeID.Enabled = true;
                    txtNodeName.Enabled = true;
                    txtDescription.Enabled = true;
                }
                else
                {
                    txtNodeID.Enabled = false;
                    txtNodeName.Enabled = false;
                    txtDescription.Enabled = false;
                }

                //  BEGIN TT#1399
                //  !!!! REMOVE THIS SETTING WHEN THIS DATA IS FETCHED
                //this.txtApplyNodePropsFrom.Text = "";
                //  !!!! REMOVE THIS SETTING WHEN THIS DATA IS FETCHED
                //  END TT#1399
				this.tabProfile.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Profile);
				this.tabStoreEligibility.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Eligibility);
				this.tabStoreGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Grades);
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				this.tabSizeCurves.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves);
				this.tabSizeCurvesCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Criteria);
				this.tabSizeCurvesTolerance.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Tolerance);
				this.tabSizeCurvesSimilarStore.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				this.tabVelocityGrades.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Velocity_Grades);
				this.tabStoreCapacity.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Capacity);
				this.tabDailyPercentages.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Daily_Percentages);
				this.tabPurgeCriteria.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Purge_Criteria);
				this.tabStockMinMax.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_MinMax);
                // Begin TT#234 MD - JSmith - Node Properties Out of Stock Tab appearance not as expected, save and hieracey service not available, tab says read only but security is full control, able to make changes when tab is read only.
                this.tabSizeOutOfStock.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OutOfStock);
                this.tabSizeOutOfStockParms.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_OutOfStock);
                this.tabSizeSellThru.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_SellThru);
                // End TT#234 MD

                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                this.tabCharacteristics.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Characteristics);
                this.tabReservation.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_ID);
                this.tabChainSetPct.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_ChainSetPercent);
                // End TT#2138
			
				if (this._nodeSecurity.AllowUpdate)
				{
					if (_securityProfile.IsReadOnly)
					{
						this.tabProfile.Text += " [Read Only]";
					}
					else if (_securityProfile.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabProfile);
					}

					if (_securityEligibility.IsReadOnly)
					{
						this.tabStoreEligibility.Text += " [Read Only]";
					}
					else if (_securityEligibility.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabStoreEligibility);
					}

					if (_securityStoreGrades.IsReadOnly)
					{
						this.tabStoreGrades.Text += " [Read Only]";
					}
					else if (_securityStoreGrades.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabStoreGrades);
					}

					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					if (_securitySizeCurves.IsReadOnly)
					{
						this.tabSizeCurves.Text += " [Read Only]";
					}
					else if (_securitySizeCurves.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabSizeCurves);
					}

					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					if (_securitySizeOutOfStock.IsReadOnly)
					{
						this.tabSizeOutOfStock.Text += " [Read Only]";
					}
					else if (_securitySizeOutOfStock.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabSizeOutOfStock);
					}

					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					if (_securityStockMinMax.IsReadOnly)
					{
						this.tabStockMinMax.Text += " [Read Only]";
					}
					else if (_securityStockMinMax.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabStockMinMax);
					}

					if (_securityVelocity.IsReadOnly)
					{
						this.tabVelocityGrades.Text += " [Read Only]";
					}
					else if (_securityVelocity.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabVelocityGrades);
					}

					if (_securityCapacity.IsReadOnly)
					{
						this.tabStoreCapacity.Text += " [Read Only]";
					}
					else if (_securityCapacity.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabStoreCapacity);
					}

					if (_securityDailyPcts.IsReadOnly)
					{
						this.tabDailyPercentages.Text += " [Read Only]";
					}
					else if (_securityDailyPcts.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabDailyPercentages);
					}

					if (_securityPurge.IsReadOnly)
					{
						this.tabPurgeCriteria.Text += " [Read Only]";
					}
					else if (_securityPurge.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabPurgeCriteria);
					}

					if (_securityCharacteristics.IsReadOnly)
					{
						this.tabCharacteristics.Text += " [Read Only]";
					}
					else if (_securityCharacteristics.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabCharacteristics);
					}

                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    if (_securityChainSetPercent.IsReadOnly)
                    {
                        this.tabChainSetPct.Text += " [Read Only]";
                    }
                    else if (_securityChainSetPercent.AccessDenied)
                    {
                        this.tabNodeProperties.Controls.Remove(this.tabChainSetPct);
                    }
                    //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
					
                    // Begin TT#1401 - Reservation Stores - gtaylor
                    if (_securityIMO.IsReadOnly)
					{
						this.tabReservation.Text += " [Read Only]";
					}
					else if (_securityIMO.AccessDenied)
					{
						this.tabNodeProperties.Controls.Remove(this.tabReservation);
					}
                    // End TT#1401 - Reservation Stores - gtaylor
				}

				//Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				if (_hnp.HomeHierarchyOwner != Include.GlobalUserRID)
				{
					this.tabNodeProperties.Controls.Remove(this.tabSizeCurves);
				}
				else
				{
					if (!tabNodeProperties.Controls.Contains(this.tabSizeCurves))
					{
						this.tabNodeProperties.Controls.Add(this.tabSizeCurves);
					}
				}

				//End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (_hnp.LevelType == eHierarchyLevelType.Size)
				{
					this.tabNodeProperties.Controls.Remove(this.tabSizeOutOfStock);
				}
				else
				{
					if (!tabNodeProperties.Controls.Contains(this.tabSizeOutOfStock))
					{
						this.tabNodeProperties.Controls.Add(this.tabSizeOutOfStock);
					}
				}

                // Begin TT#251-MD - JSmith - Remove Out of Stock tab in Node Properties until can be reviewed in 5.1
                if (tabNodeProperties.Controls.Contains(this.tabSizeOutOfStock))
                {
                    this.tabNodeProperties.Controls.Remove(this.tabSizeOutOfStock);
                }
                // End TT#251-MD - JSmith - Remove Out of Stock tab in Node Properties until can be reviewed in 5.1

				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				this.btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);

				if (_securityProfile.AllowUpdate ||
					_securityEligibility.AllowUpdate ||
					_securityStoreGrades.AllowUpdate ||
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					_securitySizeCurves.AllowUpdate ||
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securitySizeOutOfStock.AllowUpdate ||
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					_securityVelocity.AllowUpdate ||
					_securityCapacity.AllowUpdate ||
					_securityDailyPcts.AllowUpdate ||
					_securityPurge.AllowUpdate ||
					_securityStockMinMax.AllowUpdate ||
					_securityCharacteristics.AllowUpdate)
				{
					this.btnOK.Enabled = true;
				}
				else
				{
					this.btnOK.Enabled = false;
					this.btnApply.Enabled = false;
				}

                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                if (!aNewNode)
                {
                    if (_allowEdit)
                    {
                        btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Edit);
                        btnApply.Enabled = true;
                        _editEnabled = false;
                    }
                }
                else
                {
				//Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                    if (_allowEdit)
                    {
                        btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Edit);
                        btnApply.Enabled = true;
                        _editEnabled = false;
                    }
                    else
                    {
                    _editEnabled = true;
                        }
				//End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                }
                // End TT#2138

				SetApplySecurity(cbxSEInheritFromHigherLevel, cbxSEApplyToLowerLevels, rbApplyChangesToLowerLevelsElig, _securityEligibility);
				SetApplySecurity(cbxSGInheritFromHigherLevel, cbxSGApplyToLowerLevels, _securityStoreGrades);
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				SetApplySecurity(cbxSZCriteriaInheritFromHigherLevel, cbxSZCriteriaApplyToLowerLevels, _securitySizeCurves);
				SetApplySecurity(cbxSZToleranceInheritFromHigherLevel, cbxSZToleranceApplyToLowerLevels, _securitySizeCurves);
				SetApplySecurity(cbxSZSimilarStoreInheritFromHigherLevel, cbxSZSimilarStoreApplyToLowerLevels, _securitySizeCurves);
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				SetApplySecurity(cbxSMMInheritFromHigherLevel, cbxSMMApplyToLowerLevels, _securityStockMinMax);
				SetApplySecurity(cbxVGInheritFromHigherLevel, cbxVGApplyToLowerLevels, _securityVelocity);
				SetApplySecurity(cbxSCInheritFromHigherLevel, cbxSCApplyToLowerLevels, rbApplyChangesToLowerLevelsSC, _securityCapacity);
				SetApplySecurity(cbxDPInheritFromHigherLevel, cbxDPApplyToLowerLevels, rbApplyChangesToLowerLevelsDailyPct, _securityDailyPcts);
				SetApplySecurity(cbxPCInheritFromHigherLevel, cbxPCApplyToLowerLevels, rbApplyChangesToLowerLevelsPurge, _securityPurge);
                SetApplySecurity(cbxCHInheritFromHigherLevel, cbxCHApplyToLowerLevels, rbApplyChangesToLowerLevelsChar, _securityCharacteristics);
                //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                SetApplySecurity(cbxCSPInheritFromHigherLevel, cbxCSPApplyToLowerLevels, rbApplyChangesToLowerLevelsChainSet, _securityChainSetPercent);
                //End TT#1671 - DOConnell - Chain Set Percent Node Properties
                SetApplySecurity(cbxRsrvInheritFromHigherLevel, cbxApplyToLowerLevels, rbApplyChangesToLowerLevelsIMO, _securityIMO);   // TT#1401 - Reservation Stores - gtaylor

//Begin  TT#7 - MD - RBeck _ Dynamic download

                AdjustTextWidthComboBox_DropDown(cbSMMStoreAttribute);     
                AdjustTextWidthComboBox_DropDown(cbSCStoreAttribute);     
                AdjustTextWidthComboBox_DropDown(cbDPStoreAttribute);     
                AdjustTextWidthComboBox_DropDown(cbSZStoreAttribute);     
                AdjustTextWidthComboBox_DropDown(cboSZOOSStoreAttribute);     
                AdjustTextWidthComboBox_DropDown(cbCSPStoreAttribute);    
                AdjustTextWidthComboBox_DropDown(midAttributeCbx);     
                AdjustTextWidthComboBox_DropDown(cbSEStoreAttribute);
    
//End    TT#7 - MD - RBeck _ Dynamic download

            }
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        // BEGIN TT#2015 - Apply Changes to Lower Levels - GTaylor
        private void SetApplySecurity(RadioButton aHighLevelRadioButton, RadioButton aLowLevelRadioButton, RadioButton aLowLevelChangesRadioButton,
            FunctionSecurityProfile aSecurityProfile)
        {
            if (_hnp.HomeHierarchyLevel == 0 ||
                !aSecurityProfile.AllowInheritFromHigherLevel)
            {
                aHighLevelRadioButton.Visible = false;
            }
            else
            {
                aHighLevelRadioButton.Visible = true;
            }

            if (!aSecurityProfile.AllowApplyChangesToLowerLevels)
            {
                aLowLevelChangesRadioButton.Visible = false;
            }
            else
            {
                aLowLevelChangesRadioButton.Visible = true;
            }

            if (!aSecurityProfile.AllowApplyToLowerLevels)
            {
                aLowLevelRadioButton.Visible = false;
            }
            else
            {
                aLowLevelRadioButton.Visible = true;
            }
        }
        // END TT#2015 - Apply Changes to Lower Levels - GTaylor

		private void SetApplySecurity(CheckBox aHighLevelCheckbox, CheckBox aLowLevelCheckbox, 
			FunctionSecurityProfile aSecurityProfile)
		{
			if (_hnp.HomeHierarchyLevel == 0 ||
				!aSecurityProfile.AllowInheritFromHigherLevel)
			{
				aHighLevelCheckbox.Visible = false;
			}
			else
			{
				aHighLevelCheckbox.Visible = true;
			}

			if (!aSecurityProfile.AllowApplyToLowerLevels)
			{
				aLowLevelCheckbox.Visible = false;
			}
			else
			{
				aLowLevelCheckbox.Visible = true;
			}
		}

		private void displayNodeFolderColor(string name, string folderExtension)
		{
			Image image;
			try
			{
				name = GraphicsDirectory + "\\" + name + folderExtension;
				
				if (!System.IO.File.Exists(name))
				{
					name = GraphicsDirectory + "\\" + Include.MIDDefaultColor + folderExtension;
				}

				image = Image.FromFile(name);
				int imageWidth = image.Width;
				int imageHeight = image.Height;

				SizeF sizef = new SizeF(imageHeight / image.HorizontalResolution,
					imageWidth / image.VerticalResolution);
				float fScale = Math.Min(_buttonWidth / sizef.Width,
					_buttonHeight / sizef.Height);
				sizef.Width *= fScale;
				sizef.Height *= fScale;
				Size size = Size.Ceiling(sizef);
				Bitmap bitmap = new Bitmap(image, size);
				picNodeColor.Image = bitmap;
				picNodeColor.Size = new Size(_buttonWidth, _buttonHeight);
			}

			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtNodeName_Enter(object sender, System.EventArgs e)
		{
			try
			{
				// If ID is the same as name mirror changes in ID
				_IDSameAsName = (this.txtNodeID.Text == this.txtNodeName.Text);
			
				// If description is the same as name mirror changes in ID
				_DescriptionSameAsName =  (this.txtDescription.Text == this.txtNodeName.Text);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtNodeName_Leave(object sender, System.EventArgs e)
		{
		}

		private void txtNodeID_Leave(object sender, System.EventArgs e)
		{
			try
			{
				_colorFound = false;
				_sizeFound = false;
				if (_hnp.LevelType == eHierarchyLevelType.Color)
				{
					ColorCodeProfile ccp = _SAB.HierarchyServerSession.GetColorCodeProfile(this.txtNodeID.Text);
					if (ccp.Key == Include.NoRID)
					{
						_colorFound = false;
					}
					else
					{
						int colorNodeRID = Include.NoRID;
						_colorFound = true;
						this.txtNodeName.Text = ccp.ColorCodeName;
						this.txtColorGroup.Text = ccp.ColorCodeGroup;
						_hnp.ColorOrSizeCodeRID = ccp.Key;
						ErrorProvider.SetError (this.txtNodeID,string.Empty);
                        if (_SAB.HierarchyServerSession.ColorExistsForStyle(_parent.HomeHierarchyRID, _parent.Key, this.txtNodeName.Text, ref colorNodeRID))
                        {
                            HierarchyNodeProfile color_hnp = _SAB.HierarchyServerSession.GetNodeData(colorNodeRID);
                            this.txtDescription.Text = color_hnp.NodeDescription;
                            _newNode = false;
                        }
                        // Begin TT#103 MD - JSmith - Color and Size Description not updating correcty when manually adding in Merch Explorer
                        else
                        {
                            this.txtDescription.Text = ccp.ColorCodeName;
                        }
                        // End TT#103 MD
					}

				}
				else
					if (_hnp.LevelType == eHierarchyLevelType.Size)
				{
					SizeCodeProfile scp = _SAB.HierarchyServerSession.GetSizeCodeProfile(this.txtNodeID.Text);
					if (scp.Key == Include.NoRID)
					{
						_sizeFound = false;
					}
					else
					{
						int sizeNodeRID = Include.NoRID;
						_sizeFound = true;
						this.txtNodeName.Text = scp.SizeCodeName;
						_hnp.ColorOrSizeCodeRID = scp.Key;
						ErrorProvider.SetError (this.txtNodeID,string.Empty);
						if(_SAB.HierarchyServerSession.ColorExistsForStyle(_parent.HomeHierarchyRID, _parent.Key, this.txtNodeName.Text, ref sizeNodeRID))
						{
							HierarchyNodeProfile size_hnp = _SAB.HierarchyServerSession.GetNodeData(sizeNodeRID);
							this.txtDescription.Text = size_hnp.NodeDescription;
							_newNode = false;
						}
                        // Begin TT#103 MD - JSmith - Color and Size Description not updating correcty when manually adding in Merch Explorer
                        else
                        {
                            this.txtDescription.Text = scp.SizeCodeName;
                        }
                        // End TT#103 MD
					}
				}
				else
					if (_newNode || txtNodeID.Text != _hnp.NodeID)  // make sure ID is unique
				{
					HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(txtNodeID.Text);
					if (hnp.Key != Include.NoRID)
					{
						string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NodeIDAlreadyExists);
						MessageBox.Show (error, this.Text,
							MessageBoxButtons.OK, MessageBoxIcon.Error);
						ErrorProvider.SetError (this.txtNodeID,error);
					}
					else
					{
						ErrorProvider.SetError (this.txtNodeID,string.Empty);
					}
				}
				else
				{
					EditMsgs em = new EditMsgs();
					if (!NodeIDIsValid(ref em, txtNodeID.Text))
					{
						for (int i=0; i<em.EditMessages.Count; i++)
						{
							EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
							AddErrorMessage(emm);
						}
						MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						ErrorProvider.SetError (this.txtNodeID,_errors);
					}
					else
					{
						ErrorProvider.SetError (this.txtNodeID,string.Empty);
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
        private void SetNoAction()
        {
            this.rbNoActionChar.Checked = true; // Characteristics
            this.rbNoActionCSP.Checked = true;  // Chain Set Percent
            this.rbNoActionDP.Checked = true;   // Daily Percentages
            this.rbNoActionIMO.Checked = true;  // VSW/IMO
            this.rbNoActionPC.Checked = true;   // Purge Criteria
            this.rbNoActionSC.Checked = true;   // Store Capacity
            this.rbNoActionSE.Checked = true;   // Store Eligibility
        }
        //  END TT#2015 - gtaylor - apply changes to lower levels
		#region Profile Tab

		private void ProfileTab_Load()
		{
			try
			{
                //BEGIN TT#4984 - BVaughan - Change Hierarchy in Organizational Hierarchy to be an Alternte.  If focus on a different node the Alternate Hierarhcy will appear even though nothing was changed.
                ClearProfileTabControls();
                //END TT#4984

                // BEGIN TT#2015
                SetNoAction();
                // END TT#2015

                //  BEGIN TT#1399
                txtApplyNodePropsFrom.Tag = new MIDMerchandiseTextBoxTag(SAB, txtApplyNodePropsFrom, eMIDControlCode.form_NodeProperties, (eSecurityTypes.Chain | eSecurityTypes.Store | eSecurityTypes.Allocation), eSecuritySelectType.View);
                HierarchyNodeProfile inheritanceProfile = null;
                string inheritMsg = null;
                //  END TT#1399
				this.txtDescription.Text = _hnp.NodeDescription;
				this.txtNodeID.Text = _hnp.NodeID;
				this.txtNodeName.Text = _hnp.NodeName;
                this.gbxApplyNodeProperties.Enabled = (!(_hnp.HomeHierarchyType == eHierarchyType.organizational));
                // BEGIN TT#1399 - GRT - Alternate Hierarchy Inherit Node Properties
                if (_hnp.ApplyHNRIDFrom != Include.NoRID)
                {
                    this.txtApplyNodePropsFrom.Text = _SAB.HierarchyServerSession.GetNodeData(_hnp.ApplyHNRIDFrom, false).Text;
                    if (_hnp.ApplyFromInherited != eInheritedFrom.None)
                    {
                        inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.ApplyFromInheritedFrom);
                        switch (_hnp.ApplyFromInherited)
                        {
                            case eInheritedFrom.Node:
                                //if (_hnp.Key != _hnp.NodeInheritedFrom &&
                                //    inheritanceProfile.Key != _hnp.NodeInheritedFrom)
                                //{
                                //    hnProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.NodeInheritedFrom);
                                //    if (_hnp.NodeInheritedFrom != Include.NoRID)
                                //        inheritMsg = _txtInheritedFrom + hnProfile.Text;
                                //    else
                                //        inheritMsg = string.Empty;
                                //}
                                //else
                                //{
                                //    inheritMsg = string.Empty;
                                //}
                                //if (inheritanceProfile == null ||
                                //    inheritanceProfile.Key != _hnp.NodeInheritedFrom)
                                //{
                                //inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.NodeInheritedFrom);
                                if (_hnp.ApplyFromInheritedFrom != -1)
                                    inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                                else
                                    inheritMsg = string.Empty;
                                //}
                                //else
                                //{
                                //    inheritMsg = string.Empty;
                                //}
                                InheritanceProvider.SetError(this.gbxApplyNodeProperties, inheritMsg);
                                break;
                            default:
                                InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                                break;
                        }
                    }
                }
                else
                {
                //    this.txtApplyNodePropsFrom.Tag = null;
                    this.txtApplyNodePropsFrom.Text = string.Empty;
                    InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                }
                // END TT#1399
				switch (_hnp.ProductType)
				{
					case eProductType.Hardline:
						this.radTypeHardline.Checked = true;
						break;
					case eProductType.Softline:
						this.radTypeSoftline.Checked = true;
						break;
					default:
						this.radTypeUndefined.Checked = true;
						break;
				}
				
				switch (_hnp.ProductTypeInherited)
				{
					case eInheritedFrom.Node:
						if (inheritanceProfile == null || 
							inheritanceProfile.Key != _hnp.ProductTypeInheritedFrom)
						{
							inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.ProductTypeInheritedFrom);
						}
						inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
						InheritanceProvider.SetError (this.gbxProductType,inheritMsg);
						break;
					case eInheritedFrom.HierarchyLevel:
                        // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                        //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.ProductTypeInheritedFrom];
                        HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                        HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.ProductTypeInheritedFrom];
                        // End TT#1959
						inheritMsg = _txtInheritedFrom + hlp.LevelID;
						InheritanceProvider.SetError (this.gbxProductType,inheritMsg);
						break;
					default:
						InheritanceProvider.SetError (this.gbxProductType,string.Empty);
						break;
				}

				if (_hnp.LevelType != eHierarchyLevelType.Size && _hnp.HomeHierarchyType != eHierarchyType.alternate)
				{
					if (_hnp.OTSPlanLevelAnchorNode != Include.NoRID)
					{
						txtOTSAnchorNode.Text = _SAB.HierarchyServerSession.GetNodeText(_hnp.OTSPlanLevelAnchorNode);
						txtOTSAnchorNode.Tag = _hnp.OTSPlanLevelAnchorNode;
					}

					if (_hnp.OTSPlanLevelHierarchyLevelSequence > Include.Undefined)
					{
						BuildOTSLevelList();
					}

					if (_hnp.OTSPlanLevelSelectType == ePlanLevelSelectType.HierarchyLevel)
					{
						this.radOTSLevel.Checked = true;
					}
					else
					{
						this.radOTSNode.Checked = true;
					}

					switch (_hnp.OTSPlanLevelMaskField)
					{
						case eMaskField.Name:
							this.radOTSContainsName.Checked = true;
							break;
						case eMaskField.Description:
							this.radOTSContainsDescription.Checked = true;
							break;
						default:
							this.radOTSContainsID.Checked = true;
							break;
					}

					this.txtOTSLevelString.Text = _hnp.OTSPlanLevelMask;

					switch (_hnp.OTSPlanLevelInherited)
					{
						case eInheritedFrom.Node:
							if (inheritanceProfile == null || 
								inheritanceProfile.Key != _hnp.OTSPlanLevelInheritedFrom)
							{
								inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.OTSPlanLevelInheritedFrom);
							}
							inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
							InheritanceProvider.SetError (this.gbxOTSProduct,inheritMsg);
							break;
						default:
							InheritanceProvider.SetError (this.gbxOTSProduct,string.Empty);
							break;
					}

					if (_securityProfile.AllowUpdate)
					{
						this.gbxOTSProduct.Enabled = true;
						this.txtOTSAnchorNode.Enabled = true;
						if (this.radOTSLevel.Checked)
						{
							this.cboOTSLevel.Enabled = true;
							this.gbxOTSNode.Enabled = false;
						}
						else
						{
							this.cboOTSLevel.Enabled = false;
							this.gbxOTSNode.Enabled = true;
							this.txtOTSLevelString.Enabled = true;
						}
					}
				}
				else
				{
					this.cboOTSLevel.DataSource = null;
					this.cboOTSLevel.Text = null;
					this.cboOTSLevel.Enabled = false;
					this.txtOTSAnchorNode.Text = null;
					this.txtOTSAnchorNode.Enabled = false;
					this.gbxOTSProduct.Enabled = false;
					this.txtOTSLevelString.Text = null;
					this.txtOTSLevelString.Enabled = false;
					this.radOTSLevel.Checked = false;
					this.radOTSNode.Checked = false;
					this.radOTSContainsID.Checked = false;
					this.radOTSContainsName.Checked = false;
					this.radOTSContainsDescription.Checked = false;
					InheritanceProvider.SetError (this.gbxOTSProduct,string.Empty);
				}

				switch (_hnp.OTSPlanLevelType)
				{
					case eOTSPlanLevelType.Regular:
						this.chkOTSTypeOverrideRegular.Checked = true;
						break;
					case eOTSPlanLevelType.Total:
						this.chkOTSTypeOverrideTotal.Checked = true;
						break;
					default:
						break;
				}

				switch (_hnp.OTSPlanLevelTypeInherited)
				{
					case eInheritedFrom.Node:
						if (inheritanceProfile == null || 
							inheritanceProfile.Key != _hnp.OTSPlanLevelTypeInheritedFrom)
						{
							inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.OTSPlanLevelTypeInheritedFrom);
						}
						inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
						InheritanceProvider.SetError (this.gbxOTSType,inheritMsg);
						break;
					case eInheritedFrom.HierarchyLevel:
                        // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                        //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.OTSPlanLevelTypeInheritedFrom];
                        HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                        HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.OTSPlanLevelTypeInheritedFrom];
                        // End TT#1959
						inheritMsg = _txtInheritedFrom + hlp.LevelID;
						InheritanceProvider.SetError (this.gbxOTSType,inheritMsg);
						break;
					case eInheritedFrom.HierarchyDefaults:
						inheritMsg = _txtInheritedFrom + "Hierarchy Defaults";
						InheritanceProvider.SetError (this.gbxOTSType,inheritMsg);
						break;
					default:
						InheritanceProvider.SetError (this.gbxOTSType,string.Empty);
						break;
				}

				if (_hnp.UseBasicReplenishment)
				{
					this.radBasicReplenishmentYes.Checked = true;
				}
				else
				{
					this.radBasicReplenishmentNo.Checked = true;
				}

                // Begin TT#988 - JSmith - Add Active Only indicator to Override Low Level Model
                if (_hnp.Active)
                {
                    radActiveYes.Checked = true;
                }
                else
                {
                    radActiveNo.Checked = true;
                }
                // End TT#988
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildOTSLevelList()
		{
			int i;
			int levelIndex = 0;
			HierarchyLevelComboObject valItem;
			HierarchyNodeProfile anchorNodeProfile = null;
			
			try
			{

				if (_hnp.OTSPlanLevelAnchorNode != Include.NoRID)
				{
					anchorNodeProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.OTSPlanLevelAnchorNode);
				}

				// Load Level arrays

				cboOTSLevel.Items.Clear();
				cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.Undefined, Include.NoRID, Include.NoRID, "Undefined"));
				++levelIndex;

				if (_hnp.OTSPlanLevelAnchorNode == Include.NoRID ||
					(anchorNodeProfile != null && 
					anchorNodeProfile.HomeHierarchyType == eHierarchyType.organizational)
					)
				{
					cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.Undefined,_hpHome.Key, 0, _hpHome.HierarchyID));
					++levelIndex;

					for (i = 1; i <= _hpHome.HierarchyLevels.Count; i++)
					{
						if (((HierarchyLevelProfile)_hpHome.HierarchyLevels[i]).LevelType != eHierarchyLevelType.Size)
						{
							cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.HierarchyLevel, _hpHome.Key, ((HierarchyLevelProfile)_hpHome.HierarchyLevels[i]).Key, ((HierarchyLevelProfile)_hpHome.HierarchyLevels[i]).LevelID));
							++levelIndex;
						}
					}
				}
				else
				{
					cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.LevelOffset, anchorNodeProfile.Key, 0, anchorNodeProfile.Text, anchorNodeProfile.Text));
					++levelIndex;
					HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();

					int highestGuestLevel = _SAB.HierarchyServerSession.GetHighestGuestLevel(_hnp.OTSPlanLevelAnchorNode);

					// add guest levels to comboBox
					if (highestGuestLevel != int.MaxValue)
					{
						for (i = highestGuestLevel; i <= mainHierProf.HierarchyLevels.Count; i++)
						{
							if (i == 0)
							{
								//Begin TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
								//cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.HierarchyLevel, mainHierProf.Key, 0, "Root"));
								cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.HierarchyLevel, mainHierProf.Key, 0, _hpHome.HierarchyID));
								//End TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
								++levelIndex;
							}
							else
							{
								HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[i];
								if (hlp.LevelType != eHierarchyLevelType.Size)
								{
									cboOTSLevel.Items.Add(new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.HierarchyLevel, mainHierProf.Key, ((HierarchyLevelProfile)mainHierProf.HierarchyLevels[i]).Key, ((HierarchyLevelProfile)mainHierProf.HierarchyLevels[i]).LevelID));
									++levelIndex;
								}
							}
						}
					}

					// add offsets to comboBox
					
                    //BEGIN TT#4689 - DOConnell - OTS Forecast - Multi-Level Low Levels not being populated correctly
                    //int longestBranchCount = _SAB.HierarchyServerSession.GetLongestBranch(_hnp.OTSPlanLevelAnchorNode);
                    DataTable hierarchyLevels = _SAB.HierarchyServerSession.GetHierarchyDescendantLevels(_hnp.OTSPlanLevelAnchorNode);
                    int longestBranchCount = hierarchyLevels.Rows.Count - 1;
                    //END TT#4689 - DOConnell - OTS Forecast - Multi-Level Low Levels not being populated correctly
					int offset = 0;
					for (i = 0; i < longestBranchCount; i++)
					{
						++offset;
						cboOTSLevel.Items.Add(
							new HierarchyLevelComboObject(levelIndex, ePlanLevelLevelType.LevelOffset,
							anchorNodeProfile.HomeHierarchyRID,
							offset,
							null));
						++levelIndex;
					}
				}

				for (i = 0; i < cboOTSLevel.Items.Count; i++)
				{
					valItem = (HierarchyLevelComboObject)cboOTSLevel.Items[i];

					if (_hnp.OTSPlanLevelLevelType == valItem.PlanLevelLevelType && valItem.HierarchyRID == _hnp.OTSPlanLevelHierarchyRID && valItem.Level == _hnp.OTSPlanLevelHierarchyLevelSequence)
					{
						cboOTSLevel.SelectedIndex = i;
						break;
					}
				}

				if (i == cboOTSLevel.Items.Count)
				{
					cboOTSLevel.SelectedIndex = 0;
				}
			}
			catch (Exception exc)
			{
				string message = exc.ToString();
				throw;
			}
		}

		private void cbxOTSTypeOverrideRegular_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (!_checkBoxChanging)
				{
					_checkBoxChanging = true;

					if (FormLoaded && !_loadingWindow)
					{
						OTSTypeChangesMade = true;
						InheritanceProvider.SetError(this.gbxOTSType, string.Empty);
					}

					if (chkOTSTypeOverrideRegular.Checked)
					{
						chkOTSTypeOverrideTotal.Checked = false;
					}

					_checkBoxChanging = false;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void cbxOTSTypeOverrideTotal_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (!_checkBoxChanging)
				{
					_checkBoxChanging = true;

					if (FormLoaded && !_loadingWindow)
					{
						OTSTypeChangesMade = true;
						InheritanceProvider.SetError(this.gbxOTSType, string.Empty);
					}

					if (chkOTSTypeOverrideTotal.Checked)
					{
						chkOTSTypeOverrideRegular.Checked = false;
					}

					_checkBoxChanging = false;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtOTSAnchorNode_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
		{
			try
			{
				if (e.KeyCode == Keys.OemQuestion && (e.Control && e.Shift)) 
				{
					string message = string.Empty;
					string anchorName = "None";
					string levelName = "None";
					HierarchyProfile mainHierarchy = _SAB.HierarchyServerSession.GetMainHierarchyData();
					NodeAncestorList nal = _SAB.HierarchyServerSession.GetPlanLevelPath(_hnp.Key);
					HierarchyNodeProfile planLevelNode = _SAB.HierarchyServerSession.GetPlanLevelData(_hnp.Key);
					if (_hnp.OTSPlanLevelAnchorNode != Include.NoRID)
					{
						HierarchyNodeProfile anchor = _SAB.HierarchyServerSession.GetNodeData(_hnp.OTSPlanLevelAnchorNode, false);
						anchorName = anchor.Text;
					}
					if (planLevelNode == null)
					{
						message = "Plan Level Node can not be determined" + System.Environment.NewLine;
					}
					else
					{
						message = "Plan Level Node is = " + planLevelNode.Text + System.Environment.NewLine;
					}
					if (_hnp.OTSPlanLevelHierarchyLevelSequence != Include.Undefined)
					{
						if (_hnp.OTSPlanLevelLevelType == ePlanLevelLevelType.HierarchyLevel)
						{
							HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierarchy.HierarchyLevels[_hnp.OTSPlanLevelHierarchyLevelSequence];
							levelName = hlp.LevelID;
						}
						else if (_hnp.OTSPlanLevelLevelType == ePlanLevelLevelType.LevelOffset)
						{
							levelName = "+" + _hnp.OTSPlanLevelHierarchyLevelSequence.ToString();
						}
					}
					message += "  Settings: " + System.Environment.NewLine;
					message += "     Hierarchy   = " + anchorName + System.Environment.NewLine;
					message += "     Select type = " + _hnp.OTSPlanLevelSelectType.ToString() + System.Environment.NewLine;
					message += "     Level type  = " + _hnp.OTSPlanLevelLevelType.ToString() + System.Environment.NewLine;
					message += "     Level       = " + levelName + System.Environment.NewLine;
					message += "     Node Field  = " + _hnp.OTSPlanLevelMaskField.ToString() + System.Environment.NewLine;
					if (_hnp.OTSPlanLevelMask == null)
					{
						message += "     Node Mask   = " + System.Environment.NewLine;
					}
					else
					{
						message += "     Node Mask   = " + _hnp.OTSPlanLevelMask.ToString() + System.Environment.NewLine;
					}
					message += "  Search Path: " + System.Environment.NewLine;
					if (nal.Count == 1)
					{
						message += "     Node is not in path.  Check hierarchy."+ System.Environment.NewLine;
					}
					else
					{
						foreach (NodeAncestorProfile nap in nal)
						{
							HierarchyNodeProfile ancestor = _SAB.HierarchyServerSession.GetNodeData(nap.Key, false);
							message += "     " + ancestor.Text + System.Environment.NewLine;
						}
					}
					MessageBox.Show(message);
					e.Handled = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtOTSAnchorNode_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
		{
			_needsValidated = true;
			ErrorProvider.SetError(txtOTSAnchorNode, string.Empty);
			InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
		}

		private void txtOTSAnchorNode_Validating(object sender, System.ComponentModel.CancelEventArgs e)
		{
			try
			{
				string errorMessage;
				if (_needsValidated)
				{
					if (((TextBox)sender).Text.Trim().Length == 0)
					{
						((TextBox)sender).Text = string.Empty;
						txtOTSAnchorNode.Tag = Include.NoRID;
						_hnp.OTSPlanLevelAnchorNode = Include.NoRID;
						BuildOTSLevelList();
						OTSLevelChangesMade = true;
					}
					else
					{
						HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(((TextBox)sender).Text);
						if ((hnp.HomeHierarchyType == eHierarchyType.organizational &&
							hnp.HomeHierarchyLevel == 0) ||
							hnp.HomeHierarchyType == eHierarchyType.alternate)
						{
							((TextBox)sender).Text = hnp.Text;
							txtOTSAnchorNode.Tag = hnp.Key;
							_hnp.OTSPlanLevelAnchorNode = hnp.Key;
							BuildOTSLevelList();
							OTSLevelChangesMade = true;
							InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
						}
						else 
						{
							errorMessage = string.Format(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InvalidOTSHierarchy),
								((TextBox)sender).Text );	
							ErrorProvider.SetError((TextBox)sender,errorMessage);
							MessageBox.Show( errorMessage);
							e.Cancel = true;
						}
					}
				}
				else if (((TextBox)sender).Text.Trim().Length == 0 &&
					txtOTSAnchorNode.Tag != null &&
					Convert.ToInt32(txtOTSAnchorNode.Tag) != Include.NoRID)
				{
					((TextBox)sender).Text = string.Empty;
					txtOTSAnchorNode.Tag = Include.NoRID;
					_hnp.OTSPlanLevelAnchorNode = Include.NoRID;
					BuildOTSLevelList();
					OTSLevelChangesMade = true;
				}
			}
			catch (Exception exc)
			{
				HandleException(exc);
			}
			finally
			{
				_needsValidated = false;
			}
		}

		private void txtOTSAnchorNode_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
			try
			{
                Image_DragEnter(sender, e);
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
				{
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(cbList.ClipboardProfile.Key, true, true);
					if ((hnp.HomeHierarchyType == eHierarchyType.organizational &&
						hnp.HomeHierarchyLevel == 0) ||
						hnp.HomeHierarchyType == eHierarchyType.alternate)
					{
						e.Effect = DragDropEffects.All;
					}
					else
					{
						e.Effect = DragDropEffects.None;
					}
				}
				else
				{
					e.Effect = DragDropEffects.None;
				}
			}
			catch (Exception exc)
			{
				HandleException(exc);
			}
		}

		private void txtOTSAnchorNode_DragOver(object sender, System.Windows.Forms.DragEventArgs e)
		{
            Image_DragOver(sender, e);
		}

		private void txtOTSAnchorNode_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList;

			try
			{
                //// Create a new instance of the DataObject interface.

                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));

                    if (cbList.ClipboardDataType == eProfileType.HierarchyNode)
					{
						HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(cbList.ClipboardProfile.Key);
						((TextBox)sender).Text = hnp.Text;
						txtOTSAnchorNode.Tag = hnp.Key;
						_hnp.OTSPlanLevelAnchorNode = hnp.Key;
						BuildOTSLevelList();
						OTSLevelChangesMade = true;
						InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
					}
					else
					{
						MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNodeToDrop));
					}
				}
				else
				{
					MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNodeToDrop));
				}
			}
			catch (Exception exc)
			{
				HandleException(exc);
			}
		}

		private void cboOTSLevel_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded && !_loadingWindow)
				{
					OTSLevelChangesMade = true;
					InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void radOTSLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			if (_securityProfile.AllowUpdate)
			{
				if (radOTSLevel.Checked)
				{
					if (_securityProfile.AllowUpdate)
					{
						cboOTSLevel.Enabled = true;
					}
					gbxOTSNode.Enabled = false;
					ErrorProvider.SetError(this.txtOTSLevelString, string.Empty);
				}
				else
				{
					cboOTSLevel.Enabled = false;
					if (_securityProfile.AllowUpdate)
					{
						gbxOTSNode.Enabled = true;
					}
				}
			}

			if (FormLoaded && !_loadingWindow)
			{
				BuildOTSLevelList();
				OTSLevelChangesMade = true;
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void radOTSNode_CheckedChanged(object sender, System.EventArgs e)
		{
			if (radOTSNode.Checked)
			{
				gbxOTSNode.Enabled = true;
				cboOTSLevel.Enabled = false;
				if (!radOTSContainsID.Checked &&
					!radOTSContainsName.Checked &&
					!radOTSContainsDescription.Checked)
				{
					radOTSContainsID.Checked = true;
				}
			}
			else
			{
				gbxOTSNode.Enabled = false;
				cboOTSLevel.Enabled = true;
			}

			if (FormLoaded && !_loadingWindow)
			{
				OTSLevelChangesMade = true;
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void radOTSContainsID_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				if (radOTSContainsID.Checked)
				{
					radOTSNode.Checked = true;
				}
			
				OTSLevelChangesMade = true;
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void radOTSContainsName_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				if (radOTSContainsName.Checked)
				{
					radOTSNode.Checked = true;
				}
			
				OTSLevelChangesMade = true;
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void radOTSContainsDescription_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				if (radOTSContainsDescription.Checked)
				{
					radOTSNode.Checked = true;
				}
			
				OTSLevelChangesMade = true;
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void txtOTSLevelString_TextChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				radOTSNode.Checked = true;
				OTSLevelChangesMade = true;
				ErrorProvider.SetError(this.txtOTSLevelString, string.Empty);
				InheritanceProvider.SetError(this.gbxOTSProduct, string.Empty);
			}
		}

		private void radTypeUndefined_CheckedChanged(object sender, System.EventArgs e)
		{
			_hnp.ProductType = eProductType.Undefined;
			if (FormLoaded && !_loadingWindow)
			{
				ProductTypeChangesMade = true;
				InheritanceProvider.SetError(this.gbxProductType, string.Empty);
			}
		}

		private void radTypeHardline_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProductTypeChangesMade = true;
				InheritanceProvider.SetError(this.gbxProductType, string.Empty);
			}
		}

		private void radTypeSoftline_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProductTypeChangesMade = true;
				InheritanceProvider.SetError(this.gbxProductType, string.Empty);
			}
		}

		private void radBasicReplenishmentYes_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProfileChangesMade = true;
			}
		}

		private void radBasicReplenishmentNo_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProfileChangesMade = true;
			}
		}

		private void txtNodeID_TextChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProfileChangesMade = true;
				_nameChanged = true;
			}
		}

		private void txtNodeName_TextChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProfileChangesMade = true;
				_nameChanged = true;
			}
            //if (!_colorFound)	// do not echo if entered color code
            if (!_colorFound &&
                !_sizeFound)	// do not echo if entered color or sizecode
			{
				if (_IDSameAsName)
				{
					this.txtNodeID.Text = txtNodeName.Text;
				}
				if (_DescriptionSameAsName)
				{
					this.txtDescription.Text = txtNodeName.Text;
				}
			}
		}

		private void txtDescription_TextChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded && !_loadingWindow)
			{
				ProfileChangesMade = true;
				_nameChanged = true;
			}
		}

		private bool ValidTabProfile(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;

				if (this.txtNodeName.Text == string.Empty)
				{
					errorMessage = AddErrorMessage(eMIDTextCode.msg_NameRequired);
					ErrorProvider.SetError (this.txtNodeName,errorMessage);
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
				}
				else
				{
					ErrorProvider.SetError (this.txtNodeName,string.Empty);
				}

				if (this.txtNodeID.Text == string.Empty)
				{
					errorMessage = AddErrorMessage(eMIDTextCode.msg_IDRequired);
					ErrorProvider.SetError (this.txtNodeID,errorMessage);
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
				}
				else
                // Begin TT#407-MD - JSmith - Node Properties created an Alternate Hierachy named it a duplicate name and get a databaseUniqueIndexConstaraintViolation
                //{
                //    ErrorProvider.SetError(this.txtNodeID, string.Empty);
                //}
                    // Begin TT#3132 - JSmith - Node Properties - Hierarchy Issue
                    if (_hnp.LevelType != eHierarchyLevelType.Color &&
                    _hnp.LevelType != eHierarchyLevelType.Size)
                    // End TT#3132 - JSmith - Node Properties - Hierarchy Issue
                {
                    HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(txtNodeID.Text);
                    if (hnp.Key != Include.NoRID &&
                        hnp.Key != _hnp.Key)
                    {
                        errorMessage = AddErrorMessage(eMIDTextCode.msg_NodeIDAlreadyExists);
                        ErrorProvider.SetError(this.txtNodeID, errorMessage);
                        em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
                    }
                    else
                    {
                        ErrorProvider.SetError(this.txtNodeID, string.Empty);
                    }
                }
                // End TT#407-MD - JSmith - Node Properties created an Alternate Hierachy named it a duplicate name and get a databaseUniqueIndexConstaraintViolation

				if ((_hnp.LevelType == eHierarchyLevelType.Color) &&
					!_colorFound)
				{
					DialogResult result = MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_AutoAddColorCode),  this.Text,
						MessageBoxButtons.YesNo, MessageBoxIcon.Question);
					if(result == DialogResult.Yes)
					{
						if (this.txtNodeID.Text.Length > Include.ColorIDMaxSize)
						{
							errorMessage = AddErrorMessage(eMIDTextCode.msg_ColorCodeNotValid);
							ErrorProvider.SetError (this.txtNodeID,errorMessage);
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
						else
						{
							ErrorProvider.SetError (this.txtNodeID,string.Empty);
							ColorCodeProfile ccp = new ColorCodeProfile(Include.NoRID);
							ccp.ColorCodeChangeType = eChangeType.add;
							ccp.ColorCodeID = this.txtNodeID.Text;
							ccp.ColorCodeName = this.txtNodeName.Text;
							ccp.ColorCodeGroup = this.txtColorGroup.Text;
							ccp = _hm.ColorCodeUpdate(ref em, ccp);
							if (em.ErrorFound)
							{
								for (int i=0; i<em.EditMessages.Count; i++)
								{
									EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
									errorMessage += _SAB.ClientServerSession.Audit.GetText(emm.code);
								}
								ErrorProvider.SetError (this.txtNodeID,errorMessage);
							}
							else
							{
								_colorFound = true;
							}
						}
					}
					else
					{
						return false;
					}
				}
				else if (_hnp.LevelType == eHierarchyLevelType.Size)
				{
					if (!_sizeFound)
					{
						SizeCodeProfile scp = _SAB.HierarchyServerSession.GetSizeCodeProfile(txtNodeID.Text);
						if (scp.Key != Include.NoRID)
						{
							_sizeFound = true;
						}
						else
						{
							string message = MIDText.GetText(eMIDTextCode.msg_AddSizeCodeQuery);
							message = message.Replace("{0}", txtNodeID.Text);
							DialogResult result = MessageBox.Show (message,  this.Text,
								MessageBoxButtons.YesNo, MessageBoxIcon.Question);
							if(result == DialogResult.Yes)
							{
								if (this.txtNodeID.Text.Length > Include.SizeIDMaxSize)
								{
									errorMessage = AddErrorMessage(eMIDTextCode.msg_SizeCodeNotValid);
									ErrorProvider.SetError (this.txtNodeID,errorMessage);
									em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								}
								else
								{
									ErrorProvider.SetError (this.txtNodeID,string.Empty);
									frmSizeCodeMaint frmSizeCodeMaint = new frmSizeCodeMaint(_SAB);
									frmSizeCodeMaint.SizeCode = txtNodeID.Text;
									frmSizeCodeMaint.StartPosition = FormStartPosition.CenterScreen;
									frmSizeCodeMaint.ShowDialog();
									if (!frmSizeCodeMaint.CodeAdded ||
										frmSizeCodeMaint.EditMessages.ErrorFound)
									{
										em = frmSizeCodeMaint.EditMessages;
										if (!frmSizeCodeMaint.CodeAdded)
										{
											em.AddMsg(eMIDMessageLevel.Edit, MIDText.GetText(eMIDTextCode.msg_SizeCodeNotAddedNotAddNode),  this.ToString());
										}
										return false;
									}
								}
							}
							else
							{
								em.AddMsg(eMIDMessageLevel.Edit, MIDText.GetText(eMIDTextCode.msg_SizeCodeNotAddedNotAddNode),  this.ToString());
								return false;
							}
						}
					}
				}

				if (OTSLevelChangesMade)
				{
					if (this.radOTSLevel.Checked)
					{
						if (this.cboOTSLevel.SelectedIndex == Include.Undefined)
						{
							errorMessage = AddErrorMessage(eMIDTextCode.msg_InvalidOTSForecastLevel);
							ErrorProvider.SetError (this.cboOTSLevel,errorMessage);
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}
					else
					{
						if (txtOTSLevelString.Text == null ||
							txtOTSLevelString.Text.Trim().Length == 0)
						{
							errorMessage = AddErrorMessage(eMIDTextCode.msg_FieldIsRequired);
							ErrorProvider.SetError (this.txtOTSLevelString,errorMessage);
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception, true);
			}
			return false;
		}

		#endregion Profile Tab

        #region Reservations Tab

        // Begin TT#1401 - Reservation Stores
        private void ReservationGridLayout()
        {
            this.ugReservation.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
            this.ugReservation.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
            this.ugReservation.DisplayLayout.AddNewBox.Hidden = true;
            this.ugReservation.DisplayLayout.GroupByBox.Hidden = true;
            this.ugReservation.DisplayLayout.GroupByBox.Prompt = string.Empty;
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Reservation Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_ID);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Min Ship Qty"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MIN_SHIP_QTY);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Pct Pack Threshold"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_PCT_PK_THRSHLD);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Item Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MAX_VALUE);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_FWOS_MAX); // TT#2225 - gtaylor - ANF VSW
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Push to Backstock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PSH_BK_STK_CDR_RID);
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].ValueList = this.uddFWOSMax; // TT#108 - MD - DOConnell - FWOS Max Model
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].AutoCompleteMode = Infragistics.Win.AutoCompleteMode.Default; // TT#108 - MD - DOConnell - FWOS Max Model
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max RID"].Hidden = true; //TT#108 - MD - DOConnell - FWOS Max Model 

            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["SetID"].Hidden = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Inherited"].Hidden = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Inherited RID"].Hidden = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Updated"].Hidden = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Store RID"].Hidden = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Store ID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Reservation Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_ID);
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Min Ship Qty"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MIN_SHIP_QTY);
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Pct Pack Threshold"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_PCT_PK_THRSHLD);
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Item Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MAX_VALUE);
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_FWOS_MAX); // TT#2225 - gtaylor - ANF VSW
            //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].ValueList = this.uddFWOSMax;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].AutoCompleteMode = Infragistics.Win.AutoCompleteMode.Default;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max RID"].Hidden = true; //TT#108 - MD - DOConnell - FWOS Max Model 
            //END TT#108 - MD - DOConnell - FWOS Max Model
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Push to Backstock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PSH_BK_STK_CDR_RID);
            this.ugReservation.DisplayLayout.UseFixedHeaders = true;
            this.ugReservation.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Fixed = true;
            this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Store ID"].Header.Fixed = true;
        }

        //BEGIN TT#1401 - gtaylor - Reservation Stores
        //  
        //  TT#1401
        void mnuIMOGrid_Popup(object sender, System.EventArgs e)
        {
            try
            {
                // Begin TT#2609 - JSmith - Node Properties
                ugReservation.PerformAction(UltraGridAction.ExitEditMode);
                // End TT#2609 - JSmith - Node Properties

                mnuIMOGrid.MenuItems.Clear();
                MenuItem mnuItemApplyAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyAll));
                MenuItem mnuItemApplyColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyColumn));
                MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
                MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
                MenuItem mnuItemClearAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearAll));
                MenuItem mnuItemClearColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearColumn));
                MenuItem mnuItemReset = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Reset_Messages));

                switch (_modelType)
                {

                    case eModelType.FWOSMax:
                        if (_FWOSMaxProfileList.Count == 0)
                        {
                            _mnuItemOpenModel.Enabled = false;
                        }
                        if (_securityFWOSMaxModels.AllowUpdate ||
                            _securityFWOSMaxModels.AllowView)
                        {
                            _mnuItemOpenModel.Enabled = true;
                        }
                        else
                        {
                            _mnuItemOpenModel.Enabled = false;
                        }

                        if (_securityFWOSMaxModels.AllowUpdate)
                        {
                            _mnuItemNewModel.Enabled = true;
                        }
                        else
                        {
                            _mnuItemNewModel.Enabled = false;
                        }

                        break;
                }

                if (this.ugReservation.ActiveRow == null ||
                    this.ugReservation.ActiveRow.Band.Key != "Sets")
				{
					mnuItemApplyAll.Enabled = false;	
					mnuItemApplyColumn.Enabled = false;	
				}
				else
				{
					mnuItemApplyAll.Enabled = true;	
					mnuItemApplyColumn.Enabled = true;	
				}

				if (!_securityIMO.AllowUpdate)
				{
					mnuItemApplyAll.Enabled = false;	
					mnuItemApplyColumn.Enabled = false;	
					mnuItemClearAll.Enabled = false;	
					mnuItemClearColumn.Enabled = false;	
				}
                if (ugReservation.ActiveCell != null)
                {
                    AdjustIMOGridMenu(ugReservation.ActiveCell);
                }

                mnuIMOGrid.MenuItems.Add(mnuItemApplyAll);
                mnuIMOGrid.MenuItems.Add(mnuItemApplyColumn);
                mnuIMOGrid.MenuItems.Add(mnuItemClearAll);
                mnuIMOGrid.MenuItems.Add(mnuItemClearColumn);
                mnuIMOGrid.MenuItems.Add("-");
                mnuIMOGrid.MenuItems.Add(mnuItemExpandAll);
                mnuIMOGrid.MenuItems.Add(mnuItemCollapseAll);
                mnuItemApplyAll.Click += new System.EventHandler(this.mnuIMOItemApplyAll_Click);
                mnuItemApplyColumn.Click += new System.EventHandler(mnuIMOItemApplyColumn_Click);
                mnuItemExpandAll.Click += new System.EventHandler(this.mnuIMOItemExpandAll_Click);
                mnuItemCollapseAll.Click += new System.EventHandler(this.mnuIMOItemCollapseAll_Click);
                mnuItemClearAll.Click += new System.EventHandler(this.mnuIMOItemClearAll_Click);
                    mnuItemClearColumn.Click += new System.EventHandler(this.mnuIMOItemClearColumn_Click);
                mnuItemReset.Click += new System.EventHandler(this.mnuIMOItemReset_Click);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void mnuIMOItemClearColumn_Click(object sender, System.EventArgs e)
        {
            try
            {
                Cursor = Cursors.WaitCursor;
                bool updateMinShipQty = false;
                bool updatePctPackThreshold = false;
                bool updateItemMax = false;
                bool updatePushtoBackstock = false;
                bool updateFWOSMax = false;
                if (this.ugReservation.ActiveCell != null)
                {
                    switch (this.ugReservation.ActiveCell.Column.Key)
                    {
                        case "Min Ship Qty":
                            updateMinShipQty = true;
                            break;
                        case "Pct Pack Threshold":
                            updatePctPackThreshold = true;
                            break;
                        case "Item Max":
                            updateItemMax = true;
                            break;
                        // BEGIN TT#2225 - gtaylor - ANF VSW
                        case "FWOS Max":
                            updateFWOSMax = true;
                            break;
                        // END TT#2225 - gtaylor - ANF VSW
                        case "Push to Backstock":
                            updatePushtoBackstock = true;
                            break;
                        default:
                            string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
                            text = text.Replace("{0}", this.ugReservation.ActiveCell.Column.Key);
                            MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                            break;
                    }
                    IMOItemClear(updateMinShipQty, updatePctPackThreshold, updateItemMax, updatePushtoBackstock, updateFWOSMax);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                Cursor = Cursors.Default;
            }
        }

        private void mnuIMOItemClearAll_Click(object sender, System.EventArgs e)
        {
            try
            {
                Cursor = Cursors.WaitCursor;
                IMOItemClear(true, true, true, true, true);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                Cursor = Cursors.Default;
            }
        }

        private void mnuIMOItemApplyAll_Click(object sender, System.EventArgs e)
        {
            try
            {
                Cursor = Cursors.WaitCursor;
                IMOItemApply(true, true, true, true, true);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                Cursor = Cursors.Default;
            }
        }

        private void mnuIMOItemApplyColumn_Click(object sender, System.EventArgs e)
        {
            try
            {
                Cursor = Cursors.WaitCursor;
                bool updateMinShipQty = false;
                bool updatePctPackThreshold = false;
                bool updateItemMax = false;
                bool updateFWOSMax = false;
                bool updatePushtoBackstock = false;
                if (this.ugReservation.ActiveCell != null)
                {
                    switch (this.ugReservation.ActiveCell.Column.Key)
                    {
                        case "Min Ship Qty":
                            updateMinShipQty = true;
                            break;
                        case "Pct Pack Threshold":
                            updatePctPackThreshold = true;
                            break;
                        case "Item Max":
                            updateItemMax = true;
                            break;
                        // BEGIN TT#2225 - gtaylor - ANF VSW
                        case "FWOS Max":
                            updateFWOSMax = true;
                            break;
                        // END TT#2225 - gtaylor - ANF VSW
                        case "Push to Backstock":
                            updatePushtoBackstock = true;
                            break;
                        default:
                            string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
                            text = text.Replace("{0}", this.ugReservation.ActiveCell.Column.Key);
                            MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                            break;
                    }
                    IMOItemApply(updateMinShipQty, updatePctPackThreshold, updateItemMax, updatePushtoBackstock, updateFWOSMax); // TT#2225 - gtaylor - ANF VSW
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                Cursor = Cursors.Default;
            }
        }

        private void mnuIMOItemReset_Click(object sender, System.EventArgs e)
        {
            try
            {
                Cursor = Cursors.WaitCursor;
                Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugReservation.ActiveRow.Band;
                Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugReservation.ActiveRow;
                Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                if (activeRowBand.Key == "Sets")		// apply values to all stores in set
                {
                    ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
                    foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                    {
                        storeRow.Cells["Inherited"].Tag = null;
                        storeRow.Cells["Inherited"].Appearance.Image = null;
                        storeRow.Cells["Inherited RID"].Tag = null;
                        storeRow.Cells["Inherited RID"].Appearance.Image = null;
                        storeRow.Cells["Store RID"].Tag = null;
                        storeRow.Cells["Store RID"].Appearance.Image = null;
                        storeRow.Cells["Store ID"].Tag = null;
                        storeRow.Cells["Store ID"].Appearance.Image = null;
                        storeRow.Cells["Reservation Store"].Tag = null;
                        storeRow.Cells["Reservation Store"].Appearance.Image = null;
                        storeRow.Cells["Min Ship Qty"].Tag = null;
                        storeRow.Cells["Min Ship Qty"].Appearance.Image = null;
                        storeRow.Cells["Pct Pack Threshold"].Tag = null;
                        storeRow.Cells["Pct Pack Threshold"].Appearance.Image = null;
                        storeRow.Cells["Item Max"].Tag = null;
                        storeRow.Cells["Item Max"].Appearance.Image = null;
                        // BEGIN TT#2225 - gtaylor - ANF VSW
                        storeRow.Cells["FWOS Max"].Tag = null;
                        storeRow.Cells["FWOS Max"].Appearance.Image = null;
                        // END TT#2225 - gtaylor - ANF VSW
                        storeRow.Cells["Push to Backstock"].Tag = null;
                        storeRow.Cells["Push to Backstock"].Appearance.Image = null;
                    }
                }
                else
                    if (activeRowBand.Key == "Stores")		// clear store value
                    {
                        activeRow.Cells["Inherited"].Tag = null;
                        activeRow.Cells["Inherited"].Appearance.Image = null;
                        activeRow.Cells["Inherited RID"].Tag = null;
                        activeRow.Cells["Inherited RID"].Appearance.Image = null;
                        activeRow.Cells["Store RID"].Tag = null;
                        activeRow.Cells["Store RID"].Appearance.Image = null;
                        activeRow.Cells["Store ID"].Tag = null;
                        activeRow.Cells["Store ID"].Appearance.Image = null;
                        activeRow.Cells["Reservation Store"].Tag = null;
                        activeRow.Cells["Reservation Store"].Appearance.Image = null;
                        activeRow.Cells["Min Ship Qty"].Tag = null;
                        activeRow.Cells["Min Ship Qty"].Appearance.Image = null;
                        activeRow.Cells["Pct Pack Threshold"].Tag = null;
                        activeRow.Cells["Pct Pack Threshold"].Appearance.Image = null;
                        activeRow.Cells["Item Max"].Tag = null;
                        activeRow.Cells["Item Max"].Appearance.Image = null;
                        // BEGIN TT#2225 - gtaylor - ANF VSW
                        activeRow.Cells["FWOS Max"].Tag = null;
                        activeRow.Cells["FWOS Max"].Appearance.Image = null;
                        // END TT#2225 - gtaylor - ANF VSW
                        activeRow.Cells["Push to Backstock"].Tag = null;
                        activeRow.Cells["Push to Backstock"].Appearance.Image = null;
                    }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                Cursor = Cursors.Default;
            }
        }

        private void mnuIMOItemCollapseAll_Click(object sender, System.EventArgs e)
        {
            try
            {
                this.ugReservation.Rows.CollapseAll(true);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void mnuIMOItemExpandAll_Click(object sender, System.EventArgs e)
        {
            try
            {
                this.ugReservation.Rows.ExpandAll(true);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void IMOItemClear(bool updateMinShipQty, bool updatePctPackThreshold, bool updateItemMax, bool updatePushtoBackstock, bool updateFWOSMax)
        {
            try
            {
                Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugReservation.ActiveRow.Band;
                Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugReservation.ActiveRow;
                Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                if (activeRowBand.Key == "Sets")		// apply values to all stores in set
                {
                    ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
                    foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                    {
                        if (storeRow.Cells["Reservation Store"].Value.ToString().Trim().Length > 0)
                        {
                            storeRow.Cells["Updated"].Value = true;
                            if (updateMinShipQty)
                            {
                                storeRow.Cells["Min Ship Qty"].Value = string.Empty;
                                storeRow.Cells["Min Ship Qty"].Appearance.Image = null;
                                storeRow.Cells["Min Ship Qty"].Tag = null;
                            }
                            if (updatePctPackThreshold)
                            {
                                storeRow.Cells["Pct Pack Threshold"].Value = string.Empty;
                                storeRow.Cells["Pct Pack Threshold"].Appearance.Image = null;
                                storeRow.Cells["Pct Pack Threshold"].Tag = null;
                            }
                            // BEGIN TT#2225 - gtaylor - ANF VSW
                            if (updateFWOSMax)
                            {
                                storeRow.Cells["FWOS Max"].Value = string.Empty;
                                storeRow.Cells["FWOS Max"].Appearance.Image = null;
                                storeRow.Cells["FWOS Max"].Tag = null;
                                storeRow.Cells["FWOS Max RID"].Value = string.Empty; //TT#108 - MD - DOConnell - FWOS Max Model 
                            }
                            // END TT#2225 - gtaylor - ANF VSW
                            if (updateItemMax)
                            {
                                storeRow.Cells["Item Max"].Value = string.Empty;
                                storeRow.Cells["Item Max"].Appearance.Image = null;
                                storeRow.Cells["Item Max"].Tag = null;
                            }
                            if (updatePushtoBackstock)
                            {
                                storeRow.Cells["Push to Backstock"].Value = string.Empty;
                                storeRow.Cells["Push to Backstock"].Appearance.Image = null;
                                storeRow.Cells["Push to Backstock"].Tag = null;
                            }
                            ReservationChangesMade = true;
                        }
                    }

                }

                if (activeRowBand.Key == "Stores")		// clear store value
                {
                    activeRow.Cells["Updated"].Value = true;
                    ReservationChangesMade = true;
                }
                if (updateMinShipQty)
                {
                    activeRow.Cells["Min Ship Qty"].Value = string.Empty;
                    activeRow.Cells["Min Ship Qty"].Appearance.Image = null;
                    activeRow.Cells["Min Ship Qty"].Tag = null;
                }
                if (updatePctPackThreshold)
                {
                    activeRow.Cells["Pct Pack Threshold"].Value = string.Empty;
                    activeRow.Cells["Pct Pack Threshold"].Appearance.Image = null;
                    activeRow.Cells["Pct Pack Threshold"].Tag = null;
                }
                if (updateItemMax)
                {
                    activeRow.Cells["Item Max"].Value = string.Empty;
                    activeRow.Cells["Item Max"].Appearance.Image = null;
                    activeRow.Cells["Item Max"].Tag = null;
                }
                // BEGIN TT#2225 - gtaylor - ANF VSW
                if (updateFWOSMax)
                {
                    activeRow.Cells["FWOS Max"].Value = string.Empty;
                    activeRow.Cells["FWOS Max"].Appearance.Image = null;
                    activeRow.Cells["FWOS Max"].Tag = null;
                    activeRow.Cells["FWOS Max RID"].Value = string.Empty; //TT#108 - MD - DOConnell - FWOS Max Model 
                }
                // END TT#2225 - gtaylor - ANF VSW
                if (updatePushtoBackstock)
                {
                    activeRow.Cells["Push to Backstock"].Value = string.Empty;
                    activeRow.Cells["Push to Backstock"].Appearance.Image = null;
                    activeRow.Cells["Push to Backstock"].Tag = null;
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void IMOItemApply(bool updateMinShipQty, bool updatePctPackThreshold, bool updateItemMax, bool updatePushtoBackstock, bool updateFWOSMax)
        {
            string errorMessage = null;
            try
            {
                if (this.ugReservation.ActiveRow == null)
                {
                    this.Cursor = Cursors.Default;
                    MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
                else
                {
                    if (ugReservation.ActiveCell != null)
                    {
                        ugReservation.ActiveCell.Row.Update();
                    }

                    Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugReservation.ActiveRow.Band;
                    Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugReservation.ActiveRow;

                    Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    if (activeRowBand.Key == "Sets")		// apply values to all stores in set
                    {
                        ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
                        foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                        {
                            if (storeRow.Cells["Reservation Store"].Value.ToString().Trim().Length > 0)
                            {
                                storeRow.Cells["Updated"].Value = true;
                                if (updateMinShipQty)
                                {
                                    storeRow.Cells["Min Ship Qty"].Value = activeRow.Cells["Min Ship Qty"].Value;
                                    storeRow.Cells["Min Ship Qty"].Appearance.Image = null;
                                    storeRow.Cells["Min Ship Qty"].Tag = null;
                                }
                                if (updatePctPackThreshold)
                                {
                                    storeRow.Cells["Pct Pack Threshold"].Value = activeRow.Cells["Pct Pack Threshold"].Value;
                                    storeRow.Cells["Pct Pack Threshold"].Appearance.Image = null;
                                    storeRow.Cells["Pct Pack Threshold"].Tag = null;
                                }
                                // BEGIN TT#2225 - gtaylor - ANF VSW
                                if (updateFWOSMax)
                                {
                                    storeRow.Cells["FWOS Max"].Value = activeRow.Cells["FWOS Max"].Value;
                                    storeRow.Cells["FWOS Max"].Appearance.Image = null;
                                    storeRow.Cells["FWOS Max"].Tag = null;
                                    storeRow.Cells["FWOS Max RID"].Value = activeRow.Cells["FWOS Max RID"].Value; //TT#108 - MD - DOConnell - FWOS Max Model 
                                }
                                // END TT#2225 - gtaylor - ANF VSW
                                if (updateItemMax)
                                {
                                    storeRow.Cells["Item Max"].Value = activeRow.Cells["Item Max"].Value;
                                    storeRow.Cells["Item Max"].Appearance.Image = null;
                                    storeRow.Cells["Item Max"].Tag = null;
                                }
                                if (updatePushtoBackstock)
                                {
                                    storeRow.Cells["Push to Backstock"].Value = activeRow.Cells["Push to Backstock"].Value;
                                    storeRow.Cells["Push to Backstock"].Appearance.Image = null;
                                    storeRow.Cells["Push to Backstock"].Tag = null;
                                }
                            }
                        }
                        _imoDataSet.AcceptChanges();
                        ReservationChangesMade = true;
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        //  after exit, mark the row if it has been updated
        //  
        private void ugReservation_AfterExitEditMode(object sender, System.EventArgs e)
        {
            //throw new System.NotImplementedException();
        }

        //  BEGIN TT#2092 - gtaylor - Item Max Node Properties
        void ugReservation_BeforeRowUpdate(object sender, CancelableRowEventArgs e)
        {
            string cellError = "";

            // BEGIN TT#2352 - GTaylor           
            double dItemMax, dFWOSMax;

            Double.TryParse(e.Row.Cells["Item Max"].Text, out dItemMax);
            Double.TryParse(e.Row.Cells["FWOS Max"].Text, out dFWOSMax);

            //  if the Item Max is less than zero, throw an error
            if (dItemMax < 0) {
                cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                e.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                e.Row.Cells["Item Max"].Tag = cellError;
                e.Row.Cells["Item Max"].ToolTipText = cellError;
                ItemMaxEntryError = true;
                return;
            }
            //  if the FWOS Max is less then zero OR greater than 99, throw an error
            if ((dFWOSMax < 0) || (dFWOSMax > 99)) {
                cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                e.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                e.Row.Cells["FWOS Max"].Tag = cellError;
                e.Row.Cells["FWOS Max"].ToolTipText = cellError;
                FWOSMaxEntryError = true;
                return;
            }
            // END TT#2352 - GTaylor
            //BEGIN TT#3635 - DOConnell - Entering space in VSW field break VSW for key item
            //if (
            //    ((e.Row.Cells["Min Ship Qty"].Text.Length > 0) ||
            //    (e.Row.Cells["Pct Pack Threshold"].Text.Length > 0)) &&
            //    ((e.Row.Cells["Item Max"].Text.Length == 0) && (e.Row.Cells["FWOS Max"].Text.Length == 0))
            //    )
            if (
                ((e.Row.Cells["Min Ship Qty"].Text.Length > 0) ||
                (e.Row.Cells["Pct Pack Threshold"].Text.Length > 0)) &&
                ((e.Row.Cells["Item Max"].Text.Trim().Length == 0) && (e.Row.Cells["FWOS Max"].Text.Trim().Length == 0))
                )
            //END TT#3635 - DOConnell - Entering space in VSW field break VSW for key item
            {
                cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_al_ItemMaxRequired);
                e.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                e.Row.Cells["Item Max"].Tag = cellError;
                e.Row.Cells["Item Max"].ToolTipText = cellError;
                if (e.Row.Cells["Item Max"].Text.Length == 0)
                    ItemMaxEntryError = true;

                cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.lbl_IMO_FWOS_MAX_REQUIRED);
                e.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                e.Row.Cells["FWOS Max"].Tag = cellError;
                e.Row.Cells["FWOS Max"].ToolTipText = cellError;
                if (e.Row.Cells["FWOS Max"].Text.Length == 0)
                    FWOSMaxEntryError = true;
            }
            else
            {
                e.Row.Cells["Item Max"].Appearance.Image = null;
                e.Row.Cells["Item Max"].Tag = null;
                e.Row.Cells["Item Max"].ToolTipText = null;
                ItemMaxEntryError = false;
                e.Row.Cells["FWOS Max"].Appearance.Image = null;
                e.Row.Cells["FWOS Max"].Tag = null;
                e.Row.Cells["FWOS Max"].ToolTipText = null;
                FWOSMaxEntryError = false;
            }
        }
        //  END TT#2092 - gtaylor - Item Max Node Properties

        private void ugReservation_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            try
            {
                // Begin TT#3680 - JSmith - VSW fields accepting invalid values
                e.Cell.Appearance.Image = null;
                e.Cell.Tag = null;
                e.Cell.ToolTipText = null;
                // End TT#3680 - JSmith - VSW fields accepting invalid values

                // Begin TT#2574 - JSmith - FWOS Max Model
                switch (e.Cell.Column.Key)
                {
                    case "FWOS Max":
                        SetHiddenRidColumn(e, "FWOS Max", "FWOS Max RID");
                        break;
                }
                // End TT#2574 - JSmith - FWOS Max Model

                string cellError = "";
                // BEGIN TT#2352 - GTaylor           
                double dItemMax, dFWOSMax;

                Double.TryParse(e.Cell.Row.Cells["Item Max"].Text, out dItemMax);
                Double.TryParse(e.Cell.Row.Cells["FWOS Max"].Text, out dFWOSMax);

                //  if the Item Max is less than zero, throw an error
                if (dItemMax < 0)
                {
                    cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                    e.Cell.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                    e.Cell.Row.Cells["Item Max"].Tag = cellError;
                    e.Cell.Row.Cells["Item Max"].ToolTipText = cellError;
                    ItemMaxEntryError = true;
                    return;
                }
                //  if the FWOS Max is less then zero OR greater than 99, throw an error
                if ((dFWOSMax < 0) || (dFWOSMax > 99))
                {
                    cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                    e.Cell.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                    e.Cell.Row.Cells["FWOS Max"].Tag = cellError;
                    e.Cell.Row.Cells["FWOS Max"].ToolTipText = cellError;
                    FWOSMaxEntryError = true;
                    return;
                }
                // END TT#2352 - GTaylor

                //  is the grid populated?
                if (_reservationIsPopulated)
                {
                    if (e.Cell.Row.Band.Key == "Stores")
                        e.Cell.Row.Cells["Updated"].Value = true;
                            ReservationChangesMade = true;
                }
                if (
                    ((e.Cell.Row.Cells["Min Ship Qty"].Text.Length > 0) ||
                    (e.Cell.Row.Cells["Pct Pack Threshold"].Text.Length > 0)
                    ) &&
                    ((e.Cell.Row.Cells["Item Max"].Text.Length == 0) && (e.Cell.Row.Cells["FWOS Max"].Text.Length == 0))
                   )
                {
                    cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_al_ItemMaxRequired);
                    e.Cell.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                    e.Cell.Row.Cells["Item Max"].Tag = cellError;
                    e.Cell.Row.Cells["Item Max"].ToolTipText = cellError;
                    if (e.Cell.Row.Cells["Item Max"].Text.Length == 0)
                        ItemMaxEntryError = true;

                    cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.lbl_IMO_FWOS_MAX_REQUIRED);
                    e.Cell.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                    e.Cell.Row.Cells["FWOS Max"].Tag = cellError;
                    e.Cell.Row.Cells["FWOS Max"].ToolTipText = cellError;
                    if (e.Cell.Row.Cells["FWOS Max"].Text.Length == 0)
                        FWOSMaxEntryError = true;

                }
                else
                {
                    e.Cell.Row.Cells["Item Max"].Appearance.Image = null;
                    e.Cell.Row.Cells["Item Max"].Tag = null;
                    e.Cell.Row.Cells["Item Max"].ToolTipText = null;
                    ItemMaxEntryError = false;
                    e.Cell.Row.Cells["FWOS Max"].Appearance.Image = null;
                    e.Cell.Row.Cells["FWOS Max"].Tag = null;
                    e.Cell.Row.Cells["FWOS Max"].ToolTipText = null;
                    FWOSMaxEntryError = false;
                }

                if (ReservationChangesMade)
                {
                    if (e.Cell.Row.Band.Key == "Stores")
                    {
                        e.Cell.Row.Cells["Inherited"].Value = false;
                        e.Cell.Row.Cells["Inherited RID"].Value = Include.NoRID;
						e.Cell.Row.Cells["Store ID"].Appearance.Image = null;
                        e.Cell.Row.Cells["Store ID"].Tag = null;
                        e.Cell.Row.Cells["Store ID"].ToolTipText = null;
                    }
                }
            }
            catch
            {
                throw;
            }
        }

        private void ugReservation_AfterCellActivate(object sender, System.EventArgs e)
        {
            try
            {
                if (ugReservation.ActiveCell != null)
                {
                    AdjustIMOGridMenu(ugReservation.ActiveCell);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugReservation_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            try
            {
			//BEGIN TT#277 - MD - DOConnell - Select FWOS Max Model for a Set and recieve Key error
                //if (e.Cell != e.Cell.Row.Cells["Updated"])
                //{
			//END TT#277 - MD - DOConnell - Select FWOS Max Model for a Set and recieve Key error
                    //  is the grid populated?
                    if (_reservationIsPopulated)
                    {
                        if (e.Cell.Row.Band.Key == "Stores")
                            e.Cell.Row.Cells["Updated"].Value = true;
                            ReservationChangesMade = true;
                        }
                    // BEGIN TT#2092 - gtaylor - item max node properties fix
                    string cellError = "";
                    // BEGIN TT#2352 - GTaylor           
                    double dItemMax, dFWOSMax;

                    Double.TryParse(e.Cell.Row.Cells["Item Max"].Text, out dItemMax);
                    Double.TryParse(e.Cell.Row.Cells["FWOS Max"].Text, out dFWOSMax);

                    //  if the Item Max is less than zero, throw an error
                    if (dItemMax < 0)
                    {
                        cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                        e.Cell.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                        e.Cell.Row.Cells["Item Max"].Tag = cellError;
                        e.Cell.Row.Cells["Item Max"].ToolTipText = cellError;
                        ItemMaxEntryError = true;
                        return;
                    }
                    //  if the FWOS Max is less then zero OR greater than 99, throw an error
                    if ((dFWOSMax < 0) || (dFWOSMax > 99))
                    {
                        cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InputInvalid);
                        e.Cell.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                        e.Cell.Row.Cells["FWOS Max"].Tag = cellError;
                        e.Cell.Row.Cells["FWOS Max"].ToolTipText = cellError;
                        FWOSMaxEntryError = true;
                        return;
                    }
                    // END TT#2352 - GTaylor
                    // TT#2225 - ANF VSW
                    if (
                        ((e.Cell.Row.Cells["Min Ship Qty"].Text.Length > 0) ||
                        (e.Cell.Row.Cells["Pct Pack Threshold"].Text.Length > 0) 
                        ) &&
                        ((e.Cell.Row.Cells["Item Max"].Text.Length == 0) && (e.Cell.Row.Cells["FWOS Max"].Text.Length == 0))
                        )
                    {
                        cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_al_ItemMaxRequired);
                        e.Cell.Row.Cells["Item Max"].Appearance.Image = ErrorImage;
                        e.Cell.Row.Cells["Item Max"].Tag = cellError;
                        e.Cell.Row.Cells["Item Max"].ToolTipText = cellError;
                        if (e.Cell.Row.Cells["Item Max"].Text.Length == 0)
                            ItemMaxEntryError = true;

                        cellError = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.lbl_IMO_FWOS_MAX_REQUIRED);
                        e.Cell.Row.Cells["FWOS Max"].Appearance.Image = ErrorImage;
                        e.Cell.Row.Cells["FWOS Max"].Tag = cellError;
                        e.Cell.Row.Cells["FWOS Max"].ToolTipText = cellError;
                        if (e.Cell.Row.Cells["FWOS Max"].Text.Length == 0)
                            FWOSMaxEntryError = true;
                    }
                    else
                    {
                        e.Cell.Row.Cells["Item Max"].Appearance.Image = null;
                        e.Cell.Row.Cells["Item Max"].Tag = null;
                        e.Cell.Row.Cells["Item Max"].ToolTipText = null;
                        ItemMaxEntryError = false;
                        e.Cell.Row.Cells["FWOS Max"].Appearance.Image = null;
                        e.Cell.Row.Cells["FWOS Max"].Tag = null;
                        e.Cell.Row.Cells["FWOS Max"].ToolTipText = null;
                        FWOSMaxEntryError = false;
                    }
                    // TT#2225 - ANF VSW
                    //  END TT#2092 - gtaylor - item max node properties fix

                    if (ReservationChangesMade)
                    {
                        if ((e.Cell.Row.Band.Key == "Stores") &&  (e.Cell != e.Cell.Row.Cells["Updated"]))
                        {
                            e.Cell.Row.Cells["Inherited"].Value = false;
                            e.Cell.Row.Cells["Inherited RID"].Value = Include.NoRID;
						    e.Cell.Row.Cells["Store ID"].Appearance.Image = null;
                            e.Cell.Row.Cells["Store ID"].Tag = null;
                            e.Cell.Row.Cells["Store ID"].ToolTipText = null;
                            //BEGIN TT#2015 - gtaylor - Apply Changes to Lower Levels
                            // create the change profile and add it to the list
                            ChangeProfileVSW vswChange = new ChangeProfileVSW(
                                Convert.ToInt16(e.Cell.Row.Cells["Store RID"].Value), // storeRID
                                e.Cell.Row.Cells["Store ID"].Value.ToString(), // storeID
                                e.Cell.Text.ToString(), // new value
                                e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                                e.Cell.Column.Header.Caption.ToString(),
                                e.Cell.Column.Index
                            );

                            // create keyvaluepair and populate
                            KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(vswChange.ChangeProfileKey, vswChange);


                            //  add to nodechangeprofile list
                            _nodeChangeProfile.Add(eProfileType.IMO, _kvp);
                        }

                        //  is the grid populated?
                        if (_reservationIsPopulated)
                        {
                            if (e.Cell.Row.Band.Key == "Stores")
                                e.Cell.Row.Cells["Updated"].Value = true;
                        }

                        //END TT#2015 - gtaylor - Apply Changes to Lower Levels
                    }

                    //switch (e.Cell.Column.Key)
                    //{
                    //    case "Push to Backstock":
                    //        if (e.Cell.Row.Band.Key == "Sets")
                    //        {
                    //            //  update similar column with this new value
                    //            int push_to_backstock = Convert.ToInt32(
                    //                ((e.Cell.Row.Cells["Push to Backstock"].Value == null || e.Cell.Row.Cells["Push to Backstock"].ToString().Trim() == "") ? 1 : e.Cell.Row.Cells["Push to Backstock"].Value), CultureInfo.CurrentUICulture
                    //                );
                    //            Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //            foreach (UltraGridRow setRow in this.ugReservation.Rows)
                    //            {
                    //                ultraGridStoreBand = setRow.ChildBands["Stores"];
                    //                foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                    //                {
                    //                    if (storeRow.Cells["Reservation Store"].Value != null)
                    //                    {
                    //                        if (storeRow.Cells["Reservation Store"].Value.ToString().Trim().Length > 0)
                    //                        {
                    //                            storeRow.Cells["Push to Backstock"].Value = Convert.ToString(push_to_backstock);
                    //                            storeRow.Cells["Updated"].Value = true;
                    //                        }
                    //                    }
                    //                }
                    //            }
                    //        }
                    //        break;
                    //    default:
                    //        break;
                    //}
                //} // TT#277 - MD - DOConnell - Select FWOS Max Model for a Set and recieve Key error
            } 
            catch
            {
                throw;
            }
        }

        // Begin TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough
        private void ugReservation_AfterColPosChanged(object sender, AfterColPosChangedEventArgs e)
        {
            foreach (Infragistics.Win.UltraWinGrid.ColumnHeader columnHeader in e.ColumnHeaders)
            {
                switch (columnHeader.Column.Key)
                {
                    case "FWOS Max":
                        this.uddFWOSMax.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].Width;
                        break;
                }
            }
        }
        // End TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough

        private void ugReservation_InitializeLayout(object sender, InitializeLayoutEventArgs e)
        {
            try
            {
                if (!_reservationGridBuilt)
                {
                    // check for saved layout
                    InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
                    // Begin TT#461-MD - JSmith - Node Properties VSW tab error
                    //InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.capacityGrid);
                    InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.nodePropertyVSWGrid);
                    // End TT#461-MD - JSmith - Node Properties VSW tab error
                    if (layout.LayoutLength > 0)
                    {
                        ugReservation.DisplayLayout.Load(layout.LayoutStream);
                    }
                    else
                    {	
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        ReservationGridLayout();
                    }
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Reservation Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_ID);
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Min Ship Qty"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MIN_SHIP_QTY);
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Pct Pack Threshold"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_PCT_PK_THRSHLD);
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Item Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MAX_VALUE);
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_FWOS_MAX); // TT#2225 - gtaylor - ANF VSW
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Push to Backstock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PSH_BK_STK_CDR_RID);
                    //  this is an application text example
                    //this.ugReservation.DisplayLayout.Bands["Sets"].Columns["Ratio"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Ratio);

                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Store ID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Reservation Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_ID);
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Min Ship Qty"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MIN_SHIP_QTY);
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Pct Pack Threshold"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_PCT_PK_THRSHLD);
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Item Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_MAX_VALUE);
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_IMO_FWOS_MAX); // TT#2225 - gtaylor - ANF VSW

                    //Begin TT#2991 - JSmith - Issues with seeing FWOS Max Models for specific users
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].ValueList = this.uddFWOSMax;
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].ValueList = this.uddFWOSMax;
                    //End TT#2991 - JSmith - Issues with seeing FWOS Max Models for specific users

                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Push to Backstock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PSH_BK_STK_CDR_RID); this.ugReservation.DisplayLayout.Bands["Stores"].Columns["Store ID"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
                    // Begin TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough
                    this.uddFWOSMax.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].Width;
                    // End TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough
                    _reservationGridBuilt = true;
                }

                if (!this._securityCapacity.AllowUpdate)
                {
                    foreach (UltraGridBand ugb in this.ugReservation.DisplayLayout.Bands)
                    {
                        ugb.Override.AllowDelete = DefaultableBoolean.False;
                    }
                }
                else
                {
                    foreach (UltraGridBand ugb in this.ugReservation.DisplayLayout.Bands)
                    {
                        ugb.Override.AllowDelete = DefaultableBoolean.True;
                    }
                }

            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void Reservation_Attributes_Populate()
        {
            //  use the store capacity list.  it is already loaded and the dropdown is identical.
            try
            {
                StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_imoGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID);
                midAttributeCbx.Initialize(SAB, _securityIMO, _imoGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(midAttributeCbx);     //TT#7 - RBeck - Dynamic dropdowns

                _groupRID = storeGroup.Key;
                this.midAttributeCbx.SelectedValue = storeGroup.Key;
                _imoGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ReservationTab_Load()
        {
            try
            {

                Reservation_Attributes_Populate();

                BuildFWOSMaxModelList(); //TT#108 - MD - DOConnell - FWOS Max Model

                if (_hnp.Key == Include.NoRID)	// new node so get parent's reservation
                {
                    _imoProfileList = _SAB.HierarchyServerSession.GetNodeIMOList(_storeList, _hnp.HomeHierarchyParentRID);
                }
                else
                {
                    _imoProfileList = _SAB.HierarchyServerSession.GetNodeIMOList(_storeList, _hnp.Key);
                }
                Reservation_Populate(false);

                this.ugReservation.ContextMenu = mnuIMOGrid;

                ugReservation.ActiveRow = ugReservation.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);
                _reservationIsPopulated = true;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void Reservation_Populate(bool doingCopy)
        {
            try
            {
                //bool updated = false;
   				//string inheritMsg = null;
                //BEGIN TT#798 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateIMOData to hierarchy service 
                IMODataSet IMOds = new IMODataSet();
                _imoDataSet = IMOds.Reservation_Define(_imoDataSet);
                //Reservation_Define();
                //END TT#798 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateIMOData to hierarchy service 
                ugReservation.DataSource = _imoDataSet;
                string FWOSMax = string.Empty; //TT#108 - MD - DOConnell - FWOS Max Model 
                IMOProfile imop;

                foreach (StoreGroupLevelListViewProfile sglp in _imoGroupLevelList)
                {
                    _imoDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, string.Empty, string.Empty, string.Empty, string.Empty, string.Empty, string.Empty, string.Empty }); //TT#108 - MD - DOConnell - FWOS Max Model 

                    foreach (StoreProfile storeProfile in sglp.Stores)
                    {
                        //updated = false;
                        if ((_imoProfileList != null) && (_imoProfileList.Contains(storeProfile.Key)))
                        {
                            //  the profile exists
                            imop = (IMOProfile)_imoProfileList.FindKey(storeProfile.Key);
                            //if (doingCopy)
                            //{
                            //    updated = true;
                            //}
                            imop.IMOIsDefault = false;
							//BEGIN TT#108 - MD - DOConnell - FWOS Max Model 
                            // Begin TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
                            //if (imop.IMOFWOS_Max != int.MaxValue)
                            //{
                            // End TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
                                switch (imop.IMOFWOS_MaxType)
                                {
                                    case eModifierType.Model:
                                        FWOSMax = imop.IMOFWOS_MaxModelName;
                                        break;
                                    case eModifierType.Percent:
                                        FWOSMax = imop.IMOFWOS_Max.ToString(CultureInfo.CurrentUICulture);
                                        break;
                                    default:
                                        FWOSMax = string.Empty;
                                        break;
                                }
                            // Begin TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
                            //}
                            //else
                            //{
                            //    FWOSMax = string.Empty;
                            //}
                            // End TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
							//END TT#108 - MD - DOConnell - FWOS Max Model 
                        }
                        else
                        {
                            //  create a new profile with existing data
                            //  is this node inherited?
                            //      if so, get it
                            //      if not, make it up
                            imop = new IMOProfile(storeProfile.Key);
                            imop.IMOStoreRID = storeProfile.Key;
                            imop.IMONodeRID = this.NodeRID;
                            imop.IMOIsDefault = true;
                        }

                        _imoDataSet.Tables["Stores"].Rows.Add(new object[] {sglp.Name, 
                            imop.IMOIsInherited, 
                            imop.IMOInheritedFromNodeRID, 
                            false, 
                            imop.IMOStoreRID, 
                            storeProfile.Text,
                            (storeProfile.IMO_ID ?? String.Empty),
                            (((imop.IMOIsDefault == true) || (imop.IMOMinShipQty == 0)) ? String.Empty : imop.IMOMinShipQty.ToString()),
                            //(((imop.IMOIsDefault == true) || (imop.IMOPackQty == .5)) ? String.Empty : imop.IMOPackQty.ToString()),    
                            (((imop.IMOIsDefault == true) || (imop.IMOPackQty == .5)) ? String.Empty : (imop.IMOPackQty*100).ToString()),    
                            (((imop.IMOIsDefault == true) || (imop.IMOMaxValue == int.MaxValue)) ? String.Empty : imop.IMOMaxValue.ToString()), 
                            //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                            //(((imop.IMOIsDefault == true) || (imop.IMOFWOS_Max == int.MaxValue)) ? String.Empty : imop.IMOFWOS_Max.ToString()), // TT#2225 - gtaylor - ANF VSW
                            //(((imop.IMOIsDefault == true) || (imop.IMOFWOS_Max == int.MaxValue)) ? String.Empty : FWOSMax),
                            FWOSMax,
                            (((imop.IMOIsDefault == true) || (imop.IMOFWOS_MaxModelRID == int.MaxValue)) ? String.Empty : imop.IMOFWOS_MaxModelRID.ToString()),
                            //END TT#108 - MD - DOConnell - FWOS Max Model
                            (((imop.IMOIsDefault == true) || (imop.IMOPshToBackStock < 0)) ? String.Empty : imop.IMOPshToBackStock.ToString())
                        });
                    }
                }
                ugReservation.DataSource = _imoDataSet;
                FunctionSecurityProfile securityProfile = _securityNodeProperties;
                if (!_newNode)
                {
                    securityProfile = _securityIMO;
                    SetControlReadOnly(this.tabReservation, !securityProfile.AllowUpdate);
                }

                Reservation_SetRowProperties(securityProfile);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void Reservation_SetRowProperties(FunctionSecurityProfile securityProfile)
        {
            try
            {
                HierarchyNodeProfile hnp = null;
                int inheritedRID;

                Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                foreach (UltraGridRow setRow in this.ugReservation.Rows)
                {
                    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                    {
                        //  if there is no reservation store, the user shouldn't be able to edit the fields.
                        if (storeRow.Cells["Reservation Store"].Text == "")
                        {
                            storeRow.Cells["Min Ship Qty"].Activation = Activation.NoEdit;
                            storeRow.Cells["Pct Pack Threshold"].Activation = Activation.NoEdit;
                            storeRow.Cells["Item Max"].Activation = Activation.NoEdit;
                            storeRow.Cells["FWOS Max"].Activation = Activation.NoEdit; // TT#2225 - gtaylor - ANF VSW
                            storeRow.Cells["Push to Backstock"].Activation = Activation.NoEdit;
                        }
                        // if it is inherited then put the information in
                        if (storeRow.Cells["Inherited"].Text == "True")
                        {
                            inheritedRID = Convert.ToInt32(storeRow.Cells["Inherited RID"].Value, CultureInfo.CurrentUICulture);
                            if (hnp == null || hnp.Key != inheritedRID)
                            {
                                hnp = _SAB.HierarchyServerSession.GetNodeData(inheritedRID);
                            }
                            string inheritMsg = _txtInheritedFrom + hnp.Text;
                            storeRow.Cells["Store ID"].Appearance.Image = InheritanceImage;
                            storeRow.Cells["Store ID"].Tag = inheritMsg;
                            storeRow.Cells["Store ID"].ToolTipText = inheritMsg;
                        }
                        //  if it is not inherited then clear it all
                        else
                        {
                            storeRow.Cells["Store ID"].Appearance.Image = null;
                            storeRow.Cells["Store ID"].Tag = null;
                            storeRow.Cells["Store ID"].ToolTipText = null;
                        }
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void Reservation_Define()
        {
            try
            {
                _imoDataSet = MIDEnvironment.CreateDataSet("reservationDataSet");

                DataTable setTable = _imoDataSet.Tables.Add("Sets");

                DataColumn dataColumn;
                //Create Columns and rows for datatable

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "SetID";
                dataColumn.ReadOnly = true;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Reservation Store";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Min Ship Qty";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Pct Pack Threshold";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);
                
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Item Max";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);

                // BEGIN TT#2225 - gtaylor - ANF VSW
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "FWOS Max";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);
                // END TT#2225 - gtaylor - ANF VSW

                //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "FWOS Max RID";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);
                //END TT#108 - MD - DOConnell - FWOS Max Model

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Push to Backstock";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                setTable.Columns.Add(dataColumn);

                //make set ID the primary key
                DataColumn[] PrimaryKeyColumn = new DataColumn[1];
                PrimaryKeyColumn[0] = setTable.Columns["SetID"];
                setTable.PrimaryKey = PrimaryKeyColumn;

                DataTable storeTable = _imoDataSet.Tables.Add("Stores");

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "SetID";
                dataColumn.ReadOnly = true;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Boolean");
                dataColumn.ColumnName = "Inherited";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
                dataColumn.ColumnName = "Inherited RID";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Boolean");
                dataColumn.ColumnName = "Updated";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
                dataColumn.ColumnName = "Store RID";
                dataColumn.ReadOnly = true;
                dataColumn.Unique = true;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Store ID";
                dataColumn.ReadOnly = true;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Reservation Store";
                dataColumn.ReadOnly = true;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Min Ship Qty";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                //dataColumn = new DataColumn();
                //dataColumn.DataType = System.Type.GetType("System.Int32");
                //dataColumn.ColumnName = "Min Ship Qty Inherited RID";
                //dataColumn.ReadOnly = false;
                //dataColumn.Unique = false;
                //storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Pct Pack Threshold";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                //dataColumn = new DataColumn();
                //dataColumn.DataType = System.Type.GetType("System.Int32");
                //dataColumn.ColumnName = "Pct Pack Threshold Inherited RID";
                //dataColumn.ReadOnly = false;
                //dataColumn.Unique = false;
                //storeTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Item Max";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                //dataColumn = new DataColumn();
                //dataColumn.DataType = System.Type.GetType("System.Int32");
                //dataColumn.ColumnName = "Item Max Inherited RID";
                //dataColumn.ReadOnly = false;
                //dataColumn.Unique = false;
                //storeTable.Columns.Add(dataColumn);

                // BEGIN TT#2225 - gtaylor - ANF VSW
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "FWOS Max";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);
                // END TT#2225 - gtaylor - ANF VSW

                //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "FWOS Max RID";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);
                //END TT#108 - MD - DOConnell - FWOS Max Model

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.ColumnName = "Push to Backstock";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeTable.Columns.Add(dataColumn);

                //dataColumn = new DataColumn();
                //dataColumn.DataType = System.Type.GetType("System.Int32");
                //dataColumn.ColumnName = "Push to Backstock Inherited RID";
                //dataColumn.ReadOnly = false;
                //dataColumn.Unique = false;
                //storeTable.Columns.Add(dataColumn);

                _imoDataSet.Relations.Add("Stores",
                    _imoDataSet.Tables["Sets"].Columns["SetID"],
                    _imoDataSet.Tables["Stores"].Columns["SetID"]);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private bool ValidTabReservation(ref EditMsgs em)
        {
            try
            {
                //if (FormIsClosing && !SaveOnClose)
                //{
                //    return true;
                //}

                if (ItemMaxEntryError)
                {
                    em.AddMsg(eMIDMessageLevel.Edit, SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_al_ItemMaxRequired), this.ToString());
                }
                // BEGIN TT#2225 - gtaylor - ANF VSW
                if (FWOSMaxEntryError)
                {
                    em.AddMsg(eMIDMessageLevel.Edit, SAB.ClientServerSession.Audit.GetText(eMIDTextCode.lbl_IMO_FWOS_MAX_REQUIRED), this.ToString());
                }
                // END TT#2225 - gtaylor - ANF VSW
                if (em.ErrorFound)
                {
                    return false;
                }
                else
                {
                    return true;
                }
            }
            catch (Exception exception)
            {
                em.AddMsg(eMIDMessageLevel.Error, exception.Message, this.ToString());
                HandleException(exception);
            }

            return false;
        }

        private void AdjustIMOGridMenu(Infragistics.Win.UltraWinGrid.UltraGridCell gridCell)
        {
            try
            {
                _gridCell = gridCell;
                switch (gridCell.Column.Key)
                {
                    case "FWOS Max":
                        _modelType = eModelType.FWOSMax;
                        _currentModelID = gridCell.Text;
                        if (!mnuIMOGrid.MenuItems.Contains(_mnuItemOpenModel))
                        {
                            mnuIMOGrid.MenuItems.Add(0, _mnuItemOpenModel);
                            mnuIMOGrid.MenuItems.Add(1, _mnuItemNewModel);
                            mnuIMOGrid.MenuItems.Add(2, _mnuItemSeparator);
                        }
                        break;
                    default:
                        if (mnuIMOGrid.MenuItems.Contains(_mnuItemOpenModel))
                        {
                            mnuIMOGrid.MenuItems.Remove(_mnuItemOpenModel);
                            mnuIMOGrid.MenuItems.Remove(_mnuItemNewModel);
                            mnuIMOGrid.MenuItems.Remove(_mnuItemSeparator);
                        }
                        break;
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }


        // End TT#1401 - Reservation Stores
        #endregion

        #region Store Eligibility Tab

		private void ugStoreEligibility_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_eligibilityGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.eligibilityGrid);
					if (layout.LayoutLength > 0)
					{
						ugStoreEligibility.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultEligibilityGridLayout();
					}
					EligibilityGridLayout();
					_eligibilityGridBuilt = true;
				}

				if (!_securityEligibility.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugStoreEligibility.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugStoreEligibility.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		/// <summary>
		/// Contains changes to the grid layout to override saved layout
		/// </summary>

		private void EligibilityGridLayout()
		{
			try
			{
				this.ugStoreEligibility.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugStoreEligibility.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugStoreEligibility.DisplayLayout.AddNewBox.Hidden = true;
				this.ugStoreEligibility.DisplayLayout.GroupByBox.Hidden = true;
				this.ugStoreEligibility.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["SimilarStoresArrayList"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["SimilarStoresArrayList"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store Changed"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Inherited RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stk Mod Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier Inherited RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sls Mod Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier Inherited RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Mod Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier Inherited RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sim Str Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store Inherited RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Store"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Eligibility);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Ineligible"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Ineligible);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sales_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_FWOS_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Until"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Ratio"].Header.Caption =  MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Ratio);

				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Eligibility);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Ineligible"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Ineligible);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sales_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_FWOS_Modifier);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Until"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Ratio"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Ratio);

				this.uddEligModel.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].Width;
				this.uddStockModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].Width;
				this.uddSalesModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].Width;
				this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Width;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].ValueList = this.uddEligModel;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].ValueList = this.uddFWOSModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].ValueList = this.uddEligModel;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].ValueList = this.uddFWOSModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].AutoEdit = true;

				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["PMPlusSales"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.TriStateCheckBox;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["PMPlusSales"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.TriStateCheckBox;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["PMPlusSales Inherited"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["PMPlusSales Inherited RID"].Hidden = true;
				_customWindowsRoutines.SetElibigilityPMPlusSalesColVisibility(ugStoreEligibility);

                // Begin TT#94 - JSmith - Eligibility tab - Need to Freeze Store/Set ID on left side of window during scrolling
                this.ugStoreEligibility.DisplayLayout.UseFixedHeaders = true;
                this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Fixed = true;
                this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Store"].Header.Fixed = true;
                // End TT#94

                //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement
				//this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Lead Weeks"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Lead_Weeks);
				//this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Lead Weeks Inherited"].Hidden = true;
				//this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Lead Weeks Inherited RID"].Hidden = true;
				//this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Lead Weeks"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Lead_Weeks);
                //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement
				
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultEligibilityGridLayout()
		{
			try
			{
				this.ugStoreEligibility.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["SetID"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Ineligible"].Width = 55;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Until"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Until RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Used Store Selector"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store Changed"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].ValueList = this.uddEligModel;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Until"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Until"].AutoEdit = false;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Ineligible"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Ratio"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["SetID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Store"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Ineligible"].Width = 55;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Width = 100;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Until"].Width = 100;

				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Updated"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Store RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Until RID"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Used Store Selector"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store Changed"].Hidden = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].ValueList = this.uddEligModel;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].ValueList = this.uddSalesModifier;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].AutoEdit = true;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Until"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Until"].AutoEdit = false;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Ineligible"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Ratio"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugStoreEligibility);
                //End TT#169

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreEligibilityTab_Load()
		{
			try
			{
				StoreEligibility_Attributes_Populate();
			
			
				BuildEligibilityModelList();

				BuildStockModifierModelList();

				BuildSalesModifierModelList();

				BuildFWOSModifierModelList();
			
				if (_hnp.Key == Include.NoRID)	// new node so get parent's elig
				{
					_storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, _hnp.HomeHierarchyParentRID, true, false);
				}
				else
				{
					_storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, _hnp.Key, true, false);
				}
				StoreEligibility_Populate(false);
				BuildStoreEligibilityContextmenu();
				this.ugStoreEligibility.ContextMenu = mnuStoreEligibilityGrid;

				ugStoreEligibility.ActiveRow = ugStoreEligibility.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);
				_eligibilityIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildEligibilityModelList()
		{
			try
			{
				this.ugStoreEligibility.BeginUpdate();
				this.ugStoreEligibility.SuspendRowSynchronization();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].ValueList = null;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].ValueList = null;
				}

				_eligibilityModelProfileList = _SAB.HierarchyServerSession.GetEligModels();
				this.uddEligModel.BeginUpdate();
				// set DataSource to null to remove all prior bindings
				this.uddEligModel.DataSource = null;
				this.uddEligModel.DataSource = _eligibilityModelProfileList.ArrayList;
				this.uddEligModel.DisplayLayout.Bands[0].Columns["Key"].Hidden = true;
				this.uddEligModel.DisplayLayout.Bands[0].Columns["ProfileType"].Hidden = true;

                //Begin TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                // InstanceID property was added to the base profile class to support group allocation - and is getting picked up by the inherited class ModelName
                this.uddEligModel.DisplayLayout.Bands[0].Columns["InstanceID"].Hidden = true;
                //End TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                


                // Begin TT#2228 - JSmith - Checkbox shows on dropdown
                this.uddEligModel.DisplayLayout.Bands[0].Columns["isFound"].Hidden = true;
                // End TT#2228
				this.uddEligModel.DisplayLayout.Bands[0].ColHeadersVisible = false;
				this.uddEligModel.DisplayMember = "ModelID";
				this.uddEligModel.ValueMember = "ModelID";
				this.uddEligModel.DisplayLayout.Override.BorderStyleCell = Infragistics.Win.UIElementBorderStyle.None;
				this.uddEligModel.DisplayLayout.Override.BorderStyleRow = Infragistics.Win.UIElementBorderStyle.None;
				this.uddEligModel.EndUpdate();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].ValueList = this.uddEligModel;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Eligibility"].ValueList = this.uddEligModel;
                    // Begin TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                    // In Use does not allow models to be deleted if referenced in Node Properties
                    // remove all deleted models from the grid
                    //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
                    //{
                    //    if (!_eligibilityModelProfileList.Contains(Convert.ToInt32(setRow.Cells["Eligibility RID"].Value, CultureInfo.CurrentUICulture)))
                    //    {
                    //        setRow.Cells["Eligibility"].Value = string.Empty;
                    //        setRow.Cells["Eligibility RID"].Value = Include.NoRID;
                    //    }
                    //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    //    foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
                    //    {
                    //        if (!_eligibilityModelProfileList.Contains(Convert.ToInt32(storeRow.Cells["Eligibility RID"].Value, CultureInfo.CurrentUICulture)))
                    //        {
                    //            storeRow.Cells["Eligibility"].Value = string.Empty;
                    //            storeRow.Cells["Eligibility RID"].Value = Include.NoRID;
                    //        }
                    //    }
                    //}
                    // End TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
				}

                // Begin TT#2609 - JSmith - Node Properties
                if (this.ugStoreEligibility.DisplayLayout.Bands.Exists("Sets"))
                {
                    this.uddEligModel.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].Width;
                }
                // End TT#2609 - JSmith - Node Properties

				this.ugStoreEligibility.ResumeRowSynchronization();
				this.ugStoreEligibility.EndUpdate();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildSalesModifierModelList()
		{
			try
			{
				this.ugStoreEligibility.BeginUpdate();
				this.ugStoreEligibility.SuspendRowSynchronization();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].ValueList = null;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].ValueList = null;
				}

				_salesModifierProfileList = _SAB.HierarchyServerSession.GetSlsModModels();
				this.uddSalesModifier.BeginUpdate();
				// set DataSource to null to remove all prior bindings
				this.uddSalesModifier.DataSource = null;
				this.uddSalesModifier.DataSource = _salesModifierProfileList.ArrayList;
				this.uddSalesModifier.DisplayMember = "ModelID";
				this.uddSalesModifier.ValueMember = "ModelID";
				this.uddSalesModifier.DisplayLayout.Bands[0].Columns["Key"].Hidden = true;
				this.uddSalesModifier.DisplayLayout.Bands[0].Columns["ProfileType"].Hidden = true;
                //Begin TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                // InstanceID property was added to the base profile class to support group allocation - and is getting picked up by the inherited class ModelName
                this.uddSalesModifier.DisplayLayout.Bands[0].Columns["InstanceID"].Hidden = true;
                //End TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data

                // Begin TT#2228 - JSmith - Checkbox shows on dropdown
                this.uddSalesModifier.DisplayLayout.Bands[0].Columns["isFound"].Hidden = true;
                // End TT#2228
				this.uddSalesModifier.DisplayLayout.Bands[0].ColHeadersVisible = false;
				this.uddSalesModifier.DisplayLayout.Override.BorderStyleCell = Infragistics.Win.UIElementBorderStyle.None;
				this.uddSalesModifier.DisplayLayout.Override.BorderStyleRow = Infragistics.Win.UIElementBorderStyle.None;
				this.uddSalesModifier.EndUpdate();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Sales Modifier"].ValueList = this.uddSalesModifier;
                    // Begin TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                    // In Use does not allow models to be deleted if referenced in Node Properties
					// remove all deleted models from the grid
                    //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
                    //{
                    //    if (!_salesModifierProfileList.Contains(Convert.ToInt32(setRow.Cells["Sales Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //    {
                    //        setRow.Cells["Sales Modifier"].Value = string.Empty;
                    //        setRow.Cells["Sales Modifier RID"].Value = Include.NoRID;
                    //    }
                    //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    //    foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
                    //    {
                    //        if (!_salesModifierProfileList.Contains(Convert.ToInt32(storeRow.Cells["Sales Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //        {
                    //            storeRow.Cells["Sales Modifier"].Value = string.Empty;
                    //            storeRow.Cells["Sales Modifier RID"].Value = Include.NoRID;
                    //        }
                    //    }
                    //}
                    // End TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
				}

                // Begin TT#2609 - JSmith - Node Properties
                if (this.ugStoreEligibility.DisplayLayout.Bands.Exists("Sets"))
                {
                    this.uddSalesModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].Width;
                }
                // End TT#2609 - JSmith - Node Properties

				this.ugStoreEligibility.ResumeRowSynchronization();
				this.ugStoreEligibility.EndUpdate();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildStockModifierModelList()
		{
			try
			{
				this.ugStoreEligibility.BeginUpdate();
				this.ugStoreEligibility.SuspendRowSynchronization();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].ValueList = null;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].ValueList = null;
				}

				_stockModifierProfileList = _SAB.HierarchyServerSession.GetStkModModels();
				this.uddStockModifier.BeginUpdate();
				// set DataSource to null to remove all prior bindings
				this.uddStockModifier.DataSource = null;
				this.uddStockModifier.DataSource = _stockModifierProfileList.ArrayList;
				this.uddStockModifier.DisplayMember = "ModelID";
				this.uddStockModifier.ValueMember = "ModelID";
				this.uddStockModifier.DisplayLayout.Bands[0].Columns["Key"].Hidden = true;
				this.uddStockModifier.DisplayLayout.Bands[0].Columns["ProfileType"].Hidden = true;
                //Begin TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                // InstanceID property was added to the base profile class to support group allocation - and is getting picked up by the inherited class ModelName
                this.uddStockModifier.DisplayLayout.Bands[0].Columns["InstanceID"].Hidden = true;
                //End TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data

                // Begin TT#2228 - JSmith - Checkbox shows on dropdown
                this.uddStockModifier.DisplayLayout.Bands[0].Columns["isFound"].Hidden = true;
                // End TT#2228
				this.uddStockModifier.DisplayLayout.Bands[0].ColHeadersVisible = false;
				this.uddStockModifier.DisplayLayout.Override.BorderStyleCell = Infragistics.Win.UIElementBorderStyle.None;
				this.uddStockModifier.DisplayLayout.Override.BorderStyleRow = Infragistics.Win.UIElementBorderStyle.None;
				this.uddStockModifier.EndUpdate();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Stock Modifier"].ValueList = this.uddStockModifier;
                    // Begin TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                    // In Use does not allow models to be deleted if referenced in Node Properties
					// remove all deleted models from the grid
                    //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
                    //{
                    //    if (!_stockModifierProfileList.Contains(Convert.ToInt32(setRow.Cells["Stock Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //    {
                    //        setRow.Cells["Stock Modifier"].Value = string.Empty;
                    //        setRow.Cells["Stock Modifier RID"].Value = Include.NoRID;
                    //    }
                    //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    //    foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
                    //    {
                    //        if (!_stockModifierProfileList.Contains(Convert.ToInt32(storeRow.Cells["Stock Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //        {
                    //            storeRow.Cells["Stock Modifier"].Value = string.Empty;
                    //            storeRow.Cells["Stock Modifier RID"].Value = Include.NoRID;
                    //        }
                    //    }
                    //}
                    // End TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
				}

                // Begin TT#2609 - JSmith - Node Properties
                if (this.ugStoreEligibility.DisplayLayout.Bands.Exists("Sets"))
                {
                    this.uddStockModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].Width;
                }
                // End TT#2609 - JSmith - Node Properties

				this.ugStoreEligibility.ResumeRowSynchronization();
				this.ugStoreEligibility.EndUpdate();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildFWOSModifierModelList()
		{
			try
			{
				this.ugStoreEligibility.BeginUpdate();
				this.ugStoreEligibility.SuspendRowSynchronization();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].ValueList = null;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].ValueList = null;
				}

				_FWOSModifierProfileList = _SAB.HierarchyServerSession.GetFWOSModModels();
				this.uddFWOSModifier.BeginUpdate();
				// set DataSource to null to remove all prior bindings
				this.uddFWOSModifier.DataSource = null;
				this.uddFWOSModifier.DataSource = _FWOSModifierProfileList.ArrayList;
				this.uddFWOSModifier.DisplayMember = "ModelID";
				this.uddFWOSModifier.ValueMember = "ModelID";
				this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["Key"].Hidden = true;
				this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["ProfileType"].Hidden = true;
                //Begin TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                // InstanceID property was added to the base profile class to support group allocation - and is getting picked up by the inherited class ModelName
                this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["InstanceID"].Hidden = true;
                //End TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data

                // Begin TT#2228 - JSmith - Checkbox shows on dropdown
                this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["isFound"].Hidden = true;
                // End TT#2228
				this.uddFWOSModifier.DisplayLayout.Bands[0].ColHeadersVisible = false;
				this.uddFWOSModifier.DisplayLayout.Override.BorderStyleCell = Infragistics.Win.UIElementBorderStyle.None;
				this.uddFWOSModifier.DisplayLayout.Override.BorderStyleRow = Infragistics.Win.UIElementBorderStyle.None;
				this.uddFWOSModifier.EndUpdate();

				if (_eligibilityGridBuilt)
				{
					this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].ValueList = this.uddFWOSModifier;
					this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["FWOS Modifier"].ValueList = this.uddFWOSModifier;
                    // Begin TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                    // In Use does not allow models to be deleted if referenced in Node Properties
					// remove all deleted models from the grid
                    //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
                    //{
                    //    if (!_FWOSModifierProfileList.Contains(Convert.ToInt32(setRow.Cells["FWOS Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //    {
                    //        setRow.Cells["FWOS Modifier"].Value = string.Empty;
                    //        setRow.Cells["FWOS Modifier RID"].Value = Include.NoRID;
                    //    }
                    //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    //    foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
                    //    {
                    //        if (!_FWOSModifierProfileList.Contains(Convert.ToInt32(storeRow.Cells["FWOS Modifier RID"].Value, CultureInfo.CurrentUICulture)))
                    //        {
                    //            storeRow.Cells["FWOS Modifier"].Value = string.Empty;
                    //            storeRow.Cells["FWOS Modifier RID"].Value = Include.NoRID;
                    //        }
                    //    }
                    //}
                    // End TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
				}

                // Begin TT#2609 - JSmith - Node Properties
                if (this.ugStoreEligibility.DisplayLayout.Bands.Exists("Sets"))
                {
                    this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Width;
                }
                // End TT#2609 - JSmith - Node Properties

				this.ugStoreEligibility.ResumeRowSynchronization();
				this.ugStoreEligibility.EndUpdate();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
        private void BuildFWOSMaxModelList()
        {
            try
            {
                
                this.ugReservation.BeginUpdate();
                this.ugReservation.SuspendRowSynchronization();

                if (_reservationGridBuilt)
                {
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].ValueList = null;
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].ValueList = null;
                }

                _FWOSMaxProfileList = _SAB.HierarchyServerSession.GetFWOSMaxModels();
                this.uddFWOSMax.BeginUpdate();
                // set DataSource to null to remove all prior bindings
                this.uddFWOSMax.DataSource = null;
                this.uddFWOSMax.DataSource = _FWOSMaxProfileList.ArrayList;
                this.uddFWOSMax.DisplayMember = "ModelID";
                this.uddFWOSMax.ValueMember = "ModelID";
                this.uddFWOSMax.DisplayLayout.Bands[0].Columns["Key"].Hidden = true;
                this.uddFWOSMax.DisplayLayout.Bands[0].Columns["ProfileType"].Hidden = true;

                //Begin TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data
                // InstanceID property was added to the base profile class to support group allocation - and is getting picked up by the inherited class ModelName
                this.uddFWOSMax.DisplayLayout.Bands[0].Columns["InstanceID"].Hidden = true;
                //End TT#1308-MD -jsobek -Store Eligibility Node Properties drop downs displaying incorrect data

                // Begin TT#2228 - JSmith - Checkbox shows on dropdown
                this.uddFWOSMax.DisplayLayout.Bands[0].Columns["isFound"].Hidden = true;
                // End TT#2228
                this.uddFWOSMax.DisplayLayout.Bands[0].ColHeadersVisible = false;
                this.uddFWOSMax.DisplayLayout.Override.BorderStyleCell = Infragistics.Win.UIElementBorderStyle.None;
                this.uddFWOSMax.DisplayLayout.Override.BorderStyleRow = Infragistics.Win.UIElementBorderStyle.None;
                this.uddFWOSMax.EndUpdate();

                if (_reservationIsPopulated)
                {
                    this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].ValueList = this.uddFWOSMax;
                    this.ugReservation.DisplayLayout.Bands["Stores"].Columns["FWOS Max"].ValueList = this.uddFWOSMax;
                    // Begin TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                    // In Use does not allow models to be deleted if referenced in Node Properties
                    // remove all deleted models from the grid
                    //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                    //foreach (UltraGridRow setRow in this.ugReservation.Rows)
                    //{
                    //    if (Convert.ToString(setRow.Cells["FWOS Max RID"].Value, CultureInfo.CurrentUICulture).Length > 0)
                    //    {
                    //        if (!_FWOSMaxProfileList.Contains(Convert.ToInt32(setRow.Cells["FWOS Max RID"].Value, CultureInfo.CurrentUICulture)))
                    //        {
                    //            setRow.Cells["FWOS Max"].Value = string.Empty;
                    //            setRow.Cells["FWOS Max RID"].Value = Include.NoRID;
                    //        }
                    //    }
                    //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                    //    foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                    //    {
                    //        if (Convert.ToString(storeRow.Cells["FWOS Max RID"].Value, CultureInfo.CurrentUICulture).Length > 0)
                    //        {
                    //            if (!_FWOSMaxProfileList.Contains(Convert.ToInt32(storeRow.Cells["FWOS Max RID"].Value, CultureInfo.CurrentUICulture)))
                    //            {
                    //                storeRow.Cells["FWOS Max"].Value = string.Empty;
                    //                storeRow.Cells["FWOS Max RID"].Value = Include.NoRID;
                    //            }
                    //        }
                    //    }
                    //}
                    // End TT#4062 - JSmith - Saving a Sales Modifier Model clears out applied Sales Modifier Value changes
                }

                // Begin TT#2609 - JSmith - Node Properties
                if (this.ugReservation.DisplayLayout.Bands.Exists("Sets"))
                {
                    this.uddFWOSMax.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugReservation.DisplayLayout.Bands["Sets"].Columns["FWOS Max"].Width;
                }
                // End TT#2609 - JSmith - Node Properties

                this.ugReservation.ResumeRowSynchronization();
                this.ugReservation.EndUpdate();
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }
        //END TT#108 - MD - DOConnell - FWOS Max Model

		private void BuildStoreEligibilityContextmenu()
		{
			try
			{
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSEItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuSEItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSEItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSEItemDelete_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSEItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStoreEligibility.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSEItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStoreEligibility.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuStoreEligibilityGrid_Popup(object sender, System.EventArgs e)
		{
			try
			{
                // Begin TT#2609 - JSmith - Node Properties
                ugStoreEligibility.PerformAction(UltraGridAction.ExitEditMode);
                // End TT#2609 - JSmith - Node Properties

				mnuStoreEligibilityGrid.MenuItems.Clear();
				MenuItem mnuItemApplyAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyAll));
				MenuItem mnuItemApplyColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyColumn));
				MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
				MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
				MenuItem mnuItemClearAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearAll)); 
				MenuItem mnuItemClearColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearColumn));
				MenuItem mnuItemReset = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Reset_Messages));
				
				switch (_modelType)
				{
					case eModelType.Eligibility:
						if (_eligibilityModelProfileList.Count == 0)
						{
							_mnuItemOpenModel.Enabled = false;
						}
						else
							if (_securityEligibilityModels.AllowUpdate ||
							_securityEligibilityModels.AllowView)
						{
							_mnuItemOpenModel.Enabled = true;
						}
						else
						{
							_mnuItemOpenModel.Enabled = false;
						}

						if (_securityEligibilityModels.AllowUpdate)
						{
							_mnuItemNewModel.Enabled = true;
						}
						else
						{
							_mnuItemNewModel.Enabled = false;
						}

						break;
					case eModelType.SalesModifier:
						if (_salesModifierProfileList.Count == 0)
						{
							_mnuItemOpenModel.Enabled = false;
						}
						else
							if (_securitySalesModifierModels.AllowUpdate ||
							_securitySalesModifierModels.AllowView)
						{
							_mnuItemOpenModel.Enabled = true;
						}
						else
						{
							_mnuItemOpenModel.Enabled = false;
						}

						if (_securitySalesModifierModels.AllowUpdate)
						{
							_mnuItemNewModel.Enabled = true;
						}
						else
						{
							_mnuItemNewModel.Enabled = false;
						}

						break;
					case eModelType.StockModifier:
						if (_stockModifierProfileList.Count == 0)
						{
							_mnuItemOpenModel.Enabled = false;
						}
						if (_securityStockModifierModels.AllowUpdate ||
							_securityStockModifierModels.AllowView)
						{
							_mnuItemOpenModel.Enabled = true;
						}
						else
						{
							_mnuItemOpenModel.Enabled = false;
						}

						if (_securityStockModifierModels.AllowUpdate)
						{
							_mnuItemNewModel.Enabled = true;
						}
						else
						{
							_mnuItemNewModel.Enabled = false;
						}

						break;
					case eModelType.FWOSModifier:
						if (_FWOSModifierProfileList.Count == 0)
						{
							_mnuItemOpenModel.Enabled = false;
						}
						if (_securityFWOSModifierModels.AllowUpdate ||
							_securityFWOSModifierModels.AllowView)
						{
							_mnuItemOpenModel.Enabled = true;
						}
						else
						{
							_mnuItemOpenModel.Enabled = false;
						}

						if (_securityFWOSModifierModels.AllowUpdate)
						{
							_mnuItemNewModel.Enabled = true;
						}
						else
						{
							_mnuItemNewModel.Enabled = false;
						}

						break;
				}
				if (this.ugStoreEligibility.ActiveRow == null ||
					this.ugStoreEligibility.ActiveRow.Band.Key != "Sets")
				{
					mnuItemApplyAll.Enabled = false;	
					mnuItemApplyColumn.Enabled = false;	
				}
				else
				{
					mnuItemApplyAll.Enabled = true;	
					mnuItemApplyColumn.Enabled = true;	
				}

				if (!_securityEligibility.AllowUpdate)
				{
					mnuItemApplyAll.Enabled = false;	
					mnuItemApplyColumn.Enabled = false;	
					mnuItemClearAll.Enabled = false;	
					mnuItemClearColumn.Enabled = false;	
				}

				if (ugStoreEligibility.ActiveCell != null)
				{
					AdjustStoreEligibilityGridMenu(ugStoreEligibility.ActiveCell);
				}
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemApplyAll);
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemApplyColumn);
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemClearAll);
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemClearColumn);
				mnuStoreEligibilityGrid.MenuItems.Add("-");
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemExpandAll);
				mnuStoreEligibilityGrid.MenuItems.Add(mnuItemCollapseAll);
				mnuItemApplyAll.Click += new System.EventHandler(this.mnuSEItemApplyAll_Click);
				mnuItemApplyColumn.Click += new System.EventHandler(mnuSEItemApplyColumn_Click);
				mnuItemExpandAll.Click += new System.EventHandler(this.mnuSEItemExpandAll_Click);
				mnuItemCollapseAll.Click += new System.EventHandler(this.mnuSEItemCollapseAll_Click);
				mnuItemClearAll.Click += new System.EventHandler(this.mnuSEItemClearAll_Click);
				mnuItemClearColumn.Click += new System.EventHandler(this.mnuSEItemClearColumn_Click);
				mnuItemReset.Click += new System.EventHandler(this.mnuSEItemReset_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSEItemApplyAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				SEItemApply(true, true, true, true, true, true, true, true, true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void mnuSEItemApplyColumn_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				bool updateEligibilityModel=false;
				bool updateIneligible=false;
				bool updateStockModifier=false;
				bool updateSalesModifier=false;
				bool updateFWOSModifier=false;
				bool updateSimilarStore=false;
				bool updateRatio=false;
				bool updateUntil=false;
				bool updatePMPlusSales = false;
				if (this.ugStoreEligibility.ActiveCell != null)
				{
					switch (this.ugStoreEligibility.ActiveCell.Column.Key)
					{
						case "Eligibility":
							updateEligibilityModel = true;
							break;
						case "Ineligible":
							updateIneligible = true;
							break;
						case "Stock Modifier":
							updateStockModifier = true;
							break;
						case "Sales Modifier":
							updateSalesModifier = true;
							break;
						case "FWOS Modifier":
							updateFWOSModifier = true;
							break;
						case "Similar Store":
							updateSimilarStore = true;
							break;
						case "Ratio":
							updateRatio = true;
							break;
						case "Until":
							updateUntil = true;
							break;
						case "PMPlusSales":
							updatePMPlusSales = true;
							break;
						default:
							string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
							text = text.Replace("{0}", this.ugStoreEligibility.ActiveCell.Column.Key);
							MessageBox.Show (text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
							break;
					}
					SEItemApply(updateEligibilityModel, updateIneligible, updateStockModifier,
						updateSalesModifier, updateFWOSModifier, updateSimilarStore, updateRatio, updateUntil,
						updatePMPlusSales);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void SEItemApply(bool updateEligibilityModel, bool updateIneligible, bool updateStockModifier,
			bool updateSalesModifier, bool updateFWOSModifier, bool updateSimilarStore, bool updateRatio, bool updateUntil,
			bool updatePMPlusSales)
		{
			string errorMessage = null;
			try
			{
				if (this.ugStoreEligibility.ActiveRow == null)
				{
					this.Cursor = Cursors.Default;
					MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					if (ugStoreEligibility.ActiveCell != null)
					{
						ugStoreEligibility.ActiveCell.Row.Update();
					}

					Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreEligibility.ActiveRow.Band;
					Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreEligibility.ActiveRow;

					Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
					if (activeRowBand.Key == "Sets")		// apply values to all stores in set
					{
						int setCalendarDateRangeRID = Convert.ToInt32(activeRow.Cells["Until RID"].Value, CultureInfo.CurrentCulture);
						ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
                        foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                        {
							//BEGIN TT#3730 - DOConnelll - Uploading Eligibility Model clears inherited Ineligible check
							//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                            //if (Convert.ToBoolean(storeRow.Cells["Ineligible"].Value) == false)
                            //{
							//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                storeRow.Cells["Updated"].Value = true;
                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateEligibilityModel)
                                //BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateEligibilityModel && ((bool)activeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Eligibility RID"].Value != Include.NoRID))
                                //if (updateEligibilityModel && ((bool)storeRow.Cells["Inherited"].Value == false || (int)storeRow.Cells["Eligibility RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
                                //END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                // Begin TT#5503 - Node Properties - FWOS Override not working for a value
                                //if (updateEligibilityModel && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Eligibility RID"].Value != Include.NoRID))
                                if (updateEligibilityModel && ((bool)storeRow.Cells["Inherited"].Value == false || activeRow.Cells["Eligibility"].Text.Length > 0))
                                // End TT#5503 - Node Properties - FWOS Override not working for a value
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["Eligibility RID"].Value = activeRow.Cells["Eligibility RID"].Value;
                                    storeRow.Cells["Eligibility"].Value = activeRow.Cells["Eligibility"].Value;
                                    // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
                                    storeRow.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.AllowEdit;
                                    storeRow.Cells["Ineligible"].Value = false;
                                    // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
                                    storeRow.Cells["Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Inherited"].Value = false;
                                    storeRow.Cells["Eligibility"].Appearance.Image = null;
                                    storeRow.Cells["Eligibility"].Tag = null;
                                    storeRow.Cells["Ineligible"].Appearance.Image = null;
                                    storeRow.Cells["Ineligible"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateIneligible)
                                //BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateIneligible && ((bool)storeRow.Cells["Inherited"].Value == false || (activeRow.Cells["Eligibility RID"].Value != null &&
                                //Convert.ToInt32(activeRow.Cells["Eligibility RID"].Value) != Include.NoRID)))
                                //if (updateIneligible && ((bool)storeRow.Cells["Inherited"].Value == false || (storeRow.Cells["Eligibility RID"].Value != null &&
                                //        Convert.ToInt32(storeRow.Cells["Eligibility RID"].Value) != Include.NoRID)))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
                                //END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                if (updateIneligible && ((bool)storeRow.Cells["Inherited"].Value == false || (bool)activeRow.Cells["Ineligible"].Value == true))
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["Ineligible"].Value = activeRow.Cells["Ineligible"].Value;
                                    storeRow.Cells["Eligibility"].Activation = activeRow.Cells["Eligibility"].Activation;
                                    // clear the eligibility RID if inherited
                                    if (storeRow.Cells["Inherited RID"].Value != null &&
                                        Convert.ToInt32(storeRow.Cells["Inherited RID"].Value) != Include.NoRID)
                                    {
                                        storeRow.Cells["Eligibility RID"].Value = Include.NoRID;
                                    }
                                    storeRow.Cells["Inherited"].Value = false;
                                    storeRow.Cells["Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Eligibility"].Appearance.Image = null;
                                    storeRow.Cells["Eligibility"].Tag = null;
                                    storeRow.Cells["Ineligible"].Appearance.Image = null;
                                    storeRow.Cells["Ineligible"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateStockModifier)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateStockModifier && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Stock Modifier Inherited RID"].Value != Include.NoRID))
                                //if (updateStockModifier && ((bool)storeRow.Cells["Stk Mod Inherited"].Value == false || (int)storeRow.Cells["Stock Modifier Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                // Begin TT#5503 - Node Properties - FWOS Override not working for a value
                                //if (updateStockModifier && ((bool)storeRow.Cells["Stk Mod Inherited"].Value == false || (int)activeRow.Cells["Stock Modifier RID"].Value != Include.NoRID))
                                if (updateStockModifier && ((bool)storeRow.Cells["Stk Mod Inherited"].Value == false || activeRow.Cells["Stock Modifier"].Text.Length > 0))
                                // End TT#5503 - Node Properties - FWOS Override not working for a value
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["Stock Modifier RID"].Value = activeRow.Cells["Stock Modifier RID"].Value;
                                    storeRow.Cells["Stock Modifier"].Value = activeRow.Cells["Stock Modifier"].Value;
                                    storeRow.Cells["Stock Modifier Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Stk Mod Inherited"].Value = false;
                                    storeRow.Cells["Stock Modifier"].Appearance.Image = null;
                                    storeRow.Cells["Stock Modifier"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateSalesModifier)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateSalesModifier && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Sales Modifier Inherited RID"].Value != Include.NoRID))
                                //if (updateSalesModifier && ((bool)storeRow.Cells["Sls Mod Inherited"].Value == false || (int)storeRow.Cells["Sales Modifier Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                // Begin TT#5503 - Node Properties - FWOS Override not working for a value
                                //if (updateSalesModifier && ((bool)storeRow.Cells["Sls Mod Inherited"].Value == false || (int)activeRow.Cells["Sales Modifier RID"].Value != Include.NoRID))
                                if (updateSalesModifier && ((bool)storeRow.Cells["Sls Mod Inherited"].Value == false || activeRow.Cells["Sales Modifier"].Text.Length > 0))
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["Sales Modifier RID"].Value = activeRow.Cells["Sales Modifier RID"].Value;
                                    storeRow.Cells["Sales Modifier"].Value = activeRow.Cells["Sales Modifier"].Value;
                                    storeRow.Cells["Sales Modifier Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Sls Mod Inherited"].Value = false;
                                    storeRow.Cells["Sales Modifier"].Appearance.Image = null;
                                    storeRow.Cells["Sales Modifier"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateFWOSModifier)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateFWOSModifier && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["FWOS Modifier Inherited RID"].Value != Include.NoRID))
                                //if (updateFWOSModifier && ((bool)storeRow.Cells["FWOS Mod Inherited"].Value == false || (int)storeRow.Cells["FWOS Modifier Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                // Begin TT#5503 - Node Properties - FWOS Override not working for a value
                                //if (updateFWOSModifier && ((bool)storeRow.Cells["FWOS Mod Inherited"].Value == false || (int)activeRow.Cells["FWOS Modifier RID"].Value != Include.NoRID))
                                if (updateFWOSModifier && ((bool)storeRow.Cells["FWOS Mod Inherited"].Value == false || activeRow.Cells["FWOS Modifier"].Text.Length > 0))
                                // End TT#5503 - Node Properties - FWOS Override not working for a value
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["FWOS Modifier RID"].Value = activeRow.Cells["FWOS Modifier RID"].Value;
                                    storeRow.Cells["FWOS Modifier"].Value = activeRow.Cells["FWOS Modifier"].Value;
                                    storeRow.Cells["FWOS Modifier Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["FWOS Mod Inherited"].Value = false;
                                    storeRow.Cells["FWOS Modifier"].Appearance.Image = null;
                                    storeRow.Cells["FWOS Modifier"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateSimilarStore)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateSimilarStore && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //if (updateSimilarStore && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || (int)storeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                if (updateSimilarStore && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || ((ArrayList)activeRow.Cells["SimilarStoresArrayList"].Value != null && ((ArrayList)activeRow.Cells["SimilarStoresArrayList"].Value).Count > 0)))
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["Used Store Selector"].Value = activeRow.Cells["Used Store Selector"].Value;
                                    if (storeRow.Cells["Similar Store"].Value != activeRow.Cells["Similar Store"].Value)
                                    {
                                        storeRow.Cells["Similar Store Changed"].Value = true;
                                    }
                                    storeRow.Cells["Similar Store"].Value = activeRow.Cells["Similar Store"].Value;
                                    ArrayList setArrayList = (ArrayList)activeRow.Cells["SimilarStoresArrayList"].Value;
                                    ArrayList storeArrayList = (ArrayList)storeRow.Cells["SimilarStoresArrayList"].Value;
                                    storeArrayList.Clear();
                                    foreach (int similarStore in setArrayList)
                                    {
                                        storeArrayList.Add(similarStore);
                                    }
                                    storeRow.Cells["SimilarStoresArrayList"].Value = storeArrayList;
                                    storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Sim Str Inherited"].Value = false;
                                    storeRow.Cells["Similar Store Changed"].Value = true;
                                    storeRow.Cells["Similar Store"].Appearance.Image = null;
                                    storeRow.Cells["Similar Store"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateRatio)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateRatio && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //if (updateRatio && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || (int)storeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
                                if (updateRatio && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || !String.IsNullOrEmpty((String)activeRow.Cells["Ratio"].Value)))
								{
                                    if (storeRow.Cells["Ratio"].Value != activeRow.Cells["Ratio"].Value)
                                    {
                                        storeRow.Cells["Similar Store Changed"].Value = true;
                                    }
                                    storeRow.Cells["Ratio"].Value = activeRow.Cells["Ratio"].Value;
                                    storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Sim Str Inherited"].Value = false;
                                    storeRow.Cells["Similar Store"].Appearance.Image = null;
                                    storeRow.Cells["Similar Store"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updateUntil)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updateUntil && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //if (updateUntil && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || (int)storeRow.Cells["Similar Store Inherited RID"].Value != Include.NoRID))
                                //END TT#4852 - DOConnell - Stock Modifier Error Message
								//END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                if (updateUntil && ((bool)storeRow.Cells["Sim Str Inherited"].Value == false || setCalendarDateRangeRID != Include.NoRID))
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    if (storeRow.Cells["Until"].Value != activeRow.Cells["Until"].Value)
                                    {
                                        storeRow.Cells["Similar Store Changed"].Value = true;
                                    }
                                    if (setCalendarDateRangeRID == Include.UndefinedCalendarDateRange
                                        || setCalendarDateRangeRID == Include.NoRID)
                                    {
                                        storeRow.Cells["Until RID"].Value = Include.NoRID;
                                    }
                                    else
                                    {
                                        DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(setCalendarDateRangeRID);
                                        if (drp.Name == null ||
                                            drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
                                        {
                                            drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(setCalendarDateRangeRID);
                                        }
                                        storeRow.Cells["Until RID"].Value = drp.Key;
                                    }
                                    storeRow.Cells["Until"].Value = activeRow.Cells["Until"].Value;
                                    storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["Sim Str Inherited"].Value = false;
                                    storeRow.Cells["Similar Store"].Appearance.Image = null;
                                    storeRow.Cells["Similar Store"].Tag = null;
                                }

                                // Begin TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								//BEGIN TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                //if (updatePMPlusSales)
								//BEGIN TT#4852 - DOConnell - Stock Modifier Error Message
                                //if (updatePMPlusSales && ((bool)storeRow.Cells["Inherited"].Value == false || (int)activeRow.Cells["PMPlusSales Inherited RID"].Value != Include.NoRID))								if (updatePMPlusSales && ((bool)storeRow.Cells["PMPlusSales Inherited"].Value == false || (int)activeRow.Cells["PMPlusSales Inherited RID"].Value != Include.NoRID))
								//END TT#4852 - DOConnell - Stock Modifier Error Message
                                //END TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                                if (updatePMPlusSales && ((bool)storeRow.Cells["PMPlusSales Inherited"].Value == false || (int)activeRow.Cells["PMPlusSales Inherited RID"].Value != Include.NoRID))
                                // End TT#5012 - JSmith - Eligibility setup - Inheritance from Higher Levels
								{
                                    storeRow.Cells["PMPlusSales"].Value = activeRow.Cells["PMPlusSales"].Value;
                                    storeRow.Cells["PMPlusSales Inherited"].Value = false;
                                    storeRow.Cells["PMPlusSales Inherited RID"].Value = Include.NoRID;
                                    storeRow.Cells["PMPlusSales"].Appearance.Image = null;
                                    storeRow.Cells["PMPlusSales"].Tag = null;
                                }
                            //} TT#4197 - DOConnell - Cannot apply a Blank Ineligible check to a column
                            _storeEligibilityDataSet.AcceptChanges();
                            EligibilityChangesMade = true;
                        }
					}
					//END TT#3730 - DOConnelll - Uploading Eligibility Model clears inherited Ineligible check
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSEItemClearAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				SEItemClear(true, true, true, true, true, true, true, true, true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void mnuSEItemClearColumn_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				bool updateEligibilityModel=false;
				bool updateIneligible=false;
				bool updateStockModifier=false;
				bool updateSalesModifier=false;
				bool updateFWOSModifier=false;
				bool updateSimilarStore=false;
				bool updateRatio=false;
				bool updateUntil=false;
				bool updatePMPlusSales = false;
				if (this.ugStoreEligibility.ActiveCell != null)
				{
					switch (this.ugStoreEligibility.ActiveCell.Column.Key)
					{
						case "Eligibility":
							updateEligibilityModel = true;
							break;
						case "Ineligible":
							updateIneligible = true;
							break;
						case "Stock Modifier":
							updateStockModifier = true;
							break;
						case "Sales Modifier":
							updateSalesModifier = true;
							break;
						case "FWOS Modifier":
							updateFWOSModifier = true;
							break;
						case "Similar Store":
							updateSimilarStore = true;
							updateRatio = true;
							updateUntil = true;
							break;
						case "Ratio":
							updateRatio = true;
							break;
						case "Until":
							updateUntil = true;
							break;
						case "PMPlusSales":
							updatePMPlusSales = true;
							break;
						default:
							string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
							text = text.Replace("{0}", this.ugStoreEligibility.ActiveCell.Column.Key);
							MessageBox.Show (text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
							break;
					}
					SEItemClear(updateEligibilityModel, updateIneligible, updateStockModifier,
						updateSalesModifier, updateFWOSModifier, updateSimilarStore, updateRatio, updateUntil,
						updatePMPlusSales);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void SEItemClear(bool updateEligibilityModel, bool updateIneligible, bool updateStockModifier,
			bool updateSalesModifier, bool updateFWOSModifier, bool updateSimilarStore, bool updateRatio, bool updateUntil,
			bool updatePMPlusSales)
		{
			try
			{
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreEligibility.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreEligibility.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				if (activeRowBand.Key == "Sets")		// apply values to all stores in set
				{
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRow.Cells["Updated"].Value = true;
						if (updateEligibilityModel)
						{
							storeRow.Cells["Eligibility RID"].Value = Include.NoRID;
							storeRow.Cells["Eligibility"].Value = string.Empty;
							storeRow.Cells["Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Eligibility"].Appearance.Image = null;
							storeRow.Cells["Eligibility"].Tag = null;
							storeRow.Cells["Ineligible"].Appearance.Image = null;
							storeRow.Cells["Ineligible"].Tag = null;
						}
						if (updateIneligible)
						{
							storeRow.Cells["Ineligible"].Value = false;
							storeRow.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.AllowEdit;
							storeRow.Cells["Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Eligibility"].Appearance.Image = null;
							storeRow.Cells["Eligibility"].Tag = null;
							storeRow.Cells["Ineligible"].Appearance.Image = null;
							storeRow.Cells["Ineligible"].Tag = null;
							if (storeRow.Cells["Eligibility"].Text.Length == 0)
							{
								storeRow.Cells["Inherited"].Value = true;
							}
						}
						if (updateStockModifier)
						{
							storeRow.Cells["Stock Modifier RID"].Value = Include.NoRID;
							storeRow.Cells["Stock Modifier"].Value = string.Empty;
							storeRow.Cells["Stock Modifier Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Stock Modifier"].Appearance.Image = null;
							storeRow.Cells["Stock Modifier"].Tag = null;
						}
						if (updateSalesModifier)
						{
							storeRow.Cells["Sales Modifier RID"].Value = Include.NoRID;
							storeRow.Cells["Sales Modifier"].Value = string.Empty;
							storeRow.Cells["Sales Modifier Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sales Modifier"].Appearance.Image = null;
							storeRow.Cells["Sales Modifier"].Tag = null;
						}
						if (updateFWOSModifier)
						{
							storeRow.Cells["FWOS Modifier RID"].Value = Include.NoRID;
							storeRow.Cells["FWOS Modifier"].Value = string.Empty;
							storeRow.Cells["FWOS Modifier Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["FWOS Modifier"].Appearance.Image = null;
							storeRow.Cells["FWOS Modifier"].Tag = null;
						}
						if (updateSimilarStore)
						{
							storeRow.Cells["Used Store Selector"].Value = false;
							if (storeRow.Cells["Similar Store"].Text.Length != 0)
							{
								storeRow.Cells["Similar Store Changed"].Value = true;
							}
							storeRow.Cells["Similar Store"].Value = string.Empty;
							storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sim Str Inherited"].Value = false;
							storeRow.Cells["Similar Store Changed"].Value = true;
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
						if (updateRatio)
						{
							if (storeRow.Cells["Ratio"].Text.Length != 0)
							{
								storeRow.Cells["Similar Store Changed"].Value = true;
							}
							storeRow.Cells["Ratio"].Value = string.Empty;
							storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sim Str Inherited"].Value = false;
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
						if (updateUntil)
						{
							if (storeRow.Cells["Until"].Text.Length != 0)
							{
								storeRow.Cells["Similar Store Changed"].Value = true;
							}
							storeRow.Cells["Until RID"].Value = Include.NoRID;
							storeRow.Cells["Until"].Value = string.Empty;
							storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sim Str Inherited"].Value = false;
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
						if (updatePMPlusSales)
						{
							storeRow.Cells["PMPlusSales"].Value = false;
							storeRow.Cells["PMPlusSales Inherited"].Value = false;
							storeRow.Cells["PMPlusSales Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["PMPlusSales"].Appearance.Image = null;
							storeRow.Cells["PMPlusSales"].Tag = null;
						}
						EligibilityChangesMade = true;
					}
				
				}

				if (activeRowBand.Key == "Stores")		// clear store value
				{
					activeRow.Cells["Updated"].Value = true;
					EligibilityChangesMade = true;
				}
				if (updateEligibilityModel)
				{
					activeRow.Cells["Eligibility RID"].Value = Include.NoRID;
					activeRow.Cells["Eligibility"].Value = string.Empty;
					activeRow.Cells["Eligibility"].Appearance.Image = null;
					activeRow.Cells["Eligibility"].Tag = null;
					activeRow.Cells["Ineligible"].Appearance.Image = null;
					activeRow.Cells["Ineligible"].Tag = null;
				}
				if (updateIneligible)
				{
					activeRow.Cells["Ineligible"].Value = false;
					activeRow.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.AllowEdit;
					activeRow.Cells["Eligibility"].Appearance.Image = null;
					activeRow.Cells["Eligibility"].Tag = null;
					activeRow.Cells["Ineligible"].Appearance.Image = null;
					activeRow.Cells["Ineligible"].Tag = null;
					if (activeRow.Cells["Eligibility"].Text.Length == 0 &&
						activeRow.Band.Key == "Stores")
					{
						activeRow.Cells["Inherited"].Value = true;
					}
				}
				if (updateStockModifier)
				{
					activeRow.Cells["Stock Modifier RID"].Value = Include.NoRID;
					activeRow.Cells["Stock Modifier"].Value = string.Empty;
					activeRow.Cells["Stock Modifier"].Appearance.Image = null;
					activeRow.Cells["Stock Modifier"].Tag = null;
				}
				if (updateSalesModifier)
				{
					activeRow.Cells["Sales Modifier RID"].Value = Include.NoRID;
					activeRow.Cells["Sales Modifier"].Value = string.Empty;
					activeRow.Cells["Sales Modifier"].Appearance.Image = null;
					activeRow.Cells["Sales Modifier"].Tag = null;
				}
				if (updateFWOSModifier)
				{
					activeRow.Cells["FWOS Modifier RID"].Value = Include.NoRID;
					activeRow.Cells["FWOS Modifier"].Value = string.Empty;
					activeRow.Cells["FWOS Modifier"].Appearance.Image = null;
					activeRow.Cells["FWOS Modifier"].Tag = null;
				}
				if (updateSimilarStore)
				{
					activeRow.Cells["Used Store Selector"].Value = false;
					if (activeRow.Cells["Similar Store"].Text.Length != 0)
					{
						activeRow.Cells["Similar Store Changed"].Value = true;
					}
					activeRow.Cells["Similar Store"].Value = string.Empty;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
					if (activeRowBand.Key == "Stores")		// clear store value
					{
						activeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
						activeRow.Cells["Sim Str Inherited"].Value = false;
					}
					activeRow.Cells["SimilarStoresArrayList"].Value = new ArrayList();
				}
				if (updateRatio)
				{
					if (activeRow.Cells["Ratio"].Text.Length != 0)
					{
						activeRow.Cells["Similar Store Changed"].Value = true;
					}
					activeRow.Cells["Ratio"].Value = string.Empty;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
				}
				if (updateUntil)
				{
					if (activeRow.Cells["Until"].Text.Length != 0)
					{
						activeRow.Cells["Similar Store Changed"].Value = true;
					}
					activeRow.Cells["Until RID"].Value = Include.NoRID;
					activeRow.Cells["Until"].Value = string.Empty;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
				}
				if (updatePMPlusSales)
				{
					activeRow.Cells["PMPlusSales"].Value = false;
					if (activeRowBand.Key == "Stores")		// clear store value
					{
						activeRow.Cells["PMPlusSales Inherited"].Value = false;
						activeRow.Cells["PMPlusSales Inherited RID"].Value = Include.NoRID;
					}
					activeRow.Cells["PMPlusSales"].Appearance.Image = null;
					activeRow.Cells["PMPlusSales"].Tag = null;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSEItemReset_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreEligibility.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreEligibility.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				if (activeRowBand.Key == "Sets")		// apply values to all stores in set
				{
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRow.Cells["Eligibility"].Tag = null;
						storeRow.Cells["Eligibility"].Appearance.Image = null;
						storeRow.Cells["Ineligible"].Tag = null;
						storeRow.Cells["Ineligible"].Appearance.Image = null;
						storeRow.Cells["Stock Modifier"].Tag = null;
						storeRow.Cells["Stock Modifier"].Appearance.Image = null;
						storeRow.Cells["Sales Modifier"].Tag = null;
						storeRow.Cells["Sales Modifier"].Appearance.Image = null;
						storeRow.Cells["FWOS Modifier"].Tag = null;
						storeRow.Cells["FWOS Modifier"].Appearance.Image = null;
						storeRow.Cells["Similar Store"].Tag = null;
						storeRow.Cells["Similar Store"].Appearance.Image = null;
						storeRow.Cells["Ratio"].Tag = null;
						storeRow.Cells["Ratio"].Appearance.Image = null;
						storeRow.Cells["Until"].Tag = null;
						storeRow.Cells["Until"].Appearance.Image = null;
					}
				}
				else
					if (activeRowBand.Key == "Stores")		// clear store value
				{
					activeRow.Cells["Eligibility"].Tag = null;
					activeRow.Cells["Eligibility"].Appearance.Image = null;
					activeRow.Cells["Ineligible"].Tag = null;
					activeRow.Cells["Ineligible"].Appearance.Image = null;
					activeRow.Cells["Stock Modifier"].Tag = null;
					activeRow.Cells["Stock Modifier"].Appearance.Image = null;
					activeRow.Cells["Sales Modifier"].Tag = null;
					activeRow.Cells["Sales Modifier"].Appearance.Image = null;
					activeRow.Cells["FWOS Modifier"].Tag = null;
					activeRow.Cells["FWOS Modifier"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Ratio"].Tag = null;
					activeRow.Cells["Ratio"].Appearance.Image = null;
					activeRow.Cells["Until"].Tag = null;
					activeRow.Cells["Until"].Appearance.Image = null;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

        //BEGIN TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 
        //Relocated code to the StoreEligibilityProfiles.cs project in the MIDRetail.Common folder.
        //private void StoreEligibility_Define()
        //{
        //    try
        //    {
        //        _storeEligibilityDataSet = MIDEnvironment.CreateDataSet("storeEligibilityDataSet");

        //        DataColumn dataColumn;

        //        DataTable setTable = _storeEligibilityDataSet.Tables.Add("Sets");

        //        //Create Columns and rows for datatable
        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "SetID";
        //        dataColumn.ReadOnly = true;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Eligibility RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Eligibility";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Eligibility);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Ineligible";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Ineligible);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "PMPlusSales";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PMPlusSales);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Stock Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Stock Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Sales Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Sales Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sales_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement
        //        //dataColumn = new DataColumn();
        //        //dataColumn.DataType = System.Type.GetType("System.String");
        //        //dataColumn.ColumnName = "Stock Lead Weeks";
        //        //dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Lead_Weeks);
        //        //dataColumn.ReadOnly = false;
        //        //dataColumn.Unique = false;
        //        //setTable.Columns.Add(dataColumn);
        //        //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "FWOS Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "FWOS Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_FWOS_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Used Store Selector";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Similar Store Changed";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Object");
        //        dataColumn.ColumnName = "SimilarStoresArrayList";
        //        dataColumn.Caption = "SimilarStoresArrayList";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Similar Store";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Ratio";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Ratio);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Until RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Until";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        setTable.Columns.Add(dataColumn);

        //        //make set ID the primary key
        //        DataColumn[] PrimaryKeyColumn = new DataColumn[1];
        //        PrimaryKeyColumn[0] = setTable.Columns["SetID"];
        //        setTable.PrimaryKey = PrimaryKeyColumn;

        //        DataTable storeTable = _storeEligibilityDataSet.Tables.Add("Stores");

        //        //Create Columns and rows for datatable
        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "SetID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Updated";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Store RID";
        //        dataColumn.ReadOnly = true;
        //        dataColumn.Unique = true;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Store";
        //        dataColumn.ReadOnly = true;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Eligibility RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Eligibility";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Eligibility);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Ineligible";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Ineligible);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "PMPlusSales";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_PMPlusSales);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "PMPlusSales Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "PMPlusSales Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Stk Mod Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Stock Modifier Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Stock Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Stock Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Sls Mod Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Sales Modifier Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Sales Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Sales Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sales_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement
        //        //dataColumn = new DataColumn();
        //        //dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        //dataColumn.ColumnName = "Stock Lead Weeks Inherited";
        //        //dataColumn.ReadOnly = false;
        //        //dataColumn.Unique = false;
        //        //storeTable.Columns.Add(dataColumn);

        //        //dataColumn = new DataColumn();
        //        //dataColumn.DataType = System.Type.GetType("System.Int32");
        //        //dataColumn.ColumnName = "Stock Lead Weeks Inherited RID";
        //        //dataColumn.ReadOnly = false;
        //        //dataColumn.Unique = false;
        //        //storeTable.Columns.Add(dataColumn);

        //        //dataColumn = new DataColumn();
        //        //dataColumn.DataType = System.Type.GetType("System.String");
        //        //dataColumn.ColumnName = "Stock Lead Weeks";
        //        //dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_Lead_Weeks);
        //        //dataColumn.ReadOnly = false;
        //        //dataColumn.Unique = false;
        //        //dataColumn.MaxLength = 2;
        //        //storeTable.Columns.Add(dataColumn);
        //        //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "FWOS Mod Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "FWOS Modifier Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "FWOS Modifier RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "FWOS Modifier";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_FWOS_Modifier);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Sim Str Inherited";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Similar Store Inherited RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Used Store Selector";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Boolean");
        //        dataColumn.ColumnName = "Similar Store Changed";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Object");
        //        dataColumn.ColumnName = "SimilarStoresArrayList";
        //        dataColumn.Caption = "SimilarStoresArrayList";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Similar Store";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Ratio";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Ratio);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.Int32");
        //        dataColumn.ColumnName = "Until RID";
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        dataColumn = new DataColumn();
        //        dataColumn.DataType = System.Type.GetType("System.String");
        //        dataColumn.ColumnName = "Until";
        //        dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
        //        dataColumn.ReadOnly = false;
        //        dataColumn.Unique = false;
        //        storeTable.Columns.Add(dataColumn);

        //        _storeEligibilityDataSet.Relations.Add("Stores",
        //            _storeEligibilityDataSet.Tables["Sets"].Columns["SetID"],
        //            _storeEligibilityDataSet.Tables["Stores"].Columns["SetID"]);
        //    }
        //    catch( Exception exception )
        //    {
        //        HandleException(exception);
        //    }

        //}
        //TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 

		private void StoreEligibility_Populate(bool doingCopy)
		{
			try
			{
				bool updated = false;
				bool usedStoreSelector = false;
				bool similarStoreChanged = false;
				ArrayList setSimilarStores;
                //BEGIN TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 
                storeEligibilityDataSet seds = new storeEligibilityDataSet();
                _storeEligibilityDataSet = seds.StoreEligibility_Define(_storeEligibilityDataSet);
				//StoreEligibility_Define();
                //END TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 
				ugStoreEligibility.DataSource = _storeEligibilityDataSet;

				StoreEligibilityProfile sep;
				string slsMod;
				string stkMod;
				string FWOSMod;
				string ratio;
				string simStores;
				string until;
				int simStoreUntilDateRangeRID;
				object PMPlusSales;
                //object stkLeadWeeks; //TT#44 - MD - DOConnell - New Store Forecasting Enhancement

				foreach(StoreGroupLevelListViewProfile sglp in _storeEligibilityGroupLevelList)
				{
					setSimilarStores = new ArrayList(); 
					_storeEligibilityDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, Include.NoRID, string.Empty,
																					  false, false, Include.NoRID, string.Empty, Include.NoRID, string.Empty,
																					  //string.Empty, //TT#44 - MD - DOConnell - New Store Forecasting Enhancement
																					  Include.NoRID, string.Empty,
																					  false, false, setSimilarStores,
																					  string.Empty, string.Empty, Include.NoRID, string.Empty});
					foreach(StoreProfile storeProfile in sglp.Stores)
					{
						updated = false;
						usedStoreSelector = false;
						slsMod = string.Empty;
						stkMod = string.Empty;
						FWOSMod = string.Empty;
						ratio = string.Empty;
						simStores = string.Empty;
						until = string.Empty;
						if (_storeEligList.Contains(storeProfile.Key))
						{
							sep = (StoreEligibilityProfile)_storeEligList.FindKey(storeProfile.Key);
							if (doingCopy ||
								sep.StoreEligChangeType != eChangeType.none)
							{
								updated = true;
							}
							switch (sep.StkModType)
							{
								case eModifierType.Model:
									stkMod = sep.StkModModelName;
									break;
								case eModifierType.Percent:
									stkMod = sep.StkModPct.ToString(CultureInfo.CurrentUICulture);
									break;
								default:
									stkMod = string.Empty;
									break;
							}
					
							switch (sep.SlsModType)
							{
								case eModifierType.Model:
									slsMod = sep.SlsModModelName;
									break;
								case eModifierType.Percent:
									slsMod = sep.SlsModPct.ToString(CultureInfo.CurrentUICulture);
									break;
								default:
									slsMod = string.Empty;
									break;
							}

							switch (sep.FWOSModType)
							{
								case eModifierType.Model:
									FWOSMod = sep.FWOSModModelName;
									break;
								case eModifierType.Percent:
									FWOSMod = sep.FWOSModPct.ToString(CultureInfo.CurrentUICulture);
									break;
								default:
									FWOSMod = string.Empty;
									break;
							}
					
							switch (sep.SimStoreType)
							{
								case eSimilarStoreType.Stores:
									if (sep.SimStores == null ||
										sep.SimStores.Count == 0)
									{
										simStores = string.Empty;
									}
									else
									{
										if (doingCopy)
										{
											similarStoreChanged = true;
										}
										if (sep.SimStores.Count > 1)
										{
											simStores = _txtMultipleSimilarStores;
											usedStoreSelector = true;
										}
										else
										{
											int simStore = (int)sep.SimStores[0];
                                            StoreProfile sp = StoreMgmt.StoreProfile_Get(simStore); //_SAB.StoreServerSession.GetStoreProfile(simStore);
											if (sp.ActiveInd)
											{
												simStores += sp.Text;
											}
											usedStoreSelector = true;
										}
									}
									if (sep.SimStoreRatio != Include.DefaultSimilarStoreRatio)	// display default as blank
									{
										ratio = sep.SimStoreRatio.ToString(CultureInfo.CurrentUICulture);
									}
									until = sep.SimStoreDisplayDate;
									break;
								default:
									simStores = string.Empty;
									ratio = string.Empty;
									until = string.Empty;
									break;
							}
						}
						else
						{
							sep = new StoreEligibilityProfile(storeProfile.Key);
						}

						simStoreUntilDateRangeRID = sep.SimStoreUntilDateRangeRID;
						if (doingCopy &&
							simStoreUntilDateRangeRID > Include.NoRID)
						{
							DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(simStoreUntilDateRangeRID);
							if (drp.Name == null ||
								drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
							{
								drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(simStoreUntilDateRangeRID);
								simStoreUntilDateRangeRID = drp.Key;
							}
						}
						if (!sep.PresPlusSalesIsSet)
						{
							PMPlusSales = false;
						}
						else if (sep.PresPlusSalesInd)
						{
							PMPlusSales = true;
						}
						else 
						{
							PMPlusSales = System.DBNull.Value;
						}
                        //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement 
						//if (sep.StkLeadWeeks != Include.NoRID)
						//{
						//    stkLeadWeeks = sep.StkLeadWeeks;
						//}
						//else
						//{
						//    stkLeadWeeks = System.DBNull.Value;
						//}
                        //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement 

						_storeEligibilityDataSet.Tables["Stores"].Rows.Add(new object[] {sglp.Name, sep.EligIsInherited, sep.EligInheritedFromNodeRID, updated, storeProfile.Key, storeProfile.Text, sep.EligModelRID, sep.EligModelName,
																							sep.StoreIneligible, 
																							PMPlusSales, sep.PresPlusSalesIsInherited, sep.PresPlusSalesInheritedFromNodeRID,
																							sep.StkModIsInherited, sep.StkModInheritedFromNodeRID, sep.StkModModelRID, stkMod, 
																							sep.SlsModIsInherited, sep.SlsModInheritedFromNodeRID, sep.SlsModModelRID, slsMod,
                                                                                            //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement 
                                                                                            //sep.StkLeadWeeksInherited, sep.StkLeadWeeksInheritedRid, stkLeadWeeks,
                                                                                            //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement
																							sep.FWOSModIsInherited, sep.FWOSModInheritedFromNodeRID, sep.FWOSModModelRID, FWOSMod,
																							sep.SimStoreIsInherited, sep.SimStoreInheritedFromNodeRID,
																							usedStoreSelector, similarStoreChanged, sep.SimStores, simStores, ratio, simStoreUntilDateRangeRID, until});
					}
				}
				ugStoreEligibility.DataSource = _storeEligibilityDataSet;
				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityEligibility;
					SetControlReadOnly(this.tabStoreEligibility, !securityProfile.AllowUpdate);
				}

				StoreEligibility_SetRowProperties(securityProfile);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void StoreEligibility_SetRowProperties(FunctionSecurityProfile securityProfile)
		{
			try
			{
				HierarchyNodeProfile hnp = null;
				int inheritedRID;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if(storeRow.Cells["Ineligible"].Text == "True")
						{
							storeRow.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.Disabled;
						}
						else
							if (securityProfile.AllowUpdate)
						{
							storeRow.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.AllowEdit;
						}

						if(storeRow.Cells["Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							if(storeRow.Cells["Ineligible"].Text == "True")
							{
								storeRow.Cells["Ineligible"].Appearance.Image = InheritanceImage;
								storeRow.Cells["Ineligible"].Tag = inheritMsg;
							}
							else
							{
								storeRow.Cells["Eligibility"].Appearance.Image = InheritanceImage;
								storeRow.Cells["Eligibility"].Tag = inheritMsg;
							}
						}
						else
						{
							storeRow.Cells["Eligibility"].Appearance.Image = null;
							storeRow.Cells["Eligibility"].Tag = null;
							storeRow.Cells["Ineligible"].Appearance.Image = null;
							storeRow.Cells["Ineligible"].Tag = null;
						}

						if(storeRow.Cells["Stk Mod Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Stock Modifier Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Stock Modifier"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Stock Modifier"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Stock Modifier"].Appearance.Image = null;
							storeRow.Cells["Stock Modifier"].Tag = null;
						}

						if(storeRow.Cells["Sls Mod Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Sales Modifier Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Sales Modifier"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Sales Modifier"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Sales Modifier"].Appearance.Image = null;
							storeRow.Cells["Sales Modifier"].Tag = null;
						}

						if(storeRow.Cells["FWOS Mod Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["FWOS Modifier Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["FWOS Modifier"].Appearance.Image = InheritanceImage;
							storeRow.Cells["FWOS Modifier"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["FWOS Modifier"].Appearance.Image = null;
							storeRow.Cells["FWOS Modifier"].Tag = null;
						}

						if(storeRow.Cells["Sim Str Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Similar Store Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Similar Store"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Similar Store"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}

						if(storeRow.Cells["PMPlusSales Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["PMPlusSales Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["PMPlusSales"].Appearance.Image = InheritanceImage;
							Set_PMPlusSales_ToolTip (storeRow.Cells["PMPlusSales"], storeRow.Cells["PMPlusSales"].Value, inheritMsg + Environment.NewLine);
						}
						else
						{
							storeRow.Cells["PMPlusSales"].Appearance.Image = null;
							Set_PMPlusSales_ToolTip (storeRow.Cells["PMPlusSales"], storeRow.Cells["PMPlusSales"].Value, null);
						}
                        //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement
						//if (storeRow.Cells["Stock Lead Weeks Inherited"].Text == "True")
						//{
						//    inheritedRID = Convert.ToInt32(storeRow.Cells["Stock Lead Weeks Inherited RID"].Value, CultureInfo.CurrentUICulture);
						//    if (hnp == null || hnp.Key != inheritedRID)
						//    {
						//        hnp = GetHNProfile(inheritedRID);
						//    }
						//    string inheritMsg = _txtInheritedFrom + hnp.Text;
						//    storeRow.Cells["Stock Lead Weeks"].Appearance.Image = InheritanceImage;
						//    storeRow.Cells["Stock Lead Weeks"].Tag = inheritMsg;
						//}
						//else
						//{
						//    storeRow.Cells["Stock Lead Weeks"].Appearance.Image = null;
						//    storeRow.Cells["Stock Lead Weeks"].Tag = null;
						//}
                        //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void Set_PMPlusSales_ToolTip (UltraGridCell aGridCell, object aValue, string aMessage)
		{
			if (aValue == System.DBNull.Value)
			{
				aGridCell.Tag = aMessage + MIDText.GetTextOnly(eMIDTextCode.tt_PMPlusSales_Off);
			}
			else if (Convert.ToBoolean(aValue))
			{
				aGridCell.Tag = aMessage + MIDText.GetTextOnly(eMIDTextCode.tt_PMPlusSales_On);
			}
			else
			{
				aGridCell.Tag = aMessage + MIDText.GetTextOnly(eMIDTextCode.tt_PMPlusSales_Inherit);
			}
		}

		private void StoreEligibility_Attributes_Populate()
		{
			try
			{
				StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_storeEligibilityGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID);
				_groupRID = storeGroup.Key;

                cbSEStoreAttribute.Initialize(SAB, _securityEligibility, _storeEligibilityGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbSEStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				_groupRID = storeGroup.Key;
				this.cbSEStoreAttribute.SelectedValue = storeGroup.Key;
                _storeEligibilityGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuModelNew_Click(object sender, System.EventArgs e)
		{
			try
			{
				switch (_modelType)
				{
					case eModelType.Eligibility:
						frmEligModelMaint eligMaintForm = new frmEligModelMaint(_SAB);
						eligMaintForm.InitializeForm();
						eligMaintForm.ShowDialog(this);
						if (eligMaintForm.ChangeMade)
						{
							BuildEligibilityModelList();
						}
						break;
					case eModelType.StockModifier:
						frmStockModifierModelMaint stockModifierMaintForm = new frmStockModifierModelMaint(_SAB);
						stockModifierMaintForm.InitializeForm();
						stockModifierMaintForm.ShowDialog(this);
						if (stockModifierMaintForm.ChangeMade)
						{
							BuildStockModifierModelList();
						}
						break;
					case eModelType.SalesModifier:
						frmSalesModifierModelMaint SalesModifierMaintForm = new frmSalesModifierModelMaint(_SAB);
						SalesModifierMaintForm.InitializeForm();
						SalesModifierMaintForm.ShowDialog(this);
						if (SalesModifierMaintForm.ChangeMade)
						{
							BuildSalesModifierModelList();
						}
						break;
					case eModelType.FWOSModifier:
						frmFWOSModifierModelMaint FWOSModifierMaintForm = new frmFWOSModifierModelMaint(_SAB);
						FWOSModifierMaintForm.InitializeForm();
						FWOSModifierMaintForm.ShowDialog(this);
						if (FWOSModifierMaintForm.ChangeMade)
						{
							BuildFWOSModifierModelList();
						}
						break;
                    //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                    case eModelType.FWOSMax:
                        frmFWOSMaxModelMaint FWOSMaxMaintForm = new frmFWOSMaxModelMaint(_SAB);
                        FWOSMaxMaintForm.InitializeForm();
                        FWOSMaxMaintForm.ShowDialog(this);
                        if (FWOSMaxMaintForm.ChangeMade)
                        {
                            BuildFWOSMaxModelList();
                        }
                        break;
                    //END TT#108 - MD - DOConnell - FWOS Max Model
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuModelEdit_Click(object sender, System.EventArgs e)
		{
			try
			{
				switch (_modelType)
				{
					case eModelType.Eligibility:
						frmEligModelMaint eligMaintForm = new frmEligModelMaint(_SAB);
						if (eligMaintForm.InitializeForm(_gridCell.Text))
						{
							eligMaintForm.ShowDialog(this);
							if (eligMaintForm.ChangeMade)
							{
								BuildEligibilityModelList();
							}
						}
						break;
					case eModelType.StockModifier:
						frmStockModifierModelMaint stockModifierMaintForm = new frmStockModifierModelMaint(_SAB);
						if (stockModifierMaintForm.InitializeForm(_gridCell.Text))
						{
							stockModifierMaintForm.ShowDialog(this);
							if (stockModifierMaintForm.ChangeMade)
							{
								BuildStockModifierModelList();
							}
						}
						break;
					case eModelType.SalesModifier:
						frmSalesModifierModelMaint SalesModifierMaintForm = new frmSalesModifierModelMaint(_SAB);
						if (SalesModifierMaintForm.InitializeForm(_gridCell.Text))
						{
							SalesModifierMaintForm.ShowDialog(this);
							if (SalesModifierMaintForm.ChangeMade)
							{
								BuildSalesModifierModelList();
							}
						}
						break;
					case eModelType.FWOSModifier:
						frmFWOSModifierModelMaint FWOSModifierMaintForm = new frmFWOSModifierModelMaint(_SAB);
						if (FWOSModifierMaintForm.InitializeForm(_gridCell.Text))
						{
							FWOSModifierMaintForm.ShowDialog(this);
							if (FWOSModifierMaintForm.ChangeMade)
							{
								BuildFWOSModifierModelList();
							}
						}
						break;
                    //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
                    case eModelType.FWOSMax:
                        frmFWOSMaxModelMaint FWOSMaxMaintForm = new frmFWOSMaxModelMaint(_SAB);
                        if (FWOSMaxMaintForm.InitializeForm(_gridCell.Text))
                        {
                            FWOSMaxMaintForm.ShowDialog(this);
                            if (FWOSMaxMaintForm.ChangeMade)
                            {
                                BuildFWOSMaxModelList();
                            }
                        }
                        break;
                    //ENDTT#108 - MD - DOConnell - FWOS Max Model
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void uddEligModel_RowSelected(object sender, Infragistics.Win.UltraWinGrid.RowSelectedEventArgs e)
		{
			try
			{
				if (FormLoaded)
				{
					if (e.Row != null)
					{
						_dropdownRow = e.Row;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void uddStockModifier_RowSelected(object sender, Infragistics.Win.UltraWinGrid.RowSelectedEventArgs e)
		{
			try
			{
				if (FormLoaded)
				{
					if (e.Row != null)
					{
						_dropdownRow = e.Row;
					}
					
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void uddSalesModifier_RowSelected(object sender, Infragistics.Win.UltraWinGrid.RowSelectedEventArgs e)
		{
			try
			{
				if (FormLoaded)
				{
					if (e.Row != null)
					{
						_dropdownRow = e.Row;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void uddFWOSModifier_RowSelected(object sender, Infragistics.Win.UltraWinGrid.RowSelectedEventArgs e)
		{
			try
			{
				if (FormLoaded)
				{
					if (e.Row != null)
					{
						_dropdownRow = e.Row;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //BEGIN TT#108 - MD - DOConnell - FWOS Max Model
        private void uddFWOSMax_RowSelected(object sender, Infragistics.Win.UltraWinGrid.RowSelectedEventArgs e)
        {
            try
            {
                if (FormLoaded)
                {
                    if (e.Row != null)
                    {
                        _dropdownRow = e.Row;
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugReservation_AfterCellListCloseUp(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            try
            {
                if (e.Cell != null && _dropdownRow != null && !_deletingValueWhileListOpen)
                {
                    switch (e.Cell.Column.Key)
                    {
                        case "FWOS Max":
                            e.Cell.Row.Cells["FWOS Max RID"].Value = _dropdownRow.Cells["Key"].Value;
                            break;
                    }
                }
                _dropdownRow = null;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
			finally
			{
				_deletingValueWhileListOpen = false;
				_cellListOpen = false;
			}
        }

        //END TT#108 - MD - DOConnell - FWOS Max Model

		private void ugStoreEligibility_BeforeCellListDropDown(object sender, Infragistics.Win.UltraWinGrid.CancelableCellEventArgs e)
		{
			_cellListOpen = true;
		}

		private void ugStoreEligibility_AfterCellListCloseUp(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (e.Cell != null && _dropdownRow != null && !_deletingValueWhileListOpen)
				{
					switch (e.Cell.Column.Key)
					{
						case "Eligibility":
							e.Cell.Row.Cells["Eligibility RID"].Value = _dropdownRow.Cells["Key"].Value;
							break;
						case "Stock Modifier":
							e.Cell.Row.Cells["Stock Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
							break;
						case "Sales Modifier":
							e.Cell.Row.Cells["Sales Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
							break;
						case "FWOS Modifier":
							e.Cell.Row.Cells["FWOS Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
							break;
					}
				}
				_dropdownRow = null;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				_deletingValueWhileListOpen = false;
				_cellListOpen = false;
			}
		}

		private void ugStoreEligibility_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
		{
			if (ugStoreEligibility.ActiveCell != null)
			{
				if (e.KeyCode == Keys.A &&
					e.Modifiers == Keys.Control)
				{
					ugStoreEligibility.ActiveCell.SelectAll();
				}
				else if (e.KeyCode == Keys.Delete &&
                    ugStoreEligibility.ActiveCell.IsInEditMode &&  // TT#2333 - AGallagher - Unhandled Exception in Node Properties if Try to make Change in Read only (delete key deprressed on read only cell)
					ugStoreEligibility.ActiveCell.SelLength == ugStoreEligibility.ActiveCell.Text.Length)
				{
					switch (ugStoreEligibility.ActiveCell.Column.Key)
					{
						case "Eligibility":
							ugStoreEligibility.ActiveCell.Row.Cells["Eligibility RID"].Value = Include.NoRID;
							break;
						case "Stock Modifier":
							ugStoreEligibility.ActiveCell.Row.Cells["Stock Modifier RID"].Value = Include.NoRID;
							break;
						case "Sales Modifier":
							ugStoreEligibility.ActiveCell.Row.Cells["Sales Modifier RID"].Value = Include.NoRID;
							break;
						case "FWOS Modifier":
							ugStoreEligibility.ActiveCell.Row.Cells["FWOS Modifier RID"].Value = Include.NoRID;
							break;
					}
				}
				else if (e.KeyCode == Keys.Escape)
				{
					if (ugStoreEligibility.ActiveCell.Column.ValueList.SelectedItemIndex != -1) 
					{
						_dropdownRow = ((Infragistics.Win.UltraWinGrid.UltraDropDownBase)ugStoreEligibility.ActiveCell.Column.ValueList).SelectedRow;
						switch (ugStoreEligibility.ActiveCell.Column.Key)
						{
							case "Eligibility":
								ugStoreEligibility.ActiveCell.Row.Cells["Eligibility RID"].Value = _dropdownRow.Cells["Key"].Value;
								break;
							case "Stock Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["Stock Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
								break;
							case "Sales Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["Sales Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
								break;
							case "FWOS Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["FWOS Modifier RID"].Value = _dropdownRow.Cells["Key"].Value;
								break;
						}
					}
					else
					{
						_dropdownRow = null;
						switch (ugStoreEligibility.ActiveCell.Column.Key)
						{
							case "Eligibility":
								ugStoreEligibility.ActiveCell.Row.Cells["Eligibility RID"].Value = Include.NoRID;
								break;
							case "Stock Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["Stock Modifier RID"].Value = Include.NoRID;
								break;
							case "Sales Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["Sales Modifier RID"].Value = Include.NoRID;
								break;
							case "FWOS Modifier":
								ugStoreEligibility.ActiveCell.Row.Cells["FWOS Modifier RID"].Value = Include.NoRID;
								break;
						}
					}
				}
			}
		}

		private void btnAdvancedStoreEligibiligy_Click(object sender, System.EventArgs e)
		{
			try
			{
				frmAdvancedStoreEligibility advancedStoreEligibilityForm = new frmAdvancedStoreEligibility();
				advancedStoreEligibilityForm.ShowDialog(this);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreEligibility_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugStoreEligibility.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugStoreEligibility.ActiveCell = mouseCell;
							AdjustStoreEligibilityGridMenu(mouseCell);
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugStoreEligibility, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        // BEGIN TT#2015 - gtaylor - apply changes to lower levels
        private void ugStoreEligibility_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            if (e.Cell.Row.Band.Key == "Stores")
            {
                if ((e.Cell != e.Cell.Row.Cells["Updated"])
                    && (e.Cell != e.Cell.Row.Cells["Eligibility"]))
                {
                    string[] compColumns = new string[] { };
                    string dataColumn = "";
                    string[] dataColumns = new string[] { };

                    KeyValuePair<long, object> _kvp;
                    ChangeProfileElig eligChange;

                    int storeRID = Convert.ToInt16(e.Cell.Row.Cells["Store RID"].Value);

                    //  if the cell edited is Similar Store, Index, Time Period then add them to the change list
                    //  if the cell edited is Eligibility or Ineligible, add the other to the change list
                    //  set the dataColumn for the first addition to the changes list
                    //switch (e.Cell.Column.Header.Caption.ToUpper())
                    
                    if (e.Cell == e.Cell.Row.Cells["Eligibility RID"])
                    {
                        //  add INELIGIBLE
                        compColumns = new string[] { "INELIGIBLE" };
                        dataColumns = new string[] { "EM_RID" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["InEligible"])
                    {
                        //  add ELIGIBILITY
                        compColumns = new string[] { "ELIGIBILITY RID" };
                        dataColumns = new string[] { "INELIGIBLE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Similar Store"])
                    {
                        //  add INDEX
                        //  add TIME PERIOD
                        compColumns = new string[] { "RATIO", "UNTIL RID" };
                        dataColumns = new string[] { "SIMILAR_STORE_TYPE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Ratio"])
                    {
                        //  add SIMILAR STORE
                        //  add TIME PERIOD
                        compColumns = new string[] { "SIMILAR STORE", "UNTIL RID" };
                        dataColumns = new string[] { "SIMILAR_STORE_RATIO" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Until Rid"])
                    {
                        //  add SIMILAR STORE
                        //  add INDEX
                        compColumns = new string[] { "RATIO", "SIMILAR STORE" };
                        dataColumns = new string[] { "UNTIL_DATE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Stock Modifier"])
                    {
                        dataColumns = new string[] { "STKMOD_TYPE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Stock Modifier RID"])
                    {
                        dataColumns = new string[] { "STKMOD_RID" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Sales Modifier"])
                    {
                        dataColumns = new string[] { "SLSMOD_TYPE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["Sales Modifier RID"])
                    {
                        dataColumns = new string[] { "SLSMOD_RID" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["FWOS Modifier"])
                    {
                        dataColumns = new string[] { "FWOSMOD_TYPE" };
                    }
                    else if (e.Cell == e.Cell.Row.Cells["FWOS Modifier RID"])
                    {
                        dataColumns = new string[] { "FWOSMOD_RID" };
                    }
                    foreach (string dcol in dataColumns)
                    {
                        // create the change profile and add it to the list
                        eligChange = new ChangeProfileElig(
                            storeRID, // storeRID
                            //e.Cell.Row.Cells["Store"].Value.ToString(), // storeID
                            e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                            e.Cell.Text.ToString(), // new value
                            dcol,
                            e.Cell.Column.Index
                        );

                        // create keyvaluepair and populate
                        _kvp = new KeyValuePair<long, object>(eligChange.ChangeProfileKey, eligChange);

                        //  add to nodechangeprofile list
                        _nodeChangeProfile.Add(eProfileType.StoreEligibility, _kvp);
                    }
                    //  Companion Columns
                    //      set above
                    //      compColumns = the column names
                    //      dataColumn = the data column in sql
                    if (compColumns.Length > 0)
                    {
                        foreach (string col in compColumns)
                        {
                            switch (col)
                            {
                                case "INELIGIBLE":
                                    dataColumn = "INELIGIBLE";
                                    break;
                                case "ELIGIBILITY RID":
                                    dataColumn = "EM_RID";
                                    break;
                                case "SIMILAR STORE":
                                    dataColumn = "SIMILAR_STORE_TYPE";
                                    break;
                                case "UNTIL RID":
                                    dataColumn = "UNTIL_DATE";
                                    break;
                                case "RATIO":
                                    dataColumn = "SIMILAR_STORE_RATIO";
                                    break;
                            }
                            eligChange = new ChangeProfileElig(
                                storeRID, // storeRID
                                //e.Cell.Row.Cells["Store"].Value.ToString(), // storeID
                                e.Cell.Row.Cells[col].OriginalValue.ToString(), // old value
                                e.Cell.Row.Cells[col].Text.ToString(), // new value
                                dataColumn,
                                e.Cell.Row.Cells[col].Column.Index
                            );
                            _kvp = new KeyValuePair<long, object>(eligChange.ChangeProfileKey, eligChange);
                            _nodeChangeProfile.Add(eProfileType.StoreEligibility, _kvp);
                        }
                    }
                    compColumns = null;
                }
            }
        }
        // END TT#2015 - gtaylor - apply changes to lower levels

		private void ugStoreEligibility_AfterCellActivate(object sender, System.EventArgs e)
		{
			try
			{
				if (ugStoreEligibility.ActiveCell != null)
				{
					AdjustStoreEligibilityGridMenu(ugStoreEligibility.ActiveCell);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void AdjustStoreEligibilityGridMenu(Infragistics.Win.UltraWinGrid.UltraGridCell gridCell)
		{
			try
			{
				_gridCell = gridCell;
				switch (gridCell.Column.Key)
				{
					case "Eligibility":
						_modelType = eModelType.Eligibility;
						_currentModelID = gridCell.Text;
						if (!mnuStoreEligibilityGrid.MenuItems.Contains(_mnuItemOpenModel))
						{
							mnuStoreEligibilityGrid.MenuItems.Add(0,_mnuItemOpenModel);
							mnuStoreEligibilityGrid.MenuItems.Add(1,_mnuItemNewModel);
							mnuStoreEligibilityGrid.MenuItems.Add(2,_mnuItemSeparator);
						}
						break;
					case "Stock Modifier":
						_modelType = eModelType.StockModifier;
						_currentModelID = gridCell.Text;
						if (!mnuStoreEligibilityGrid.MenuItems.Contains(_mnuItemOpenModel))
						{
							mnuStoreEligibilityGrid.MenuItems.Add(0,_mnuItemOpenModel);
							mnuStoreEligibilityGrid.MenuItems.Add(1,_mnuItemNewModel);
							mnuStoreEligibilityGrid.MenuItems.Add(2,_mnuItemSeparator);
						}
						break;
					case "Sales Modifier":
						_modelType = eModelType.SalesModifier;
						_currentModelID = gridCell.Text;
						if (!mnuStoreEligibilityGrid.MenuItems.Contains(_mnuItemOpenModel))
						{
							mnuStoreEligibilityGrid.MenuItems.Add(0,_mnuItemOpenModel);
							mnuStoreEligibilityGrid.MenuItems.Add(1,_mnuItemNewModel);
							mnuStoreEligibilityGrid.MenuItems.Add(2,_mnuItemSeparator);
						}
						break;
					case "FWOS Modifier":
						_modelType = eModelType.FWOSModifier;
						_currentModelID = gridCell.Text;
						if (!mnuStoreEligibilityGrid.MenuItems.Contains(_mnuItemOpenModel))
						{
							mnuStoreEligibilityGrid.MenuItems.Add(0,_mnuItemOpenModel);
							mnuStoreEligibilityGrid.MenuItems.Add(1,_mnuItemNewModel);
							mnuStoreEligibilityGrid.MenuItems.Add(2,_mnuItemSeparator);
						}
						break;
					default:
						if (mnuStoreEligibilityGrid.MenuItems.Contains(_mnuItemOpenModel))
						{
							mnuStoreEligibilityGrid.MenuItems.Remove(_mnuItemOpenModel);
							mnuStoreEligibilityGrid.MenuItems.Remove(_mnuItemNewModel);
							mnuStoreEligibilityGrid.MenuItems.Remove(_mnuItemSeparator);
						}
						break;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreEligibility_AfterColPosChanged(object sender, Infragistics.Win.UltraWinGrid.AfterColPosChangedEventArgs e)
		{
			foreach (Infragistics.Win.UltraWinGrid.ColumnHeader columnHeader in e.ColumnHeaders)
			{
				switch (columnHeader.Column.Key)
				{
					case "Eligibility":
						this.uddEligModel.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Eligibility"].Width;
						break;
					case "Stock Modifier":
						this.uddStockModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Stock Modifier"].Width;
						break;
					case "Sales Modifier":
						this.uddSalesModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Sales Modifier"].Width;
						break;
					case "FWOS Modifier":
                        // Begin TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough
                        //this.uddSalesModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Width;
                        this.uddFWOSModifier.DisplayLayout.Bands[0].Columns["ModelID"].Width = this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["FWOS Modifier"].Width;
                        // End TT#3010 - JSmith - FWOS Max & FWOS Override model drop down not wide enough
						break;
				}
			}
		}

		private void EligibilityRowChanged(object ob, DataRowChangeEventArgs e) 
		{ 
			try
			{
				if (_eligibilityIsPopulated)
				{
					DataTable t = (DataTable)  ob; 
					e.Row["Updated"] = true;
					EligibilityChangesMade = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreEligibility_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (this.ugStoreEligibility.ActiveCell != null)
					{
						switch (this.ugStoreEligibility.ActiveCell.Column.Key)
						{
							case "Similar Store":
								if (ugStoreEligibility.ActiveCell.Row.Cells["Ratio"].Text.Length > 0 ||
									ugStoreEligibility.ActiveCell.Row.Cells["Until"].Text.Length > 0)
								{
									if (!SimilarStoresValid(ugStoreEligibility.ActiveCell, ref errorMessage))
									{
										MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
										e.Cancel = true;
									}
								}
								break;
							case "Ratio":
								if (ugStoreEligibility.ActiveCell.Row.Cells["Similar Store"].Text.Length > 0 ||
									ugStoreEligibility.ActiveCell.Row.Cells["Until"].Text.Length > 0)
								{
									if (!RatioValid(ugStoreEligibility.ActiveCell, false, ref errorMessage))
									{
										MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
										e.Cancel = true;
									}
								}
								break;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool SimilarStoresValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (!Convert.ToBoolean(gridCell.Row.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
				{
					//	no need to edit if no similar store
				}
				else
					if (Convert.ToBoolean(gridCell.Row.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
				{
					//	no need to edit if used selector
				}
				else 
					if (gridCell.Text != null &&
					gridCell.Text.Trim().Length == 0 &&
					(gridCell.Row.Cells["Ratio"].Text.Length > 0 ||
					gridCell.Row.Cells["Until"].Text.Length > 0))
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
					if (gridCell.Value == gridCell.OriginalValue)
				{
					//	no need to edit value did not change
				}
				else
				{
					if (gridCell.Text.Length == 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
						errorFound = true;
					}
					else
					{
						bool simStoreError = false;
						ArrayList SimilarStoresList = new ArrayList();
						string[] fields = gridCell.Text.Split(',');
						for (int i=0; i< fields.Length; i++)
						{
							StoreProfile sp = StoreMgmt.StoreProfile_Get(fields[i].Trim()); //_SAB.StoreServerSession.GetStoreProfile(fields[i].Trim());
							if (sp.ActiveInd)
							{
								if (sp.Key == Include.NoRID)
								{
									sp.Key = 1;
								}
							}
							else
							{
								simStoreError = true;
							}
						}
						if (simStoreError)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreNotFound);
							errorFound = true;
						}
					}
				}
				
			}
			catch( Exception error)
			{
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
			
		}

		private bool RatioValid(UltraGridCell gridCell, bool useDefault, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					if (!useDefault)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
						errorFound = true;
					}
				}
				else
				{
					double cellValue = Convert.ToDouble(gridCell.Text, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool UntilValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DateRequired);
					errorFound = true;
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private void SetHiddenRidColumn(Infragistics.Win.UltraWinGrid.CellEventArgs e, string textColumnName, string ridColumnName)
		{
			if ((e.Cell.Column.ValueList.SelectedItemIndex != -1) && (e.Cell.Row.Cells[textColumnName].Text == e.Cell.Column.ValueList.GetValue(e.Cell.Column.ValueList.SelectedItemIndex).ToString())) 
			{
				_dropdownRow = ((Infragistics.Win.UltraWinGrid.UltraDropDownBase)e.Cell.Column.ValueList).SelectedRow;
				e.Cell.Row.Cells[ridColumnName].Value = _dropdownRow.Cells["Key"].Value;
			}
			else 
			{
				_dropdownRow = null;
				e.Cell.Row.Cells[ridColumnName].Value = Include.NoRID;
			}
		}

		private void ugStoreEligibility_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			bool changeCancelled = false;
			try
			{
				if (_eligibilityIsPopulated)
				{
					EligibilityChangesMade = true;
					switch (e.Cell.Column.Key)
					{
						case "Eligibility":
							SetHiddenRidColumn(e, "Eligibility", "Eligibility RID");

							// set the value if the use deletes the text in the cell
							if (e.Cell.Text.Length == 0)
							{
								if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ReestablishInheritance),  this.Text,
									MessageBoxButtons.YesNo, MessageBoxIcon.Question)
									== DialogResult.Yes)
								{
									// if already inheriting, cancel change
									if (Convert.ToInt32(e.Cell.Row.Cells["Eligibility RID"].Value, CultureInfo.CurrentCulture) == Include.NoRID)
									{
										changeCancelled = true;
									}
									else
									{
										e.Cell.Row.Cells["Eligibility RID"].Value = Include.NoRID;
									}
									if (_cellListOpen)
									{
										_deletingValueWhileListOpen = true;
									}
								}
								else
								{
									e.Cell.Value = e.Cell.OriginalValue;
									e.Cell.Refresh();
									SetHiddenRidColumn(e, "Eligibility", "Eligibility RID");
									changeCancelled = true;
								}
							}

							if (!changeCancelled)
							{
								// remove inheritance provider
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["Inherited"].Value = false;
									e.Cell.Row.Cells["Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Eligibility"].Appearance.Image = null;
									e.Cell.Row.Cells["Eligibility"].Tag = null;
									e.Cell.Row.Cells["Ineligible"].Appearance.Image = null;
									e.Cell.Row.Cells["Ineligible"].Tag = null;
								}
							}
							break;
						case "Ineligible":
							if(e.Cell.Text== "True")
							{
								e.Cell.Row.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.Disabled;
							}
							else
							{
								e.Cell.Row.Cells["Eligibility"].Activation = Infragistics.Win.UltraWinGrid.Activation.AllowEdit;
							}
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								e.Cell.Row.Cells["Inherited"].Value = false;
								e.Cell.Row.Cells["Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Eligibility"].Appearance.Image = null;
								e.Cell.Row.Cells["Eligibility"].Tag = null;
								e.Cell.Row.Cells["Ineligible"].Appearance.Image = null;
								e.Cell.Row.Cells["Ineligible"].Tag = null;
							}
							break;
						case "Stock Modifier":
							SetHiddenRidColumn(e, "Stock Modifier", "Stock Modifier RID");

							// set the value if the use deletes the text in the cell
							if (e.Cell.Text.Length == 0)
							{
								if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ReestablishInheritance),  this.Text,
									MessageBoxButtons.YesNo, MessageBoxIcon.Question)
									== DialogResult.Yes)
								{
									// if already inheriting, cancel change
									if (Convert.ToInt32(e.Cell.Row.Cells["Stock Modifier RID"].Value, CultureInfo.CurrentCulture) == Include.NoRID)
									{
										changeCancelled = true;
									}
									else
									{
										e.Cell.Row.Cells["Stock Modifier RID"].Value = Include.NoRID;
									}
									if (_cellListOpen)
									{
										_deletingValueWhileListOpen = true;
									}
								}
								else
								{
									e.Cell.Value = e.Cell.OriginalValue;
									e.Cell.Refresh();
									SetHiddenRidColumn(e, "Stock Modifier", "Stock Modifier RID");
									changeCancelled = true;
								}
							}

							if (!changeCancelled)
							{
								// remove inheritance provider
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["Stock Modifier Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Stock Modifier"].Appearance.Image = null;
									e.Cell.Row.Cells["Stock Modifier"].Tag = null;
								}
							}
							break;
						case "Sales Modifier":
							SetHiddenRidColumn(e, "Sales Modifier", "Sales Modifier RID");

							// set the value if the use deletes the text in the cell
							if (e.Cell.Text.Length == 0)
							{
								if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ReestablishInheritance),  this.Text,
									MessageBoxButtons.YesNo, MessageBoxIcon.Question)
									== DialogResult.Yes)
								{
									// if already inheriting, cancel change
									if (Convert.ToInt32(e.Cell.Row.Cells["Sales Modifier RID"].Value, CultureInfo.CurrentCulture) == Include.NoRID)
									{
										changeCancelled = true;
									}
									else
									{
										e.Cell.Row.Cells["Sales Modifier RID"].Value = Include.NoRID;
									}
									if (_cellListOpen)
									{
										_deletingValueWhileListOpen = true;
									}
								}
								else
								{
									e.Cell.Value = e.Cell.OriginalValue;
									e.Cell.Refresh();
									SetHiddenRidColumn(e, "Sales Modifier", "Sales Modifier RID");
									changeCancelled = true;
								}
							}

							if (!changeCancelled)
							{
								// remove inheritance provider
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["Sales Modifier Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Sales Modifier"].Appearance.Image = null;
									e.Cell.Row.Cells["Sales Modifier"].Tag = null;
								}
							}
							break;
						case "FWOS Modifier":
							SetHiddenRidColumn(e, "FWOS Modifier", "FWOS Modifier RID");

							// set the value if the use deletes the text in the cell
							if (e.Cell.Text.Length == 0)
							{
								if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ReestablishInheritance),  this.Text,
									MessageBoxButtons.YesNo, MessageBoxIcon.Question)
									== DialogResult.Yes)
								{
									// if already inheriting, cancel change
									if (Convert.ToInt32(e.Cell.Row.Cells["FWOS Modifier RID"].Value, CultureInfo.CurrentCulture) == Include.NoRID)
									{
										changeCancelled = true;
									}
									else
									{
										e.Cell.Row.Cells["FWOS Modifier RID"].Value = Include.NoRID;
									}
									if (_cellListOpen)
									{
										_deletingValueWhileListOpen = true;
									}
								}
								else
								{
									e.Cell.Value = e.Cell.OriginalValue;
									e.Cell.Refresh();
									SetHiddenRidColumn(e, "FWOS Modifier", "FWOS Modifier RID");
									changeCancelled = true;
								}
							}

							if (!changeCancelled)
							{
								// remove inheritance provider
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["FWOS Modifier Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["FWOS Modifier"].Appearance.Image = null;
									e.Cell.Row.Cells["FWOS Modifier"].Tag = null;
								}
							}
							break;
						case "Similar Store":
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							e.Cell.Row.Cells["Used Store Selector"].Value = false;
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								if (Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									e.Cell.Row.Cells["Until RID"].Value = drp.Key;
								}

								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
							}
							if (ugStoreEligibility.ActiveCell.Text.Length == 0 )
							{
								ArrayList similarStores = (ArrayList)ugStoreEligibility.ActiveCell.Row.Cells["SimilarStoresArrayList"].Value;									
								if (similarStores.Count > 0)
								{
									similarStores.Clear();
									ugStoreEligibility.ActiveCell.Row.Cells["SimilarStoresArrayList"].Value = similarStores;
								}
							}
							break;
						case "Ratio":
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								if (Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									e.Cell.Row.Cells["Until RID"].Value = drp.Key;
								}
								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
							}
							break;
						case "Until":
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
							}
							break;
						case "PMPlusSales":
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								e.Cell.Row.Cells["PMPlusSales Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["PMPlusSales Inherited"].Value = false;
								e.Cell.Row.Cells["PMPlusSales"].Appearance.Image = null;
								object cellValue;
								switch (e.Cell.Row.Cells["PMPlusSales"].Text.ToUpper())
								{
									case "TRUE":
										cellValue = true;
										break;
									case "FALSE":
										cellValue = false;
										break;
									default:
										cellValue = System.DBNull.Value;
										break;
								}
								Set_PMPlusSales_ToolTip (e.Cell.Row.Cells["PMPlusSales"], cellValue, null);
							}
							break;
					}
					if (e.Cell.Row.Band.Key == "Stores")
					{
						e.Cell.Row.Cells["Updated"].Value = true;
						EligibilityChangesMade = true;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //BEGIN TT #1401 - gtaylor - Reservation Stores
        void midAttributeCbx_SelectionChangeCommitted(object sender, System.EventArgs e)
        {
            try
            {
                EditMsgs em = new EditMsgs();

                if (_reservationIsPopulated)
                {
                    if (ValidTabReservation(ref em))
                    {
                        UpdateIMOData();
                        StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_imoGroupList[midAttributeCbx.SelectedIndex];
                        _groupRID = storeGroup.Key;
                        _imoGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
                        Reservation_Populate(false);
                    }
                    else
                    {
                        if (Convert.ToInt32(midAttributeCbx.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
                        {
                            // ??
                            cbDPStoreAttribute.SelectedValue = _groupRID;
                            for (int i = 0; i < em.EditMessages.Count; i++)
                            {
                                EditMsgs.Message emm = (EditMsgs.Message)em.EditMessages[i];
                                AddErrorMessage(emm);
                            }
                            MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                        }
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }
        //END TT#1401 - gtaylor - Reservation Stores

		private void cbSEStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				EditMsgs em = new EditMsgs();
			
				if (_eligibilityIsPopulated)
				{
					if (ValidTabStoreEligibility (ref em))
					{
                        //BEGIN TT#796 - MD - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 
                        //Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                        
                        //ugStoreEligibility.PerformAction(UltraGridAction.ExitEditMode);
                        //SAB.HierarchyServerSession.UpdateEligibilityData();
                        UpdateEligibilityData();
                        //END TT#796 - MD - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service 

						StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_storeEligibilityGroupList[cbSEStoreAttribute.SelectedIndex];
						_groupRID = storeGroup.Key;
                        _storeEligibilityGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
						StoreEligibility_Populate(false);
					}
					else
					{
						if (Convert.ToInt32(cbSEStoreAttribute.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
						{
							cbDPStoreAttribute.SelectedValue = _groupRID;
							for (int i=0; i<em.EditMessages.Count; i++)
							{
								EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
								AddErrorMessage(emm);
							}
							MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        private void cbSEStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {

        }

        private void cbSEStoreAttribute_DragDrop(object sender, DragEventArgs e)
        {
            try
            {
                bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

                if (isSuccessfull)
                {
                    ChangePending = true;
                }
            }
            catch (Exception exc)
            {
                HandleException(exc);
            }
        }

		private void ugStoreEligibility_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				string storeName = null;
				int storeRid = 0;
				switch (e.Cell.Column.Key)
				{
					case "Similar Store":
                        //Begin TT#??? - JSmith - Add Size Curve info to Node Properties
                        //frmSimilarStoreSelect frmSimilarStoreSelect = new frmSimilarStoreSelect(_SAB, _securityEligibility);
                        frmSimilarStoreSelect frmSimilarStoreSelect = new frmSimilarStoreSelect(_SAB, _securityEligibility, Convert.ToInt32(cbSEStoreAttribute.SelectedValue));
                        //End TT#??? - JSmith - Add Size Curve info to Node Properties
						if (e.Cell.Row.Band.Key == "Sets")
						{
							storeName = e.Cell.Row.Cells["SetID"].Text;
						}
						else
						{
							storeName = e.Cell.Row.Cells["Store"].Text;
						}
						ArrayList similarStores = (ArrayList)e.Cell.Row.Cells["SimilarStoresArrayList"].Value;
						frmSimilarStoreSelect.InitializeForm(storeName, _hnp.Key, _hnp.Text, similarStores);
						frmSimilarStoreSelect.ShowDialog();
						if (!frmSimilarStoreSelect.CancelClicked)
						{
							EligibilityChangesMade = true;
							similarStores = frmSimilarStoreSelect.SimilarStoreList;
							e.Cell.Row.Cells["SimilarStoresArrayList"].Value = similarStores;
							string simStores = null;
							if (similarStores.Count == 0)
							{
								simStores = string.Empty;
								e.Cell.Row.Cells["Ratio"].Value = string.Empty;
								e.Cell.Row.Cells["Until RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Until"].Value = string.Empty;
							}
							else
								if (similarStores.Count > 1)
							{
								simStores = _txtMultipleSimilarStores;
							}
							else
							{
								int simStore = (int)similarStores[0];
                                StoreProfile sp = StoreMgmt.StoreProfile_Get(simStore); //_SAB.StoreServerSession.GetStoreProfile(simStore);
								if (sp.ActiveInd)
								{
									simStores += sp.Text;
								}
							}
							e.Cell.Row.Cells["Similar Store"].Value = simStores;
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							e.Cell.Row.Cells["Used Store Selector"].Value = true;
							if (e.Cell.Row.Band.Key == "Stores")
							{
								if (Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									e.Cell.Row.Cells["Until RID"].Value = drp.Key;
								}
								e.Cell.Row.Cells["Updated"].Value = true;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
							}
						}
						frmSimilarStoreSelect.Dispose();
						break;
					case "Until":
						if (_securityEligibility.AllowUpdate)
						{
							CalendarDateSelector frmCalDtSelector = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[]{_SAB});
							if (e.Cell.Row.Cells["Until RID"].Value != null &&
								e.Cell.Row.Cells["Until RID"].Value != System.DBNull.Value &&
								Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture) != Include.NoRID)
							{
								int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
								if (e.Cell.Row.Band.Key == "Stores" &&
									Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									untilRID = drp.Key;
								}

								frmCalDtSelector.DateRangeRID = untilRID;
							}
							frmCalDtSelector.RestrictToSingleDate = false;
							frmCalDtSelector.AllowDynamicToCurrent = false;
							frmCalDtSelector.AllowDynamicToPlan = false;
                            frmCalDtSelector.AllowDynamicToStoreOpen = false;
							frmCalDtSelector.AllowDynamic = false;


							if (e.Cell.Row.Band.Key == "Sets")
							{
								storeName = e.Cell.Row.Cells["SetID"].Text;
							}
							else
							{
								storeName = e.Cell.Row.Cells["Store"].Text;
								storeRid = Convert.ToInt32(e.Cell.Row.Cells["Store RID"].Value, CultureInfo.CurrentUICulture);
                                StoreProfile storeProfile = StoreMgmt.StoreProfile_Get(storeRid); //_SAB.StoreServerSession.GetStoreProfile(storeRid);
								if (storeProfile.SellingOpenDt != _nullDate)
								{
									frmCalDtSelector.AllowDynamic = true;
									DayProfile mrsDay = _SAB.ClientServerSession.Calendar.GetDay(storeProfile.SellingOpenDt);
									frmCalDtSelector.AnchorDate = mrsDay;
									frmCalDtSelector.AllowDynamicToStoreOpen = true;
									frmCalDtSelector.AnchorDateRelativeTo = eDateRangeRelativeTo.StoreOpen;
								}
							}
							DialogResult DateRangeResult = frmCalDtSelector.ShowDialog();
							if (DateRangeResult == DialogResult.OK)
							{
								DateRangeProfile SelectedDateRange = (DateRangeProfile)frmCalDtSelector.Tag;
								e.Cell.Value = SelectedDateRange.DisplayDate;
								e.Cell.Row.Cells["Until RID"].Value = SelectedDateRange.Key;
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["Updated"].Value = true;
									e.Cell.Row.Cells["Similar Store Changed"].Value = true;
									e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
									e.Cell.Row.Cells["Similar Store"].Tag = null;
									e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								}
								// clear if error flags
								e.Cell.Tag = null;
								e.Cell.Appearance.Image = null;
								EligibilityChangesMade = true;
							}
							frmCalDtSelector.Dispose();
						}
						break;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool ValidTabStoreEligibility(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;

				foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if (Convert.ToBoolean(storeRow.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
						{
							if (storeRow.Cells["Similar Store"].Text.Length > 0 ||
								storeRow.Cells["Ratio"].Text.Length > 0 ||
								storeRow.Cells["Until"].Text.Length > 0)
							{
								if (Convert.ToBoolean(storeRow.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
								{
								}
								else
								{
									if (!SimilarStoresValid(storeRow.Cells["Similar Store"], ref errorMessage))
									{
										em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
									}
								}

								if (!RatioValid(storeRow.Cells["Ratio"], true, ref errorMessage))
								{
									em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								}

								if (!UntilValid(storeRow.Cells["Until"], ref errorMessage))
								{
									em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								}
							}
							else
							{
								storeRow.Cells["Similar Store"].Appearance.Image = null;
								storeRow.Cells["Similar Store"].Tag = null;
								storeRow.Cells["Ratio"].Appearance.Image = null;
								storeRow.Cells["Ratio"].Tag = null;
								storeRow.Cells["Until"].Appearance.Image = null;
								storeRow.Cells["Until"].Tag = null;
							}
						}
					}
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			
			return false;
		}

		private void ugStoreEligibility_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				UltraGridCell gridCell = (UltraGridCell)e.Element.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));
				if (gridCell != null)
				{
					if (gridCell.Band.Key == "Stores" 
						&& gridCell.Column.Key == "Similar Store" 
						&& gridCell.Tag == null
						&& gridCell.Row.Cells["SimilarStoresArrayList"].Value != System.DBNull.Value) 
					{
						ArrayList similarStores = (ArrayList)gridCell.Row.Cells["SimilarStoresArrayList"].Value;
						if (similarStores.Count > 1)
						{
							if (similarStores.Count <= 10)
							{
								bool firstStore = true;
								string stores = "Stores=";
								int storeLen = 0;
								foreach (int storeRID in similarStores)
								{
									if (!firstStore)
									{
										stores += ",";
										if (storeLen > 60)
										{
											stores += System.Environment.NewLine;
											storeLen = 0;
										}
									}
									StoreProfile sp = (StoreProfile)_storeProfiles.FindKey(storeRID);
									stores += sp.Text;
									firstStore = false;
									storeLen += sp.Text.Length;
								}
								gridCell.Tag = stores;
							}
							else
							{
								gridCell.Tag = "Too many stores to display";
							}
						}
					}
				}

				ShowUltraGridToolTip(ugStoreEligibility, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		#endregion Store Eligibility Tab

		#region Store Grades Tab

		private void ugStoreGrades_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_storeGradesGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.storeGradeGrid);
					if (layout.LayoutLength > 0)
					{
						ugStoreGrades.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        //End TT#169

						DefaultStoreGradesGridLayout();
					}
					this.ugStoreGrades.DisplayLayout.Bands[0].Columns["RowPosition"].Hidden = true;
				}

				// adjust columns based on type of produce
				if (_hnp.ProductType == eProductType.Hardline)
				{
					this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].Hidden = true;
					this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].Hidden = true;
				}
				else
				{
					this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].Hidden = false;
					this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].Hidden = false;
				}
				
				if (!_securityStoreGrades.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugStoreGrades.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugStoreGrades.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}
				
				_storeGradesGridBuilt = true;
				

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultStoreGradesGridLayout()
		{
			try
			{
				this.ugStoreGrades.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugStoreGrades.DisplayLayout.Override.AllowColSizing = Infragistics.Win.UltraWinGrid.AllowColSizing.Default;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Grade"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Left;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Grade"].Width = 40;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Boundary"].Width = 75;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Stock"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Width = 90;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Max Stock"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Width = 90;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Ad"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Right;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Width = 65;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].Width = 70;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].Width = 70;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Ship Up To"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;    // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

				int colScrollWidth = this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Grade"].Width;
				colScrollWidth += this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Boundary"].Width;
				colScrollWidth += this.ugStoreGrades.DisplayLayout.Bands[0].Columns["WOS Index"].Width;

				this.ugStoreGrades.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugStoreGrades.DisplayLayout.MaxColScrollRegions = 2;
				this.ugStoreGrades.DisplayLayout.ColScrollRegions[0].Width = colScrollWidth;
				this.ugStoreGrades.DisplayLayout.ColScrollRegions[0].Split (this.ugStoreGrades.DisplayLayout.ColScrollRegions[0].Width);

                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["OriginalBoundary"].Hidden = true;  // TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreGradesTab_Load()
		{
			try
			{
				if (_hnp.Key == Include.NoRID)
				{
					StoreGrades_Populate(_hnp.HomeHierarchyParentRID, false);
				}
				else
				{
					StoreGrades_Populate(_hnp.Key, false);
				}
				
				this.ugStoreGrades.DisplayLayout.GroupByBox.Hidden = true;
				this.ugStoreGrades.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugStoreGrades.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugStoreGrades.DisplayLayout.Bands[0].AddButtonCaption = "Store Grade";

				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Grade"].Header.ExclusiveColScrollRegion = this.ugStoreGrades.DisplayLayout.ColScrollRegions[0];
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Boundary"].Header.ExclusiveColScrollRegion = this.ugStoreGrades.DisplayLayout.ColScrollRegions[0];
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["WOS Index"].Header.ExclusiveColScrollRegion = this.ugStoreGrades.DisplayLayout.ColScrollRegions[0];
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Grade"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Grade);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Boundary"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["WOS Index"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_WOS_Index);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Stock);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Stock);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Ad);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Min"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Color_Min);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Color Max"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Color_Max);
				this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Ship Up To"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Override_Ship_Up_To);   // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)


				BuildStoreGradesContextmenu();
				this.ugStoreGrades.ContextMenu = mnuStoreGrades;

                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugStoreGrades);
                //End TT#169

				_storeGradesIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreGrades_Define()
		{
			try
			{
				_storeGradesDataTable = MIDEnvironment.CreateDataTable("storeGradesDataTable");
			
				DataColumn dataColumn;

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "RowPosition";
				dataColumn.Caption = "RowPosition";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Grade";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Grade);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = true;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Boundary";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "WOS Index";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_WOS_Index);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Min Stock";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Stock);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Max Stock";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Stock);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Min Ad";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Ad);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Color Min";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Color_Min);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Color Max";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Color_Max);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);

				// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
				dataColumn = new DataColumn();
				//dataColumn.DataType = System.Type.GetType("System.String");   // MID Track 6255 Enter max "1,000" and get error "must be integer" 
				dataColumn.DataType = System.Type.GetType("System.Int32");      // MID Track 6255 Enter max "1,000" and get error "must be integer" 
				dataColumn.ColumnName = "Ship Up To";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Override_Ship_Up_To);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_storeGradesDataTable.Columns.Add(dataColumn);
				// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

                // Begin TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
                dataColumn.ColumnName = "OriginalBoundary";
                dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                dataColumn.AllowDBNull = true;
                _storeGradesDataTable.Columns.Add(dataColumn);
                // End TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review

				//make grade column the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = _storeGradesDataTable.Columns["Grade"];
				_storeGradesDataTable.PrimaryKey = PrimaryKeyColumn;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void BuildStoreGradesContextmenu()
		{
			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuStoreGrades.MenuItems.Clear();
                // End TT#2138
				MenuItem mnuItemInsert = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert));
				MenuItem mnuItemInsertBefore = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_Before));
				MenuItem mnuItemInsertAfter = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_after));
				MenuItem mnuItemCut= new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Cut));
				MenuItem mnuItemCopy = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Copy));
				MenuItem mnuItemPaste = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Paste));
				MenuItem mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete));
				MenuItem mnuItemDeleteAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_DeleteAll));
				if (!_securityStoreGrades.AllowUpdate)
				{
					mnuItemInsert.Enabled = false;
					mnuItemInsertBefore.Enabled = false;
					mnuItemInsertAfter.Enabled = false;
					mnuItemCut.Enabled = false;
					mnuItemCopy.Enabled = false;
					mnuItemPaste.Enabled = false;
					mnuItemDelete.Enabled = false;
					mnuItemDeleteAll.Enabled = false;
				}
				mnuStoreGrades.MenuItems.Add(mnuItemInsert);
				mnuItemInsert.MenuItems.Add(mnuItemInsertBefore);
				mnuItemInsert.MenuItems.Add(mnuItemInsertAfter);
				mnuStoreGrades.MenuItems.Add(mnuItemDelete);
				mnuStoreGrades.MenuItems.Add(mnuItemDeleteAll);
				mnuItemInsert.Click += new System.EventHandler(this.mnuSGItemInsert_Click);
				mnuItemInsertBefore.Click += new System.EventHandler(this.mnuSGItemInsertBefore_Click);
				mnuItemInsertAfter.Click += new System.EventHandler(this.mnuSGItemInsertAfter_Click);
				mnuItemCut.Click += new System.EventHandler(this.mnuSGItemCut_Cut);
				mnuItemCopy.Click += new System.EventHandler(this.mnuSGItemCopy_Click);
				mnuItemPaste.Click += new System.EventHandler(this.mnuSGItemPaste_Click);
				mnuItemDelete.Click += new System.EventHandler(this.mnuSGItemDelete_Click);
				mnuItemDeleteAll.Click += new System.EventHandler(this.mnuSGItemDeleteAll_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSGItemInsert_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSGItemInsertBefore_Click(object sender, System.EventArgs e)
		{
			try
			{
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                if (ugStoreGrades.Rows.Count > 0 &&
                    ugStoreGrades.ActiveRow != null)
                {
                    int rowPosition = Convert.ToInt32(this.ugStoreGrades.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugStoreGrades.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) >= rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugStoreGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition;
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugStoreGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                _setRowPosition = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
            finally
            {
                this.Cursor = Cursors.Default;
            }
		}

		private void mnuSGItemInsertAfter_Click(object sender, System.EventArgs e)
		{
            try
            {
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                // Begin TT#2747 - JSmith - Store Grade Tab in Node Properties
                //if (ugSellThruPcts.Rows.Count > 0 &&
                //    ugSellThruPcts.ActiveRow != null)
                if (ugStoreGrades.Rows.Count > 0 &&
                    ugStoreGrades.ActiveRow != null)
                // End TT#2747 - JSmith - Store Grade Tab in Node Properties
                {

                    int rowPosition = Convert.ToInt32(this.ugStoreGrades.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugStoreGrades.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) > rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugStoreGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition + 1;
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugStoreGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                _setRowPosition = true;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                this.Cursor = Cursors.Default;
            }
		}

		private void mnuSGItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuSGItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSGItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSGItemDelete_Click(object sender, System.EventArgs e)
		{
			try
			{
				if (this.ugStoreGrades.ActiveRow != null)
				{
					this.ugStoreGrades.ActiveRow.Delete();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSGItemDeleteAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				_storeGradesDataTable.Rows.Clear();
				_storeGradesDataTable.AcceptChanges();
				StoreGradesChangesMade = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSGItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStoreGrades.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSGItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStoreGrades.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreGrades_Populate(int nodeRID, bool aReplaceValues)
		{
			try
			{
				string storeGradesInheritedFrom = null;
				string minMaxesInheritedFrom = null;
				string inheritMsg = null;
				int count = 0;
				int minStock, maxStock, minAd, minColor, MaxColor, ShipUpTo;  // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
				HierarchyNodeProfile hnp = null;

				_storeGradesInherited = false;
				_minMaxesInherited = false;

				StoreGrades_Define();

				if (_storeGradeList == null ||
					aReplaceValues)
				{
					_storeGradeList = _SAB.HierarchyServerSession.GetStoreGradeList(nodeRID, false, true);
				}
				//bool[,] cellIsNull = new bool[_storeGradeList.Count, 5]; // MID Track 6255 Enter max "1,000" and get error "must be integer" 
				bool[,] cellIsNull = new bool[_storeGradeList.Count, 6]; // MID Track 6255 Enter max "1,000" and get error "must be integer" 
				cellIsNull.Initialize();
                int col;
				foreach(StoreGradeProfile sgp in _storeGradeList)
				{
                    col = 0;
					if (sgp.StoreGradesIsInherited)
					{
						_storeGradesInherited = true;
						if (hnp == null || hnp.Key != sgp.StoreGradesInheritedFromNodeRID)
						{
							hnp = _SAB.HierarchyServerSession.GetNodeData(sgp.StoreGradesInheritedFromNodeRID);
						}
						storeGradesInheritedFrom = hnp.Text;
					}
					if (sgp.MinMaxesIsInherited)
					{
						_minMaxesInherited = true;
						if (hnp == null || hnp.Key != sgp.MinMaxesInheritedFromNodeRID)
						{
							hnp = _SAB.HierarchyServerSession.GetNodeData(sgp.MinMaxesInheritedFromNodeRID);
						}
						minMaxesInheritedFrom = hnp.Text;
					}

                    if (sgp.MinStock > Include.Undefined)
                    {
                        minStock = sgp.MinStock;
                    }
                    else
                    {
                        cellIsNull[count,col] = true;
                        minStock = 0;
                    }
                    col++;
                    if (sgp.MaxStock > Include.Undefined)
                    {
                        maxStock = sgp.MaxStock;
                    }
                    else
                    {
                        cellIsNull[count,col] = true;
                        maxStock = 0;
                    }
                    col++;
                    if (sgp.MinAd > Include.Undefined)
                    {
                        minAd = sgp.MinAd;
                    }
                    else
                    {
                        cellIsNull[count,col] = true;
                        minAd = 0;
                    }
                    col++;
                    if (sgp.MinColor > Include.Undefined)
                    {
                        minColor = sgp.MinColor;
                    }
                    else
                    {
                        cellIsNull[count,col] = true;
                        minColor = 0;
                    }
                    col++;
                    if (sgp.MaxColor > Include.Undefined)
                    {
                        MaxColor = sgp.MaxColor;
                    }
                    else
                    {
                        cellIsNull[count,col] = true;
                        MaxColor = 0;
                    }
					col++;
					// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
					if (sgp.ShipUpTo > Include.Undefined)
					{
						ShipUpTo = sgp.ShipUpTo;
					}
					else
					{
						cellIsNull[count, col] = true;
						ShipUpTo = 0;
					}
					// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

                    _storeGradesDataTable.Rows.Add(new object[] { count, sgp.StoreGrade, sgp.Boundary, sgp.WosIndex,  
																	minStock, maxStock, minAd,  
																	minColor, MaxColor, ShipUpTo, sgp.OriginalBoundary });    // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)  // TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review
					++count;
				}

				this.ugStoreGrades.DataSource = _storeGradesDataTable;
                this.ugStoreGrades.DisplayLayout.Bands[0].Columns["Ship Up To"].Hidden = true;   // TT#853 - AGallagher - Allocation Override - Ship Up To by Grade Criteria - Hide until redesign is finalized 

                for (int i = 0; i < _storeGradeList.Count; i++)
                {
					for (int j = 0; j < 6; j++)  // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
                    {
                        if (cellIsNull[i, j])
                        {
                            ugStoreGrades.Rows[i].Cells[j + 4].Value = System.DBNull.Value;
                        }
                    }
                }

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityStoreGrades;
					SetControlReadOnly(this.tabStoreGrades, !securityProfile.AllowUpdate);
				}
				if (securityProfile.AllowUpdate)
				{
					this.ugStoreGrades.DisplayLayout.AddNewBox.Hidden = false;
				}
				else
				{
					this.ugStoreGrades.DisplayLayout.AddNewBox.Hidden = true;
				}
				
				if (_storeGradesInherited)
				{
					inheritMsg = _txtInheritedFrom + storeGradesInheritedFrom;
					InheritanceProvider.SetError (this.lblStoreGradesInheritance,inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError (this.lblStoreGradesInheritance,string.Empty);
				}

				if (_minMaxesInherited)
				{
					inheritMsg = _txtInheritedFrom + minMaxesInheritedFrom;
					InheritanceProvider.SetError (this.lblMinMaxesInheritance,inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError (this.lblMinMaxesInheritance,string.Empty);
				}

				// order by boundary
				ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true); 
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_storeGradesIsPopulated)
				{
					switch (e.Cell.Column.Key)
					{
						case "Grade":
						case "Boundary":
						case "WOS Index":
							StoreGradesChangesMade = true;
							InheritanceProvider.SetError (this.lblStoreGradesInheritance,string.Empty);
							break;
						case "Min Stock":
						case "Max Stock":
						case "Min Ad":
						case "Color Min":
						case "Color Max":
						case "Ship Up To":    // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
							MinMaxesChangesMade = true;
							InheritanceProvider.SetError (this.lblMinMaxesInheritance,string.Empty);
							break;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_AfterRowInsert(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				e.Row.Cells["RowPosition"].Value = this.ugStoreGrades.Rows.Count;
                if (_storeGradesIsPopulated)
                {
                    ChangePending = true;
                }
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_AfterRowsDeleted(object sender, System.EventArgs e)
		{
			try
			{
				if (_storeGradesIsPopulated)
				{
					StoreGradesChangesMade = true;
					MinMaxesChangesMade = true;
					ugStoreGrades.UpdateData();
                    ChangePending = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		/// <summary>
		/// Reassignes the RowPosition after a sort
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void ugStoreGrades_AfterSortChange(object sender, Infragistics.Win.UltraWinGrid.BandEventArgs e)
		{
			try
			{
				int count = 0;
				if (_setRowPosition)
				{
					foreach(  UltraGridRow gridRow in ugStoreGrades.Rows )
					{
						gridRow.Cells["RowPosition"].Value = count;
						++count;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugStoreGrades.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugStoreGrades.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugStoreGrades, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugStoreGrades, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (this.ugStoreGrades.ActiveCell != null)
					{
						switch (this.ugStoreGrades.ActiveCell.Column.Key)
						{
							case "Grade":
								if (!StoreGradeValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Boundary":
								if (!StoreBoundaryValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "WOS Index":
								if (!WOSIndexValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Min Stock":
								if (!MinStockValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Max Stock":
								if (!MaxStockValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Min Ad":
								if (!MinAdValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Color Min":
								if (!ColorMinValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Color Max":
								if (!ColorMaxValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
							case "Ship Up To":
								if (!ShipUpToValid(ugStoreGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_BeforeRowUpdate(object sender, Infragistics.Win.UltraWinGrid.CancelableRowEventArgs e)
		{
			try
			{
				if (e.Row.Cells["Grade"].Text.Length == 0 &&
					e.Row.Cells["Boundary"].Text.Length == 0 &&
					e.Row.Cells["WOS Index"].Text.Length == 0 &&
					e.Row.Cells["Min Stock"].Text.Length == 0 &&
					e.Row.Cells["Max Stock"].Text.Length == 0 &&
					e.Row.Cells["Min Ad"].Text.Length == 0 &&
					e.Row.Cells["Color Min"].Text.Length == 0 &&
					e.Row.Cells["Color Max"].Text.Length == 0 &&
					e.Row.Cells["Ship Up To"].Text.Length == 0)  // TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
				{
					e.Cancel = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_AfterRowUpdate(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true); 	
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool StoreGradeValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					// make sure grades are unique
					foreach(  UltraGridRow gridRow in this.ugStoreGrades.Rows )
					{
						if (gridCell.Row != gridRow)
						{
							if ((string)gridCell.Text == (string)gridRow.Cells["Grade"].Text)
							{
								errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreGradesNotUnique);
								errorFound = true;
								break;
							}
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool StoreBoundaryValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					{
						// make sure boundaries are unique
						foreach(  UltraGridRow gridRow in this.ugStoreGrades.Rows )
						{
							if (gridCell.Row != gridRow)
							{
								if (Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture) == Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture))
								{
									errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_GradeBoundariesNotUnique);
									errorFound = true;
									break;
								}
							}
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool WOSIndexValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool MinStockValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool MaxStockValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					// validate against min stock if entered
					if (gridCell.Row.Cells["Min Stock"].Text.Length != 0)
					{
						if (Convert.ToInt32(gridCell.Row.Cells["Min Stock"].Value, CultureInfo.CurrentUICulture) > cellValue)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MinStockNotLessThanMax);
							errorFound = true;
							gridCell.Row.Cells["Min Stock"].Appearance.Image = ErrorImage;
							gridCell.Row.Cells["Min Stock"].Tag = errorMessage;
						}
						else
						{
							gridCell.Row.Cells["Min Stock"].Appearance.Image = null;
							gridCell.Row.Cells["Min Stock"].Tag = null;
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool MinAdValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool ColorMinValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
						// validate against min stock if entered
						if (gridCell.Row.Cells["Min Stock"].Text.Length > 0)
					{
						if (Convert.ToInt32(gridCell.Row.Cells["Min Stock"].Value, CultureInfo.CurrentUICulture) < cellValue)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MinColorNotLessThanMinStock);
							errorFound = true;
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool ColorMaxValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
						// validate against color min if entered
						if (gridCell.Row.Cells["Color Min"].Text.Length != 0)
					{
						if (Convert.ToInt32(gridCell.Row.Cells["Color Min"].Value, CultureInfo.CurrentUICulture) > cellValue)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MinColorNotLessThanMax);
							errorFound = true;
							gridCell.Row.Cells["Color Min"].Appearance.Image = ErrorImage;
							gridCell.Row.Cells["Color Min"].Tag = errorMessage;
						}
						else
						{
							gridCell.Row.Cells["Color Min"].Appearance.Image = null;
							gridCell.Row.Cells["Color Min"].Tag = null;
						}
					}
					else
						// validate against max stock if entered
						if (gridCell.Row.Cells["Max Stock"].Text.Length > 0)
					{
						if (Convert.ToInt32(gridCell.Row.Cells["Max Stock"].Value, CultureInfo.CurrentUICulture) < cellValue)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MaxColorNotLessThanMaxStock);
							errorFound = true;
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
		private bool ShipUpToValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					//					int cellValue = Convert.ToInt32(gridCell.Text, CultureInfo.CurrentUICulture);
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					//else
					//    // validate against color min if entered
					//    if (gridCell.Row.Cells["Ship Up To"].Text.Length != 0)
					//    {
					//        //						if (Convert.ToInt32(gridCell.Row.Cells["Color Min"].Text, CultureInfo.CurrentUICulture) > cellValue)
					//        if (Convert.ToInt32(gridCell.Row.Cells["Ship Up To"].Value, CultureInfo.CurrentUICulture) > cellValue)
					//        {
					//            errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MinColorNotLessThanMax);
					//            errorFound = true;
					//            gridCell.Row.Cells["Ship Up To"].Appearance.Image = ErrorImage;
					//            gridCell.Row.Cells["Ship Up To"].Tag = errorMessage;
					//        }
					//        else
					//        {
					//            gridCell.Row.Cells["Ship Up To"].Appearance.Image = null;
					//            gridCell.Row.Cells["Ship Up To"].Tag = null;
					//        }
					//    }
					//    else
					//        // validate against max stock if entered
					//        if (gridCell.Row.Cells["Max Stock"].Text.Length > 0)
					//        {
					//            //						if (Convert.ToInt32(gridCell.Row.Cells["Max Stock"].Text, CultureInfo.CurrentUICulture) < cellValue)
					//            if (Convert.ToInt32(gridCell.Row.Cells["Max Stock"].Value, CultureInfo.CurrentUICulture) < cellValue)
					//            {
					//                errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MaxColorNotLessThanMaxStock);
					//                errorFound = true;
					//            }
					//        }
				}
			}
			catch (Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}
		// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

		private bool ValidTabStoreGrades(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;
				int lastBoundary = 0;
				// sort descending by boundary
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
				UltraGridRow lastRow = null;
				foreach(  UltraGridRow gridRow in ugStoreGrades.Rows )
				{
					lastRow = gridRow;
					if (!StoreGradeValid(gridRow.Cells["Grade"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
				
					if (!StoreBoundaryValid(gridRow.Cells["Boundary"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						lastBoundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture);
					}
				
					if (!WOSIndexValid(gridRow.Cells["WOS Index"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
						
					if (gridRow.Cells["Min Stock"].Text != string.Empty)
					{
						if (!MinStockValid(gridRow.Cells["Min Stock"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}

					if (gridRow.Cells["Max Stock"].Text != string.Empty)
					{
						if (!MaxStockValid(gridRow.Cells["Max Stock"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}

					if (gridRow.Cells["Min Ad"].Text != string.Empty)
					{
						if (!MinAdValid(gridRow.Cells["Min Ad"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}
				
					if (gridRow.Cells["Color Min"].Text != string.Empty)
					{
						if (!ColorMinValid(gridRow.Cells["Color Min"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}

					if (gridRow.Cells["Color Max"].Text != string.Empty)
					{
						if (!ColorMaxValid(gridRow.Cells["Color Max"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}
					// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
					if (gridRow.Cells["Ship Up To"].Text != string.Empty)
					{
						if (!ShipUpToValid(gridRow.Cells["Ship Up To"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
						}
					}
					// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

				}

				if (lastBoundary != 0)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_LastBoundaryNotZero);
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					lastRow.Cells["Boundary"].Appearance.Image = ErrorImage;
					lastRow.Cells["Boundary"].Tag = errorMessage;
				}
			
				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			
			return false;
		}

		private void cbxSGInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				StoreGradesChangesMade = true;
				MinMaxesChangesMade = true;
			}
		}

		private void cbxSGApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				StoreGradesChangesMade = true;
				MinMaxesChangesMade = true;
			}
		}

		#endregion Store Grades Tab

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties

		#region Size Curves Criteria Tab

		private void ugSizeCurvesInheritedCriteria_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_sizeCurvesInheritedCriteriaGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveInheritedCriteriaGrid);
					if (layout.LayoutLength > 0)
					{
						ugSizeCurvesInheritedCriteria.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultSizeCurvesInheritedCriteriaGridLayout();
					}
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["CriteriaIsInherited"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["CriteriaIsInheritedFromRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Updated"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["CriteriaRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Sequence"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["DefaultIsReadOnly"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["DefaultIsInherited"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["DefaultIsInheritedFromRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["LevelType"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["LevelRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["LevelSeq"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["LevelOff"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["DateRangeRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["OLLRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["CustomOLLRID"].Hidden = true;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["SizeGroupRID"].Hidden = true;
					//Begin TT#1076 - JScott - Size Curves by Set
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["SGRID"].Hidden = true;
					//End TT#1076 - JScott - Size Curves by Set

					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].CellActivation = Activation.Disabled;
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].CellActivation = Activation.Disabled;
					//Begin TT#1076 - JScott - Size Curves by Set
					this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].CellActivation = Activation.Disabled;
					//End TT#1076 - JScott - Size Curves by Set
                    // Begin TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
                    if (_securitySizeCurves.AllowUpdate)
                    {
                        this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                        this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.Disabled;
                        this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    }
                    // End TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
				}

				if (!_securitySizeCurves.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

				BuildSizeCurveCriteriaSizeGroupList(ugSizeCurvesInheritedCriteria);
				//Begin TT#1076 - JScott - Size Curves by Set
				BuildSizeCurveCriteriaStoreGroupList(ugSizeCurvesInheritedCriteria);
				//End TT#1076 - JScott - Size Curves by Set

				_sizeCurvesInheritedCriteriaGridBuilt = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_sizeCurvesCriteriaGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveCriteriaGrid);
					if (layout.LayoutLength > 0)
					{
						ugSizeCurvesCriteria.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultSizeCurvesCriteriaGridLayout();
					}
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["CriteriaIsInherited"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["CriteriaIsInheritedFromRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Updated"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["CriteriaRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Sequence"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["DefaultIsReadOnly"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["DefaultIsInherited"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["DefaultIsInheritedFromRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["LevelType"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["LevelRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["LevelSeq"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["LevelOff"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["DateRangeRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["OLLRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["CustomOLLRID"].Hidden = true;
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["SizeGroupRID"].Hidden = true;
					//Begin TT#1076 - JScott - Size Curves by Set
					this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["SGRID"].Hidden = true;
					//End TT#1076 - JScott - Size Curves by Set
                     
                    // Begin TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
                    if (_securitySizeCurves.AllowUpdate)
                    {
                        this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                        this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.NoEdit;
                        this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    }
                    // End TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
				}
                
				if (!_securitySizeCurves.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesCriteria.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesCriteria.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

				BuildSizeCurveCriteriaMerchandiseList(ugSizeCurvesCriteria);
				BuildSizeCurveCriteriaSizeGroupList(ugSizeCurvesCriteria);
				//Begin TT#1076 - JScott - Size Curves by Set
				BuildSizeCurveCriteriaStoreGroupList(ugSizeCurvesCriteria);
				//End TT#1076 - JScott - Size Curves by Set

				_sizeCurvesCriteriaGridBuilt = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void DefaultSizeCurvesInheritedCriteriaGridLayout()
		{
			try
			{
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Override.AllowColSizing = Infragistics.Win.UltraWinGrid.AllowColSizing.Default;

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Default"].Width = 45;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Width = 200;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Width = 160;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Width = 45;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Center;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Width = 110;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Width = 100;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Width = 100;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].Width = 120;
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Width = 100;
				//End TT#1076 - JScott - Size Curves by Set

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Default"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Default"].CellActivation = Activation.NoEdit;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].CellActivation = Activation.Disabled;
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].CellActivation = Activation.Disabled;
				//End TT#1076 - JScott - Size Curves by Set

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.AddNewBox.Hidden = true;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Override.AllowAddNew = AllowAddNew.No;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Override.AllowDelete = Infragistics.Win.DefaultableBoolean.False;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void DefaultSizeCurvesCriteriaGridLayout()
		{
			try
			{
				this.ugSizeCurvesCriteria.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugSizeCurvesCriteria.DisplayLayout.Override.AllowColSizing = Infragistics.Win.UltraWinGrid.AllowColSizing.Default;

				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Default"].Width = 45;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Width = 200;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Width = 160;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Width = 45;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Center;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Width = 110;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Width = 100;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Width = 100;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].Width = 120;
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Width = 100;
				//End TT#1076 - JScott - Size Curves by Set

				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Default"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Default"].CellActivation = Activation.NoEdit;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].AutoEdit = true;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.NoEdit;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.CheckBox;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].CellActivation = Activation.NoEdit;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellActivation = Activation.NoEdit;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Override Model"].AutoEdit = true;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Size Group"].AutoEdit = true;
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Attribute"].AutoEdit = true;
				//End TT#1076 - JScott - Size Curves by Set

				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].AddButtonCaption = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Criteria);
				this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Hidden = false;
				this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Style = AddNewBoxStyle.Compact;

				if (!_securitySizeCurves.AllowUpdate)
				{
					this.ugSizeCurvesCriteria.DisplayLayout.Override.AllowAddNew = AllowAddNew.No;
					this.ugSizeCurvesCriteria.DisplayLayout.Override.AllowDelete = Infragistics.Win.DefaultableBoolean.False;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesCriteriaTab_Load()
		{
			try
			{
				//Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				//SizeCurvesCriteria_Populate(false);
				SizeCurvesCriteria_Populate(true);
				//End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.GroupByBox.Hidden = true;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Default"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Merchandise);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Date_Range);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Lost_Sales);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Include_Exclude);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Header.Caption = string.Empty;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Group);
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Curve_Name);
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Attribute);
				//End TT#1076 - JScott - Size Curves by Set

				this.ugSizeCurvesCriteria.DisplayLayout.GroupByBox.Hidden = true;
				this.ugSizeCurvesCriteria.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugSizeCurvesCriteria.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].AddButtonCaption = "Size Curve Criteria";

				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Default"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Merchandise);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Date_Range);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Lost_Sales);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Include_Exclude);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Override Model"].Header.Caption = string.Empty;
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Size Group"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Group);
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Curve_Name);
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Attribute"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Attribute);
				//End TT#1076 - JScott - Size Curves by Set

				BuildSizeCurvesCriteriaContextmenu();
				this.ugSizeCurvesCriteria.ContextMenu = mnuSizeCurvesCriteria;

				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugSizeCurvesInheritedCriteria);
                //FormatColumns(this.ugSizeCurvesCriteria);
                //End TT#169
				_sizeCurvesCriteriaIsPopulated = true;
				_sizeCurvesInheritedCriteriaIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesCriteria_Define(ref DataTable aTable)
		{
			DataColumn dataColumn;
			DataColumn[] PrimaryKeyColumn;

			try
			{
				aTable = MIDEnvironment.CreateDataTable("sizeCurvesInheritedCriteriaDataTable");

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "CriteriaIsInherited";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "CriteriaIsInheritedFromRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = false;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "Updated";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = false;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "CriteriaRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = false;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "Sequence";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = false;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "DefaultIsReadOnly";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "DefaultIsInherited";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "DefaultIsInheritedFromRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = false;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "Default";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Default);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "LevelType";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "LevelRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "LevelSeq";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "LevelOff";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Merchandise";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Merchandise);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "DateRangeRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Date Range";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(bool);
				dataColumn.ColumnName = "Lost Sales";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Lost_Sales);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "OLLRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "CustomOLLRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Include/Exclude";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Include_Exclude);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Override Model";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_OverrideModel_Model);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "SizeGroupRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Size Group";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Group);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Curve Name";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Curve_Name);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				//Begin TT#1076 - JScott - Size Curves by Set
				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(int);
				dataColumn.ColumnName = "SGRID";
				dataColumn.Caption = string.Empty;
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = typeof(string);
				dataColumn.ColumnName = "Attribute";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Attribute);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				aTable.Columns.Add(dataColumn);

				//End TT#1076 - JScott - Size Curves by Set
				//make key column the primary key
				PrimaryKeyColumn = new DataColumn[2];
				PrimaryKeyColumn[0] = aTable.Columns["CriteriaRID"];
				PrimaryKeyColumn[1] = aTable.Columns["Sequence"];
				aTable.PrimaryKey = PrimaryKeyColumn;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildSizeCurvesCriteriaContextmenu()
		{
			MenuItem mnuItemAdd;
			MenuItem mnuItemDelete;
            MenuItem mnuItemDeleteAll;
            MenuItem mnuItemInUse;  //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties

			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuSizeCurvesCriteria.MenuItems.Clear();
                // End TT#2138
				mnuItemAdd = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Add));
				mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete));
                mnuItemDeleteAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_DeleteAll));
                mnuItemInUse = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_In_Use));  //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties


				if (!_securitySizeCurves.AllowUpdate)
				{
					mnuItemAdd.Enabled = false;
					mnuItemDelete.Enabled = false;
                    mnuItemDeleteAll.Enabled = false;
                    mnuItemInUse.Enabled = true;  //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
                }

				mnuSizeCurvesCriteria.MenuItems.Add(mnuItemAdd);
				mnuSizeCurvesCriteria.MenuItems.Add(mnuItemDelete);
                mnuSizeCurvesCriteria.MenuItems.Add(mnuItemDeleteAll);
                mnuSizeCurvesCriteria.MenuItems.Add(mnuItemInUse);  //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties

				mnuItemAdd.Click += new System.EventHandler(this.mnuSCCItemAdd_Click);
				mnuItemDelete.Click += new System.EventHandler(this.mnuSCCItemDelete_Click);
                mnuItemDeleteAll.Click += new System.EventHandler(this.mnuSCCItemDeleteAll_Click);
                mnuItemInUse.Click += new System.EventHandler(this.mnuSCCItemInUse_Click);  //TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
            }
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSCCItemAdd_Click(object sender, System.EventArgs e)
		{
			try
			{
				InsertSizeCurvesCriteriaRow();
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSCCItemDelete_Click(object sender, System.EventArgs e)
		{
			int key;
			SizeCurveCriteriaProfile sccp;

			try
			{
				if (this.ugSizeCurvesCriteria.ActiveRow != null)
				{
					key = (int)ugSizeCurvesCriteria.ActiveRow.Cells["CriteriaRID"].Value;

                    //BEGIN TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties   
                    if (key >= 0)
                    {
                        //Mandatory check for Size Curve Criteria In Use before delete.
                        _ridList = new ArrayList();
                        _ridList.Add(key);
                        etype = eProfileType.SizeCurveCriteria;
                        //string inUseTitle = Regex.Replace(etype.ToString(), "((?<=[a-z])[A-Z]|[A-Z](?=[a-z]))", " $1").Trim(); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                        string inUseTitle = InUseUtility.GetInUseTitleFromProfileType(etype); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                        bool inQuiry = false;
                        bool dialogShown;
                        DisplayInUseForm(_ridList, etype, inUseTitle, inQuiry, out dialogShown);

                        if (!dialogShown)
                        {
                            this.ugSizeCurvesCriteria.BeginUpdate();

                            key = (int)ugSizeCurvesCriteria.ActiveRow.Cells["CriteriaRID"].Value;

                            //Begin TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                            if (key >= 0)
                            {
                                //End TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                                sccp = (SizeCurveCriteriaProfile)_sizeCurvesCriteriaList.FindKey(key);
                                sccp.CriteriaChangeType = eChangeType.delete;
                                _sizeCurvesCriteriaList.Update(sccp);
                                //Begin TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                            }
                            //End TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception

                            this.ugSizeCurvesCriteria.ActiveRow.Delete();

                            _sizeCurvesCriteriaDataTable.AcceptChanges();
                            this.ugSizeCurvesCriteria.EndUpdate();

                            SizeCurvesCriteriaChangesMade = true;
                        }
                        //END   TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
                    }
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSCCItemDeleteAll_Click(object sender, System.EventArgs e)
		{
			string message;
			ArrayList rowsToDelete;
			int key;
			SizeCurveCriteriaProfile sccp;

			try
			{
				message = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ConfirmDelete);
				message = message.Replace("{0}", MIDText.GetTextOnly(eMIDTextCode.lbl_Size_Curves_Criteria));

				rowsToDelete = new ArrayList();

                //BEGIN TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
                _ridList = new ArrayList();
				int sc_rid;

                foreach (UltraGridRow gridRow in this.ugSizeCurvesCriteria.Rows)
                {
                    sc_rid = (int)gridRow.Cells["CriteriaRID"].Value;
                    _ridList.Add(sc_rid);
                }


                if (MessageBox.Show(message, this.Text, MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
                {
                    etype = eProfileType.SizeCurveCriteria;
                    //string inUseTitle =  Regex.Replace(etype.ToString(), "((?<=[a-z])[A-Z]|[A-Z](?=[a-z]))", " $1").Trim(); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                    string inUseTitle = InUseUtility.GetInUseTitleFromProfileType(etype); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                    bool inQuiry = false;
                    bool dialogShown;
                    DisplayInUseForm(_ridList, etype, inUseTitle, inQuiry, out dialogShown);

                    if (!dialogShown)
                    {
                        this.ugSizeCurvesCriteria.BeginUpdate();

                        rowsToDelete = new ArrayList();

                        foreach (UltraGridRow gridRow in this.ugSizeCurvesCriteria.Rows)
                        {
                            rowsToDelete.Add(gridRow);
                        }

                        foreach (UltraGridRow gridRow in rowsToDelete)
                        {
                            key = (int) gridRow.Cells["CriteriaRID"].Value;

                            //Begin TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                            if (key >= 0)
                            {
                                //End TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                                sccp = (SizeCurveCriteriaProfile) _sizeCurvesCriteriaList.FindKey(key);
                                sccp.CriteriaChangeType = eChangeType.delete;
                                _sizeCurvesCriteriaList.Update(sccp);
                                //Begin TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception
                            }
                            //End TT #412 - JScott - Size Curve - Node Properties - added 3 rows to Criteria tab did a right click>delete and received null reference exception

                            gridRow.Delete(false);
                        }

                        _sizeCurvesCriteriaDataTable.AcceptChanges();
                        this.ugSizeCurvesCriteria.EndUpdate();

                        SizeCurvesCriteriaChangesMade = true;
                    }
                }
			    //END   TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

        //BEGIN TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties
        private void mnuSCCItemInUse_Click(object sender, System.EventArgs e)
        {
            _ridList = new ArrayList();
            int key;
            try
            {
                if (ugSizeCurvesCriteria.ActiveRow != null)
                {
                    key = (int)ugSizeCurvesCriteria.ActiveRow.Cells["CriteriaRID"].Value;
                    if (key >= 0)
                    {
                        _ridList.Add(key);
                    }
                }
                //If the no RID is selected do nothing.
                if (_ridList.Count > 0)
                {
                    etype = eProfileType.SizeCurveCriteria;
                    //string inUseTitle = Regex.Replace(etype.ToString(), "((?<=[a-z])[A-Z]|[A-Z](?=[a-z]))", " $1").Trim(); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                    string inUseTitle = InUseUtility.GetInUseTitleFromProfileType(etype); //TT#1532-MD -jsobek -Add In Use for Header Characteristics
                    bool display = false;
                    bool inQuiry = true; 
                    DisplayInUseForm(_ridList, etype, inUseTitle, ref display, inQuiry);
                    _display = display;
                }
            }
            catch (Exception)
            {
                
                throw;
            }
        }
        //END   TT#729-MD-VStuart-In Use 4 Size Curve Criteria with Curve Name in Node Properties

	    private void SizeCurvesCriteria_Populate(bool aReplaceValues)
		{
			FunctionSecurityProfile securityProfile;
			int nodeRID;

			try
			{
				//Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				if (!tabNodeProperties.Controls.Contains(this.tabSizeCurves))
				{
					return;
				}

				//End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				if (_hnp.Key == Include.NoRID)
				{
					nodeRID = _hnp.HomeHierarchyParentRID;
				}
				else
				{
					nodeRID = _hnp.Key;
				}

				if (_sizeCurvesCriteriaList == null || aReplaceValues)
				{
					_sizeCurvesCriteriaList = _SAB.HierarchyServerSession.GetSizeCurveCriteriaList(nodeRID, false);
				}

				if (_sizeCurveDefaultCriteriaProfile == null || aReplaceValues)
				{
					_sizeCurveDefaultCriteriaProfile = _SAB.HierarchyServerSession.GetSizeCurveDefaultCriteriaProfile(nodeRID, _sizeCurvesCriteriaList, false);
				}

				Populate_SizeCurvesInheritedCriteria();
				Populate_SizeCurvesCriteria();
				SelectDefaultCriteria();

				securityProfile = _securityNodeProperties;

				if (!_newNode)
				{
					securityProfile = _securitySizeCurves;
					SetControlReadOnly(this.tabSizeCurvesCriteria, !securityProfile.AllowUpdate);
				}

				if (securityProfile.AllowUpdate)
				{
					this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Hidden = false;
				}
				else
				{
					this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Hidden = true;
				}

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.AddNewBox.Hidden = true;

				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Merchandise"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Lost Sales"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Include/Exclude"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Override Model"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Size Group"].CellActivation = Activation.Disabled;
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Curve Name"].CellActivation = Activation.Disabled;
				//Begin TT#1076 - JScott - Size Curves by Set
				this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Attribute"].CellActivation = Activation.Disabled;
				//End TT#1076 - JScott - Size Curves by Set

				// order by boundary
				ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Clear();
				ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Add("Sequence", false);

				ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].SortedColumns.Clear();
				ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].SortedColumns.Add("Sequence", false);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void Populate_SizeCurvesInheritedCriteria()
		{
			int count;
			bool updated;
			object[] rowValues;

			try
			{
				SizeCurvesCriteria_Define(ref _sizeCurvesInheritedCriteriaDataTable);

				//Begin TT#1076 - JScott - Size Curves by Set
				//rowValues = new object[24];
				rowValues = new object[26];
				//End TT#1076 - JScott - Size Curves by Set
				count = 0;

				foreach (SizeCurveCriteriaProfile sccp in _sizeCurvesCriteriaList)
				{
					if (sccp.CriteriaIsInherited)
					{
						updated = sccp.CriteriaChangeType != eChangeType.none;

                        rowValues[0] = sccp.CriteriaIsInherited;                //CriteriaIsInherited
                        rowValues[1] = sccp.CriteriaInheritedFromNodeRID;       //CriteriaIsInheritedFromRID
                        rowValues[2] = updated;                                 //Updated
                        rowValues[3] = sccp.Key;                                //CriteriaRID
                        rowValues[4] = sccp.CriteriaSequence;                   //Sequence
                        rowValues[5] = false;                                   //DefaultIsReadOnly
                        rowValues[6] = false;                                   //DefaultIsInherited
                        rowValues[7] = Include.NoRID;                           //DefaultIsInheritedFromRID
                        rowValues[8] = false;                                   //Default
                        rowValues[9] = sccp.CriteriaLevelType;                  //LevelType
                        rowValues[10] = sccp.CriteriaLevelRID;                  //LevelRID
                        rowValues[11] = sccp.CriteriaLevelSequence;             //LevelSeq
                        rowValues[12] = sccp.CriteriaLevelOffset;               //LevelOff
                        rowValues[13] = System.DBNull.Value;                    //Merchandise
                        rowValues[14] = sccp.CriteriaDateRID;                   //DateRangeRID
                        rowValues[15] = System.DBNull.Value;                    //Date Range
                        rowValues[16] = sccp.CriteriaApplyLostSalesInd;         //Lost Sales
                        rowValues[17] = sccp.CriteriaOLLRID;                    //OLLRID
                        rowValues[18] = sccp.CriteriaCustomOLLRID;              //CustomOLLRID
                        rowValues[19] = System.DBNull.Value;                    //Include/Exclude
                        rowValues[20] = System.DBNull.Value;                    //Override Model
                        rowValues[21] = sccp.CriteriaSizeGroupRID;              //SizeGroupRID
                        rowValues[22] = System.DBNull.Value;                    //Size Group
                        rowValues[23] = sccp.CriteriaCurveName;                 //Curve Name
                        //Begin TT#1076 - JScott - Size Curves by Set           
                        rowValues[24] = sccp.CriteriaSgRID;                     //SGRID
                        rowValues[25] = System.DBNull.Value;                    //Attribute
						//End TT#1076 - JScott - Size Curves by Set

						_sizeCurvesInheritedCriteriaDataTable.Rows.Add(rowValues);

						++count;
					}
				}

				this.ugSizeCurvesInheritedCriteria.DataSource = _sizeCurvesInheritedCriteriaDataTable;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void Populate_SizeCurvesCriteria()
		{
			int count;
			bool updated;
			object[] rowValues;

			try
			{
				SizeCurvesCriteria_Define(ref _sizeCurvesCriteriaDataTable);

				//Begin TT#1076 - JScott - Size Curves by Set
				//rowValues = new object[24];
				rowValues = new object[26];
				//End TT#1076 - JScott - Size Curves by Set
				count = 0;

				foreach (SizeCurveCriteriaProfile sccp in _sizeCurvesCriteriaList)
				{
					if (!sccp.CriteriaIsInherited)
					{
						updated = sccp.CriteriaChangeType != eChangeType.none;

                        rowValues[0] = sccp.CriteriaIsInherited;                //CriteriaIsInherited
                        rowValues[1] = sccp.CriteriaInheritedFromNodeRID;       //CriteriaIsInheritedFromRID
                        rowValues[2] = updated;                                 //Updated
                        rowValues[3] = sccp.Key;                                //CriteriaRID
                        rowValues[4] = sccp.CriteriaSequence;                   //Sequence
                        rowValues[5] = false;                                   //DefaultIsReadOnly
                        rowValues[6] = false;                                   //DefaultIsInherited
                        rowValues[7] = Include.NoRID;                           //DefaultIsInheritedFromRID
                        rowValues[8] = false;                                   //Default
                        rowValues[9] = sccp.CriteriaLevelType;                  //LevelType
                        rowValues[10] = sccp.CriteriaLevelRID;                  //LevelRID
                        rowValues[11] = sccp.CriteriaLevelSequence;             //LevelSeq
                        rowValues[12] = sccp.CriteriaLevelOffset;               //LevelOff
                        rowValues[13] = System.DBNull.Value;                    //Merchandise
                        rowValues[14] = sccp.CriteriaDateRID;                   //DateRangeRID
                        rowValues[15] = System.DBNull.Value;                    //Date Range
                        rowValues[16] = sccp.CriteriaApplyLostSalesInd;         //Lost Sales
                        rowValues[17] = sccp.CriteriaOLLRID;                    //OLLRID
                        rowValues[18] = sccp.CriteriaCustomOLLRID;              //CustomOLLRID
                        rowValues[19] = System.DBNull.Value;                    //Include/Exclude
                        rowValues[20] = System.DBNull.Value;                    //Override Model
                        rowValues[21] = sccp.CriteriaSizeGroupRID;              //SizeGroupRID
                        rowValues[22] = System.DBNull.Value;                    //Size Group
                        rowValues[23] = sccp.CriteriaCurveName;                 //Curve Name
                        //Begin TT#1076 - JScott - Size Curves by Set           
                        rowValues[24] = sccp.CriteriaSgRID;                     //SGRID
                        rowValues[25] = System.DBNull.Value;                    //Attribute
						//End TT#1076 - JScott - Size Curves by Set



						_sizeCurvesCriteriaDataTable.Rows.Add(rowValues);

						++count;
					}
				}

				this.ugSizeCurvesCriteria.DataSource = _sizeCurvesCriteriaDataTable;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SelectDefaultCriteria()
		{
			bool defaultFound;

			try
			{
				if (_sizeCurveDefaultCriteriaProfile.DefaultRID != Include.NoRID)
				{
					defaultFound = false;

					ugSizeCurvesInheritedCriteria.BeginUpdate();
					ugSizeCurvesInheritedCriteria.SuspendRowSynchronization();

					foreach (UltraGridRow row in ugSizeCurvesInheritedCriteria.Rows)
					{
						if (Convert.ToInt32(row.Cells["CriteriaRID"].Value) == _sizeCurveDefaultCriteriaProfile.DefaultRID)
						{
							row.Cells["Default"].Value = true;
							row.Cells["DefaultIsInherited"].Value = _sizeCurveDefaultCriteriaProfile.DefaultRIDIsInherited;
							row.Cells["DefaultIsInheritedFromRID"].Value = _sizeCurveDefaultCriteriaProfile.DefaultRIDIsInheritedFromRID;
							defaultFound = true;
							break;
						}
					}

					ugSizeCurvesInheritedCriteria.ResumeRowSynchronization();
					ugSizeCurvesInheritedCriteria.EndUpdate();

					if (!defaultFound)
					{
						ugSizeCurvesCriteria.BeginUpdate();
						ugSizeCurvesCriteria.SuspendRowSynchronization();

						foreach (UltraGridRow row in ugSizeCurvesCriteria.Rows)
						{
							if (Convert.ToInt32(row.Cells["CriteriaRID"].Value) == _sizeCurveDefaultCriteriaProfile.DefaultRID)
							{
								row.Cells["Default"].Value = true;
								row.Cells["DefaultIsInherited"].Value = _sizeCurveDefaultCriteriaProfile.DefaultRIDIsInherited;
								row.Cells["DefaultIsInheritedFromRID"].Value = _sizeCurveDefaultCriteriaProfile.DefaultRIDIsInheritedFromRID;
								break;
							}
						}

						ugSizeCurvesCriteria.ResumeRowSynchronization();
						ugSizeCurvesCriteria.EndUpdate();
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildSizeCurveCriteriaInheritedMerchandiseList(UltraGrid aGrid, UltraGridRow aRow)
		{
			ArrayList levelList;
			int i;
			ValueList valueList;
			MerchandiseLevelValueItem valueItem;

			try
			{
				aGrid.BeginUpdate();
				aGrid.SuspendRowSynchronization();

				if (_inheritedLevelListHash == null)
				{
					_inheritedLevelListHash = new Hashtable();
				}

				levelList = BuildSizeCurveCriteriaLevelList(Convert.ToInt32(aRow.Cells["CriteriaIsInheritedFromRID"].Value));
				_inheritedLevelListHash[Convert.ToInt32(aRow.Cells["CriteriaRID"].Value)] = levelList;

				// Setup Merchandise ValueLists

				if (aRow.Cells["Merchandise"].ValueList == null)
				{
					valueList = new Infragistics.Win.ValueList();
					aRow.Cells["Merchandise"].ValueList = valueList;
				}
				else
				{
					valueList = (Infragistics.Win.ValueList)aRow.Cells["Merchandise"].ValueList;
					valueList.ValueListItems.Clear();
				}

				for (i = 0; i < levelList.Count; i++)
				{
					valueItem = (MerchandiseLevelValueItem)levelList[i];
					valueList.ValueListItems.Add(i, valueItem.LevelName);
				}

				aGrid.ResumeRowSynchronization();
				aGrid.EndUpdate();
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildSizeCurveCriteriaMerchandiseList(UltraGrid aGrid)
		{
			int i;
			ValueList valueList;
			MerchandiseLevelValueItem valueItem;

			try
			{
				aGrid.BeginUpdate();
				aGrid.SuspendRowSynchronization();

				_sizeCurveCriteriaLevelList = BuildSizeCurveCriteriaLevelList(this.NodeRID);

				// Setup Merchandise ValueLists

				if (aGrid.DisplayLayout.Bands[0].Columns["Merchandise"].ValueList == null)
				{
					valueList = new Infragistics.Win.ValueList();
					aGrid.DisplayLayout.Bands[0].Columns["Merchandise"].ValueList = valueList;
				}
				else
				{
					valueList = (Infragistics.Win.ValueList)aGrid.DisplayLayout.Bands[0].Columns["Merchandise"].ValueList;
					valueList.ValueListItems.Clear();
				}

				for (i = 0; i < _sizeCurveCriteriaLevelList.Count; i++)
				{
					valueItem = (MerchandiseLevelValueItem)_sizeCurveCriteriaLevelList[i];
					valueList.ValueListItems.Add(i, valueItem.LevelName);
				}

				aGrid.ResumeRowSynchronization();
				aGrid.EndUpdate();
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private ArrayList BuildSizeCurveCriteriaLevelList(int aStartNode)
		{
            HierarchyProfile localHome;                 //  TT#1572 - GRT - Urban Alternate
			HierarchyNodeProfile nodeProf;
			HierarchyProfile hierProf;
			ArrayList levelList;
			int startLevel;
			int i;
			int highestGuestLevel;
			int longestBranchCount;
			int offset;

			try
			{
				nodeProf = _SAB.HierarchyServerSession.GetNodeData(aStartNode);

                //  BEGIN TT#1572 - GRT - Urban Alternate
                localHome = _hpHome;
                //  END TT#1572 - GRT - Urban Alternate

				// Load Level arrays

				levelList = new ArrayList();
				levelList.Add(new MerchandiseLevelValueItem(Include.NoRID, Include.Undefined, " "));

				if (nodeProf.HomeHierarchyType == eHierarchyType.organizational)
				{
                    //  
                    //  BEGIN TT#1572 - GRT - Urban Alternate
                    //
                    if (nodeProf.HomeHierarchyLevel == 0)
                    {
                        levelList.Add(new MerchandiseLevelValueItem(localHome.Key, 0, localHome.HierarchyID));
                        startLevel = 1;
                    }
                    else
                    {
                        levelList.Add(new MerchandiseLevelValueItem(localHome.Key, ((HierarchyLevelProfile)localHome.HierarchyLevels[nodeProf.HomeHierarchyLevel]).Key, ((HierarchyLevelProfile)localHome.HierarchyLevels[nodeProf.HomeHierarchyLevel]).LevelID));
                        startLevel = nodeProf.HomeHierarchyLevel + 1;
                    }

                    for (i = startLevel; i <= localHome.HierarchyLevels.Count; i++)
                    {
                        //Begin TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
                        if (((HierarchyLevelProfile)localHome.HierarchyLevels[i]).LevelType != eHierarchyLevelType.Size)
                        {
                            //End TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise. 
                            levelList.Add(new MerchandiseLevelValueItem(localHome.Key, ((HierarchyLevelProfile)localHome.HierarchyLevels[i]).Key, ((HierarchyLevelProfile)localHome.HierarchyLevels[i]).LevelID));
                            //Begin TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
                        }
                        //End TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
                    }
                    //  
                    //  END TT#1572 - GRT - Urban Alternate
                    //
                }
				else
				{
					//Begin TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.
					//levelList.Add(new MerchandiseLevelValueItem(0, nodeProf.Text));
					hierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
					levelList.Add(new MerchandiseLevelValueItem(_hp.Key, nodeProf.Text, 0));
					//End TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.

					highestGuestLevel = _SAB.HierarchyServerSession.GetHighestGuestLevel(nodeProf.Key);

					// add guest levels to comboBox
					if (highestGuestLevel != int.MaxValue)
					{
						for (i = highestGuestLevel; i <= hierProf.HierarchyLevels.Count; i++)
						{
							if (i == 0)
							{
								//Begin TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
								//levelList.Add(new MerchandiseLevelValueItem(hierProf.Key, 0, "Root"));
                                levelList.Add(new MerchandiseLevelValueItem(hierProf.Key, 0, localHome.HierarchyID));
								//End TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
							}
							else
							{
								//Begin TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
								if (((HierarchyLevelProfile)hierProf.HierarchyLevels[i]).LevelType != eHierarchyLevelType.Size)
								{
								//End TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise. 
									levelList.Add(new MerchandiseLevelValueItem(hierProf.Key, ((HierarchyLevelProfile)hierProf.HierarchyLevels[i]).Key, ((HierarchyLevelProfile)hierProf.HierarchyLevels[i]).LevelID));
								//Begin TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
								}
								//Begin TT#426 - JScott - Node Properties  On the Size Curves Tab Should not be able to select Size Level at Node Property setting for Merchandise.
							}
						}
					}

					// add offsets to comboBox
					
                    //BEGIN TT#4689 - DOConnell - OTS Forecast - Multi-Level Low Levels not being populated correctly
                    //int longestBranchCount = _SAB.HierarchyServerSession.GetLongestBranch(nodeProf.Key);
                    DataTable hierarchyLevels = _SAB.HierarchyServerSession.GetHierarchyDescendantLevels(nodeProf.Key);
                    longestBranchCount = hierarchyLevels.Rows.Count - 1;
                    //END TT#4689 - DOConnell - OTS Forecast - Multi-Level Low Levels not being populated correctly
					offset = 0;

					for (i = 0; i < longestBranchCount; i++)
					{
						++offset;
						//Begin TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.
						//levelList.Add(new MerchandiseLevelValueItem(offset, "+" + offset.ToString()));
						levelList.Add(new MerchandiseLevelValueItem(_hp.Key, "+" + offset.ToString(), offset));
						//End TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.
					}
				}

				return levelList;
			}
			catch (Exception exc)
			{
				string message = exc.ToString();
				throw;
			}
		}

		private void BuildSizeCurveCriteriaSizeGroupList(UltraGrid aGrid)
		{
			int i;
			ValueList valueList;
			SizeGroupProfile valueItem;

			try
			{
				aGrid.BeginUpdate();
				aGrid.SuspendRowSynchronization();

				_sizeCurveCriteriaGroupList = new SizeGroupList(eProfileType.SizeGroup);

				_sizeCurveCriteriaGroupList.LoadAll(false);

				// Setup Size Group ValueLists

				if (aGrid.DisplayLayout.Bands[0].Columns["Size Group"].ValueList == null)
				{
					valueList = new Infragistics.Win.ValueList();
				}
				else
				{
					valueList = (Infragistics.Win.ValueList)aGrid.DisplayLayout.Bands[0].Columns["Size Group"].ValueList;
					valueList.ValueListItems.Clear();
				}

				valueList.ValueListItems.Add(Include.NoRID, " ");

				for (i = 0; i < _sizeCurveCriteriaGroupList.Count; i++)
				{
					valueItem = (SizeGroupProfile)_sizeCurveCriteriaGroupList[i];
					valueList.ValueListItems.Add(valueItem.Key, valueItem.SizeGroupName);
				}

				aGrid.DisplayLayout.Bands[0].Columns["Size Group"].ValueList = valueList;

				aGrid.ResumeRowSynchronization();
				aGrid.EndUpdate();
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildSizeCurveCriteriaOverrideLowLeveList(UltraGrid aGrid, UltraGridRow aRow)
		{
			ValueList valueList;
			ArrayList overrideList;
			string listName;

			try
			{
				if (aRow.Cells["OLLRID"].Value != DBNull.Value && aRow.Cells["CustomOLLRID"].Value != DBNull.Value)
				{
					listName = "OverrideList" + Convert.ToInt32(aRow.Cells["CriteriaRID"].Value) + Convert.ToInt32(aRow.Cells["Sequence"].Value);

					if (!aGrid.DisplayLayout.ValueLists.Exists(listName))
					{
						valueList = aGrid.DisplayLayout.ValueLists.Add(listName);
					}
					else
					{
						valueList = aGrid.DisplayLayout.ValueLists[listName];
						valueList.ValueListItems.Clear();
					}

					valueList.ValueListItems.Add(Include.NoRID, " ");

					overrideList = BuildOverrideModelList(Convert.ToInt32(aRow.Cells["OLLRID"].Value), Convert.ToInt32(aRow.Cells["CustomOLLRID"].Value));

					foreach (ComboObject comboObj in overrideList)
					{
						valueList.ValueListItems.Add(comboObj.Key, comboObj.Value);
					}

					aRow.Cells["Override Model"].ValueList = valueList;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//Begin TT#1076 - JScott - Size Curves by Set
		private void BuildSizeCurveCriteriaStoreGroupList(UltraGrid aGrid)
		{
			int i;
			ValueList valueList;
			StoreGroupListViewProfile valueItem;

			try
			{
				aGrid.BeginUpdate();
				aGrid.SuspendRowSynchronization();

				// Setup Store Group ValueLists

				if (aGrid.DisplayLayout.Bands[0].Columns["Attribute"].ValueList == null)
				{
					valueList = new Infragistics.Win.ValueList();
				}
				else
				{
					valueList = (Infragistics.Win.ValueList)aGrid.DisplayLayout.Bands[0].Columns["Attribute"].ValueList;
					valueList.ValueListItems.Clear();
				}

				valueList.ValueListItems.Add(Include.NoRID, " ");

				for (i = 0; i < _sizeCurvesCriteriaStoreGroupList.Count; i++)
				{
					valueItem = (StoreGroupListViewProfile)_sizeCurvesCriteriaStoreGroupList[i];
					valueList.ValueListItems.Add(valueItem.Key, valueItem.Name);
				}

				aGrid.DisplayLayout.Bands[0].Columns["Attribute"].ValueList = valueList;

				aGrid.ResumeRowSynchronization();
				aGrid.EndUpdate();
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//End TT#1076 - JScott - Size Curves by Set
		private void ugSizeCurvesCriteria_InitializeRow(object sender, Infragistics.Win.UltraWinGrid.InitializeRowEventArgs e)
		{
			try
			{
				SizeCurveCriteria_CommonRowInitialization(sender, e, _sizeCurveCriteriaLevelList);
			}
			catch (Exception ex)
			{
				HandleException(ex, "grdMerchBasis_InitializeRow");
			}
		}

		private void ugSizeCurvesInheritedCriteria_InitializeRow(object sender, Infragistics.Win.UltraWinGrid.InitializeRowEventArgs e)
		{
			try
			{
				if (!e.ReInitialize || e.Row.Cells["Merchandise"].ValueList == null)
				{
					BuildSizeCurveCriteriaInheritedMerchandiseList(ugSizeCurvesInheritedCriteria, e.Row);
				}

				SizeCurveCriteria_CommonRowInitialization(sender, e, (ArrayList)_inheritedLevelListHash[Convert.ToInt32(e.Row.Cells["CriteriaRID"].Value)]);
			}
			catch (Exception ex)
			{
				HandleException(ex, "grdMerchBasis_InitializeRow");
			}
		}

		private void ugSizeCurvesInheritedCriteria_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (e.Cell.Column.Key == "Default" && !_updatingDefaultInd)
				{
					ugSizeCurvesInheritedCriteria.PerformAction(UltraGridAction.ExitEditMode);
				}
			}
			catch (Exception ex)
			{
				HandleException(ex, "grdMerchBasis_InitializeRow");
			}
		}

		private void ugSizeCurvesCriteria_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (e.Cell.Column.Key == "Default" && !_updatingDefaultInd)
				{
					ugSizeCurvesCriteria.PerformAction(UltraGridAction.ExitEditMode);
				}
			}
			catch (Exception ex)
			{
				HandleException(ex, "grdMerchBasis_InitializeRow");
			}
		}

		private void SizeCurveCriteria_CommonRowInitialization(object sender, Infragistics.Win.UltraWinGrid.InitializeRowEventArgs e, ArrayList aLevelList)
		{
			DateRangeProfile dr;
			int i;
			MerchandiseLevelValueItem valueItem;
			string inheritMsg;

			try
			{
				if (!e.ReInitialize || e.Row.Cells["Override Model"].ValueList == null)
				{
					BuildSizeCurveCriteriaOverrideLowLeveList((UltraGrid)sender, e.Row);
				}

				if (!e.ReInitialize)
				{
					if (Convert.ToBoolean(e.Row.Cells["DefaultIsReadOnly"].Value))
					{
						e.Row.Cells["Default"].Activation = Activation.Disabled;
					}

					e.Row.Cells["Include/Exclude"].Value = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_OverrideLowVersion);

					if (e.Row.Cells["LevelSeq"].Value == System.DBNull.Value &&
						e.Row.Cells["LevelOff"].Value == System.DBNull.Value)
					{
						e.Row.Cells["Merchandise"].Value = System.DBNull.Value;
					}
					else
					{
						for (i = 0; i < aLevelList.Count; i++)
						{
							valueItem = (MerchandiseLevelValueItem)aLevelList[i];

							if ((e.Row.Cells["LevelType"].Value == System.DBNull.Value ||
								(eLowLevelsType)Convert.ToInt32(e.Row.Cells["LevelType"].Value) == eLowLevelsType.None) &&
								(valueItem.LevelType == eLowLevelsType.HierarchyLevel &&
								valueItem.HierarchyRID == Convert.ToInt32(e.Row.Cells["LevelRID"].Value) &&
								valueItem.LevelRID == Convert.ToInt32(e.Row.Cells["LevelSeq"].Value)) ||

								(e.Row.Cells["LevelType"].Value != System.DBNull.Value &&
								valueItem.LevelType == (eLowLevelsType)Convert.ToInt32(e.Row.Cells["LevelType"].Value) &&
								((valueItem.LevelType == eLowLevelsType.HierarchyLevel &&
								valueItem.HierarchyRID == Convert.ToInt32(e.Row.Cells["LevelRID"].Value) &&
								valueItem.LevelRID == Convert.ToInt32(e.Row.Cells["LevelSeq"].Value)) ||
								(valueItem.LevelType == eLowLevelsType.LevelOffset &&
								valueItem.Offset == Convert.ToInt32(e.Row.Cells["LevelOff"].Value)))))
							{
								e.Row.Cells["Merchandise"].Value = i;
								break;
							}
						}

						if (i == aLevelList.Count)
						{
							e.Row.Cells["Merchandise"].Value = System.DBNull.Value;
						}
					}

					if (e.Row.Cells["DateRangeRID"].Value.ToString() != "")
					{
						dr = SAB.ClientServerSession.Calendar.GetDateRange(Convert.ToInt32(e.Row.Cells["DateRangeRID"].Value, CultureInfo.CurrentUICulture));

						e.Row.Cells["Date Range"].Value = dr.DisplayDate;

						if (dr.DateRangeType == eCalendarRangeType.Dynamic)
						{
							switch (dr.RelativeTo)
							{
								case eDateRangeRelativeTo.Current:
									e.Row.Cells["Date Range"].Appearance.Image = this.DynamicToCurrentImage;
									break;
								case eDateRangeRelativeTo.Plan:
									e.Row.Cells["Date Range"].Appearance.Image = this.DynamicToPlanImage;
									break;
								default:
									e.Row.Cells["Date Range"].Appearance.Image = null;
									break;
							}
						}
					}

					e.Row.Cells["Override Model"].Value = e.Row.Cells["OLLRID"].Value;

					e.Row.Cells["Size Group"].Value = e.Row.Cells["SizeGroupRID"].Value;
					//Begin TT#1076 - JScott - Size Curves by Set

					e.Row.Cells["Attribute"].Value = e.Row.Cells["SGRID"].Value;
					//End TT#1076 - JScott - Size Curves by Set
				}

				if (e.Row.Cells["CriteriaIsInherited"].Value != DBNull.Value)
				{
					if (Convert.ToBoolean(e.Row.Cells["CriteriaIsInherited"].Value))
					{
						inheritMsg = _txtInheritedFrom + _SAB.HierarchyServerSession.GetNodeData(Convert.ToInt32(e.Row.Cells["CriteriaIsInheritedFromRID"].Value), false).Text;
						e.Row.Cells["Merchandise"].Appearance.Image = InheritanceImage;
						e.Row.Cells["Merchandise"].Tag = inheritMsg;
					}
					else
					{
						e.Row.Cells["Merchandise"].Appearance.Image = null;
						e.Row.Cells["Merchandise"].Tag = null;
					}
				}


				if (e.Row.Cells["DefaultIsInherited"].Value != DBNull.Value)
				{
					if (Convert.ToBoolean(e.Row.Cells["DefaultIsInherited"].Value))
					{
						inheritMsg = _txtInheritedFrom + _SAB.HierarchyServerSession.GetNodeData(Convert.ToInt32(e.Row.Cells["DefaultIsInheritedFromRID"].Value), false).Text;
						e.Row.Cells["Default"].Appearance.Image = InheritanceImage;
						e.Row.Cells["Default"].Tag = inheritMsg;
					}
					else
					{
						e.Row.Cells["Default"].Appearance.Image = null;
						e.Row.Cells["Default"].Tag = null;
					}
				}
			}
			catch (Exception ex)
			{
				HandleException(ex, "grdMerchBasis_InitializeRow");
			}
		}

		private void ugSizeCurvesInheritedCriteria_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_sizeCurvesInheritedCriteriaIsPopulated)
				{
					switch (e.Cell.Column.Key)
					{
						case "Default":

							if (Convert.ToBoolean(e.Cell.Value))
							{
								if (!_updatingDefaultInd)
								{
									_updatingDefaultInd = true;

									try
									{
										foreach (UltraGridRow row in ugSizeCurvesInheritedCriteria.Rows)
										{
											if (Convert.ToInt32(row.Cells["CriteriaRID"].Value) != Convert.ToInt32(e.Cell.Row.Cells["CriteriaRID"].Value))
											{
												row.Cells["DefaultIsInherited"].Value = false;
												row.Cells["DefaultIsInheritedFromRID"].Value = Include.NoRID;
												row.Cells["Default"].Value = false;
												row.Cells["Default"].Appearance.Image = null;
												row.Cells["Default"].Tag = null;
											}
										}

										foreach (UltraGridRow row in ugSizeCurvesCriteria.Rows)
										{
											row.Cells["Default"].Value = false;
										}
									}
									catch
									{
										throw;
									}
									finally
									{
										_updatingDefaultInd = false;
									}
								}
							}

							break;
					}

					e.Cell.Row.Cells["Updated"].Value = true;
					SizeCurvesCriteriaChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			MerchandiseLevelValueItem valItem;

			try
			{
				if (_sizeCurvesCriteriaIsPopulated)
				{
					switch (e.Cell.Column.Key)
					{
						case "Default":

							if (Convert.ToBoolean(e.Cell.Value))
							{
								if (!_updatingDefaultInd)
								{
									_updatingDefaultInd = true;

									try
									{
										foreach (UltraGridRow row in ugSizeCurvesInheritedCriteria.Rows)
										{
											row.Cells["DefaultIsInherited"].Value = false;
											row.Cells["DefaultIsInheritedFromRID"].Value = Include.NoRID;
											row.Cells["Default"].Value = false;
											row.Cells["Default"].Appearance.Image = null;
											row.Cells["Default"].Tag = null;
										}

										foreach (UltraGridRow row in ugSizeCurvesCriteria.Rows)
										{
											if (Convert.ToInt32(row.Cells["CriteriaRID"].Value) != Convert.ToInt32(e.Cell.Row.Cells["CriteriaRID"].Value))
											{
												row.Cells["Default"].Value = false;
											}
										}
									}
									catch
									{
										throw;
									}
									finally
									{
										_updatingDefaultInd = false;
									}
								}
							}

							break;

						case "Merchandise":

							if (e.Cell.Value == System.DBNull.Value)
							{
								e.Cell.Row.Cells["LevelType"].Value = eLowLevelsType.None;
								e.Cell.Row.Cells["LevelRID"].Value = Include.NoRID;
								e.Cell.Row.Cells["LevelSeq"].Value = Include.Undefined;
								e.Cell.Row.Cells["LevelOff"].Value = Include.Undefined;
							}
							else
							{
								valItem = (MerchandiseLevelValueItem)_sizeCurveCriteriaLevelList[Convert.ToInt32(e.Cell.Value)];
								e.Cell.Row.Cells["LevelType"].Value = valItem.LevelType;

								if (valItem.LevelType == eLowLevelsType.HierarchyLevel)
								{
									e.Cell.Row.Cells["LevelRID"].Value = valItem.HierarchyRID;
									e.Cell.Row.Cells["LevelSeq"].Value = valItem.LevelRID;
									e.Cell.Row.Cells["LevelOff"].Value = Include.Undefined;
								}
								else
								{
									//Begin TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.
									//e.Cell.Row.Cells["LevelRID"].Value = Include.NoRID;
									e.Cell.Row.Cells["LevelRID"].Value = valItem.HierarchyRID;
									//End TT#449 - JScott - In the Alternate Hierarchy Size Curve Alternate>Node Properties>Size Curve Tab filled in criteria and selected Apply.  Received an error message "40122 Field is required>"  It is already filled in.
									e.Cell.Row.Cells["LevelSeq"].Value = Include.Undefined;
									e.Cell.Row.Cells["LevelOff"].Value = valItem.Offset;
								}
							}

							break;

						//Begin TT#420 - JScott - SIZE CURVE -> node properties-> customer override cannot be removed
						//case "OverrideList":
						case "Override Model":
						//End TT#420 - JScott - SIZE CURVE -> node properties-> customer override cannot be removed

							e.Cell.Row.Cells["OLLRID"].Value = e.Cell.Value;
							break;

						case "Size Group":

							e.Cell.Row.Cells["SizeGroupRID"].Value = e.Cell.Value;
							break;
						//Begin TT#1076 - JScott - Size Curves by Set

						case "Attribute":

							e.Cell.Row.Cells["SGRID"].Value = e.Cell.Value;
							break;
						//End TT#1076 - JScott - Size Curves by Set
					}

					e.Cell.Row.Cells["Updated"].Value = true;
					SizeCurvesCriteriaChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_AfterCellListCloseUp(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
		}

		private void ugSizeCurvesCriteria_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			CalendarDateSelector frmCalDtSelector;
			int untilRID;
			HierarchyNodeProfile hierNodeProf;
			HierarchyProfile hierProf;
			HierarchyLevelProfile hlp;
			frmOverrideLowLevelModel frm;
			//Begin TT#632 - JScott - Finish Line - Test environment -> created size curve on node properties for the alternate +2- select override and get null ref exception error
			string lowLevelText;
			//End TT#632 - JScott - Finish Line - Test environment -> created size curve on node properties for the alternate +2- select override and get null ref exception error

			try
			{
				switch (e.Cell.Column.Key)
				{
					case "Date Range":

						if (_securitySizeCurves.AllowUpdate)
						{
							frmCalDtSelector = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[] { _SAB });

							if (e.Cell.Row.Cells["DateRangeRID"].Value != null &&
								e.Cell.Row.Cells["DateRangeRID"].Value != System.DBNull.Value &&
								Convert.ToInt32(e.Cell.Row.Cells["DateRangeRID"].Value, CultureInfo.CurrentUICulture) != Include.NoRID)
							{
								untilRID = Convert.ToInt32(e.Cell.Row.Cells["DateRangeRID"].Value, CultureInfo.CurrentUICulture);
								frmCalDtSelector.DateRangeRID = untilRID;
							}

							frmCalDtSelector.RestrictToSingleDate = false;
							frmCalDtSelector.AllowDynamicToCurrent = false;
							frmCalDtSelector.AllowDynamicToPlan = false;
							frmCalDtSelector.AllowDynamicToStoreOpen = false;
							//Begin TT #414 - JScott - Size Curve Node Properties - Date Range Calendar - Dynamic button is grayed out and cannot be selected
							//frmCalDtSelector.AllowDynamic = false;
							frmCalDtSelector.AllowDynamic = true;
							frmCalDtSelector.AllowDynamicToCurrent = true;
							frmCalDtSelector.AllowDynamicToPlan = false;
							frmCalDtSelector.AllowDynamicToStoreOpen = false;
							//End TT #414 - JScott - Size Curve Node Properties - Date Range Calendar - Dynamic button is grayed out and cannot be selected

							DialogResult DateRangeResult = frmCalDtSelector.ShowDialog();

							if (DateRangeResult == DialogResult.OK)
							{
								DateRangeProfile SelectedDateRange = (DateRangeProfile)frmCalDtSelector.Tag;
								e.Cell.Value = SelectedDateRange.DisplayDate;
								e.Cell.Row.Cells["DateRangeRID"].Value = SelectedDateRange.Key;
								e.Cell.Tag = null;
								e.Cell.Appearance.Image = null;

								e.Cell.Row.Cells["Updated"].Value = true;
								SizeCurvesCriteriaChangesMade = true;
							}

							frmCalDtSelector.Dispose();
						}
						break;

					case "Include/Exclude":

						Cursor.Current = Cursors.WaitCursor;

						try
						{
							hierNodeProf = SAB.HierarchyServerSession.GetNodeData(_nodeRID);
							hierProf = SAB.HierarchyServerSession.GetHierarchyData(hierNodeProf.HomeHierarchyRID);
							//Begin TT#632 - JScott - Finish Line - Test environment -> created size curve on node properties for the alternate +2- select override and get null ref exception error
							//hlp = (HierarchyLevelProfile)hierProf.HierarchyLevels[hierNodeProf.HomeHierarchyRID + 1];

							//object[] args = new object[] { SAB, Convert.ToInt32(e.Cell.Row.Cells["OLLRID"].Value), _nodeRID, Include.FV_ActualRID, hlp.LevelID, Convert.ToInt32(e.Cell.Row.Cells["CustomOLLRID"].Value), _securitySizeCurves };
							if (hierProf.HierarchyType == eHierarchyType.organizational)
							{
                                // Begin TT#2007 - JSmith - Node Properties-> Size Curve tab-> when adding a new level-> the low level does not change in the override low level button to match what was selected
                                //hlp = (HierarchyLevelProfile)hierProf.HierarchyLevels[hierNodeProf.HomeHierarchyLevel + 1];
                                //lowLevelText = hlp.LevelID;
                                if (e.Cell.Row.Cells["Merchandise"].Text == null ||
                                    e.Cell.Row.Cells["Merchandise"].Text.Trim().Length == 0)
                                {
                                    hlp = (HierarchyLevelProfile)hierProf.HierarchyLevels[hierNodeProf.HomeHierarchyLevel + 1];
                                    lowLevelText = hlp.LevelID;
                                }
                                else
                                {
                                    eLowLevelsType lowlevelType = (eLowLevelsType) e.Cell.Row.Cells["LevelType"].Value;
                                    if (lowlevelType == eLowLevelsType.HierarchyLevel)
                                    {
                                        int levelSeq = (int)e.Cell.Row.Cells["LevelSeq"].Value;
                                        if (levelSeq > 0)
                                        {
                                            hlp = (HierarchyLevelProfile)hierProf.HierarchyLevels[levelSeq];
                                            lowLevelText = hlp.LevelID;
                                        }
                                        else
                                        {
                                            lowLevelText = e.Cell.Row.Cells["Merchandise"].Text.Trim();
                                        }
                                    }
                                    else
                                    {
                                        //int levelSeq = hierNodeProf.HomeHierarchyLevel + (int)e.Cell.Row.Cells["LevelOff"].Value;
                                        //hlp = (HierarchyLevelProfile)hierProf.HierarchyLevels[levelSeq];
                                        //lowLevelText = hlp.LevelID;
                                        lowLevelText = e.Cell.Row.Cells["Merchandise"].Text.Trim();
                                    }
                                }
                                // End TT#2007
                            }
                            else
                            {
                                if (e.Cell.Row.Cells["Merchandise"].Text != null)
                                {
                                    eLowLevelsType lowlevelType = (eLowLevelsType)e.Cell.Row.Cells["LevelType"].Value;
                                    if (lowlevelType == eLowLevelsType.LevelOffset)
                                    {
                                        lowLevelText = e.Cell.Row.Cells["Merchandise"].Text.Trim();
                                    }
                                    else if (lowlevelType == eLowLevelsType.HierarchyLevel)
                                    {
                                        HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                                        int levelSeq = (int)e.Cell.Row.Cells["LevelSeq"].Value;
                                        if (levelSeq > 0)
                                        {
                                            hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[levelSeq];
                                            lowLevelText = hlp.LevelID;
                                        }
                                        else
                                        {
                                            lowLevelText = e.Cell.Row.Cells["Merchandise"].Text.Trim();
                                        }
                                    }
                                    else
                                    {
                                        lowLevelText = "+1";
                                    }
                                }
                                else
                                {
                                    lowLevelText = "+1";
                                }
                            }

							object[] args = new object[] { SAB, Convert.ToInt32(e.Cell.Row.Cells["OLLRID"].Value), _nodeRID, Include.FV_ActualRID, lowLevelText, Convert.ToInt32(e.Cell.Row.Cells["CustomOLLRID"].Value), _securitySizeCurves };
							//End TT#632 - JScott - Finish Line - Test environment -> created size curve on node properties for the alternate +2- select override and get null ref exception error
							frm = (frmOverrideLowLevelModel)GetForm(typeof(frmOverrideLowLevelModel), args, false);

							frm.MdiParent = this.MdiParent;
							frm.Anchor = AnchorStyles.Left | AnchorStyles.Top;
							frm.OnOverrideLowLevelCloseHandler += new frmOverrideLowLevelModel.OverrideLowLevelCloseEventHandler(OnOverrideLowLevelCloseHandler);
							frm.Tag = e.Cell.Row;
							frm.Show();
							frm.BringToFront();
						}
						catch
						{
							throw;
						}
						finally
						{
							Cursor.Current = Cursors.Default;
						}

						break;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void OnOverrideLowLevelCloseHandler(object source, OverrideLowLevelCloseEventArgs e)
		{
			UltraGridRow row;
			bool changed;

			try
			{
				if (FormLoaded)
				{
					changed = false;
					row = (UltraGridRow)((frmOverrideLowLevelModel)source).Tag;

					if (Convert.ToInt32(row.Cells["OLLRID"].Value) != e.aOllRid)
					{
						row.Cells["OLLRID"].Value = e.aOllRid;

						changed = true;
					}

					if (Convert.ToInt32(row.Cells["CustomOLLRID"].Value) != e.aCustomOllRid)
					{
						row.Cells["CustomOLLRID"].Value = e.aCustomOllRid;

						changed = true;
					}

					if (changed)
					{
						row.Cells["Updated"].Value = true;
						SizeCurvesCriteriaChangesMade = true;
						ChangePending = true;

						foreach (UltraGridRow gridRow in ugSizeCurvesCriteria.Rows)
						{
							BuildSizeCurveCriteriaOverrideLowLeveList(ugSizeCurvesCriteria, gridRow);
						}
					}
				}
			}
			catch (Exception ex)
			{
				string message = ex.ToString();
				throw;
			}
		}

		private void ugSizeCurvesCriteria_BeforeRowInsert(object sender, BeforeRowInsertEventArgs e)
		{
			try
			{
				if (_sizeCurvesCriteriaIsPopulated)
				{
					InsertSizeCurvesCriteriaRow();
					e.Cancel = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_AfterRowInsert(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				if (_sizeCurvesCriteriaIsPopulated)
				{
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_AfterRowsDeleted(object sender, System.EventArgs e)
		{
			try
			{
				if (_sizeCurvesCriteriaIsPopulated)
				{
					SizeCurvesCriteriaChangesMade = true;
					ugSizeCurvesCriteria.UpdateData();
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesInheritedCriteria_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugSizeCurvesInheritedCriteria.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if (mouseUIElement == null) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if (null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugSizeCurvesInheritedCriteria.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if (headerUIElement.GetType() == typeof(HeaderUIElement))
						{
							headerUI = (HeaderUIElement)headerUIElement;
							Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
							_gridCol = null;
							colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
							_gridCol = colHeader.Column;
							if (_gridCol == null)
								return;

							_gridBand = colHeader.Band;

							this.mnuGridColHeader.Show(this.ugSizeCurvesInheritedCriteria, point);

						}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugSizeCurvesCriteria.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if (mouseUIElement == null) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if (null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugSizeCurvesCriteria.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if (headerUIElement.GetType() == typeof(HeaderUIElement))
						{
							headerUI = (HeaderUIElement)headerUIElement;
							Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
							_gridCol = null;
							colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
							_gridCol = colHeader.Column;
							if (_gridCol == null)
								return;

							_gridBand = colHeader.Band;

							this.mnuGridColHeader.Show(this.ugSizeCurvesCriteria, point);

						}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesInheritedCriteria_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugSizeCurvesInheritedCriteria, e);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugSizeCurvesCriteria, e);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesInheritedCriteria_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				if (DoValueByValueEdits)
				{
					if (this.ugSizeCurvesInheritedCriteria.ActiveCell != null)
					{
						switch (this.ugSizeCurvesInheritedCriteria.ActiveCell.Column.Key)
						{
							case "Default":
								if (!Convert.ToBoolean(ugSizeCurvesInheritedCriteria.ActiveCell.Value) &&
									Convert.ToBoolean(ugSizeCurvesInheritedCriteria.ActiveCell.Row.Cells["DefaultIsInherited"]))
								{
									MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_CannotUncheckInheritedDefault), this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
				//string errorMessage = null;

				//if (DoValueByValueEdits)
				//{
				//    if (this.ugSizeCurvesCriteria.ActiveCell != null)
				//    {
				//        switch (this.ugSizeCurvesCriteria.ActiveCell.Column.Key)
				//        {
				//            case "Curve Name":
				//                if (!CurveNameValid(ugSizeCurvesCriteria.ActiveCell, ref errorMessage))
				//                {
				//                    MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				//                    e.Cancel = true;
				//                }
				//                break;
				//        }
				//    }
				//}
				//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesCriteria_AfterRowUpdate(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Add("Sequence", false);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
		//private bool CurveNameValid(UltraGridCell gridCell, ref string errorMessage)
		//{
		//    bool errorFound = false;

		//    try
		//    {
		//        //TODO
		//        if (gridCell.Text.Length == 0)
		//        {
		//            errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
		//            errorFound = true;
		//        }
		//        else
		//        {
		//            foreach (UltraGridRow gridRow in this.ugSizeCurvesCriteria.Rows)
		//            {
		//                if (gridCell.Row != gridRow)
		//                {
		//                    if ((string)gridCell.Text == (string)gridRow.Cells["Curve Name"].Text)
		//                    {
		//                        errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_CurveNameNotUnique);
		//                        errorFound = true;
		//                        break;
		//                    }
		//                }
		//            }
		//        }

		//        if (errorFound)
		//        {
		//            gridCell.Appearance.Image = ErrorImage;
		//            gridCell.Tag = errorMessage;
		//        }
		//        else
		//        {
		//            gridCell.Appearance.Image = null;
		//            gridCell.Tag = null;
		//        }

		//        return !errorFound;
		//    }
		//    catch (Exception error)
		//    {
		//        string exceptionMessage = error.Message;
		//        errorMessage = error.Message;
		//        return true;
		//    }
		//}

		//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
		private bool ValidTabSizeCurveCriteria(ref EditMsgs em)
		{
			string errorMessage;
			//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
			Hashtable curveHash;
			IDictionaryEnumerator iEnum;
			CriteriaMerchandiseLevelHashEntry hashVal;
			DialogResult retCode;
			//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.

			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				errorMessage = null;
				//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.

				//foreach (UltraGridRow gridRow in ugStoreGrades.Rows)
				//{
				//    if (gridRow.Cells["Curve Name"].Text != string.Empty)
				//    {
				//        if (!CurveNameValid(gridRow.Cells["Curve Name"], ref errorMessage))
				//        {
				//            em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
				//        }
				//    }
				//}
				curveHash = new Hashtable();

				foreach (UltraGridRow gridRow in ugSizeCurvesCriteria.Rows)
				{
					AddCriteriaToHash(gridRow, curveHash, true);

					if (!ValidSizeCurveCriteriaMerchandise(gridRow.Cells["LevelRID"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
					}

					if (!ValidSizeCurveCriteriaDateRange(gridRow.Cells["DateRangeRID"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
					}
				}

				foreach (UltraGridRow gridRow in ugSizeCurvesInheritedCriteria.Rows)
				{
					AddCriteriaToHash(gridRow, curveHash, false);
				}

				if (!em.ErrorFound)
				{
					iEnum = curveHash.GetEnumerator();

					while (iEnum.MoveNext())
					{
						hashVal = (CriteriaMerchandiseLevelHashEntry)iEnum.Value;

						if (hashVal.Count > 1)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_CurveNameNotUnique);

							retCode = MessageBox.Show(errorMessage + " Do you want to continue?", "Size Curve Name Warning", MessageBoxButtons.YesNo, MessageBoxIcon.Warning);

							if (retCode == DialogResult.No)
							{
								em.AddMsg(eMIDMessageLevel.HandledEdit, errorMessage, this.ToString());
							}

							break;
						}
					}
				}

				//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch
			{
				throw;
			}
		}

		//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
		private void AddCriteriaToHash(UltraGridRow aGridRow, Hashtable aHashTable, bool aAddToHash)
		{
			CriteriaMerchandiseLevelHashEntry hashVal;
			CriteriaMerchandiseLevelHashEntry fndHashVal;

			try
			{
				hashVal = new CriteriaMerchandiseLevelHashEntry(
					(eLowLevelsType)Convert.ToInt32(aGridRow.Cells["LevelType"].Text),
					Convert.ToInt32(aGridRow.Cells["LevelRID"].Text),
					Convert.ToInt32(aGridRow.Cells["LevelSeq"].Text),
					Convert.ToInt32(aGridRow.Cells["LevelOff"].Text),
					aGridRow.Cells["Curve Name"].Text);

				fndHashVal = (CriteriaMerchandiseLevelHashEntry)aHashTable[hashVal];


				if (fndHashVal != null)
				{
					fndHashVal.Count++;
				}
				else
				{
					if (aAddToHash)
					{
						aHashTable[hashVal] = hashVal;
					}
				}
			}
			catch
			{
				throw;
			}
		}

		private bool ValidSizeCurveCriteriaMerchandise(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (Convert.ToInt32(gridCell.Value) == Include.NoRID)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
			}
			catch (Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Row.Cells["Merchandise"].Appearance.Image = ErrorImage;
				gridCell.Row.Cells["Merchandise"].Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Row.Cells["Merchandise"].Tag = null;
				return true;
			}
		}

		private bool ValidSizeCurveCriteriaDateRange(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (Convert.ToInt32(gridCell.Value) == Include.Undefined)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
			}
			catch (Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Row.Cells["Date Range"].Appearance.Image = ErrorImage;
				gridCell.Row.Cells["Date Range"].Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Row.Cells["Date Range"].Tag = null;
				return true;
			}
		}

		//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
		private void cbxSZCriteriaInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesCriteriaChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZCriteriaApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesCriteriaChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void InsertSizeCurvesCriteriaRow()
		{
			DataRow row;

			try
			{
				this.Cursor = Cursors.WaitCursor;

				if (_nextSizeCurveCriteriaSequence == -1)
				{
					_nextSizeCurveCriteriaSequence = 0;

					foreach (UltraGridRow gridRow in ugSizeCurvesCriteria.Rows)
					{
						_nextSizeCurveCriteriaSequence = Math.Max(_nextSizeCurveCriteriaSequence, Convert.ToInt32(gridRow.Cells["Sequence"].Value));
					}

					_nextSizeCurveCriteriaSequence++;
				}

				ugSizeCurvesCriteria.BeginUpdate();
				ugSizeCurvesCriteria.SuspendRowSynchronization();

				row = _sizeCurvesCriteriaDataTable.NewRow();

				row["CriteriaIsInherited"] = false;
				row["CriteriaIsInheritedFromRID"] = Include.NoRID;
				row["Updated"] = false;
				row["CriteriaRID"] = _nextSizeCurveCriteriaKey--;
				row["Sequence"] = _nextSizeCurveCriteriaSequence++;
				row["DefaultIsReadOnly"] = true;
				row["DefaultIsInherited"] = false;
				row["DefaultIsInheritedFromRID"] = Include.NoRID;
				row["Default"] = false;
				row["LevelType"] = eLowLevelsType.None;
				row["LevelRID"] = Include.NoRID;
				row["LevelSeq"] = Include.Undefined;
				row["LevelOff"] = Include.Undefined;
				row["DateRangeRID"] = Include.Undefined;
				row["Lost Sales"] = true;
				row["OLLRID"] = Include.NoRID;
				row["CustomOLLRID"] = Include.NoRID;
				row["SizeGroupRID"] = Include.NoRID;
				row["Curve Name"] = string.Empty;
				//Begin TT#1076 - JScott - Size Curves by Set
				row["SGRID"] = Include.NoRID;
				//End TT#1076 - JScott - Size Curves by Set

				ugSizeCurvesCriteria.ResumeRowSynchronization();
				ugSizeCurvesCriteria.EndUpdate();

				_sizeCurvesCriteriaDataTable.Rows.Add(row);

				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].SortedColumns.Add("Sequence", false);

				SizeCurvesCriteriaChangesMade = true;
			}
			catch
			{
				throw;
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		#endregion Size Curves Criteria Tab

		#region Size Curves Tolerance Tab

		private void SizeCurvesToleranceTab_Load()
		{
			try
			{
				_sizeCurvesToleranceIsPopulated = false;

				//Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				//SizeCurvesTolerance_Populate(false);
				SizeCurvesTolerance_Populate(true);
				//End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies

				_sizeCurvesToleranceIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesTolerance_Populate(bool aReplaceValues)
		{
			FunctionSecurityProfile securityProfile;
			int nodeRID;
			string inheritMsg;
			HierarchyNodeProfile inheritanceProfile;

            try
            {
                //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
                _loadingSizeCurvesToleranceTab = true;
                //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
                //Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
                if (!tabNodeProperties.Controls.Contains(this.tabSizeCurves))
                {
                    return;
                }

                //End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
                BuildSizeCurveToleranceMerchandiseList();

                inheritMsg = null;
                inheritanceProfile = null;

                if (_hnp.Key == Include.NoRID)
                {
                    nodeRID = _hnp.HomeHierarchyParentRID;
                }
                else
                {
                    nodeRID = _hnp.Key;
                }

                if (_sizeCurveToleranceProfile == null || aReplaceValues)
                {
                    _sizeCurveToleranceProfile = _SAB.HierarchyServerSession.GetSizeCurveToleranceProfile(nodeRID, false);
                }

                securityProfile = _securityNodeProperties;

                if (!_newNode)
                {
                    securityProfile = _securitySizeCurves;
                    SetControlReadOnly(this.tabSizeCurvesTolerance, !securityProfile.AllowUpdate);
                }


                if (_sizeCurveToleranceProfile.ToleranceMinAvg > Include.Undefined)
                {
                    this.txtSCTMinimumAvgPerSize.Text = _sizeCurveToleranceProfile.ToleranceMinAvg.ToString();

                    if (_sizeCurveToleranceProfile.ToleranceMinAvgIsInherited)
                    {
                        if (inheritanceProfile == null ||
                            inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceMinAvgInheritedFromNodeRID)
                        {
                            inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceMinAvgInheritedFromNodeRID);
                        }

                        inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                        InheritanceProvider.SetError(this.txtSCTMinimumAvgPerSize, inheritMsg);
                    }
                    else
                    {
                        InheritanceProvider.SetError(this.txtSCTMinimumAvgPerSize, string.Empty);
                    }
                }
                //Begin TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method
                else
                {
                    this.txtSCTMinimumAvgPerSize.Text = string.Empty;
                }
                //End TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method

                if (_sizeCurveToleranceProfile.ToleranceLevelType != eLowLevelsType.None)
                {
                    cboSCTHighestLevel.SelectedIndex = FindSizeCurveToleranceMerchandiseEntry(
                        _sizeCurveToleranceProfile.ToleranceLevelType,
                        _sizeCurveToleranceProfile.ToleranceLevelRID,
                        _sizeCurveToleranceProfile.ToleranceLevelSeq,
                        _sizeCurveToleranceProfile.ToleranceLevelOffset);

                    if (_sizeCurveToleranceProfile.ToleranceLevelIsInherited)
                    {
                        if (inheritanceProfile == null ||
                            inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceLevelInheritedFromNodeRID)
                        {
                            inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceLevelInheritedFromNodeRID);
                        }

                        inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                        InheritanceProvider.SetError(this.cboSCTHighestLevel, inheritMsg);
                    }
                    else
                    {
                        InheritanceProvider.SetError(this.cboSCTHighestLevel, string.Empty);
                    }
                }
                else
                {
                    cboSCTHighestLevel.SelectedIndex = -1;
                }

                if (_sizeCurveToleranceProfile.ToleranceSalesTolerance > Include.Undefined)
                {
                    this.txtSCTSalesTolerance.Text = _sizeCurveToleranceProfile.ToleranceSalesTolerance.ToString();

                    if (_sizeCurveToleranceProfile.ToleranceSalesToleranceIsInherited)
                    {
                        if (inheritanceProfile == null ||
                            inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceSalesToleranceInheritedFromNodeRID)
                        {
                            inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceSalesToleranceInheritedFromNodeRID);
                        }

                        inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                        InheritanceProvider.SetError(this.txtSCTSalesTolerance, inheritMsg);
                    }
                    else
                    {
                        InheritanceProvider.SetError(this.txtSCTSalesTolerance, string.Empty);
                    }
                }
                //Begin TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method
                else
                {
                    this.txtSCTSalesTolerance.Text = string.Empty;
                }
                //End TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method

                if (_sizeCurveToleranceProfile.ToleranceIdxUnitsInd != eNodeChainSalesType.None)
                {
                    if (_sizeCurveToleranceProfile.ToleranceIdxUnitsInd == eNodeChainSalesType.IndexToAverage)
                    {
                        rdoSCTIndexToAverage.Checked = true;
                    }
                    else
                    {
                        rdoSCTUnits.Checked = true;
                    }

                    // chain sales tolerance fields must be paired so will be inherited from same location
                    //if (_sizeCurveToleranceProfile.ToleranceIdxUnitsIndIsInherited)
                    //{
                    //    if (inheritanceProfile == null ||
                    //        inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceIdxUnitsIndInheritedFromNodeRID)
                    //    {
                    //        inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceIdxUnitsIndInheritedFromNodeRID);
                    //    }

                    //    inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                    //    InheritanceProvider.SetError(this.gbxSCTIndexUnits, inheritMsg);
                    //}
                    //else
                    //{
                    //    InheritanceProvider.SetError(this.gbxSCTIndexUnits, string.Empty);
                    //}
                    InheritanceProvider.SetError(this.gbxSCTIndexUnits, string.Empty);
                }
                //Begin TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method
                else
                {
                    rdoSCTIndexToAverage.Checked = false;
                    rdoSCTUnits.Checked = false;
                }
                //End TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method

                if (_sizeCurveToleranceProfile.ToleranceMinTolerance > Include.Undefined)
                {
                    this.txtSCTMinimumPct.Text = _sizeCurveToleranceProfile.ToleranceMinTolerance.ToString();
                    //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
                    cbxApplyMinToZeroTolerance.Enabled = true;
                    cbxApplyMinToZeroTolerance.Checked = _sizeCurveToleranceProfile.ApplyMinToZeroTolerance;
                    //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
                    if (_sizeCurveToleranceProfile.ToleranceMinToleranceIsInherited)
                    {
                        if (inheritanceProfile == null ||
                            inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceMinToleranceInheritedFromNodeRID)
                        {
                            inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceMinToleranceInheritedFromNodeRID);
                        }

                        inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                        InheritanceProvider.SetError(this.txtSCTMinimumPct, inheritMsg);
                    }
                    else
                    {
                        InheritanceProvider.SetError(this.txtSCTMinimumPct, string.Empty);
                    }
                }
                //Begin TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method
                else
                {
                    this.txtSCTMinimumPct.Text = string.Empty;
                    //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
                    cbxApplyMinToZeroTolerance.Enabled = false;
                    //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
                }
                //End TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method

                if (_sizeCurveToleranceProfile.ToleranceMaxTolerance > Include.Undefined)
                {
                    this.txtSCTMaximumPct.Text = _sizeCurveToleranceProfile.ToleranceMaxTolerance.ToString();

                    if (_sizeCurveToleranceProfile.ToleranceMaxToleranceIsInherited)
                    {
                        if (inheritanceProfile == null ||
                            inheritanceProfile.Key != _sizeCurveToleranceProfile.ToleranceMaxToleranceInheritedFromNodeRID)
                        {
                            inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeCurveToleranceProfile.ToleranceMaxToleranceInheritedFromNodeRID);
                        }

                        inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                        InheritanceProvider.SetError(this.txtSCTMaximumPct, inheritMsg);
                    }
                    else
                    {
                        InheritanceProvider.SetError(this.txtSCTMaximumPct, string.Empty);
                    }
                }
                //Begin TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method
                else
                {
                    this.txtSCTMaximumPct.Text = string.Empty;
                }
                //End TT#424 - JScott - SIZE CURVE METHOD  tolerance tab  fields not holding delete after updating method

                _sizeCurvesToleranceIsPopulated = true;
                SizeCurvesMinAvgToleranceChangesMade = false;
                SizeCurvesHighLevelToleranceChangesMade = false;
                SizeCurvesSalesToleranceChangesMade = false;
                SizeCurvesIndexToleranceChangesMade = false;
                SizeCurvesMinPctToleranceChangesMade = false;
                SizeCurvesMaxPctToleranceChangesMade = false;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue 
            finally
            {
                _loadingSizeCurvesToleranceTab = false;
            }
            //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
		}

		private void BuildSizeCurveToleranceMerchandiseList()
		{
			DataTable dtLevels;
			int i;
			DataRow row;
			MerchandiseLevelValueItem valueItem;

			try
			{
				_sizeCurveToleranceLevelList = BuildSizeCurveToleranceLevelList(this.NodeRID);

				dtLevels = new DataTable();
				dtLevels.Columns.Add(new DataColumn("Value", typeof(int)));
				dtLevels.Columns.Add(new DataColumn("Text", typeof(string)));

				for (i = 0; i < _sizeCurveToleranceLevelList.Count; i++)
				{
					valueItem = (MerchandiseLevelValueItem)_sizeCurveToleranceLevelList[i];
					row = dtLevels.NewRow();
					row["Value"] = i;
					row["Text"] = valueItem.LevelName;
					dtLevels.Rows.Add(row);
				}

				dtLevels.AcceptChanges();
				cboSCTHighestLevel.DataSource = dtLevels;
				cboSCTHighestLevel.DisplayMember = "Text";
				cboSCTHighestLevel.ValueMember = "Value";
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private int FindSizeCurveToleranceMerchandiseEntry(eLowLevelsType aLowLevelType, int aHierRID, int aSequence, int aOffset)
		{
			int i;
			MerchandiseLevelValueItem valueItem;

			try
			{
				for (i = 0; i < _sizeCurveToleranceLevelList.Count; i++)
				{
					valueItem = (MerchandiseLevelValueItem)_sizeCurveToleranceLevelList[i];

					if (aLowLevelType == eLowLevelsType.None &&
						(valueItem.LevelType == eLowLevelsType.HierarchyLevel &&
						valueItem.HierarchyRID == aHierRID &&
						valueItem.LevelRID == aSequence) ||

						(valueItem.LevelType == aLowLevelType &&
						((valueItem.LevelType == eLowLevelsType.HierarchyLevel &&
						valueItem.HierarchyRID == aHierRID &&
						valueItem.LevelRID == aSequence) ||
						(valueItem.LevelType == eLowLevelsType.LevelOffset &&
						valueItem.Offset == aOffset))))
					{
						return i;
					}
				}

				return -1;
			}
			catch
			{
				throw;
			}
		}

		private ArrayList BuildSizeCurveToleranceLevelList(int aStartNode)
		{
			HierarchyNodeProfile nodeProf;
			NodeAncestorList hierNal;
			HierarchyProfile hierProf;
			ArrayList levelList;
			int i;
			SortedList ancestorList;
			NodeAncestorProfile ancProf;
			int orgHierRID;
			string levelName;
			//Begin TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection
			HierarchyLevelProfile hlp;
			//End TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection

			try
			{
				nodeProf = _SAB.HierarchyServerSession.GetNodeData(aStartNode);

				// Load Level arrays

				levelList = new ArrayList();
				//Begin TT#450 - JScott - SZ CURVE- node properties->tolerance->minimum average per size - store 1101 should get style curve, instead getting style/color chain curve - not correct
				//levelList.Add(new MerchandiseLevelValueItem(Include.NoRID, Include.Undefined, string.Empty));
				levelList.Add(new MerchandiseLevelValueItem(Include.NoRID, Include.Undefined, MIDText.GetTextOnly(eMIDTextCode.lbl_NoHigherLevel)));
				//End TT#450 - JScott - SZ CURVE- node properties->tolerance->minimum average per size - store 1101 should get style curve, instead getting style/color chain curve - not correct

				ancestorList = SAB.HierarchyServerSession.GetAllNodeAncestors(nodeProf.Key);

				if (nodeProf.HomeHierarchyType == eHierarchyType.organizational)
				{
					orgHierRID = nodeProf.HomeHierarchyRID;
				}
				else
				{
					orgHierRID = Include.NoRID;
				}

				//Begin TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection
				hlp = null;

				levelList.Add(new MerchandiseLevelValueItem(_hpHome.Key, 0, _hpHome.HierarchyID));

				for (i = 1; i <= _hpHome.HierarchyLevels.Count && (hlp == null || hlp.LevelType != eHierarchyLevelType.Style); i++)
				{
					hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[i];
					levelList.Add(new MerchandiseLevelValueItem(_hpHome.Key, ((HierarchyLevelProfile)_hpHome.HierarchyLevels[hlp.Key]).Key, ((HierarchyLevelProfile)_hpHome.HierarchyLevels[hlp.Key]).LevelID));
				}

				//End TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection
				foreach (DictionaryEntry dictEnt in ancestorList)
				{
					hierNal = (NodeAncestorList)dictEnt.Value;
					hierProf = SAB.HierarchyServerSession.GetHierarchyData((int)dictEnt.Key);

					for (i = hierNal.Count - 1; i >= 0; i--)
					{
						ancProf = (NodeAncestorProfile)hierNal[i];

						//Begin TT#427 - JScott - Size Curve Tab,>Tolerance Tab- Node-Properties -In the Highest Level drop down do not include Personal Hierarchies.
						if (ancProf.HomeHierarchyOwner == Include.GlobalUserRID)
						{
						//End TT#427 - JScott - Size Curve Tab,>Tolerance Tab- Node-Properties -In the Highest Level drop down do not include Personal Hierarchies.
							//Begin TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection
							//if (ancProf.HomeHierarchyRID == orgHierRID)
							//{
							//    if (ancProf.HomeHierarchyLevel == 0)
							//    {
							//        //Begin TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
							//        //levelName = "Root";
							//        levelName = _hpHome.HierarchyID;
							//        //End TT#415 -- SIZE CURVE -> node properties on the tolerance tab-> drop down for highet level has incorrect listing 
							//    }
							//    else
							//    {
							//        levelName = ((HierarchyLevelProfile)hierProf.HierarchyLevels[ancProf.HomeHierarchyLevel + 1]).LevelID;
							//    }

							//    if (ancProf.HomeHierarchyLevel == 0)
							//    {
							//        levelList.Add(new MerchandiseLevelValueItem(_hpHome.Key, 0, levelName));
							//    }
							//    else
							//    {
							//        levelList.Add(new MerchandiseLevelValueItem(_hpHome.Key, ((HierarchyLevelProfile)_hpHome.HierarchyLevels[ancProf.HomeHierarchyLevel]).Key, levelName));
							//    }
							//}
							//else
							if (ancProf.HomeHierarchyRID != orgHierRID)
							//End TT#435 - JScott - Size Curve - Node Properties - Tolerance tab - Highest Level drop down does not contain Style/SKU for selection
							{
								if (nodeProf.HomeHierarchyType == eHierarchyType.organizational ||
									(nodeProf.HomeHierarchyRID != ancProf.HomeHierarchyRID))
								{
									levelName = hierProf.HierarchyID + ": " + SAB.HierarchyServerSession.GetNodeData(ancProf.Key, false, true).Text;
								}
								else
								{
									levelName = "-" + Convert.ToString(nodeProf.HomeHierarchyLevel - ancProf.HomeHierarchyLevel);
								}

								levelList.Add(new MerchandiseLevelValueItem(ancProf.HomeHierarchyRID, levelName, ancProf.HomeHierarchyLevel));
							}
						//Begin TT#427 - JScott - Size Curve Tab,>Tolerance Tab- Node-Properties -In the Highest Level drop down do not include Personal Hierarchies.
						}
						//End TT#427 - JScott - Size Curve Tab,>Tolerance Tab- Node-Properties -In the Highest Level drop down do not include Personal Hierarchies.
					}
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties

				return levelList;
			}
			catch (Exception exc)
			{
				string message = exc.ToString();
				throw;
			}
		}

		private bool ValidTabSizeCurveTolerance(ref EditMsgs em)
		{
			if (FormIsClosing && !SaveOnClose)
			{
				return true;
			}

			bool validValues = true;
			if (!ValidTabSizeCurveTolerance(this.txtSCTMinimumAvgPerSize))
			{
				validValues = false;
			}
			if (!ValidTabSizeCurveTolerance(this.txtSCTSalesTolerance))
			{
				validValues = false;
			}
			if (!ValidTabSizeCurveTolerance(this.txtSCTMinimumPct))
			{
				validValues = false;
			}
			if (!ValidTabSizeCurveTolerance(this.txtSCTMaximumPct))
			{
				validValues = false;
			}

			return validValues;
		}

		private bool ValidTabSizeCurveTolerance(TextBox aToleranceField)
		{
			try
			{
				if (aToleranceField.Text.Length > 0)
				{
					try
					{
						double toleranceValue = Convert.ToDouble(aToleranceField.Text, CultureInfo.CurrentUICulture);
						if (toleranceValue < 0)
						{
							string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
							ErrorProvider.SetError(aToleranceField, error);
							return false;
						}
						else
						{
							ErrorProvider.SetError(aToleranceField, string.Empty);
							return true;
						}
					}
					catch
					{
						string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						ErrorProvider.SetError(aToleranceField, error);
						return false;
					}
				}
				else
				{
					return true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			return false;
		}

		private void txtSCTMinimumAvgPerSize_TextChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.txtSCTMinimumAvgPerSize, string.Empty);
					SizeCurvesMinAvgToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cboSCTHighestLevel_SelectionChangeCommitted(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.cboSCTHighestLevel, string.Empty);
					SizeCurvesHighLevelToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void txtSCTSalesTolerance_TextChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.txtSCTSalesTolerance, string.Empty);
					SizeCurvesSalesToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void rdoSCTIndexToAverage_CheckedChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.gbxSCTIndexUnits, string.Empty);
					SizeCurvesIndexToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void rdoSCTUnits_CheckedChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.gbxSCTIndexUnits, string.Empty);
					SizeCurvesIndexToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void txtSCTMinimumPct_TextChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.txtSCTMinimumPct, string.Empty);
					SizeCurvesMinPctToleranceChangesMade = true;
                    //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
                    cbxApplyMinToZeroTolerance.Enabled = true;
                    //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void txtSCTMaximumPct_TextChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeCurvesToleranceIsPopulated)
				{
					InheritanceProvider.SetError(this.txtSCTMaximumPct, string.Empty);
					SizeCurvesMaxPctToleranceChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZToleranceInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesMinAvgToleranceChangesMade = true;
					SizeCurvesHighLevelToleranceChangesMade = true;
					SizeCurvesSalesToleranceChangesMade = true;
					SizeCurvesIndexToleranceChangesMade = true;
					SizeCurvesMinPctToleranceChangesMade = true;
					SizeCurvesMaxPctToleranceChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZToleranceApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesMinAvgToleranceChangesMade = true;
					SizeCurvesHighLevelToleranceChangesMade = true;
					SizeCurvesSalesToleranceChangesMade = true;
					SizeCurvesIndexToleranceChangesMade = true;
					SizeCurvesMinPctToleranceChangesMade = true;
					SizeCurvesMaxPctToleranceChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		#endregion Size Curves Tolerance Tab

		#region Size Curves Similar Store Tab

		private void ugSizeCurvesSimilarStore_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_sizeCurvesSimilarStoreGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveSimilarStoreGrid);
					if (layout.LayoutLength > 0)
					{
						ugSizeCurvesSimilarStore.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultSizeCurvesSimilarStoreGridLayout();
					}
					SizeCurvesSimilarStoreGridLayout();
					_sizeCurvesSimilarStoreGridBuilt = true;
				}

				if (!_securitySizeCurves.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesSimilarStore.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugSizeCurvesSimilarStore.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		/// <summary>
		/// Contains changes to the grid layout to override saved layout
		/// </summary>

		private void SizeCurvesSimilarStoreGridLayout()
		{
			try
			{
				this.ugSizeCurvesSimilarStore.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugSizeCurvesSimilarStore.DisplayLayout.AddNewBox.Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.GroupByBox.Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["SimilarStoreRID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["SimilarStoreRID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store Changed"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Inherited"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Inherited RID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Sim Str Inherited"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store Inherited RID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Store"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Right;

				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Until"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);

				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Until"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);

			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void DefaultSizeCurvesSimilarStoreGridLayout()
		{
			try
			{
				this.ugSizeCurvesSimilarStore.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["SetID"].Width = 100;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Width = 100;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Until"].Width = 100;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Until RID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Used Store Selector"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Similar Store Changed"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Similar Store"].AutoEdit = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Until"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Sets"].Columns["Until"].AutoEdit = false;

				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["SetID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Store"].Width = 100;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Width = 100;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Until"].Width = 100;

				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Updated"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Store RID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Until RID"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Used Store Selector"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store Changed"].Hidden = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Similar Store"].AutoEdit = true;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Until"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;
				this.ugSizeCurvesSimilarStore.DisplayLayout.Bands["Stores"].Columns["Until"].AutoEdit = false;
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugSizeCurvesSimilarStore);
                //End TT#169

			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesSimilarStoreTab_Load()
		{
			try
			{
				SizeCurvesSimilarStore_Attributes_Populate();

				if (_hnp.Key == Include.NoRID)	// new node so get parent's elig
				{
					_sizeCurveSimilarStoreList = _SAB.HierarchyServerSession.GetSizeCurveSimilarStoreList(_storeList, _hnp.HomeHierarchyParentRID, true, false);
				}
				else
				{
					_sizeCurveSimilarStoreList = _SAB.HierarchyServerSession.GetSizeCurveSimilarStoreList(_storeList, _hnp.Key, true, false);
				}

				SizeCurvesSimilarStore_Populate(false);

				BuildSizeCurvesSimilarStoreContextmenu();
				this.ugSizeCurvesSimilarStore.ContextMenu = mnuSizeCurvesSimilarStoreGrid;

				ugSizeCurvesSimilarStore.ActiveRow = ugSizeCurvesSimilarStore.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);
				_sizeCurvesSimilarStoreIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildSizeCurvesSimilarStoreContextmenu()
		{
			try
			{
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSizeCurvesSimilarStoreGrid_Popup(object sender, System.EventArgs e)
		{
			try
			{
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Clear();
				MenuItem mnuItemApplyAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyAll));
				MenuItem mnuItemApplyColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ApplyColumn));
				MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
				MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
				MenuItem mnuItemClearAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearAll));
				MenuItem mnuItemClearColumn = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ClearColumn));

				if (this.ugSizeCurvesSimilarStore.ActiveRow == null ||
					this.ugSizeCurvesSimilarStore.ActiveRow.Band.Key != "Sets")
				{
					mnuItemApplyAll.Enabled = false;
					mnuItemApplyColumn.Enabled = false;
				}
				else
				{
					mnuItemApplyAll.Enabled = true;
					mnuItemApplyColumn.Enabled = true;
				}

				if (!_securitySizeCurves.AllowUpdate)
				{
					mnuItemApplyAll.Enabled = false;
					mnuItemApplyColumn.Enabled = false;
					mnuItemClearAll.Enabled = false;
					mnuItemClearColumn.Enabled = false;
				}

				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemApplyAll);
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemApplyColumn);
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemClearAll);
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemClearColumn);
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add("-");
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemExpandAll);
				mnuSizeCurvesSimilarStoreGrid.MenuItems.Add(mnuItemCollapseAll);
				mnuItemApplyAll.Click += new System.EventHandler(this.mnuSZItemApplyAll_Click);
				mnuItemApplyColumn.Click += new System.EventHandler(mnuSZItemApplyColumn_Click);
				mnuItemExpandAll.Click += new System.EventHandler(this.mnuSZItemExpandAll_Click);
				mnuItemCollapseAll.Click += new System.EventHandler(this.mnuSZItemCollapseAll_Click);
				mnuItemClearAll.Click += new System.EventHandler(this.mnuSZItemClearAll_Click);
				mnuItemClearColumn.Click += new System.EventHandler(this.mnuSZItemClearColumn_Click);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSZItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugSizeCurvesSimilarStore.Rows.ExpandAll(true);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSZItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugSizeCurvesSimilarStore.Rows.CollapseAll(true);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSZItemApplyAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				SZItemApply(true, true);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void mnuSZItemApplyColumn_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				bool updateSimilarStore = false;
				bool updateUntil = false;
				if (this.ugSizeCurvesSimilarStore.ActiveCell != null)
				{
					switch (this.ugSizeCurvesSimilarStore.ActiveCell.Column.Key)
					{
						case "Similar Store":
							updateSimilarStore = true;
							break;
						case "Until":
							updateUntil = true;
							break;
						default:
							string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
							text = text.Replace("{0}", this.ugSizeCurvesSimilarStore.ActiveCell.Column.Key);
							MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
							break;
					}
					SZItemApply(updateSimilarStore, updateUntil);
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void SZItemApply(bool updateSimilarStore, bool updateUntil)
		{
			string errorMessage = null;
			try
			{
				if (this.ugSizeCurvesSimilarStore.ActiveRow == null)
				{
					this.Cursor = Cursors.Default;
					MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					if (ugSizeCurvesSimilarStore.ActiveCell != null)
					{
						ugSizeCurvesSimilarStore.ActiveCell.Row.Update();
					}

					Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugSizeCurvesSimilarStore.ActiveRow.Band;
					Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugSizeCurvesSimilarStore.ActiveRow;

					Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
					if (activeRowBand.Key == "Sets")		// apply values to all stores in set
					{
						int setCalendarDateRangeRID = Convert.ToInt32(activeRow.Cells["Until RID"].Value, CultureInfo.CurrentCulture);
						ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
						foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
						{
							storeRow.Cells["Updated"].Value = true;
							if (updateSimilarStore)
							{
								storeRow.Cells["Used Store Selector"].Value = activeRow.Cells["Used Store Selector"].Value;
								if (storeRow.Cells["Similar Store"].Value != activeRow.Cells["Similar Store"].Value)
								{
									storeRow.Cells["Similar Store Changed"].Value = true;
								}
								storeRow.Cells["Similar Store"].Value = activeRow.Cells["Similar Store"].Value;
								storeRow.Cells["SimilarStoreRID"].Value = activeRow.Cells["SimilarStoreRID"].Value;
								storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								storeRow.Cells["Sim Str Inherited"].Value = false;
								storeRow.Cells["Similar Store Changed"].Value = true;
								storeRow.Cells["Similar Store"].Appearance.Image = null;
								storeRow.Cells["Similar Store"].Tag = null;
							}
							if (updateUntil)
							{
								if (storeRow.Cells["Until"].Value != activeRow.Cells["Until"].Value)
								{
									storeRow.Cells["Similar Store Changed"].Value = true;
								}
								if (setCalendarDateRangeRID == Include.UndefinedCalendarDateRange
									|| setCalendarDateRangeRID == Include.NoRID)
								{
									storeRow.Cells["Until RID"].Value = Include.NoRID;
								}
								else
								{
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(setCalendarDateRangeRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(setCalendarDateRangeRID);
									}
									storeRow.Cells["Until RID"].Value = drp.Key;
								}
								storeRow.Cells["Until"].Value = activeRow.Cells["Until"].Value;
								storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								storeRow.Cells["Sim Str Inherited"].Value = false;
								storeRow.Cells["Similar Store"].Appearance.Image = null;
								storeRow.Cells["Similar Store"].Tag = null;
							}
						}
						_sizeCurvesSimilarStoreDataSet.AcceptChanges();
						SizeCurvesSimilarStoreChangesMade = true;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mnuSZItemClearAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				SZItemClear(true, true);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void mnuSZItemClearColumn_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cursor = Cursors.WaitCursor;
				bool updateSimilarStore = false;
				bool updateUntil = false;
				if (this.ugSizeCurvesSimilarStore.ActiveCell != null)
				{
					switch (this.ugSizeCurvesSimilarStore.ActiveCell.Column.Key)
					{
						case "Similar Store":
							updateSimilarStore = true;
							updateUntil = true;
							break;
						case "Until":
							updateUntil = true;
							break;
						default:
							string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ColumnCanNotBeApplied);
							text = text.Replace("{0}", this.ugSizeCurvesSimilarStore.ActiveCell.Column.Key);
							MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
							break;
					}
					SZItemClear(updateSimilarStore, updateUntil);
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				Cursor = Cursors.Default;
			}
		}

		private void SZItemClear(bool updateSimilarStore, bool updateUntil)
		{
			try
			{
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugSizeCurvesSimilarStore.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugSizeCurvesSimilarStore.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				if (activeRowBand.Key == "Sets")		// apply values to all stores in set
				{
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
					{
						storeRow.Cells["Updated"].Value = true;
						if (updateSimilarStore)
						{
							storeRow.Cells["Used Store Selector"].Value = false;
							if (storeRow.Cells["Similar Store"].Text.Length != 0)
							{
								storeRow.Cells["Similar Store Changed"].Value = true;
							}
							storeRow.Cells["Similar Store"].Value = string.Empty;
							storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sim Str Inherited"].Value = false;
							storeRow.Cells["Similar Store Changed"].Value = true;
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
						if (updateUntil)
						{
							if (storeRow.Cells["Until"].Text.Length != 0)
							{
								storeRow.Cells["Similar Store Changed"].Value = true;
							}
							storeRow.Cells["Until RID"].Value = Include.NoRID;
							storeRow.Cells["Until"].Value = string.Empty;
							storeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
							storeRow.Cells["Sim Str Inherited"].Value = false;
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
						SizeCurvesSimilarStoreChangesMade = true;
					}

				}

				if (activeRowBand.Key == "Stores")		// clear store value
				{
					activeRow.Cells["Updated"].Value = true;
					SizeCurvesSimilarStoreChangesMade = true;
				}
				if (updateSimilarStore)
				{
					activeRow.Cells["Used Store Selector"].Value = false;
					if (activeRow.Cells["Similar Store"].Text.Length != 0)
					{
						activeRow.Cells["Similar Store Changed"].Value = true;
					}
					activeRow.Cells["Similar Store"].Value = string.Empty;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
					if (activeRowBand.Key == "Stores")		// clear store value
					{
						activeRow.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
						activeRow.Cells["Sim Str Inherited"].Value = false;
					}
					activeRow.Cells["SimilarStoreRID"].Value = Include.NoRID;
				}
				if (updateUntil)
				{
					if (activeRow.Cells["Until"].Text.Length != 0)
					{
						activeRow.Cells["Similar Store Changed"].Value = true;
					}
					activeRow.Cells["Until RID"].Value = Include.NoRID;
					activeRow.Cells["Until"].Value = string.Empty;
					activeRow.Cells["Similar Store"].Appearance.Image = null;
					activeRow.Cells["Similar Store"].Tag = null;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesSimilarStore_Define()
		{
			try
			{
				_sizeCurvesSimilarStoreDataSet = MIDEnvironment.CreateDataSet("SizeCurvesSimilarStoreDataSet");

				DataColumn dataColumn;

				DataTable setTable = _sizeCurvesSimilarStoreDataSet.Tables.Add("Sets");

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Used Store Selector";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Similar Store Changed";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "SimilarStoreRID";
				dataColumn.Caption = "SimilarStoreRID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Similar Store";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Until RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Until";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				//make set ID the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = setTable.Columns["SetID"];
				setTable.PrimaryKey = PrimaryKeyColumn;


				DataTable storeTable = _sizeCurvesSimilarStoreDataSet.Tables.Add("Stores");

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Inherited";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Inherited RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Updated";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Store RID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = true;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Store";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Sim Str Inherited";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Similar Store Inherited RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Used Store Selector";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Similar Store Changed";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "SimilarStoreRID";
				dataColumn.Caption = "SimilarStoreRID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Similar Store";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Until RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Until";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Similar_Store_Until);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				_sizeCurvesSimilarStoreDataSet.Relations.Add("Stores",
					_sizeCurvesSimilarStoreDataSet.Tables["Sets"].Columns["SetID"],
					_sizeCurvesSimilarStoreDataSet.Tables["Stores"].Columns["SetID"]);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}

		}

		private void SizeCurvesSimilarStore_Populate(bool doingCopy)
		{
			bool updated = false;
			bool similarStoreChanged = false;
			SizeCurveSimilarStoreProfile sccp;
			string simStore;
			string until;
			int simStoreUntilDateRangeRID;

			try
			{
				//Begin TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				if (!tabNodeProperties.Controls.Contains(this.tabSizeCurves))
				{
					return;
				}

				//End TT#428 - JScott - Size Curve - Node Properties - Do not allow Size curve Tab for Personal Hierarchies
				SizeCurvesSimilarStore_Define();

				ugSizeCurvesSimilarStore.DataSource = _sizeCurvesSimilarStoreDataSet;

				foreach (StoreGroupLevelListViewProfile sglp in _sizeCurvesSimilarStoreGroupLevelList)
				{
					_sizeCurvesSimilarStoreDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, false, false, Include.NoRID, string.Empty, Include.NoRID, string.Empty });

					foreach (StoreProfile storeProfile in sglp.Stores)
					{
						updated = false;
						simStore = string.Empty;
						until = string.Empty;

						if (_sizeCurveSimilarStoreList.Contains(storeProfile.Key))
						{
							sccp = (SizeCurveSimilarStoreProfile)_sizeCurveSimilarStoreList.FindKey(storeProfile.Key);
							if (doingCopy ||
								sccp.SimilarStoreChangeType != eChangeType.none)
							{
								updated = true;
							}

							if (sccp.SimStoreRID == Include.NoRID)
							{
								simStore = string.Empty;
							}
							else
							{
								if (doingCopy)
								{
									similarStoreChanged = true;
								}
                                StoreProfile sp = StoreMgmt.StoreProfile_Get(sccp.SimStoreRID); //_SAB.StoreServerSession.GetStoreProfile(sccp.SimStoreRID);
								if (sp.ActiveInd)
								{
									simStore = sp.Text;
								}
							}
							until = sccp.SimStoreDisplayDate;
						}
						else
						{
							sccp = new SizeCurveSimilarStoreProfile(storeProfile.Key);
						}

						simStoreUntilDateRangeRID = sccp.SimStoreUntilDateRangeRID;
						if (doingCopy &&
							simStoreUntilDateRangeRID > Include.NoRID)
						{
							DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(simStoreUntilDateRangeRID);
							if (drp.Name == null ||
								drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
							{
								drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(simStoreUntilDateRangeRID);
								simStoreUntilDateRangeRID = drp.Key;
							}
						}

						_sizeCurvesSimilarStoreDataSet.Tables["Stores"].Rows.Add(new object[] {sglp.Name, false, Include.NoRID, updated, storeProfile.Key, storeProfile.Text,
						//Begin TT#973 - JScott - Received "Store not found" error in Size Curve/Similar Store tab
						//																	sccp.SimStoreIsInherited, sccp.SimStoreInheritedFromNodeRID, false,
																							sccp.SimStoreIsInherited, sccp.SimStoreInheritedFromNodeRID, true,
						//End TT#973 - JScott - Received "Store not found" error in Size Curve/Similar Store tab
																							similarStoreChanged, sccp.SimStoreRID, simStore, simStoreUntilDateRangeRID, until});
					}
				}
				ugSizeCurvesSimilarStore.DataSource = _sizeCurvesSimilarStoreDataSet;
				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securitySizeCurves;
					SetControlReadOnly(this.tabSizeCurvesSimilarStore, !securityProfile.AllowUpdate);
				}

				SizeCurvesSimilarStore_SetRowProperties(securityProfile);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}


		private void SizeCurvesSimilarStore_SetRowProperties(FunctionSecurityProfile securityProfile)
		{
			try
			{
				HierarchyNodeProfile hnp = null;
				int inheritedRID;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				foreach (UltraGridRow setRow in this.ugSizeCurvesSimilarStore.Rows)
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
					{
						if (storeRow.Cells["Sim Str Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Similar Store Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = GetHNProfile(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Similar Store"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Similar Store"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Similar Store"].Appearance.Image = null;
							storeRow.Cells["Similar Store"].Tag = null;
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesSimilarStore_Attributes_Populate()
		{
			try
			{
				StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_sizeCurvesSimilarStoreGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID);
				_groupRID = storeGroup.Key;

				cbSZStoreAttribute.Initialize(SAB, _securitySizeCurves, _sizeCurvesSimilarStoreGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbSZStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				_groupRID = storeGroup.Key;
				this.cbSZStoreAttribute.SelectedValue = storeGroup.Key;
                _sizeCurvesSimilarStoreGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesSimilarStore_BeforeCellListDropDown(object sender, Infragistics.Win.UltraWinGrid.CancelableCellEventArgs e)
		{
			_cellListOpen = true;
		}

		private void ugSizeCurvesSimilarStore_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
		{
			if (ugSizeCurvesSimilarStore.ActiveCell != null)
			{
				if (e.KeyCode == Keys.A &&
					e.Modifiers == Keys.Control)
				{
					ugSizeCurvesSimilarStore.ActiveCell.SelectAll();
				}
			}
		}

		private void ugSizeCurvesSimilarStore_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugSizeCurvesSimilarStore.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if (mouseUIElement == null) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if (null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugSizeCurvesSimilarStore.ActiveCell = mouseCell;
							AdjustSizeCurvesSimilarStoreGridMenu(mouseCell);
						}
					}
					else
						if (headerUIElement.GetType() == typeof(HeaderUIElement))
						{
							headerUI = (HeaderUIElement)headerUIElement;
							Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
							_gridCol = null;
							colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
							_gridCol = colHeader.Column;
							if (_gridCol == null)
								return;

							_gridBand = colHeader.Band;

							this.mnuGridColHeader.Show(this.ugSizeCurvesSimilarStore, point);

						}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

        private void ugSizeCurvesSimilarStore_MouseEnterElement(object sender, UIElementEventArgs e)
        {
            ShowUltraGridToolTip(ugSizeCurvesSimilarStore, e);
        }

		private void AdjustSizeCurvesSimilarStoreGridMenu(Infragistics.Win.UltraWinGrid.UltraGridCell gridCell)
		{
			try
			{
				_gridCell = gridCell;
				
				if (mnuSizeCurvesSimilarStoreGrid.MenuItems.Contains(_mnuItemOpenModel))
				{
					mnuSizeCurvesSimilarStoreGrid.MenuItems.Remove(_mnuItemOpenModel);
					mnuSizeCurvesSimilarStoreGrid.MenuItems.Remove(_mnuItemNewModel);
					mnuSizeCurvesSimilarStoreGrid.MenuItems.Remove(_mnuItemSeparator);
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeCurvesSimilarStoreRowChanged(object ob, DataRowChangeEventArgs e)
		{
			try
			{
				if (_sizeCurvesSimilarStoreIsPopulated)
				{
					DataTable t = (DataTable)ob;
					e.Row["Updated"] = true;
					SizeCurvesSimilarStoreChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugSizeCurvesSimilarStore_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (this.ugSizeCurvesSimilarStore.ActiveCell != null)
					{
						switch (this.ugSizeCurvesSimilarStore.ActiveCell.Column.Key)
						{
							case "Similar Store":
								if (ugSizeCurvesSimilarStore.ActiveCell.Row.Cells["Until"].Text.Length > 0)
								{
									if (!SizeCurveSimilarStoreValid(ugSizeCurvesSimilarStore.ActiveCell, ref errorMessage))
									{
										MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
										e.Cancel = true;
									}
								}
								break;
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private bool SizeCurveSimilarStoreValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (!Convert.ToBoolean(gridCell.Row.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
				{
					//	no need to edit if no similar store
				}
				else
					if (Convert.ToBoolean(gridCell.Row.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
				{
					//	no need to edit if used selector
				}
				else
				if (gridCell.Text != null &&
				gridCell.Text.Trim().Length == 0 &&
				gridCell.Row.Cells["Until"].Text.Length > 0)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				if (gridCell.Value == gridCell.OriginalValue)
				{
					//	no need to edit value did not change
				}
				else
				{
					if (gridCell.Text.Length == 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
						errorFound = true;
					}
					else
					{
						bool simStoreError = false;
                        StoreProfile sp = StoreMgmt.StoreProfile_Get(gridCell.Text.Trim()); //_SAB.StoreServerSession.GetStoreProfile(gridCell.Text.Trim());
						if (sp.ActiveInd)
						{
							if (sp.Key == Include.NoRID)
							{
								sp.Key = 1;
							}
						}
						else
						{
							simStoreError = true;
						}
						if (simStoreError)
						{
							errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreNotFound);
							errorFound = true;
						}
					}
				}
			}
			catch (Exception error)
			{
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool SizeCurveSimilarStoreUntilValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DateRequired);
					errorFound = true;
				}
			}
			catch (Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private void ugSizeCurvesSimilarStore_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_sizeCurvesSimilarStoreIsPopulated)
				{
					SizeCurvesSimilarStoreChangesMade = true;
					switch (e.Cell.Column.Key)
					{
						case "Similar Store":
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							e.Cell.Row.Cells["Used Store Selector"].Value = false;
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								if (Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									e.Cell.Row.Cells["Until RID"].Value = drp.Key;
								}

								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
							}
							break;
						case "Until":
							e.Cell.Row.Cells["Similar Store Changed"].Value = true;
							// remove inheritance provider
							if (e.Cell.Row.Band.Key == "Stores")
							{
								e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
								e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
								e.Cell.Row.Cells["Similar Store"].Tag = null;
							}
							break;
					}
					if (e.Cell.Row.Band.Key == "Stores")
					{
						e.Cell.Row.Cells["Updated"].Value = true;
						SizeCurvesSimilarStoreChangesMade = true;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbSZStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				EditMsgs em = new EditMsgs();

				if (_sizeCurvesSimilarStoreIsPopulated &&
                    !FormIsClosing)
				{
					if (ValidTabSizeCurvesSimilarStore(ref em))
					{
						UpdateSizeCurvesSimilarStoreData();
						StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_sizeCurvesSimilarStoreGroupList[cbSZStoreAttribute.SelectedIndex];
						_groupRID = storeGroup.Key;
                        _sizeCurvesSimilarStoreGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
						SizeCurvesSimilarStore_Populate(false);
					}
					else
					{
						if (Convert.ToInt32(cbSZStoreAttribute.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
						{
							cbDPStoreAttribute.SelectedValue = _groupRID;
							for (int i = 0; i < em.EditMessages.Count; i++)
							{
								EditMsgs.Message emm = (EditMsgs.Message)em.EditMessages[i];
								AddErrorMessage(emm);
							}
							MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbSZStoreAttribute_DragEnter(object sender, DragEventArgs e)
		{

		}

		private void cbSZStoreAttribute_DragDrop(object sender, DragEventArgs e)
		{
			try
			{
				bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

				if (isSuccessfull)
				{
					ChangePending = true;
				}
			}
			catch (Exception exc)
			{
				HandleException(exc);
			}
		}
		private void ugSizeCurvesSimilarStore_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				string storeName = null;
				int storeRid = 0;
				switch (e.Cell.Column.Key)
				{
					case "Similar Store":
                        //Begin TT#??? - JSmith - Add Size Curve info to Node Properties
                        //frmSimilarStoreSelect frmSimilarStoreSelect = new frmSimilarStoreSelect(_SAB, _securitySizeCurves);
                        frmSimilarStoreSelect frmSimilarStoreSelect = new frmSimilarStoreSelect(_SAB, _securitySizeCurves, Convert.ToInt32(cbSZStoreAttribute.SelectedValue));
                        //End TT#??? - JSmith - Add Size Curve info to Node Properties
						if (e.Cell.Row.Band.Key == "Sets")
						{
							storeName = e.Cell.Row.Cells["SetID"].Text;
						}
						else
						{
							storeName = e.Cell.Row.Cells["Store"].Text;
						}
						ArrayList similarStores = new ArrayList();
						similarStores.Add(Convert.ToInt32(e.Cell.Row.Cells["SimilarStoreRID"].Value));
						frmSimilarStoreSelect.InitializeForm(storeName, _hnp.Key, _hnp.Text, similarStores);
						frmSimilarStoreSelect.ShowDialog();
						if (!frmSimilarStoreSelect.CancelClicked)
						{
							if (similarStores.Count <= 1)
							{
								SizeCurvesSimilarStoreChangesMade = true;
								similarStores = frmSimilarStoreSelect.SimilarStoreList;

								string simStores = null;
								int simStore = Include.NoRID;
								if (similarStores.Count == 0)
								{
									simStores = string.Empty;
									e.Cell.Row.Cells["Until RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Until"].Value = string.Empty;
								}
								else
								{
									simStore = (int)similarStores[0];
                                    StoreProfile sp = StoreMgmt.StoreProfile_Get(simStore); //_SAB.StoreServerSession.GetStoreProfile(simStore);
									if (sp.ActiveInd)
									{
										simStores = sp.Text;
									}
								}
								e.Cell.Row.Cells["Similar Store"].Value = simStores;
								e.Cell.Row.Cells["SimilarStoreRID"].Value = simStore;
								e.Cell.Row.Cells["Similar Store Changed"].Value = true;
								e.Cell.Row.Cells["Used Store Selector"].Value = true;
								if (e.Cell.Row.Band.Key == "Stores")
								{
									if (Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
									{
										int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
										DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
										if (drp.Name == null ||
											drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
										{
											drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
										}
										e.Cell.Row.Cells["Until RID"].Value = drp.Key;
									}
									e.Cell.Row.Cells["Updated"].Value = true;
									e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
									e.Cell.Row.Cells["Similar Store"].Tag = null;
									e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								}
							}
							else
							{
								string message = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_OnlyOneSimilarStoreAllowed);
								MessageBox.Show(message, this.Text,
									MessageBoxButtons.OK, MessageBoxIcon.Warning);
							}
						}
						frmSimilarStoreSelect.Dispose();
						break;
					case "Until":
						if (_securitySizeCurves.AllowUpdate)
						{
							CalendarDateSelector frmCalDtSelector = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[] { _SAB });
							if (e.Cell.Row.Cells["Until RID"].Value != null &&
								e.Cell.Row.Cells["Until RID"].Value != System.DBNull.Value &&
								Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture) != Include.NoRID)
							{
								int untilRID = Convert.ToInt32(e.Cell.Row.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
								if (e.Cell.Row.Band.Key == "Stores" &&
									Convert.ToBoolean(e.Cell.Row.Cells["Sim Str Inherited"].Value))
								{
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(untilRID);
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(untilRID);
									}
									untilRID = drp.Key;
								}

								frmCalDtSelector.DateRangeRID = untilRID;
							}
							frmCalDtSelector.RestrictToSingleDate = false;
							frmCalDtSelector.AllowDynamicToCurrent = false;
							frmCalDtSelector.AllowDynamicToPlan = false;
                            frmCalDtSelector.AllowDynamicToStoreOpen = false;
							frmCalDtSelector.AllowDynamic = false;


							if (e.Cell.Row.Band.Key == "Sets")
							{
								storeName = e.Cell.Row.Cells["SetID"].Text;
							}
							else
							{
								storeName = e.Cell.Row.Cells["Store"].Text;
								storeRid = Convert.ToInt32(e.Cell.Row.Cells["Store RID"].Value, CultureInfo.CurrentUICulture);
                                StoreProfile storeProfile = StoreMgmt.StoreProfile_Get(storeRid); //_SAB.StoreServerSession.GetStoreProfile(storeRid);
								if (storeProfile.SellingOpenDt != _nullDate)
								{
									frmCalDtSelector.AllowDynamic = true;
									DayProfile mrsDay = _SAB.ClientServerSession.Calendar.GetDay(storeProfile.SellingOpenDt);
									frmCalDtSelector.AnchorDate = mrsDay;
									frmCalDtSelector.AllowDynamicToStoreOpen = true;
									frmCalDtSelector.AnchorDateRelativeTo = eDateRangeRelativeTo.StoreOpen;
								}
							}
							DialogResult DateRangeResult = frmCalDtSelector.ShowDialog();
							if (DateRangeResult == DialogResult.OK)
							{
								DateRangeProfile SelectedDateRange = (DateRangeProfile)frmCalDtSelector.Tag;
								e.Cell.Value = SelectedDateRange.DisplayDate;
								e.Cell.Row.Cells["Until RID"].Value = SelectedDateRange.Key;
								if (e.Cell.Row.Band.Key == "Stores")
								{
									e.Cell.Row.Cells["Updated"].Value = true;
									e.Cell.Row.Cells["Similar Store Changed"].Value = true;
									e.Cell.Row.Cells["Similar Store"].Appearance.Image = null;
									e.Cell.Row.Cells["Similar Store"].Tag = null;
									e.Cell.Row.Cells["Similar Store Inherited RID"].Value = Include.NoRID;
									e.Cell.Row.Cells["Sim Str Inherited"].Value = false;
								}
								// clear if error flags
								e.Cell.Tag = null;
								e.Cell.Appearance.Image = null;
								SizeCurvesSimilarStoreChangesMade = true;
							}
							frmCalDtSelector.Dispose();
						}
						break;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private bool ValidTabSizeCurvesSimilarStore(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;

				foreach (UltraGridRow setRow in this.ugSizeCurvesSimilarStore.Rows)
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
					{
						if (Convert.ToBoolean(storeRow.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
						{
							if (storeRow.Cells["Similar Store"].Text.Length > 0 ||
								storeRow.Cells["Until"].Text.Length > 0)
							{
								if (Convert.ToBoolean(storeRow.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
								{
								}
								if (!SizeCurveSimilarStoreValid(storeRow.Cells["Similar Store"], ref errorMessage))
								{
									em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
								}

								if (!SizeCurveSimilarStoreUntilValid(storeRow.Cells["Until"], ref errorMessage))
								{
									em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
								}
							}
							else
							{
								storeRow.Cells["Similar Store"].Appearance.Image = null;
								storeRow.Cells["Similar Store"].Tag = null;
								storeRow.Cells["Until"].Appearance.Image = null;
								storeRow.Cells["Until"].Tag = null;
							}
						}
					}
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}

			return false;
		}

		private void cbxSZSimilarStoreInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesSimilarStoreChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZSimilarStoreApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeCurvesSimilarStoreChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		#endregion Size Curves Similar Store Tab

		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		#region Size Out Of Stock Tab

		private void SizeOutOfStockTab_Load()
		{
			try
			{
				_sizeCurvesToleranceIsPopulated = false;

				SizeOutOfStock_Populate(true, Include.NoRID, Include.NoRID);

				_sizeOutOfStockIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeOutOfStock_Populate(bool aReplaceValues, int aStrGrpRID, int aSzGrpRID)
		{
			FunctionSecurityProfile securityProfile;
			int nodeRID;
			string inheritMsg;
			HierarchyNodeProfile inheritanceProfile;

			try
			{
				_sizeOutOfStockIsPopulated = false;

				if (!tabNodeProperties.Controls.Contains(this.tabSizeOutOfStock))
				{
					return;
				}

				inheritMsg = null;
				inheritanceProfile = null;

				if (_hnp.Key == Include.NoRID)
				{
					nodeRID = _hnp.HomeHierarchyParentRID;
				}
				else
				{
					nodeRID = _hnp.Key;
				}

				if (_sizeOutOfStockProfile == null || aReplaceValues)
				{
                    // Begin TT#1935-MD - JSmith - SVC - Node Properties- Chain Set Percent - Select Str Attribute, Date Range and type in % by week.  Select the Apply button and receive a DB Error.
                    //_sizeOutOfStockProfile = _SAB.HierarchyServerSession.GetSizeOutOfStockProfile(nodeRID, aStrGrpRID, aSzGrpRID, false);
                    _sizeOutOfStockProfile = _SAB.HierarchyServerSession.GetSizeOutOfStockProfile(nodeRID, aStrGrpRID, aSzGrpRID, false, StoreMgmt.StoreGroup_GetVersion(aStrGrpRID));
                    // End TT#1935-MD - JSmith - SVC - Node Properties- Chain Set Percent - Select Str Attribute, Date Range and type in % by week.  Select the Apply button and receive a DB Error.
				}

				BindSizeGroupComboBox(_sizeOutOfStockProfile.SizeGrpRID);
				BindStoreAttrComboBox(_sizeOutOfStockProfile.StoreGrpRID);

				LoadSizeOutOfStockDataSet();

				mcColorSizeByAttribute.InitializeControl(
					_SAB,
					_sizeOutOfStockProfile.dsValues.Tables["ColorCodes"],
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeCodes"],
					_securitySizeOutOfStock,
					ErrorImage,
					InheritanceImage);

				mcColorSizeByAttribute.BindControl(_sizeOutOfStockDataSet);

				securityProfile = _securityNodeProperties;

				if (!_newNode)
				{
					securityProfile = _securitySizeOutOfStock;
					SetControlReadOnly(this.tabSizeOutOfStockParms, !securityProfile.AllowUpdate);
				}

				if (_sizeOutOfStockProfile.SizeGrpRID > Include.NoRID)
				{
					if (_sizeOutOfStockProfile.SizeGrpIsInherited)
					{
						if (inheritanceProfile == null ||
							inheritanceProfile.Key != _sizeOutOfStockProfile.SizeGrpIsInheritedFromNodeRID)
						{
							inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeOutOfStockProfile.SizeGrpIsInheritedFromNodeRID);
						}

						inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
						InheritanceProvider.SetError(this.cboSZOOSSizeGroup, inheritMsg);
					}
					else
					{
						InheritanceProvider.SetError(this.cboSZOOSSizeGroup, string.Empty);
					}
				}

				if (_sizeOutOfStockProfile.StoreGrpRID > Include.NoRID)
				{
					if (_sizeOutOfStockProfile.StrGrpIsInherited)
					{
						if (_sizeOutOfStockProfile.StrGrpIsInheritedFromNodeRID != Include.NoRID)
						{
							if (inheritanceProfile == null ||
								inheritanceProfile.Key != _sizeOutOfStockProfile.StrGrpIsInheritedFromNodeRID)
							{
								inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeOutOfStockProfile.StrGrpIsInheritedFromNodeRID);
							}

							inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
							InheritanceProvider.SetError(this.cboSZOOSStoreAttribute, inheritMsg);
						}
						else
						{
							inheritMsg = _txtInheritedFrom + "System Options";
							InheritanceProvider.SetError(this.cboSZOOSStoreAttribute, inheritMsg);
						}
					}
					else
					{
						InheritanceProvider.SetError(this.cboSZOOSStoreAttribute, string.Empty);
					}
				}

				_sizeOutOfStockIsPopulated = true;
				SizeOutOfStockSizeGroupChangesMade = false;
				SizeOutOfStockStoreGroupChangesMade = false;
				SizeOutOfStockQuantityChangesMade = false;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void LoadSizeOutOfStockDataSet()
		{
			DataTable dtSetLevel;
			DataTable dtAllColor;
			DataTable dtColor;
			DataTable dtAllColorSize;
			DataTable dtColorSize;
			DataTable dtColorSizeDimension;
			DataTable dtAllColorSizeDimension;
			ForeignKeyConstraint fkc;

			try
			{
				_sizeOutOfStockDataSet = MIDEnvironment.CreateDataSet();
				_sizeOutOfStockDataSet.EnforceConstraints = true;

				dtSetLevel = _sizeOutOfStockProfile.dsValues.Tables["SetLevelValues"].Copy();
				dtSetLevel.TableName = "SetLevel";
				dtSetLevel.PrimaryKey = new DataColumn[] { dtSetLevel.Columns["SGL_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtSetLevel);

				dtAllColor = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtAllColor.TableName = "AllColor";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.AllColor)))
				{
					dtAllColor.Rows.Add(row.ItemArray);
				}
				dtAllColor.PrimaryKey = new DataColumn[] { dtAllColor.Columns["SGL_RID"], dtAllColor.Columns["COLOR_CODE_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtAllColor);

				dtColor = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtColor.TableName = "Color";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.Color)))
				{
					dtColor.Rows.Add(row.ItemArray);
				}
				dtColor.PrimaryKey = new DataColumn[] { dtColor.Columns["SGL_RID"], dtColor.Columns["COLOR_CODE_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtColor);

				dtAllColorSize = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtAllColorSize.TableName = "AllColorSize";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.AllColorSize)))
				{
					dtAllColorSize.Rows.Add(row.ItemArray);
				}
				dtAllColorSize.PrimaryKey = new DataColumn[] { dtAllColorSize.Columns["SGL_RID"], dtAllColorSize.Columns["COLOR_CODE_RID"], dtAllColorSize.Columns["DIMENSIONS_RID"], dtAllColorSize.Columns["SIZE_CODE_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtAllColorSize);

				dtColorSize = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtColorSize.TableName = "ColorSize";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.ColorSize)))
				{
					dtColorSize.Rows.Add(row.ItemArray);
				}
				dtColorSize.PrimaryKey = new DataColumn[] { dtColorSize.Columns["SGL_RID"], dtColorSize.Columns["COLOR_CODE_RID"], dtColorSize.Columns["DIMENSIONS_RID"], dtColorSize.Columns["SIZE_CODE_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtColorSize);

				dtColorSizeDimension = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtColorSizeDimension.TableName = "ColorSizeDimension";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.ColorSizeDimension)))
				{
					dtColorSizeDimension.Rows.Add(row.ItemArray);
				}
				dtColorSizeDimension.PrimaryKey = new DataColumn[] { dtColorSizeDimension.Columns["SGL_RID"], dtColorSizeDimension.Columns["COLOR_CODE_RID"], dtColorSizeDimension.Columns["DIMENSIONS_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtColorSizeDimension);

				dtAllColorSizeDimension = _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clone();
				dtAllColorSizeDimension.TableName = "AllColorSizeDimension";
				foreach (DataRow row in _sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Select("ROW_TYPE_ID = " + Convert.ToInt32(eSizeMethodRowType.AllColorSizeDimension)))
				{
					dtAllColorSizeDimension.Rows.Add(row.ItemArray);
				}
				dtAllColorSizeDimension.PrimaryKey = new DataColumn[] { dtAllColorSizeDimension.Columns["SGL_RID"], dtAllColorSizeDimension.Columns["COLOR_CODE_RID"], dtAllColorSizeDimension.Columns["DIMENSIONS_RID"] };
				_sizeOutOfStockDataSet.Tables.Add(dtAllColorSizeDimension);

				fkc = new ForeignKeyConstraint("SetAllColor",
					new DataColumn[] { dtSetLevel.Columns["SGL_RID"] },
					new DataColumn[] { dtAllColor.Columns["SGL_RID"] });

				InitForeignKeyConstraint(fkc);
				dtAllColor.Constraints.Add(fkc);

				fkc = new ForeignKeyConstraint("SetColor",
					new DataColumn[] { dtSetLevel.Columns["SGL_RID"] },
					new DataColumn[] { dtColor.Columns["SGL_RID"] });

				InitForeignKeyConstraint(fkc);
				dtColor.Constraints.Add(fkc);

				fkc = new ForeignKeyConstraint("AllColorSize",
					new DataColumn[] {	dtAllColorSizeDimension.Columns["SGL_RID"],
											dtAllColorSizeDimension.Columns["COLOR_CODE_RID"],
											dtAllColorSizeDimension.Columns["DIMENSIONS_RID"] },
					new DataColumn[] {	dtAllColorSize.Columns["SGL_RID"],
											dtAllColorSize.Columns["COLOR_CODE_RID"],
											dtAllColorSize.Columns["DIMENSIONS_RID"] });

				InitForeignKeyConstraint(fkc);
				dtAllColorSize.Constraints.Add(fkc);

				fkc = new ForeignKeyConstraint("ColorSize",
					new DataColumn[] {	dtColorSizeDimension.Columns["SGL_RID"],
											dtColorSizeDimension.Columns["COLOR_CODE_RID"],
											dtColorSizeDimension.Columns["DIMENSIONS_RID"] },
					new DataColumn[] {	dtColorSize.Columns["SGL_RID"],
											dtColorSize.Columns["COLOR_CODE_RID"],
											dtColorSize.Columns["DIMENSIONS_RID"] });

				InitForeignKeyConstraint(fkc);
				dtColorSize.Constraints.Add(fkc);

				fkc = new ForeignKeyConstraint("ColorSizeDimension",
					new DataColumn[] {	dtColor.Columns["SGL_RID"],
											dtColor.Columns["COLOR_CODE_RID"] },
					new DataColumn[] {	dtColorSizeDimension.Columns["SGL_RID"],
											dtColorSizeDimension.Columns["COLOR_CODE_RID"] });

				InitForeignKeyConstraint(fkc);
				dtColorSizeDimension.Constraints.Add(fkc);

				fkc = new ForeignKeyConstraint("AllColorSizeDimension",
					new DataColumn[] {	dtAllColor.Columns["SGL_RID"],
											dtAllColor.Columns["COLOR_CODE_RID"] },
					new DataColumn[] {	dtAllColorSizeDimension.Columns["SGL_RID"],
											dtAllColorSizeDimension.Columns["COLOR_CODE_RID"] });

				InitForeignKeyConstraint(fkc);
				dtAllColorSizeDimension.Constraints.Add(fkc);

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("SetAllColor",
					new DataColumn[] { dtSetLevel.Columns["SGL_RID"] },
					new DataColumn[] { dtAllColor.Columns["SGL_RID"] }));

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("SetColor",
					new DataColumn[] { dtSetLevel.Columns["SGL_RID"] },
					new DataColumn[] { dtColor.Columns["SGL_RID"] }));

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("AllColorSizeDimension",
					new DataColumn[] { dtAllColor.Columns["SGL_RID"], 
										dtAllColor.Columns["COLOR_CODE_RID"] },
					new DataColumn[] { dtAllColorSizeDimension.Columns["SGL_RID"], 
										dtAllColorSizeDimension.Columns["COLOR_CODE_RID"] }));

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("ColorSizeDimension",
					new DataColumn[] { dtColor.Columns["SGL_RID"],
										dtColor.Columns["COLOR_CODE_RID"] },
					new DataColumn[] { dtColorSizeDimension.Columns["SGL_RID"],
										dtColorSizeDimension.Columns["COLOR_CODE_RID"] }));

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("AllColorSize",
					new DataColumn[] {	dtAllColorSizeDimension.Columns["SGL_RID"],
										dtAllColorSizeDimension.Columns["COLOR_CODE_RID"],
										dtAllColorSizeDimension.Columns["DIMENSIONS_RID"] },
					new DataColumn[] {	dtAllColorSize.Columns["SGL_RID"],
										dtAllColorSize.Columns["COLOR_CODE_RID"],
										dtAllColorSize.Columns["DIMENSIONS_RID"] }));

				_sizeOutOfStockDataSet.Relations.Add(new DataRelation("ColorSize",
					new DataColumn[] {	dtColorSizeDimension.Columns["SGL_RID"],
										dtColorSizeDimension.Columns["COLOR_CODE_RID"],
										dtColorSizeDimension.Columns["DIMENSIONS_RID"] },
					new DataColumn[] {  dtColorSize.Columns["SGL_RID"],
										dtColorSize.Columns["COLOR_CODE_RID"],
										dtColorSize.Columns["DIMENSIONS_RID"] }));
			}
			catch
			{
				throw;
			}
		}

		private void InitForeignKeyConstraint(ForeignKeyConstraint aConstraint)
		{
			try
			{
				aConstraint.AcceptRejectRule = AcceptRejectRule.None;
				aConstraint.DeleteRule = Rule.Cascade;
				aConstraint.UpdateRule = Rule.Cascade;
			}
			catch
			{
				throw;
			}
		}

		/// <summary>
		/// Populates the size group combo box.
		/// </summary>
		private void BindSizeGroupComboBox(int aSizeGroupRID)
		{
			DataTable dtGroups;
			SizeGroupProfile sgp;

			try
			{
				cboSZOOSSizeGroup.DataSource = null;
				cboSZOOSSizeGroup.Items.Clear();

				_sizeOutOfStockGroupList = new SizeGroupList(eProfileType.SizeGroup);
				_sizeOutOfStockGroupList.LoadAll(false);

				dtGroups = MIDEnvironment.CreateDataTable("Groups");
				dtGroups.Columns.Add("Key");
				dtGroups.Columns.Add("Name");

				if (SAB.ApplicationServerSession.GlobalOptions.SizeGroupCharMask != string.Empty)
				{
					if (aSizeGroupRID != Include.NoRID)
					{
						sgp = (SizeGroupProfile)_sizeOutOfStockGroupList.FindKey(aSizeGroupRID);
						dtGroups.Rows.Add(new object[] { sgp.Key, sgp.SizeGroupName });
					}
				}
				else
				{
					foreach (SizeGroupProfile sizegrp in _sizeOutOfStockGroupList.ArrayList)
					{
						dtGroups.Rows.Add(new object[] { sizegrp.Key, sizegrp.SizeGroupName });
					}
				}

				cboSZOOSSizeGroup.DataSource = dtGroups;
				cboSZOOSSizeGroup.DisplayMember = "Name";
				cboSZOOSSizeGroup.ValueMember = "Key";
				cboSZOOSSizeGroup.SelectedValue = aSizeGroupRID;

				if (SAB.ApplicationServerSession.GlobalOptions.SizeGroupCharMask != string.Empty)
				{
					this.cboSZOOSSizeGroup.Enabled = false;
				}
				else
				{
					this.cboSZOOSSizeGroup.Enabled = true;
				}
			}
			catch (Exception ex)
			{
				HandleException(ex, "BindSizeGroupComboBox");
			}
		}

		virtual protected void BindSizeGroupComboBox(int aSizeGroupRID, string aFilterString, bool aCaseSensitive)
		{
			SizeGroup sizeGroup;
			string whereClause;
			DataTable dtGroups;
			SizeGroupProfile sgp;

			try
			{
				cboSZOOSSizeGroup.DataSource = null;
				cboSZOOSSizeGroup.Items.Clear();

				sizeGroup = new SizeGroup();

				aFilterString = aFilterString.Replace("*", "%");
				//aFilterString = aFilterString.Replace("'", "''");	// for string with single quote

				//whereClause = "SIZE_GROUP_NAME LIKE '" + aFilterString + "'";

                //if (!aCaseSensitive)
                //{
                //    whereClause += Include.CaseInsensitiveCollation;
                //}

                //dtGroups = sizeGroup.SizeGroup_FilterRead(whereClause);
                if (aCaseSensitive)
                {
                    dtGroups = sizeGroup.SizeGroup_FilterReadCaseSensitive(aFilterString);
                }
                else
                {
                    dtGroups = sizeGroup.SizeGroup_FilterReadCaseInsensitive(aFilterString);
                }

				dtGroups.Rows.Add(new object[] { Include.NoRID, "" });

				if (dtGroups.Select("SIZE_GROUP_RID = " + aSizeGroupRID).Length == 0)
				{
					sgp = (SizeGroupProfile)_sizeOutOfStockGroupList.FindKey(aSizeGroupRID);
					dtGroups.Rows.Add(new object[] { sgp.Key, sgp.SizeGroupName });
				}

				dtGroups.DefaultView.Sort = "SIZE_GROUP_NAME ASC";
				dtGroups.Columns["SIZE_GROUP_RID"].ColumnName = "Key";
				dtGroups.Columns["SIZE_GROUP_NAME"].ColumnName = "Name";
				dtGroups.AcceptChanges();

				cboSZOOSSizeGroup.DataSource = dtGroups;
				cboSZOOSSizeGroup.DisplayMember = "Name";
				cboSZOOSSizeGroup.ValueMember = "Key";
				cboSZOOSSizeGroup.SelectedValue = aSizeGroupRID;
				cboSZOOSSizeGroup.Enabled = true;
			}
			catch (Exception ex)
			{
				HandleException(ex, "BindSizeGroupComboBox");
			}
		}

		/// <summary>
		/// Populate all Store_Groups (Attributes); 1st sel if new else selection made
		/// in load
		/// </summary>
		virtual protected void BindStoreAttrComboBox(int aStoreAttrRID)
		{
			ProfileList profileList;
			int currValue;

			try
			{
				cboSZOOSStoreAttribute.DataSource = null;
				cboSZOOSStoreAttribute.Items.Clear();

				if (aStoreAttrRID != Include.NoRID)
				{
					currValue = aStoreAttrRID;
				}
				else
				{
					currValue = Include.AllStoreGroupRID;
				}

                profileList = StoreMgmt.StoreGroup_GetListViewList(eStoreGroupSelectType.GlobalOnly, false); //SAB.StoreServerSession.GetStoreGroupListViewList(eStoreGroupSelectType.GlobalOnly, false);

				cboSZOOSStoreAttribute.Initialize(SAB, FunctionSecurity, profileList.ArrayList, false);

                AdjustTextWidthComboBox_DropDown(cboSZOOSStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				cboSZOOSStoreAttribute.SelectedValue = currValue;
			}
			catch
			{
				throw;
			}
		}

		private bool ValidTabSizeOutOfStock(ref EditMsgs em)
		{
			try
			{
				//TODO
				return true;
			}
			catch (Exception exception)
			{
				throw;
			}
		}

		private void picSZOOSSizeGroupFilter_MouseHover(object sender, System.EventArgs e)
		{
			try
			{
				string message = MIDText.GetTextOnly((int)eMIDTextCode.tt_ClickToFilterDropDown);
				ToolTip.Active = true;
				ToolTip.SetToolTip((System.Windows.Forms.Control)sender, message);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void picSZOOSSizeGroupFilter_Click(object sender, System.EventArgs e)
		{
			try
			{
				string enteredMask = string.Empty;
				bool caseSensitive = false;
				PictureBox picBox = (PictureBox)sender;

				if (CharMaskFromDialogOK(Convert.ToString(picBox.Tag), ref enteredMask, ref caseSensitive))
				{
					BindSizeGroupComboBox(_sizeOutOfStockProfile.SizeGrpRID, enteredMask, caseSensitive);
				}
			}
			catch (Exception ex)
			{
				HandleException(ex);
			}
		}

		private void cboSZOOSStoreAttribute_DragEnter(object sender, DragEventArgs e)
		{
			Image_DragEnter(sender, e);
		}

		private void cboSZOOSStoreAttribute_DragOver(object sender, DragEventArgs e)
		{
			Image_DragOver(sender, e);
		}

		private void cboSZOOSStoreAttribute_SelectionChangeCommitted(object sender, EventArgs e)
		{
			SizeOutOfStockHeaderProfile pHeader;
			string message;
			bool change;
			int strGrpRID;
			int szGrpRID;

			try
			{
				if (_sizeOutOfStockIsPopulated && !_comboBoxChanging)
				{
					change = true;

					if (_sizeOutOfStockProfile.StrGrpIsInherited)
					{
						pHeader = SAB.HierarchyServerSession.GetSizeOutOfStockHeaderProfile(_hnp.HomeHierarchyParentRID, Include.NoRID, Include.NoRID, false);

						if (pHeader.StoreGrpRID != Convert.ToInt32(cboSZOOSStoreAttribute.SelectedValue))
						{
							message = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DetachSizeOutOfStockInheritance);
							change = (MessageBox.Show(message, this.Text, MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes);
						}
					}

					if (change)
					{
						if (_sizeOutOfStockProfile.StoreGrpRID != Convert.ToInt32(cboSZOOSStoreAttribute.SelectedValue))
						{
							_sizeOutOfStockProfile.StoreGrpRID = Convert.ToInt32(cboSZOOSStoreAttribute.SelectedValue);
							_sizeOutOfStockProfile.StrGrpIsInherited = false;
							_sizeOutOfStockProfile.StrGrpIsInheritedFromNodeRID = Include.NoRID;

							DetermineCurrentSizeStoreRIDs(out strGrpRID, out szGrpRID);
							SizeOutOfStock_Populate(true, strGrpRID, szGrpRID);
							SizeOutOfStockStoreGroupChangesMade = true;
							ChangePending = true;
						}
					}
					else
					{
						_comboBoxChanging = true;
						cboSZOOSStoreAttribute.SelectedValue = _sizeOutOfStockProfile.StoreGrpRID;
						_comboBoxChanging = false;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cboSZOOSSizeGroup_SelectionChangeCommitted(object sender, EventArgs e)
		{
			int strGrpRID;
			int szGrpRID;

			try
			{
				if (_sizeOutOfStockIsPopulated)
				{
					if (cboSZOOSSizeGroup.SelectedValue != null)
					{
						_sizeOutOfStockProfile.SizeGrpRID = Convert.ToInt32(cboSZOOSSizeGroup.SelectedValue);
					}
					else
					{
						_sizeOutOfStockProfile.SizeGrpRID = Include.NoRID;
					}

					_sizeOutOfStockProfile.SizeGrpIsInherited = false;
					_sizeOutOfStockProfile.SizeGrpIsInheritedFromNodeRID = Include.NoRID;

					DetermineCurrentSizeStoreRIDs(out strGrpRID, out szGrpRID);
					SizeOutOfStock_Populate(true, strGrpRID, szGrpRID);
					SizeOutOfStockSizeGroupChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void mcColorSizeByAttribute_ValueChanged(object source)
		{
			try
			{
				SizeOutOfStockQuantityChangesMade = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZOOSInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeOutOfStockQuantityChangesMade = true;
					SizeOutOfStockSizeGroupChangesMade = true;
					SizeOutOfStockStoreGroupChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void cbxSZOOSApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (FormLoaded &&
					!_processingSave &&
					!_rebuildScreen)
				{
					SizeOutOfStockQuantityChangesMade = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void DisplayPictureBoxImage(System.Windows.Forms.PictureBox aPicBox)
		{
			Image image;
			try
			{
				image = Image.FromFile(MIDGraphics.ImageDir + "\\" + MIDGraphics.MagnifyingGlassImage);
				SizeF sizef = new SizeF(aPicBox.Width, aPicBox.Height);
				Size size = Size.Ceiling(sizef);
				Bitmap bitmap = new Bitmap(image, size);
				aPicBox.Image = bitmap;
			}
			catch (Exception ex)
			{
				MessageBox.Show(ex.Message);
				throw;
			}
		}

		private bool CharMaskFromDialogOK(string aGlobalMask, ref string aEnteredMask, ref bool aCaseSensitive)
		{
			bool maskOK = false;
			string errMessage = string.Empty;

			try
			{
				bool cancelAction = false;
				string dialogLabel = MIDText.GetTextOnly((int)eMIDTextCode.lbl_FilterSelection);
				string textLabel = MIDText.GetTextOnly((int)eMIDTextCode.lbl_FilterSelectionText);

				NameDialog nameDialog = new NameDialog(dialogLabel, textLabel, aGlobalMask);
				nameDialog.AllowCaseSensitive();

				while (!(maskOK || cancelAction))
				{
					nameDialog.StartPosition = FormStartPosition.CenterParent;
					nameDialog.TreatEmptyAsCancel = false;
					DialogResult dialogResult = nameDialog.ShowDialog();

					if (dialogResult == DialogResult.Cancel)
						cancelAction = true;
					else
					{
						maskOK = false;
						aEnteredMask = nameDialog.TextValue.Trim();
						aCaseSensitive = nameDialog.CaseSensitive;
						// append mask with trailing asterisk
						if (!aEnteredMask.EndsWith("*"))
						{
							aEnteredMask += "*";
						}
						maskOK = (aGlobalMask == string.Empty) ? true : EnteredMaskOK(aEnteredMask, aGlobalMask);

						if (!maskOK)
						{
							errMessage = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_al_FilterGlobalOptionMismatch);
							MessageBox.Show(errMessage, dialogLabel, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
				}

				if (cancelAction)
				{
					maskOK = false;
				}
				else
				{
					nameDialog.Dispose();
				}
			}
			catch (Exception ex)
			{
				HandleException(ex);
			}

			return maskOK;
		}

		private bool EnteredMaskOK(string aEnteredMask, string aGlobalMask)
		{
			bool maskOK = true;
			try
			{
				//bool okToContinue = true;
				int gXCount = 0;
				int eXCount = 0;
				int gWCount = 0;
				int eWCount = 0;
				char wildCard = '*';
				char[] cGlobalArray = aGlobalMask.ToCharArray(0, aGlobalMask.Length);
				for (int i = 0; i < cGlobalArray.Length; i++)
				{
					if (cGlobalArray[i] == wildCard)
					{
						gWCount++;
					}
					else
					{
						gXCount++;
					}
				}
				char[] cEnteredArray = aEnteredMask.ToCharArray(0, aEnteredMask.Length);
				for (int i = 0; i < cEnteredArray.Length; i++)
				{
					if (cEnteredArray[i] == wildCard)
					{
						eWCount++;
					}
					else
					{
						eXCount++;
					}
				}

				if (eXCount < gXCount)
				{
					maskOK = false;
				}
				else if (eXCount > gXCount && gWCount == 0)
				{
					maskOK = false;
				}
				else if (aEnteredMask.Length < aGlobalMask.Length && !aGlobalMask.EndsWith("*"))
				{
					maskOK = false;
				}
				string[] globalParts = aGlobalMask.Split(new char[] { '*' });
				string[] enteredParts = aEnteredMask.Split(new char[] { '*' });
				int gLastEntry = globalParts.Length - 1;
				int eLastEntry = enteredParts.Length - 1;
				if (enteredParts[0].Length < globalParts[0].Length)
				{
					maskOK = false;
				}
				else if (enteredParts[eLastEntry].Length < globalParts[gLastEntry].Length)
				{
					maskOK = false;
				}
			}
			catch
			{
				throw;
			}
			return maskOK;
		}

		protected void SetMaskedComboBoxesEnabled()
		{
			if (SAB.ApplicationServerSession.GlobalOptions.SizeGroupCharMask != string.Empty)
			{
				this.cboSZOOSSizeGroup.Enabled = false;
			}
		}

		private void DetermineCurrentSizeStoreRIDs(out int aStrGrpRID, out int aSzGrpRID)
		{
			try
			{
				if (_sizeOutOfStockProfile == null)
				{
					aStrGrpRID = Include.NoRID;
					aSzGrpRID = Include.NoRID;
				}
				else
				{
					if (_sizeOutOfStockProfile.StrGrpIsInherited)
					{
						aStrGrpRID = Include.NoRID;
					}
					else
					{
						aStrGrpRID = _sizeOutOfStockProfile.StoreGrpRID;
					}

					if (_sizeOutOfStockProfile.SizeGrpIsInherited)
					{
						aSzGrpRID = Include.NoRID;
					}
					else
					{
						aSzGrpRID = _sizeOutOfStockProfile.SizeGrpRID;
					}
				}
			}
			catch
			{
				throw;
			}
		}

		#endregion Size Out Of Stock Tab

		#region Size Sell Thru Tab

		private void SizeSellThruTab_Load()
		{
			try
			{
				_sizeSellThruIsPopulated = false;

				SizeSellThru_Populate(true);

				_sizeSellThruIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void SizeSellThru_Populate(bool aReplaceValues)
		{
			FunctionSecurityProfile securityProfile;
			int nodeRID;
			string inheritMsg;
			HierarchyNodeProfile inheritanceProfile;

			try
			{
				if (!tabNodeProperties.Controls.Contains(this.tabSizeOutOfStock))
				{
					return;
				}

				inheritMsg = null;
				inheritanceProfile = null;

				if (_hnp.Key == Include.NoRID)
				{
					nodeRID = _hnp.HomeHierarchyParentRID;
				}
				else
				{
					nodeRID = _hnp.Key;
				}

				if (_sizeSellThruProfile == null || aReplaceValues)
				{
					_sizeSellThruProfile = _SAB.HierarchyServerSession.GetSizeSellThruProfile(nodeRID, false);
				}

				securityProfile = _securityNodeProperties;

				if (!_newNode)
				{
					securityProfile = _securitySizeOutOfStock;
					SetControlReadOnly(this.tabSizeSellThru, !securityProfile.AllowUpdate);
				}

				if (_sizeSellThruProfile.SellThruLimit > Include.Undefined)
				{
					this.txtSSTLimit.Text = _sizeSellThruProfile.SellThruLimit.ToString();

					if (_sizeSellThruProfile.SellThruLimitIsInherited)
					{
						if (inheritanceProfile == null ||
							inheritanceProfile.Key != _sizeSellThruProfile.SellThruLimitInheritedFromNodeRID)
						{
							inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_sizeSellThruProfile.SellThruLimitInheritedFromNodeRID);
						}

						inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
						InheritanceProvider.SetError(this.txtSSTLimit, inheritMsg);
					}
					else
					{
						InheritanceProvider.SetError(this.txtSSTLimit, string.Empty);
					}
				}
				else
				{
					this.txtSSTLimit.Text = string.Empty;
					InheritanceProvider.SetError(this.txtSSTLimit, string.Empty);
				}

				_sizeSellThruIsPopulated = true;
				SizeSellThruChangesMade = false;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private bool ValidTabSizeSellThru(ref EditMsgs em)
		{
			//TODO
			if (FormIsClosing && !SaveOnClose)
			{
				return true;
			}

			bool validValues = true;
			if (!ValidTabSizeSellThru(this.txtSSTLimit))
			{
				validValues = false;
			}

			return validValues;
		}

		private bool ValidTabSizeSellThru(TextBox aSellThruField)
		{
			try
			{
				if (aSellThruField.Text.Length > 0)
				{
					try
					{
						double SellThruValue = Convert.ToDouble(aSellThruField.Text, CultureInfo.CurrentUICulture);
						if (SellThruValue < 0)
						{
							string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
							ErrorProvider.SetError(aSellThruField, error);
							return false;
						}
						else
						{
							ErrorProvider.SetError(aSellThruField, string.Empty);
							return true;
						}
					}
					catch
					{
						string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						ErrorProvider.SetError(aSellThruField, error);
						return false;
					}
				}
				else
				{
					return true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			return false;
		}

		private void txtSSTLimit_TextChanged(object sender, EventArgs e)
		{
			try
			{
				if (_sizeSellThruIsPopulated)
				{
					InheritanceProvider.SetError(this.txtSSTLimit, string.Empty);
					SizeSellThruChangesMade = true;
					ChangePending = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		#endregion Size Sell Thru Tab

		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		#region Stock Min/Max Tab

		private void ugStockMinMax_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_StockMinMaxGridBuilt)
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                    //ugld.ApplyDefaults(e);
                    MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                    ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                    //End TT#169

					DefaultStockMinMaxGridLayout();
                }
				
				_StockMinMaxGridBuilt = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultStockMinMaxGridLayout()
		{
			try
			{
				//Prevent the user from re-arranging columns.
				ugStockMinMax.DisplayLayout.Override.AllowColMoving = AllowColMoving.NotAllowed;

				ugStockMinMax.DisplayLayout.Bands[0].Columns["Boundary"].Hidden = true;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["StoreGrade"].Width = 180;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["StoreGrade"].CellActivation = Activation.NoEdit;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["StoreGrade"].Header.VisiblePosition = 1;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["StoreGrade"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_StoreGradeSingular);
				ugStockMinMax.DisplayLayout.Bands[0].Columns["DisplayDate"].Header.Caption = " ";
				ugStockMinMax.DisplayLayout.Bands[0].Columns["DisplayDate"].Header.VisiblePosition = 2;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Minimum"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Minimum);
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Minimum"].Width = 80;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Minimum"].Header.VisiblePosition = 3;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Minimum"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Maximum"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Maximum);
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Maximum"].Width = 80;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Maximum"].Header.VisiblePosition = 4;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["Maximum"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				
				//Make some columns readonly.
				ugStockMinMax.DisplayLayout.Bands[0].Columns["StoreGrade"].CellActivation = Activation.NoEdit;
				ugStockMinMax.DisplayLayout.Bands[0].Columns["DisplayDate"].CellActivation = Activation.NoEdit;

				// this basically disables the "store grade" add new box
				ugStockMinMax.DisplayLayout.Bands[0].Override.AllowAddNew = AllowAddNew.No;

				ugStockMinMax.DisplayLayout.Bands[1].Columns["Boundary"].Hidden = true;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["StoreGrade"].Header.VisiblePosition = 1;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["StoreGrade"].Header.Caption = " ";
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].Header.VisiblePosition = 2;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Date_Range);
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].Width = 180;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].CellActivation = Activation.NoEdit;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Minimum"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Minimum);
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Minimum"].Width = 80;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Minimum"].Header.VisiblePosition = 3;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Minimum"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Maximum"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Maximum);
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Maximum"].Width = 80;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Maximum"].Header.VisiblePosition = 4;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["Maximum"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				ugStockMinMax.DisplayLayout.Bands[1].Columns["DateRangeRID"].Hidden = true;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DateRange"].Hidden = true;
				ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;


				//Make some columns readonly.
				ugStockMinMax.DisplayLayout.Bands[1].Columns["StoreGrade"].CellActivation = Activation.NoEdit;

				ugStockMinMax.DisplayLayout.Bands[1].AddButtonCaption = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_AddNewStockMinMax);
				ugStockMinMax.DisplayLayout.Bands[1].AddButtonToolTipText = MIDText.GetTextOnly(eMIDTextCode.tt_AddNewStockMinMax);
				ugStockMinMax.DisplayLayout.AddNewBox.Hidden = false;
				ugStockMinMax.DisplayLayout.AddNewBox.Style = AddNewBoxStyle.Compact;

				if (!_securityStockMinMax.AllowUpdate)
				{
					ugStockMinMax.DisplayLayout.Override.AllowAddNew = AllowAddNew.No;
					ugStockMinMax.DisplayLayout.Override.AllowDelete = Infragistics.Win.DefaultableBoolean.False;
                    ugStockMinMax.DisplayLayout.AddNewBox.Hidden = true;
				}
			}
			catch(Exception ex)
			{
				HandleException(ex);
			}
		}

		private void StockMinMaxTab_Load()
		{
			try
			{
				StockMinMax_Attributes_Populate();
				if (_hnp.Key == Include.NoRID)
				{
					StockMinMax_Populate(_hnp.HomeHierarchyParentRID, false, false);
				}
				else
				{
					StockMinMax_Populate(_hnp.Key, false, false);
				}
				StockMinMax_AttributeSets_Populate(_groupRID);
				
				BuildStockMinMaxContextmenu();
				this.ugStockMinMax.ContextMenu = mnuStockMinMax;

				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugStockMinMax);
                //End TT#169

				_stockMinMaxIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StockMinMax_Define()
		{
			try
			{
                _stockMinMaxDataSet = MIDEnvironment.CreateDataSet("stockMinMaxDataSet");

				DataTable defaultTable = _stockMinMaxDataSet.Tables.Add("Default");

				DataColumn dataColumn;
				//Create Columns and rows for datatable

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Boundary";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				defaultTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "StoreGrade";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				defaultTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				defaultTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
				dataColumn.ColumnName = "Minimum";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				defaultTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
				dataColumn.ColumnName = "Maximum";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				defaultTable.Columns.Add(dataColumn);

				//make set ID the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = defaultTable.Columns["Boundary"];
				defaultTable.PrimaryKey = PrimaryKeyColumn;

				DataTable detailTable = _stockMinMaxDataSet.Tables.Add("Details");

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Boundary";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "StoreGrade";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "DateRangeRID";
				dataColumn.Caption = "Date Range RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Object");
				dataColumn.ColumnName = "DateRange";
				dataColumn.Caption = "Date Range";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
				dataColumn.ColumnName = "Minimum";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
				dataColumn.ColumnName = "Maximum";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				detailTable.Columns.Add(dataColumn);

				_stockMinMaxDataSet.Relations.Add("Details",
					_stockMinMaxDataSet.Tables["Default"].Columns["Boundary"],
					_stockMinMaxDataSet.Tables["Details"].Columns["Boundary"]);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void BuildStockMinMaxContextmenu()
		{
			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuStockMinMax.MenuItems.Clear();
                // End TT#2138
				MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
				MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
				MenuItem mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete));
				MenuItem mnuItemDeleteAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_DeleteAll));
				if (!_securityStockMinMax.AllowUpdate)
				{
					mnuItemDelete.Enabled = false;
					mnuItemDeleteAll.Enabled = false;
				}
				if (!_nodeStockMinMaxesProfile.NodeStockMinMaxsIsInherited)
				{
					mnuStockMinMax.MenuItems.Add(mnuItemDelete);
					mnuStockMinMax.MenuItems.Add(mnuItemDeleteAll);
					mnuStockMinMax.MenuItems.Add("-");
				}
				mnuStockMinMax.MenuItems.Add(mnuItemExpandAll);
				mnuStockMinMax.MenuItems.Add(mnuItemCollapseAll);
				mnuItemDelete.Click += new System.EventHandler(this.mnuSMMItemDelete_Click);
				mnuItemExpandAll.Click += new System.EventHandler(this.mnuSMMItemExpandAll_Click);
				mnuItemCollapseAll.Click += new System.EventHandler(this.mnuSMMItemCollapseAll_Click);
				mnuItemDeleteAll.Click += new System.EventHandler(this.mnuSMMItemDeleteAll_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSMMItemDelete_Click(object sender, System.EventArgs e)
		{
			try
			{
				if (ugStockMinMax.Selected.Rows.Count > 0)
				{
					ugStockMinMax.BeginUpdate();
					ArrayList rowsToDelete = new ArrayList();
					foreach (UltraGridRow gridRow in ugStockMinMax.Selected.Rows)
					{
						if (gridRow.Band.Key == "Default")
						{
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //gridRow.Cells["Minimum"].Value = string.Empty;
                            //gridRow.Cells["Maximum"].Value = string.Empty;
                            gridRow.Cells["Minimum"].Value = DBNull.Value;
                            gridRow.Cells["Maximum"].Value = DBNull.Value;
                            //End TT#169
						}
						else
						{
							rowsToDelete.Add(gridRow);
						}
					}
					foreach (UltraGridRow gridRow in rowsToDelete)
					{
						gridRow.Delete(false);
					}
					_stockMinMaxDataSet.AcceptChanges();
					ugStockMinMax.EndUpdate();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSMMItemDeleteAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				string message = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ConfirmDelete);
				message = message.Replace("{0}", MIDText.GetTextOnly(eMIDTextCode.lbl_Stock_MinMax));
				if (MessageBox.Show (message,  this.Text,
					MessageBoxButtons.YesNo, MessageBoxIcon.Warning)
					== DialogResult.Yes)
				{
					ugStockMinMax.BeginUpdate();
					ArrayList rowsToDelete = new ArrayList();
					foreach (UltraGridRow gridRow in ugStockMinMax.Rows)
					{
						//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //gridRow.Cells["Minimum"].Value = string.Empty;
                        //gridRow.Cells["Maximum"].Value = string.Empty;
                        gridRow.Cells["Minimum"].Value = DBNull.Value;
                        gridRow.Cells["Maximum"].Value = DBNull.Value;
                        //End TT#169

						if (gridRow.HasChild())
						{
							foreach (UltraGridRow childRow in gridRow.ChildBands[0].Rows)
							{
								rowsToDelete.Add(childRow);
							}
						}
					}
					foreach (UltraGridRow childRow in rowsToDelete)
					{
						childRow.Delete(false);
					}
					_stockMinMaxDataSet.AcceptChanges();
					ugStockMinMax.EndUpdate();
					StockMinMaxChangesMade = true;
					_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.delete;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSMMItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStockMinMax.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSMMItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.ugStockMinMax.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StockMinMax_Populate(int aNodeRID, bool doingCopy, bool aCurrentSetOnly)
		{
			try
			{
				if (doingCopy && aCurrentSetOnly)
				{
					int setRID = Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue);
					// remove old values
					NodeStockMinMaxSetProfile minMaxSetProfile = (NodeStockMinMaxSetProfile)_nodeStockMinMaxesProfile.NodeSetList.FindKey(setRID);
					if (minMaxSetProfile != null)
					{
						_nodeStockMinMaxesProfile.NodeSetList.Remove(minMaxSetProfile);
					}
					// add new values
					NodeStockMinMaxesProfile nodeStockMinMaxesProfile = _SAB.HierarchyServerSession.GetStockMinMaxes(aNodeRID);
					minMaxSetProfile = (NodeStockMinMaxSetProfile)nodeStockMinMaxesProfile.NodeSetList.FindKey(setRID);
					if (minMaxSetProfile != null)
					{
						_nodeStockMinMaxesProfile.NodeSetList.Add(minMaxSetProfile);
					}
				}
				else
				{
					_nodeStockMinMaxesProfile = _SAB.HierarchyServerSession.GetStockMinMaxes(aNodeRID);
					if (!_nodeStockMinMaxesProfile.NodeStockMinMaxFound)
					{
						StockMinMax_AttributeSets_Populate(_groupRID);
					}
					else
						if (_groupRID != _nodeStockMinMaxesProfile.NodeStockStoreGroupRID)
					{
						StockMinMax_AttributeSets_Populate(_nodeStockMinMaxesProfile.NodeStockStoreGroupRID);
						_groupRID = _nodeStockMinMaxesProfile.NodeStockStoreGroupRID;
					}
				}
				if (_nodeStockMinMaxesProfile.NodeStockMinMaxFound &&
					_nodeStockMinMaxesProfile.NodeStockStoreGroupRID != Convert.ToInt32(cbSMMStoreAttribute.SelectedValue))
				{
					this.cbSMMStoreAttribute.SelectedValue = _nodeStockMinMaxesProfile.NodeStockStoreGroupRID;
					_groupRID = _nodeStockMinMaxesProfile.NodeStockStoreGroupRID;
				}
				else
				{
					_nodeStockMinMaxesProfile.NodeStockStoreGroupRID = _groupRID;
				}
				
				if (_storeGradeList == null)
				{
					_storeGradeList = _SAB.HierarchyServerSession.GetStoreGradeList(aNodeRID, false, true);
				}

                ProfileList pl = StoreMgmt.StoreGroup_GetLevelListViewList(_nodeStockMinMaxesProfile.NodeStockStoreGroupRID); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_nodeStockMinMaxesProfile.NodeStockStoreGroupRID);
				StoreGroupLevelListViewProfile sglp = (StoreGroupLevelListViewProfile)pl[0];

				StockMinMax_PopulateSet(Convert.ToInt32(sglp.Key), doingCopy);

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityStockMinMax;
					SetControlReadOnly(this.tabStockMinMax, !securityProfile.AllowUpdate);
				}
				if (securityProfile.AllowUpdate)
				{
                    this.ugStockMinMax.DisplayLayout.AddNewBox.Hidden = false;
                }
				else
				{
                    this.ugStockMinMax.DisplayLayout.AddNewBox.Hidden = true;
                }
				
				if (doingCopy)
				{
					_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.update;
					InheritanceProvider.SetError (this.ugStockMinMax,string.Empty);
				}
				else if (_nodeStockMinMaxesProfile.NodeStockMinMaxsIsInherited)
				{
					string inheritMsg = _txtInheritedFrom + _SAB.HierarchyServerSession.GetNodeData(_nodeStockMinMaxesProfile.NodeStockMinMaxsInheritedFromNodeRID, false).Text;
					InheritanceProvider.SetError (this.ugStockMinMax,inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError (this.ugStockMinMax,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StockMinMax_PopulateSet(int aSetRID, bool doingCopy)
		{
			try
			{
                //string minStock = string.Empty, maxStock = string.Empty;
                object minStock = null, maxStock = null;
                NodeStockMinMaxProfile minMaxProfile = null;
				NodeStockMinMaxBoundaryProfile minMaxBoundaryProfile = null;

				this.ugStockMinMax.DataSource = null;
				_StockMinMaxGridBuilt = false;
				StockMinMax_Define();

				NodeStockMinMaxSetProfile minMaxSetProfile = (NodeStockMinMaxSetProfile)_nodeStockMinMaxesProfile.NodeSetList.FindKey(aSetRID);

				// populate default values
				// set default/default
				if (minMaxSetProfile == null)
				{
					_stockMinMaxDataSet.Tables["Default"].Rows.Add(new object[] { Include.Undefined, "Default", "(Default)", 
																					minStock, maxStock});
				}
				else
				{
					minMaxProfile = (NodeStockMinMaxProfile)minMaxSetProfile.Defaults.MinMaxList.FindKey(Include.UndefinedCalendarDateRange);
					if (minMaxProfile != null)
					{
						if (minMaxProfile.Minimum != int.MinValue)
						{
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //minStock = minMaxProfile.Minimum.ToString();
                            minStock = new Int32();
                            minStock = minMaxProfile.Minimum;
                            //End TT#169
						}
						if (minMaxProfile.Maximum != int.MaxValue)
						{
							//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //maxStock = minMaxProfile.Maximum.ToString();
                            maxStock = new Int32();
                            maxStock = minMaxProfile.Maximum;
                            //End TT#169
						}
					}
					_stockMinMaxDataSet.Tables["Default"].Rows.Add(new object[] { Include.Undefined, "Default", "(Default)", 
																					minStock, maxStock});

					// set default date ranges
					foreach(NodeStockMinMaxProfile MMProfile in minMaxSetProfile.Defaults.MinMaxList)
					{
						//Begin TT#1407 - JScott - System Argument error in Node Properties-> Stock min/max tab
						//minStock = string.Empty;
						//maxStock = string.Empty;
						minStock = null;
						maxStock = null;
						//End TT#1407 - JScott - System Argument error in Node Properties-> Stock min/max tab
						if (MMProfile.Key != Include.UndefinedCalendarDateRange)
						{
							if (MMProfile.Minimum != int.MinValue)
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //minStock = minMaxProfile.Minimum.ToString();
                                minStock = new Int32();
                                //minStock = minMaxProfile.Minimum;
                                minStock = MMProfile.Minimum;   // TT#1548 - Selected the min/max tab in Node properties and received a system null reference error.  - GRT
                                //End TT#169
							}
							if (MMProfile.Maximum != int.MaxValue)
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //maxStock = minMaxProfile.Maximum.ToString();
                                maxStock = new Int32();
                                //maxStock = minMaxProfile.Maximum;
                                maxStock = MMProfile.Maximum;   // TT#1548 - Selected the min/max tab in Node properties and received a system null reference error.  - GRT
                                //End TT#169
							}
							DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(MMProfile.Key);
							if (doingCopy)
							{
								if (drp.Name == null ||
									drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
								{
									drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(MMProfile.Key);
								}
							}
							_stockMinMaxDataSet.Tables["Details"].Rows.Add(new object[] { Include.Undefined, string.Empty,
																							MMProfile.Key, drp, drp.DisplayDate,
																							minStock, maxStock});
						}
					}
				}
				
				// populate store grades
				foreach(StoreGradeProfile sgp in _storeGradeList)
				{
                    minStock = null;
                    maxStock = null;
                    if (minMaxSetProfile == null)
					{
						_stockMinMaxDataSet.Tables["Default"].Rows.Add(new object[] { sgp.Boundary, sgp.StoreGrade,
																						"(Default)", minStock, maxStock});
					}
					else
					{
						minMaxBoundaryProfile = (NodeStockMinMaxBoundaryProfile)minMaxSetProfile.BoundaryList.FindKey(sgp.Boundary);
						if (minMaxBoundaryProfile == null)
						{
							_stockMinMaxDataSet.Tables["Default"].Rows.Add(new object[] { sgp.Boundary, sgp.StoreGrade,
																							"(Default)", minStock, maxStock});
						}
						else
						{
							// set default/default
							minMaxProfile = (NodeStockMinMaxProfile)minMaxBoundaryProfile.MinMaxList.FindKey(Include.UndefinedCalendarDateRange);
							if (minMaxProfile != null)
							{
								if (minMaxProfile.Minimum != int.MinValue)
								{
                                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                    //minStock = minMaxProfile.Minimum.ToString();
                                    minStock = new Int32();
                                    minStock = minMaxProfile.Minimum;
                                    //End TT#169
                                }
								if (minMaxProfile.Maximum != int.MaxValue)
								{
                                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                    //maxStock = minMaxProfile.Maximum.ToString();
                                    maxStock = new Int32();
                                    maxStock = minMaxProfile.Maximum;
                                    //End TT#169
                                }
							}
					
							_stockMinMaxDataSet.Tables["Default"].Rows.Add(new object[] { sgp.Boundary, sgp.StoreGrade,
																							"(Default)", minStock, maxStock});

							foreach(NodeStockMinMaxProfile MMProfile in minMaxBoundaryProfile.MinMaxList)
							{
                                minStock = null;
                                maxStock = null;
								if (MMProfile.Key != Include.UndefinedCalendarDateRange)
								{
									if (MMProfile.Minimum != int.MinValue)
									{
                                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                        //minStock = MMProfile.Minimum.ToString();
                                        minStock = new Int32();
                                        minStock = MMProfile.Minimum;
                                        //End TT#169
									}
									if (MMProfile.Maximum != int.MaxValue)
									{
                                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                        //maxStock = MMProfile.Maximum.ToString();
                                        maxStock = new Int32();
                                        maxStock = MMProfile.Maximum;
                                        //End TT#169
									}
									DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(MMProfile.Key);
									if (doingCopy)
									{
										if (drp.Name == null ||
											drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
										{
											drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(MMProfile.Key);
										}
									}
									_stockMinMaxDataSet.Tables["Details"].Rows.Add(new object[] { sgp.Boundary, string.Empty,
																									MMProfile.Key, drp, drp.DisplayDate,
																									minStock, maxStock});
								}
							}
						}
					}
				}
			
				this.ugStockMinMax.DataSource = _stockMinMaxDataSet;

				AttributeSetTag setTag = null;
				if (cbSMMStoreAttributeSet.Tag != null &&
					cbSMMStoreAttributeSet.Tag.GetType() == typeof(AttributeSetTag))
				{
					setTag = (AttributeSetTag)cbSMMStoreAttributeSet.Tag;
				}
				else
				{
					setTag = new AttributeSetTag();
					cbSMMStoreAttributeSet.Tag = setTag;
				}

				setTag.CurrentSetRID = aSetRID;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StockMinMax_Attributes_Populate()
		{
			try
			{
				StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_stockMinMaxGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID);
				_groupRID = storeGroup.Key;

                cbSMMStoreAttribute.Initialize(SAB, _securityStockMinMax, _stockMinMaxGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbSMMStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				_groupRID = storeGroup.Key;
				this.cbSMMStoreAttribute.SelectedValue = storeGroup.Key;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StockMinMax_AttributeSets_Populate(int aGroupRID)
		{
			try
			{
				try
				{
                    ProfileList pl = StoreMgmt.StoreGroup_GetLevelListViewList(aGroupRID); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(aGroupRID);
				
					this.cbSMMStoreAttributeSet.ValueMember = "Key";
					this.cbSMMStoreAttributeSet.DisplayMember = "Name";
					this.cbSMMStoreAttributeSet.DataSource = pl.ArrayList;

					StoreGroupLevelListViewProfile sglp = (StoreGroupLevelListViewProfile)pl[0];
					this.cbSMMStoreAttributeSet.SelectedValue = sglp.Key;
				}
				catch(Exception ex)
				{
					HandleException(ex, "PopulateStoreGLCombo");
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void cbSMMStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			if (_stockMinMaxIsPopulated)
			{
				if (_nodeStockMinMaxesProfile != null)
				{
					if (_nodeStockMinMaxesProfile.NodeSetList.Count > 0 ||
						StockMinMaxChangesMade)
					{
						if (_promptAttributeChange)
						{
							if (ShowWarningPrompt() == DialogResult.Yes)
							{
								_storeAttributeIsChanged = true;
								StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_stockMinMaxGroupList[cbSMMStoreAttribute.SelectedIndex];
								StockMinMax_AttributeSets_Populate(storeGroup.Key);
								_nodeStockMinMaxesProfile.NodeStockStoreGroupRID = storeGroup.Key;
								_groupRID = storeGroup.Key;
								_nodeStockMinMaxesProfile.NodeSetList.Clear();
								_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.delete;
                                ProfileList pl = StoreMgmt.StoreGroup_GetLevelListViewList(storeGroup.Key); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(storeGroup.Key);
								StoreGroupLevelListViewProfile sglp = (StoreGroupLevelListViewProfile)pl[0];
								StockMinMax_PopulateSet(sglp.Key, false);
							}
							else
							{
								//Shut off the prompt so the combo can be reset to original value.
								_promptAttributeChange = false;
								cbSMMStoreAttribute.SelectedValue = _nodeStockMinMaxesProfile.NodeStockStoreGroupRID;
							}
						}
						else
						{
							//Turn the prompt back on.
							_promptAttributeChange = true;
						}
					}
					else
					{
						StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_stockMinMaxGroupList[cbSMMStoreAttribute.SelectedIndex];
						StockMinMax_AttributeSets_Populate(storeGroup.Key);
						_nodeStockMinMaxesProfile.NodeStockStoreGroupRID = storeGroup.Key;
						_groupRID = storeGroup.Key;
					}
				}
			}
		}

        private void cbSMMStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {

        }

        private void cbSMMStoreAttribute_DragDrop(object sender, DragEventArgs e)
        {
            try
            {
                bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

                if (isSuccessfull)
                {
                    ChangePending = true;
                }
            }
            catch (Exception exc)
            {
                HandleException(exc);
            }
        }
		protected DialogResult ShowWarningPrompt()
		{
			
			
			try
			{
				DialogResult drResult;

				drResult = DialogResult.Yes;
				ChangePending = false;
				string message = SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StockMinMaxWarning, true);

				drResult = MessageBox.Show(message,
					"Confirmation",
					MessageBoxButtons.YesNo, MessageBoxIcon.Warning);

				if (drResult == DialogResult.Yes)
				{
					ChangePending = true;
				}

				return drResult;
			}
			catch (Exception ex)
			{
				HandleException(ex, "ShowWarningPrompt");
				return DialogResult.No;
			}	

			
		}

		private void cbSMMStoreAttributeSet_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				if (_stockMinMaxIsPopulated)
				{
					if (_storeAttributeIsChanged)
					{
						if (cbSMMStoreAttributeSet.Tag != null &&
							cbSMMStoreAttributeSet.Tag.GetType() == typeof(AttributeSetTag))
						{
							AttributeSetTag setTag = (AttributeSetTag)cbSMMStoreAttributeSet.Tag;
							setTag.CurrentSetRID = Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue);
						}
						int setRID = Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue);
						StockMinMax_PopulateSet(setRID, false);
					}
					else if (StockMinMaxChangesMade)
					{
						EditMsgs em = new EditMsgs();
						_errors = null;
						if (ValidTabStockMinMax(ref em))
						{
							if (cbSMMStoreAttributeSet.Tag != null &&
								cbSMMStoreAttributeSet.Tag.GetType() == typeof(AttributeSetTag))
							{
								AttributeSetTag setTag = (AttributeSetTag)cbSMMStoreAttributeSet.Tag;
								if (setTag != null &&
									setTag.CurrentSetRID != Include.NoRID)
								{
									UpdateStockMinMaxData(setTag.CurrentSetRID);
								}
							}
							int setRID = Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue);
							StockMinMax_PopulateSet(setRID, false);
						}
						else
						{
							if (em.EditMessages.Count == 1)
							{
								EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[0];
								AddErrorMessage(emm);
							}
							else
							{
								AddErrorMessage(eMIDTextCode.msg_ErrorsFoundReviewCorrect);
							}
							MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
					else
					{
						if (cbSMMStoreAttributeSet.Tag != null &&
							cbSMMStoreAttributeSet.Tag.GetType() == typeof(AttributeSetTag))
						{
							AttributeSetTag setTag = (AttributeSetTag)cbSMMStoreAttributeSet.Tag;
							setTag.CurrentSetRID = Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue);
							StockMinMax_PopulateSet(setTag.CurrentSetRID, false);
						}
					}
				}
			}
			catch
			{
			}
			finally
			{
				_storeAttributeIsChanged = false;
			}
		}

		private void ugStockMinMax_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_stockMinMaxIsPopulated)
				{
					StockMinMaxChangesMade = true;
					InheritanceProvider.SetError (this.ugStockMinMax,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_AfterRowInsert(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
			}
			catch(Exception err)
			{
				HandleException(err);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void ugStockMinMax_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_securityStockMinMax.AllowUpdate)
				{
					CalendarDateSelector frmCalDtSelector = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[]{_SAB});
					frmCalDtSelector.AllowReoccurring = false;
					frmCalDtSelector.AllowDynamic = false;
					frmCalDtSelector.AllowDynamicToStoreOpen = false;
					frmCalDtSelector.RestrictToSingleDate = false;

					if (e.Cell.Row.Cells["DateRangeRID"].Value != null &&
						e.Cell.Row.Cells["DateRangeRID"].Value != System.DBNull.Value)
					{
						frmCalDtSelector.DateRangeRID = Convert.ToInt32(e.Cell.Row.Cells["DateRangeRID"].Value, CultureInfo.CurrentUICulture);
					}
					DialogResult DateRangeResult = frmCalDtSelector.ShowDialog();
					if (DateRangeResult == DialogResult.OK)
					{
						DateRangeProfile SelectedDateRange = (DateRangeProfile)frmCalDtSelector.Tag;
						e.Cell.Value = SelectedDateRange.DisplayDate;
						e.Cell.Row.Cells["DateRangeRID"].Value = SelectedDateRange.Key;
						e.Cell.Row.Cells["DateRange"].Value = SelectedDateRange;
						if (SelectedDateRange.DateRangeType == eCalendarRangeType.Dynamic)
						{
							if (SelectedDateRange.RelativeTo == eDateRangeRelativeTo.Plan)
								e.Cell.Appearance.Image = DynamicToPlanImage;
							else
								e.Cell.Appearance.Image = DynamicToCurrentImage;
						}
						else
						{
							e.Cell.Appearance.Image = null;
						}
						StockMinMaxChangesMade = true;
					}
				}
			}
			catch(Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_AfterRowsDeleted(object sender, System.EventArgs e)
		{
			try
			{
				if (_stockMinMaxIsPopulated)
				{
					StockMinMaxChangesMade = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				if (_securityStockMinMax.AllowUpdate)
				{
					ObjectDragEnter(e);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityStockMinMax.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        // make sure data is compatible
                        NodeStockMinMaxesProfile nodeStockMinMaxesProfile = _SAB.HierarchyServerSession.GetStockMinMaxes(cbList.ClipboardProfile.Key);
                        if (nodeStockMinMaxesProfile.NodeStockMinMaxFound &&
                            nodeStockMinMaxesProfile.NodeStockStoreGroupRID != _nodeStockMinMaxesProfile.NodeStockStoreGroupRID)
                        {
                            MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreGroupDoesNotMatch));
                            return;
                        }

                        bool storeGradesMatch = true;
                        if (_storeGradeList == null)
                        {
                            _storeGradeList = _SAB.HierarchyServerSession.GetStoreGradeList(_nodeRID, false, true);
                        }
                        StoreGradeList storeGradeList = _SAB.HierarchyServerSession.GetStoreGradeList(cbList.ClipboardProfile.Key, false, true);
                        if (storeGradeList.Count != _storeGradeList.Count)
                        {
                            storeGradesMatch = false;
                        }
                        else
                        {
                            for (int i = 0; i < storeGradeList.Count; i++)
                            {
                                if (((StoreGradeProfile)storeGradeList[i]).Boundary != ((StoreGradeProfile)_storeGradeList[i]).Boundary ||
                                    ((StoreGradeProfile)storeGradeList[i]).StoreGrade != ((StoreGradeProfile)_storeGradeList[i]).StoreGrade)
                                {
                                    storeGradesMatch = false;
                                    break;
                                }
                            }
                        }

                        if (!storeGradesMatch)
                        {
                            MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreGradesDoNotMatch));
                        }

                        DialogResult dialogResult = MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_OnlyCopyCurrentSet), this.Text,
                            MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question);
                        bool currentSet = true;
                        switch (dialogResult)
                        {
                            case DialogResult.Cancel:
                                return;
                            case DialogResult.No:
                                currentSet = false;
                                break;
                        }

                        StockMinMax_Populate(cbList.ClipboardProfile.Key, true, currentSet);
                        StockMinMaxChangesMade = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugStockMinMax.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugStockMinMax.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugStockMinMax, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStockMinMax_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugStockMinMax, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool ValidTabStockMinMax(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;
				bool errorFound = false;
				int min = 0, max = 0;
				
				foreach (UltraGridRow gridRow in ugStockMinMax.Rows)
				{
					if (!ValidStockValue(gridRow.Cells["Minimum"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						errorFound = true;
					}
					if (!ValidStockValue(gridRow.Cells["Maximum"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						errorFound = true;
					}
					if (!errorFound)
					{
						if (gridRow.Cells["Minimum"].Text.Length > 0 &&
							gridRow.Cells["Maximum"].Text.Length > 0)
						{
							min = Convert.ToInt32(gridRow.Cells["Minimum"].Value, CultureInfo.CurrentUICulture);
							max = Convert.ToInt32(gridRow.Cells["Maximum"].Value, CultureInfo.CurrentUICulture);
							if (max < min)
							{
								errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MaxGEMin);
								em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								gridRow.Cells["Minimum"].Appearance.Image = ErrorImage;
								gridRow.Cells["Minimum"].Tag = errorMessage;
								gridRow.Cells["Maximum"].Appearance.Image = ErrorImage;
								gridRow.Cells["Maximum"].Tag = errorMessage;
								errorFound = true;
							}
						}
					}

					if (gridRow.HasChild())
					{
						foreach (UltraGridRow childRow in gridRow.ChildBands[0].Rows)
						{
							if (!ValidDateRange(childRow.Cells["DateRangeRID"], ref errorMessage))
							{
								em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								errorFound = true;
							}
							if (!ValidStockValue(childRow.Cells["Minimum"], ref errorMessage))
							{
								em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								errorFound = true;
							}
							if (!ValidStockValue(childRow.Cells["Maximum"], ref errorMessage))
							{
								em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
								errorFound = true;
							}
							if (!errorFound)
							{
								if (childRow.Cells["Minimum"].Text.Length > 0 &&
									childRow.Cells["Maximum"].Text.Length > 0)
								{
									min = Convert.ToInt32(childRow.Cells["Minimum"].Value, CultureInfo.CurrentUICulture);
									max = Convert.ToInt32(childRow.Cells["Maximum"].Value, CultureInfo.CurrentUICulture);
									if (max < min)
									{
										errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MaxGEMin);
										em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
										childRow.Cells["Minimum"].Appearance.Image = ErrorImage;
										childRow.Cells["Minimum"].Tag = errorMessage;
										childRow.Cells["Maximum"].Appearance.Image = ErrorImage;
										childRow.Cells["Maximum"].Tag = errorMessage;
										errorFound = true;
									}
								}
							}
						}

					}
				}	
					
				if (errorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch (Exception ex)
			{
				HandleException(ex);
				return false; 
			}
		}

		private bool ValidStockValue (UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			int intValue;
			try
			{
				if (gridCell.Value != System.DBNull.Value &&
					gridCell.Text.Length > 0)
				{
					intValue = Convert.ToInt32(gridCell.Value.ToString(), CultureInfo.CurrentUICulture);
					if (intValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					{
						gridCell.Value  = intValue;
					}
				}

			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool ValidDateRange (UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Value == System.DBNull.Value)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Row.Cells["DisplayDate"].Appearance.Image = ErrorImage;
				gridCell.Row.Cells["DisplayDate"].Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Row.Cells["DisplayDate"].Tag = null;
				return true;
			}
		}

		private void cbxSMMInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				StockMinMaxChangesMade = true;
			}
		}

		private void cbxSMMApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				StockMinMaxChangesMade = true;
			}
		}

		#endregion Stock Min/Max Tab

		#region Store Capacity Tab

		private void ugStoreCapacity_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_storeCapacityGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.capacityGrid);
					if (layout.LayoutLength > 0)
					{
						ugStoreCapacity.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultCapacityGridLayout();
					}
					this.ugStoreCapacity.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
					this.ugStoreCapacity.DisplayLayout.Bands["Sets"].Columns["Max Capacity"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Capacity);
					this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
					this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Max Capacity"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Capacity);
					this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Inherited"].Hidden = true;
					this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Inherited RID"].Hidden = true;
					this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Store"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
					_storeCapacityGridBuilt = true;
				}

				if (!this._securityCapacity.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugStoreCapacity.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugStoreCapacity.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultCapacityGridLayout()
		{
			try
			{
				this.ugStoreCapacity.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugStoreCapacity.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugStoreCapacity.DisplayLayout.AddNewBox.Hidden = true;
				this.ugStoreCapacity.DisplayLayout.GroupByBox.Hidden = true;
				this.ugStoreCapacity.DisplayLayout.GroupByBox.Prompt = " ";
				this.ugStoreCapacity.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugStoreCapacity.DisplayLayout.Bands["Sets"].Columns["SetID"].Width = 75;
				this.ugStoreCapacity.DisplayLayout.Bands["Sets"].Columns["Max Capacity"].Width = 100;
				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Store"].Width = 75;
				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Max Capacity"].Width = 100;
				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugStoreCapacity);
                //End TT#169

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreCapacityTab_Load()
		{
			try
			{
				StoreCapacity_Attributes_Populate();
			
				if (_hnp.Key == Include.NoRID)
				{
					_storeCapacityList = _SAB.HierarchyServerSession.GetStoreCapacityList(_storeList, _hnp.HomeHierarchyParentRID, false, false);
				}
				else
				{
					_storeCapacityList = _SAB.HierarchyServerSession.GetStoreCapacityList(_storeList, _hnp.Key, false, false);
				}
				StoreCapacity_Populate(false);
				this.ugStoreCapacity.DisplayLayout.Bands["Sets"].Columns["Max Capacity"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Updated"].Hidden = true;
				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["SetID"].Hidden = true;
				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Store RID"].Hidden = true;
				this.ugStoreCapacity.DisplayLayout.Bands["Stores"].Columns["Max Capacity"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				BuildStoreCapacityContextmenu();
				this.ugStoreCapacity.ContextMenu = mnuStoreCapacityGrid;

				ugStoreCapacity.ActiveRow = ugStoreCapacity.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);

				_storeCapacityIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreCapacity_Attributes_Populate()
		{
			try
			{
				StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_storeCapacityGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.AllocationStoreGroupRID);
				_groupRID = storeGroup.Key;

                cbSCStoreAttribute.Initialize(SAB, _securityCapacity, _storeCapacityGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbSCStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				_groupRID = storeGroup.Key;
				this.cbSCStoreAttribute.SelectedValue = storeGroup.Key;
                _storeCapacityGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void BuildStoreCapacityContextmenu()
		{
			try
			{
				mnuStoreCapacityGrid.MenuItems.Clear();
				MenuItem mnuItemApply = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Apply));
				MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
				MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
				MenuItem mnuItemClear = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Clear_Values));
				MenuItem mnuItemReset = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Reset_Messages));
				if (!_securityCapacity.AllowUpdate)
				{
					mnuItemApply.Enabled = false;
					mnuItemClear.Enabled = false;
					mnuItemReset.Enabled = false;
				}

				mnuStoreCapacityGrid.MenuItems.Add(mnuItemApply);
				mnuStoreCapacityGrid.MenuItems.Add(mnuItemClear);
				mnuStoreCapacityGrid.MenuItems.Add("-");
				mnuStoreCapacityGrid.MenuItems.Add(mnuItemExpandAll);
				mnuStoreCapacityGrid.MenuItems.Add(mnuItemCollapseAll);
				mnuItemApply.Click += new System.EventHandler(this.mnuSCItemApply_Click);
				mnuItemExpandAll.Click += new System.EventHandler(this.mnuSCItemExpandAll_Click);
				mnuItemCollapseAll.Click += new System.EventHandler(this.mnuSCItemCollapseAll_Click);
				mnuItemClear.Click += new System.EventHandler(this.mnuSCItemClear_Click);
				mnuItemReset.Click += new System.EventHandler(this.mnuSCItemReset_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSCItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuSCItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSCItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSCItemDelete_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSCItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugStoreCapacity.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSCItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugStoreCapacity.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuStoreCapacityGrid_Popup(object sender, System.EventArgs e)
		{
			try
			{
				if (_securityCapacity.AllowUpdate)
				{
					if (this.ugStoreCapacity.ActiveRow == null ||
						this.ugStoreCapacity.ActiveRow.Band.Key != "Sets")
					{
						mnuStoreCapacityGrid.MenuItems[0].Enabled = false;	// apply
					}
					else
					{
						mnuStoreCapacityGrid.MenuItems[0].Enabled = true;	// apply
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSCItemApply_Click(object sender, System.EventArgs e)
		{
			string errorMessage = null;
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (ugStoreCapacity.ActiveRow == null)
				{
					this.Cursor = Cursors.Default;
					MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					if (ugStoreCapacity.ActiveCell != null)
					{
						ugStoreCapacity.ActiveCell.Row.Update();
					}

					Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreCapacity.ActiveRow.Band;
					Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreCapacity.ActiveRow;

					if (!CapacityCellValid(activeRow.Cells["Max Capacity"], ref errorMessage))
					{
						this.Cursor = Cursors.Default;
						MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
					else
					{
						Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
						string setid = (string)activeRow.Cells["SetID"].Value;
						if (activeRowBand.Key == "Sets")		// apply values to all stores in set
						{
							ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
								storeRow.Cells["Updated"].Value = true;
								storeRow.Cells["Max Capacity"].Value = activeRow.Cells["Max Capacity"].Value;
								storeRow.Cells["Store"].Appearance.Image = null;
								storeRow.Cells["Store"].Tag = null;
							}
							_storeCapacityDataSet.AcceptChanges();
							StoreCapacityChangesMade = true;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSCItemClear_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreCapacity.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreCapacity.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				if (activeRowBand.Key == "Sets")		// apply values to all stores in set
				{
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if (!Convert.IsDBNull(storeRow.Cells["Max Capacity"].Value))
						{
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //if ((string)storeRow.Cells["Max Capacity"].Value != string.Empty)
                            //{
                            //End TT#169
                            storeRow.Cells["Updated"].Value = true;
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //storeRow.Cells["Max Capacity"].Value = string.Empty;
                            storeRow.Cells["Max Capacity"].Value = System.DBNull.Value;
                            //End TT#169
                            storeRow.Cells["Store"].Appearance.Image = null;
                            storeRow.Cells["Store"].Tag = null;
                            StoreCapacityChangesMade = true;
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //}
                            //End TT#169
                        }
					}
				
				}
				else
					if (activeRowBand.Key == "Stores")		// clear store value
				{
					if (!Convert.IsDBNull(activeRow.Cells["Max Capacity"].Value))
					{
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //if ((string)activeRow.Cells["Max Capacity"].Value != string.Empty)
                        //{
                        //End TT#169
                        activeRow.Cells["Updated"].Value = true;
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //activeRow.Cells["Max Capacity"].Value = string.Empty;
                        activeRow.Cells["Max Capacity"].Value = System.DBNull.Value;
                        //End TT#169
                        StoreCapacityChangesMade = true;
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //}
                        //End TT#169
                    }
				}
				_storeCapacityDataSet.AcceptChanges();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSCItemReset_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugStoreCapacity.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugStoreCapacity.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				if (activeRowBand.Key == "Sets")		// apply values to all stores in set
				{
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRow.Cells["Updated"].Tag = null;
						storeRow.Cells["Max Capacity"].Appearance.Image = null;
					}
				
				}
				else
					if (activeRowBand.Key == "Stores")		// clear store value
				{
					activeRow.Cells["Max Capacity"].Tag = null;
					activeRow.Cells["Max Capacity"].Appearance.Image = null;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void StoreCapacity_Define()
		{
			try
			{
                _storeCapacityDataSet = MIDEnvironment.CreateDataSet("storeCapacityDataSet");

				DataTable setTable = _storeCapacityDataSet.Tables.Add("Sets");

				DataColumn dataColumn;
				//Create Columns and rows for datatable

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
                dataColumn.ColumnName = "Max Capacity";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				//make set ID the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = setTable.Columns["SetID"];
				setTable.PrimaryKey = PrimaryKeyColumn;

				DataTable storeTable = _storeCapacityDataSet.Tables.Add("Stores");

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Inherited";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Inherited RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Updated";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Store RID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = true;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Store";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Int32");
                //End TT#169
                dataColumn.ColumnName = "Max Capacity";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				_storeCapacityDataSet.Relations.Add("Stores",
					_storeCapacityDataSet.Tables["Sets"].Columns["SetID"],
					_storeCapacityDataSet.Tables["Stores"].Columns["SetID"]);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void StoreCapacity_Populate(bool doingCopy)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				bool updated = false;
				bool isInherited = false;
				int inheritedRID = Include.NoRID;
				StoreCapacityProfile scp;
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //string capacity;
                object capacity;
                //End TT#169

				StoreCapacity_Define();

				foreach(StoreGroupLevelListViewProfile sglp in _storeCapacityGroupLevelList)
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //_storeCapacityDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, string.Empty});
                    _storeCapacityDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, null });
                    //End TT#169
					foreach(StoreProfile storeProfile in sglp.Stores)
					{
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //capacity = string.Empty;
                        capacity = null;
                        //End TT#169
                        updated = false;
						isInherited = false;
						inheritedRID = Include.NoRID;
						if (_storeCapacityList.Contains(storeProfile.Key))
						{
							scp = (StoreCapacityProfile)_storeCapacityList.FindKey(storeProfile.Key);
							isInherited = scp.StoreCapacityIsInherited;
							inheritedRID = scp.StoreCapacityInheritedFromNodeRID;
							if (scp.StoreCapacity > Include.Undefined)
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //capacity = scp.StoreCapacity.ToString(CultureInfo.CurrentUICulture);
                                capacity = new Int32();
                                capacity = scp.StoreCapacity;
                                //ENd TT#169
                                if (doingCopy ||
									scp.StoreCapacityChangeType != eChangeType.none)
								{
									updated = true;
								}
							}
						}
				
						_storeCapacityDataSet.Tables["Stores"].Rows.Add(new object[] { sglp.Name, isInherited, inheritedRID, 
																						 updated, storeProfile.Key, storeProfile.Text, capacity});
					}
				}
				ugStoreCapacity.DataSource = _storeCapacityDataSet;
				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityCapacity;
					SetControlReadOnly(this.tabStoreCapacity, !securityProfile.AllowUpdate);
				}
				StoreCapacity_SetRowProperties(securityProfile);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void StoreCapacity_SetRowProperties(FunctionSecurityProfile securityProfile)
		{
			try
			{
				HierarchyNodeProfile hnp = null;
				int inheritedRID;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				foreach(  UltraGridRow setRow in this.ugStoreCapacity.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if(storeRow.Cells["Inherited"].Text == "True")
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = _SAB.HierarchyServerSession.GetNodeData(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Store"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Store"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Store"].Appearance.Image = null;
							storeRow.Cells["Store"].Tag = null;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void ugStoreCapacity_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugStoreCapacity.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugStoreCapacity.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugStoreCapacity, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
        private void ugStoreCapacity_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            if (e.Cell.Row.Band.Key == "Stores")
            {
                if (e.Cell != e.Cell.Row.Cells["Updated"])
                {
                    // create the change profile and add it to the list
                    ChangeProfileSC scChange = new ChangeProfileSC(
                        Convert.ToInt16(e.Cell.Row.Cells["Store RID"].Value), // storeRID
                        e.Cell.Row.Cells["Store"].Value.ToString(), // storeID
                        e.Cell.Text.ToString(), // new value
                        e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                        e.Cell.Column.Header.Caption.ToString(),
                        e.Cell.Column.Index
                    );

                    // create keyvaluepair and populate
                    KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(scChange.ChangeProfileKey, scChange);

                    //  add to nodechangeprofile list
                    _nodeChangeProfile.Add(eProfileType.StoreCapacity, _kvp);
                }
            }
        }
        //  END TT#2015 - gtaylor - apply changes to lower levels

		private void ugStoreCapacity_BeforeCellActivate(object sender, Infragistics.Win.UltraWinGrid.CancelableCellEventArgs e)
		{
			try
			{
				if (_storeCapacityIsPopulated)
				{
					if (e.Cell.Column.Key == "Max Capacity")
					{
						_priorCapacityValue = e.Cell.Value;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}
		
		private void ugStoreCapacity_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = e.Cell.Row.Band;
				_cancelUpdate = false;
				if (_storeCapacityIsPopulated)
				{
					if (e.Cell.Column.Key == "Max Capacity" &&
						e.Cell.Band.Key == "Stores" &&
						e.Cell.Row.Cells["Inherited"].Text == "True" &&
						e.Cell.Text.Length == 0)
					{
						if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DeleteInheritedCapacityUseZero),  this.Text,
							MessageBoxButtons.YesNo, MessageBoxIcon.Warning)
							== DialogResult.Yes)
						{
							e.Cell.Value = 0;
							e.Cell.Row.Cells["Updated"].Value = true;
							e.Cell.Row.Cells["Store"].Appearance.Image = null;
							e.Cell.Row.Cells["Store"].Tag = null;
							StoreCapacityChangesMade = true;
						}
						else
						{
							e.Cell.Value = _priorCapacityValue;
							_cancelUpdate = true;
						}
					}
					else
						if (activeRowBand.Key == "Stores")		// only mark changes to stores as updated
					{
						e.Cell.Row.Cells["Updated"].Value = true;
						e.Cell.Row.Cells["Store"].Appearance.Image = null;
						e.Cell.Row.Cells["Store"].Tag = null;
						StoreCapacityChangesMade = true;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreCapacity_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (ugStoreCapacity.ActiveCell != null)
					{					
						if (ugStoreCapacity.ActiveCell.Column.Key == "Max Capacity")
						{
							if (!CapacityCellValid(ugStoreCapacity.ActiveCell, ref errorMessage))
							{
								MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
							}
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreCapacity_BeforeCellUpdate(object sender, Infragistics.Win.UltraWinGrid.BeforeCellUpdateEventArgs e)
		{
			try
			{
				if (_cancelUpdate)
				{
					e.Cancel = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool CapacityCellValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (Convert.IsDBNull(gridCell.Value))	// cell is empty
				{
				}
				else
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if ((string)gridCell.Value != string.Empty)
                    if (gridCell.Value != null)
                    //End TT#169
                {
					int capacityValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (capacityValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				_focusCell = gridCell;
				ugStoreCapacity.ActiveRow = gridCell.Row;
				ugStoreCapacity.ActiveCell = gridCell;
				ugStoreCapacity.ActiveCell.Activate();
				ugStoreCapacity.PerformAction(Infragistics.Win.UltraWinGrid.UltraGridAction.EnterEditMode, false, false);
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private void ugStoreCapacity_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugStoreCapacity, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void cbSCStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				EditMsgs em = new EditMsgs();
		
				if (_storeCapacityIsPopulated)
				{
					if (ValidTabStoreCapacity (ref em))
					{
						UpdateCapacityData();
						StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_storeCapacityGroupList[cbSCStoreAttribute.SelectedIndex];
						_groupRID = storeGroup.Key;
                        _storeCapacityGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
						StoreCapacity_Populate(false);
					}
					else
					{
						if (Convert.ToInt32(cbSCStoreAttribute.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
						{
							cbDPStoreAttribute.SelectedValue = _groupRID;
							for (int i=0; i<em.EditMessages.Count; i++)
							{
								EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
								AddErrorMessage(emm);
							}
							MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        private void cbSCStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {

        }

        private void cbSCStoreAttribute_DragDrop(object sender, DragEventArgs e)
        {
            try
            {
                bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

                if (isSuccessfull)
                {
                    ChangePending = true;
                }
            }
            catch (Exception exc)
            {
                HandleException(exc);
            }
        }

		private void ugStoreCapacity_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityCapacity.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        _storeCapacityList = _SAB.HierarchyServerSession.GetStoreCapacityList(_storeList, cbList.ClipboardProfile.Key, false, false);
                        StoreCapacity_Populate(true);
                        StoreCapacityChangesMade = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreCapacity_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool ValidTabStoreCapacity(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				string errorMessage = null;
				bool foundBlankCapacity = false;
				bool foundNonBlankCapacity = false;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;

				foreach(  UltraGridRow setRow in this.ugStoreCapacity.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //if (storeRow.Cells["Max Capacity"].Text.Length == 0 ||
                        //    (string)storeRow.Cells["Max Capacity"].Value == string.Empty)
                        if (storeRow.Cells["Max Capacity"].Value == null)
                        //End TT#169
                        {
							foundBlankCapacity = true;
						}
						else
						{
							if (!CapacityCellValid(storeRow.Cells["Max Capacity"], ref errorMessage))
							{
								em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
							}
							else
							{
								foundNonBlankCapacity = true;
							}
						}
					}
				}

				if (foundNonBlankCapacity &&
					foundBlankCapacity)
				{
					if (MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_CapacitySaveWarning),  this.Text,
						MessageBoxButtons.YesNo, MessageBoxIcon.Warning)
						== DialogResult.No) 
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_EnterCapacityValues);
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
						foreach(  UltraGridRow setRow in this.ugStoreCapacity.Rows )
						{
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //if (storeRow.Cells["Max Capacity"].Text.Length == 0 ||
                                //    (string)storeRow.Cells["Max Capacity"].Value == string.Empty)
                                if (storeRow.Cells["Max Capacity"].Value == null)
                                //End TT#169
                                {
									storeRow.Cells["Max Capacity"].Appearance.Image = ErrorImage;
									storeRow.Cells["Max Capacity"].Tag = errorMessage;
								}
							}
						}
					}
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				em.AddMsg(eMIDMessageLevel.Error, exception.Message,  this.ToString());
				HandleException(exception);
			}
			
			return false;
		}

		#endregion Store Capacity Tab

		#region Velocity Grades Tab

		private void ugVelocityGrades_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_velocityGradesGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.velocityGradeGrid);
					if (layout.LayoutLength > 0)
					{
						ugVelocityGrades.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        //End TT#169

						DefaultVelocityGradesGridLayout();
					}
					this.ugVelocityGrades.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
					this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["RowPosition"].Hidden = true;
					this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Grade);
					this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Boundary"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
									
					_velocityGradesGridBuilt = true;
				}

				if (!_securityVelocity.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugVelocityGrades.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugVelocityGrades.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultVelocityGradesGridLayout()
		{
			try
			{
				this.ugVelocityGrades.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugVelocityGrades.DisplayLayout.Override.AllowColSizing = Infragistics.Win.UltraWinGrid.AllowColSizing.Default;
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				//this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Width = 75;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Left;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Width = 40;
				//End TT#505 - JScott - Velocity - Apply Min/Max
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Boundary"].Width = 75;
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Stock"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Right;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Width = 90;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Max Stock"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Right;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Width = 90;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Ad"].CellAppearance.TextHAlign = Infragistics.Win.HAlign.Right;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Width = 65;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Nullable = Infragistics.Win.UltraWinGrid.Nullable.Null;

				int colScrollWidth = this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Width;
				colScrollWidth += this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Boundary"].Width;

				this.ugVelocityGrades.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugVelocityGrades.DisplayLayout.MaxColScrollRegions = 2;
				this.ugVelocityGrades.DisplayLayout.ColScrollRegions[0].Width = colScrollWidth;
				this.ugVelocityGrades.DisplayLayout.ColScrollRegions[0].Split(this.ugVelocityGrades.DisplayLayout.ColScrollRegions[0].Width);
				//End TT#505 - JScott - Velocity - Apply Min/Max
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_sellThruPctsGridBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.sellThruPctsGrid);
					if (layout.LayoutLength > 0)
					{
						ugSellThruPcts.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultSellThruPctsGridLayout();
					}
					this.ugSellThruPcts.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
					this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["RowPosition"].Hidden = true;

                    this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].Header.VisiblePosition = 0;
					this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sell_Thru_Pct);
                    this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].Width = this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].CalculateAutoResizeWidth(1, true);
                    this.ugSellThruPcts.Width = this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].Width + 85;

					_sellThruPctsGridBuilt = true;
				}

				if (!_securityVelocity.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugSellThruPcts.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugSellThruPcts.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultSellThruPctsGridLayout()
		{
			try
			{
				this.ugSellThruPcts.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugSellThruPcts.DisplayLayout.Override.AllowColSizing = Infragistics.Win.UltraWinGrid.AllowColSizing.Default;
				this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugSellThruPcts.DisplayLayout.Bands[0].Columns["Sell Thru %"].Width = 75;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void VelocityGradesTab_Load()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (_hnp.Key == Include.NoRID)
				{
					TabVelocityGrades_Populate(_hnp.HomeHierarchyParentRID);
				}
				else
				{
					TabVelocityGrades_Populate(_hnp.Key);
				}

				this.ugVelocityGrades.DisplayLayout.GroupByBox.Hidden = true;
				this.ugVelocityGrades.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugVelocityGrades.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugVelocityGrades.DisplayLayout.Bands[0].AddButtonCaption = "Velocity Grade";
				//Begin TT#505 - JScott - Velocity - Apply Min/Max

				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Header.ExclusiveColScrollRegion = this.ugVelocityGrades.DisplayLayout.ColScrollRegions[0];
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Boundary"].Header.ExclusiveColScrollRegion = this.ugVelocityGrades.DisplayLayout.ColScrollRegions[0];

				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Grade"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Grade);
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Boundary"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Stock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Stock);
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Max Stock"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Stock);
				this.ugVelocityGrades.DisplayLayout.Bands[0].Columns["Min Ad"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Ad);
				//End TT#505 - JScott - Velocity - Apply Min/Max

				this.ugSellThruPcts.DisplayLayout.GroupByBox.Hidden = true;
				this.ugSellThruPcts.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugSellThruPcts.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
                this.ugSellThruPcts.DisplayLayout.Bands[0].AddButtonCaption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sell_Thru_Pct);

				this.ugVelocityGrades.DisplayLayout.Bands[0].Override.TipStyleRowConnector = TipStyle.Show;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Override.TipStyleScroll = TipStyle.Show;
				this.ugVelocityGrades.DisplayLayout.Bands[0].Override.TipStyleCell = TipStyle.Show;
			

				BuildVelocityGradesContextmenu();
				this.ugVelocityGrades.ContextMenu = mnuVelocityGradesGrid;

				BuildSellThruPctsContextmenu();
				this.ugSellThruPcts.ContextMenu = mnuSellThruPctsGrid;

				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugVelocityGrades);
                //End TT#169

				_velocityGradesIsPopulated = true;
				_sellThruPctsIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}


		private void VelocityGrades_Define()
		{
			try
			{
				_velocityGradesDataTable = MIDEnvironment.CreateDataTable("VelocityGradesDataTable");
			
				DataColumn dataColumn;

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "RowPosition";
				dataColumn.Caption = "RowPosition";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Grade";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Grade);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = true;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Boundary";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Boundary);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Min Stock";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Stock);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Max Stock";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Max_Stock);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Min Ad";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Min_Ad);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				dataColumn.AllowDBNull = true;
				_velocityGradesDataTable.Columns.Add(dataColumn);

				//End TT#505 - JScott - Velocity - Apply Min/Max
				//make grade column the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = _velocityGradesDataTable.Columns["Grade"];
				_velocityGradesDataTable.PrimaryKey = PrimaryKeyColumn;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void SellThruPcts_Define()
		{
			try
			{
				_sellThruPctsDataTable = MIDEnvironment.CreateDataTable("SellThruPctsDataTable");
			
				DataColumn dataColumn;
				//Create Columns and rows for datatable
			
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "RowPosition";
				dataColumn.Caption = "RowPosition";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				_sellThruPctsDataTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Sell Thru %";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Sell_Thru_Pct);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				_sellThruPctsDataTable.Columns.Add(dataColumn);

				//make grade column the primary key
				DataColumn[] PrimaryKeyColumn = new DataColumn[1];
				PrimaryKeyColumn[0] = _sellThruPctsDataTable.Columns["Sell Thru %"];
				_sellThruPctsDataTable.PrimaryKey = PrimaryKeyColumn;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void BuildVelocityGradesContextmenu()
		{
			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuVelocityGradesGrid.MenuItems.Clear();
                // End TT#2138
				MenuItem mnuItemInsert = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert));
				MenuItem mnuItemInsertBefore = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_Before));
				MenuItem mnuItemInsertAfter = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_after));
				MenuItem mnuItemCut= new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Cut));
				MenuItem mnuItemCopy = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Copy));
				MenuItem mnuItemPaste = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Paste));
				MenuItem mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete));
				MenuItem mnuItemDeleteAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_DeleteAll));
				if (!_securityVelocity.AllowUpdate)
				{
					mnuItemInsert.Enabled = false;
					mnuItemInsertBefore.Enabled = false;
					mnuItemInsertAfter.Enabled = false;
					mnuItemCut.Enabled = false;
					mnuItemCopy.Enabled = false;
					mnuItemPaste.Enabled = false;
					mnuItemDelete.Enabled = false;
					mnuItemDeleteAll.Enabled = false;
				}
				mnuVelocityGradesGrid.MenuItems.Add(mnuItemInsert);
				mnuItemInsert.MenuItems.Add(mnuItemInsertBefore);
				mnuItemInsert.MenuItems.Add(mnuItemInsertAfter);
				mnuVelocityGradesGrid.MenuItems.Add(mnuItemDelete);
				mnuVelocityGradesGrid.MenuItems.Add(mnuItemDeleteAll);
				mnuItemInsert.Click += new System.EventHandler(this.mnuVGItemInsert_Click);
				mnuItemInsertBefore.Click += new System.EventHandler(this.mnuVGItemInsertBefore_Click);
				mnuItemInsertAfter.Click += new System.EventHandler(this.mnuVGItemInsertAfter_Click);
				mnuItemCut.Click += new System.EventHandler(this.mnuVGItemCut_Cut);
				mnuItemCopy.Click += new System.EventHandler(this.mnuVGItemCopy_Click);
				mnuItemPaste.Click += new System.EventHandler(this.mnuVGItemPaste_Click);
				mnuItemDelete.Click += new System.EventHandler(this.mnuVGItemDelete_Click);
				mnuItemDeleteAll.Click += new System.EventHandler(this.mnuVGItemDeleteAll_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuVGItemInsert_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuVGItemInsertBefore_Click(object sender, System.EventArgs e)
		{
            try
			{
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                if (ugVelocityGrades.Rows.Count > 0 &&
                    ugVelocityGrades.ActiveRow != null)
                {
                    Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugVelocityGrades.ActiveRow;
                    int rowPosition = Convert.ToInt32(this.ugVelocityGrades.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugVelocityGrades.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) >= rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugVelocityGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition;
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugVelocityGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                _setRowPosition = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
            finally
            {
                this.Cursor = Cursors.Default;
            }
		}

		private void mnuVGItemInsertAfter_Click(object sender, System.EventArgs e)
		{
			try
			{
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                if (ugVelocityGrades.Rows.Count > 0 &&
                    ugVelocityGrades.ActiveRow != null)
                {
                    int rowPosition = Convert.ToInt32(this.ugVelocityGrades.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugVelocityGrades.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) > rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugVelocityGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition + 1;
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugVelocityGrades.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                _setRowPosition = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
            finally
            {
                this.Cursor = Cursors.Default;
            }
		}

		private void mnuVGItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuVGItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuVGItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuVGItemDelete_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (this.ugVelocityGrades.ActiveRow != null)
				{
					this.ugVelocityGrades.ActiveRow.Delete();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuVGItemDeleteAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				_velocityGradesDataTable.Rows.Clear();
				_velocityGradesDataTable.AcceptChanges();
				VelocityGradesChangesMade = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuVGItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugVelocityGrades.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuVGItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugVelocityGrades.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void BuildSellThruPctsContextmenu()
		{
			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuSellThruPctsGrid.MenuItems.Clear();
                // End TT#2138
				MenuItem mnuItemInsert = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert));
				MenuItem mnuItemInsertBefore = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_Before));
				MenuItem mnuItemInsertAfter = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Insert_after));
				MenuItem mnuItemCut= new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Cut));
				MenuItem mnuItemCopy = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Copy));
				MenuItem mnuItemPaste = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Paste));
				MenuItem mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete));
				MenuItem mnuItemDeleteAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_DeleteAll));
				if (!_securityVelocity.AllowUpdate)
				{
					mnuItemInsert.Enabled = false;
					mnuItemInsertBefore.Enabled = false;
					mnuItemInsertAfter.Enabled = false;
					mnuItemCut.Enabled = false;
					mnuItemCopy.Enabled = false;
					mnuItemPaste.Enabled = false;
					mnuItemDelete.Enabled = false;
					mnuItemDeleteAll.Enabled = false;
				}
				mnuSellThruPctsGrid.MenuItems.Add(mnuItemInsert);
				mnuItemInsert.MenuItems.Add(mnuItemInsertBefore);
				mnuItemInsert.MenuItems.Add(mnuItemInsertAfter);
				mnuSellThruPctsGrid.MenuItems.Add(mnuItemDelete);
				mnuSellThruPctsGrid.MenuItems.Add(mnuItemDeleteAll);
				mnuItemInsert.Click += new System.EventHandler(this.mnuSTItemInsert_Click);
				mnuItemInsertBefore.Click += new System.EventHandler(this.mnuSTItemInsertBefore_Click);
				mnuItemInsertAfter.Click += new System.EventHandler(this.mnuSTItemInsertAfter_Click);
				mnuItemCut.Click += new System.EventHandler(this.mnuSTItemCut_Cut);
				mnuItemCopy.Click += new System.EventHandler(this.mnuSTItemCopy_Click);
				mnuItemPaste.Click += new System.EventHandler(this.mnuSTItemPaste_Click);
				mnuItemDelete.Click += new System.EventHandler(this.mnuSTItemDelete_Click);
				mnuItemDeleteAll.Click += new System.EventHandler(this.mnuSTItemDeleteAll_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSTItemInsert_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSTItemInsertBefore_Click(object sender, System.EventArgs e)
		{
			try
			{
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                if (ugSellThruPcts.Rows.Count > 0 &&
                    ugSellThruPcts.ActiveRow != null)
                {
                    Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugSellThruPcts.ActiveRow;
                    int rowPosition = Convert.ToInt32(this.ugSellThruPcts.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugSellThruPcts.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) >= rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugSellThruPcts.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition;
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugSellThruPcts.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                _setRowPosition = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSTItemInsertAfter_Click(object sender, System.EventArgs e)
		{
			try
			{
                _setRowPosition = false;
                this.Cursor = Cursors.WaitCursor;
                if (ugSellThruPcts.Rows.Count > 0 &&
                    ugSellThruPcts.ActiveRow != null)
                {
                    int rowPosition = Convert.ToInt32(this.ugSellThruPcts.ActiveRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture);
                    // increment the position of the active row to end of grid
                    foreach (UltraGridRow gridRow in ugSellThruPcts.Rows)
                    {
                        if (Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) > rowPosition)
                        {
                            gridRow.Cells["RowPosition"].Value = Convert.ToInt32(gridRow.Cells["RowPosition"].Value, CultureInfo.CurrentUICulture) + 1;
                        }
                    }
                    UltraGridRow addedRow = this.ugSellThruPcts.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = rowPosition + 1;
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
                else
                {
                    UltraGridRow addedRow = this.ugSellThruPcts.DisplayLayout.Bands[0].AddNew();
                    addedRow.Cells["RowPosition"].Value = 1;
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
                    this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("RowPosition", false);
                }
				_setRowPosition = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSTItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuSTItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSTItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuSTItemDelete_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (this.ugSellThruPcts.ActiveRow != null)
				{
					this.ugSellThruPcts.ActiveRow.Delete();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSTItemDeleteAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugSellThruPcts.BeginUpdate();
				if (_sellThruPctsDataTable.Rows.Count > 0)
				{
					_sellThruPctsDataTable.Rows.Clear();
				}
				_sellThruPctsDataTable.AcceptChanges();
				this.ugSellThruPcts.EndUpdate();
				SellThruPctsChangesMade = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSTItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugSellThruPcts.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSTItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugSellThruPcts.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void ugVelocityGrades_AfterSortChange(object sender, Infragistics.Win.UltraWinGrid.BandEventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				int count = 0;
				if (_setRowPosition)
				{
					foreach(  UltraGridRow gridRow in ugVelocityGrades.Rows )
					{
						gridRow.Cells["RowPosition"].Value = count;
						++count;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void ugSellThruPcts_AfterSortChange(object sender, Infragistics.Win.UltraWinGrid.BandEventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				int count = 0;
				if (_setRowPosition)
				{
					foreach(  UltraGridRow gridRow in ugSellThruPcts.Rows )
					{
						gridRow.Cells["RowPosition"].Value = count;
						++count;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void TabVelocityGrades_Populate(int nodeRID)
		{
			try
			{
				VelocityGrades_Populate(nodeRID);
				SellThruPcts_Populate(nodeRID);

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityVelocity;
					SetControlReadOnly(this.tabVelocityGrades, !securityProfile.AllowUpdate);
				}

				if (securityProfile.AllowUpdate)
				{
					this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = false;
					this.ugSellThruPcts.DisplayLayout.AddNewBox.Hidden = false;
				}
				else
				{
					this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = true;
					this.ugSellThruPcts.DisplayLayout.AddNewBox.Hidden = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void VelocityGrades_Populate(int nodeRID)
		{
			VelocityGrades_Populate(nodeRID, false);
		}

		private void VelocityGrades_Populate(int nodeRID, bool doingCopy)
		{
			try
			{
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				//this.Cursor = Cursors.WaitCursor;
				//int count = 0;
				//string velocityGradesInheritedFrom = null;
				//HierarchyNodeProfile hnp = null;

				//VelocityGrades_Define();
				////			this.ugVelocityGrades.BeginUpdate();
				////			if (_velocityGradesDataTable.Rows.Count > 0)
				////			{
				////				_velocityGradesDataTable.Rows.Clear();
				////			}
				//_velocityGradeList = _SAB.HierarchyServerSession.GetVelocityGradeList(nodeRID, false);
				//foreach(VelocityGradeProfile vgp in _velocityGradeList)
				//{
				//    //Begin Track #4516 - JSmith - Copy/paste problem
				//    if (doingCopy)
				//    {
				//        _velocityGradesInherited = false;
				//    }
				//    else
				//        //End Track #4516
				//        if (vgp.VelocityGradeIsInherited)
				//    {
				//        _velocityGradesInherited = true;
				//        if (hnp == null || hnp.Key != vgp.VelocityGradeInheritedFromNodeRID)
				//        {
				//            hnp = _SAB.HierarchyServerSession.GetNodeData(vgp.VelocityGradeInheritedFromNodeRID);
				//        }
				//        velocityGradesInheritedFrom = hnp.Text;
				//    }
				//    //				_velocityGradesDataTable.Rows.Add(new object[] { count, vgp.VelocityGrade, vgp.Boundary, vgp.SellThruPct});
				//    _velocityGradesDataTable.Rows.Add(new object[] { count, vgp.VelocityGrade, vgp.Boundary});
				//    ++count;
				//}

				////			_velocityGradesDataTable.AcceptChanges();
				////			this.ugVelocityGrades.EndUpdate();
				//this.ugVelocityGrades.DataSource = _velocityGradesDataTable;

				//if (_velocityGradesInherited)
				//{
				//    string inheritMsg = _txtInheritedFrom + velocityGradesInheritedFrom;
				//    InheritanceProvider.SetError (this.lblVelocityGradesInheritance,inheritMsg);
				//}
				//else
				//{
				//    InheritanceProvider.SetError (this.lblVelocityGradesInheritance,string.Empty);
				//}
				this.Cursor = Cursors.WaitCursor;
				string velocityGradesInheritedFrom = null;
				string minMaxesInheritedFrom = null;
				string inheritMsg = null;
				int count = 0;
				int minStock, maxStock, minAd;
				HierarchyNodeProfile hnp = null;

				_velocityGradesInherited = false;
				_velocityMinMaxesInherited = false;

				VelocityGrades_Define();

				_velocityGradeList = _SAB.HierarchyServerSession.GetVelocityGradeList(nodeRID, false, true);

				bool[,] cellIsNull = new bool[_velocityGradeList.Count, 3];
				cellIsNull.Initialize();
				int col;
				foreach (VelocityGradeProfile vgp in _velocityGradeList)
				{
					col = 0;
					if (doingCopy)
					{
						_velocityGradesInherited = false;
						_velocityMinMaxesInherited = false;
					}
					else
					{
						if (vgp.VelocityGradeIsInherited)
						{
							_velocityGradesInherited = true;
							if (hnp == null || hnp.Key != vgp.VelocityGradeInheritedFromNodeRID)
							{
								hnp = _SAB.HierarchyServerSession.GetNodeData(vgp.VelocityGradeInheritedFromNodeRID);
							}
							velocityGradesInheritedFrom = hnp.Text;
						}
						if (vgp.VelocityMinMaxesIsInherited)
						{
							_velocityMinMaxesInherited = true;
							if (hnp == null || hnp.Key != vgp.VelocityMinMaxesInheritedFromNodeRID)
							{
								hnp = _SAB.HierarchyServerSession.GetNodeData(vgp.VelocityMinMaxesInheritedFromNodeRID);
							}
							minMaxesInheritedFrom = hnp.Text;
						}
					}

					if (vgp.VelocityMinStock > Include.Undefined)
					{
						minStock = vgp.VelocityMinStock;
					}
					else
					{
						cellIsNull[count, col] = true;
						minStock = 0;
					}
					col++;
					if (vgp.VelocityMaxStock > Include.Undefined)
					{
						maxStock = vgp.VelocityMaxStock;
					}
					else
					{
						cellIsNull[count, col] = true;
						maxStock = 0;
					}
					col++;
					if (vgp.VelocityMinAd > Include.Undefined)
					{
						minAd = vgp.VelocityMinAd;
					}
					else
					{
						cellIsNull[count, col] = true;
						minAd = 0;
					}

					_velocityGradesDataTable.Rows.Add(new object[] { count, vgp.VelocityGrade, vgp.Boundary,
																	minStock, maxStock, minAd});
					++count;
				}

				this.ugVelocityGrades.DataSource = _velocityGradesDataTable;

				for (int i = 0; i < _velocityGradeList.Count; i++)
				{
					for (int j = 0; j < 3; j++)
					{
						if (cellIsNull[i, j])
						{
							ugVelocityGrades.Rows[i].Cells[j + 3].Value = System.DBNull.Value;
						}
					}
				}

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityVelocity;
					SetControlReadOnly(this.tabVelocityGrades, !securityProfile.AllowUpdate);
				}
				if (securityProfile.AllowUpdate)
				{
					this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = false;
				}
				else
				{
					this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = true;
				}

				if (_velocityGradesInherited)
				{
					inheritMsg = _txtInheritedFrom + velocityGradesInheritedFrom;
					InheritanceProvider.SetError(this.lblVelocityGradesInheritance, inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError(this.lblVelocityGradesInheritance, string.Empty);
				}

				if (_velocityMinMaxesInherited)
				{
					inheritMsg = _txtInheritedFrom + minMaxesInheritedFrom;
					InheritanceProvider.SetError(this.lblVelocityMinMaxesInheritance, inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError(this.lblVelocityMinMaxesInheritance, string.Empty);
				}

				// order by boundary
				ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
				//End TT#505 - JScott - Velocity - Apply Min/Max
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void SellThruPcts_Populate(int nodeRID)
		{
			SellThruPcts_Populate(nodeRID, false);
		}

		private void SellThruPcts_Populate(int nodeRID, bool doingCopy)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				string sellThruPctsInheritedFrom = null;
				HierarchyNodeProfile hnp = null;
				int count = 0;

                _sellThruPctsInherited = false; //TT#3980 - DOConnell - Velocity Grade Selll Thru inheritance incorrect if select node without closing.

				SellThruPcts_Define();
				_sellThruPctList = _SAB.HierarchyServerSession.GetSellThruPctList(nodeRID, false);
				foreach(SellThruPctProfile stpp in _sellThruPctList)
				{
					if (doingCopy)
					{
						_sellThruPctsInherited = false;
					}
					else
					{
						if (stpp.SellThruPctIsInherited)
						{
							_sellThruPctsInherited = true;
							if (hnp == null || hnp.Key != stpp.SellThruPctInheritedFromNodeRID)
							{
								hnp = _SAB.HierarchyServerSession.GetNodeData(stpp.SellThruPctInheritedFromNodeRID);
							}
							sellThruPctsInheritedFrom = hnp.Text;
						}
					}
					_sellThruPctsDataTable.Rows.Add(new object[] { count, stpp.SellThruPct});
					++count;
				}

				this.ugSellThruPcts.DataSource = _sellThruPctsDataTable;

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityVelocity;
					SetControlReadOnly(this.tabDailyPercentages, !securityProfile.AllowUpdate);
				}
				
				if (_sellThruPctsInherited)
				{
					string inheritMsg = _txtInheritedFrom + sellThruPctsInheritedFrom;
					InheritanceProvider.SetError (this.lblSellThruPctsInheritance,inheritMsg);
				}
				else
				{
					InheritanceProvider.SetError (this.lblSellThruPctsInheritance,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void ugVelocityGrades_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				//if (_velocityGradesIsPopulated)
				//{
				//    VelocityGradesChangesMade = true;
				//    InheritanceProvider.SetError (this.lblVelocityGradesInheritance,string.Empty);
				//}
				if (_velocityGradesIsPopulated)
				{
					switch (e.Cell.Column.Key)
					{
						case "Grade":
						case "Boundary":
							VelocityGradesChangesMade = true;
							InheritanceProvider.SetError(this.lblVelocityGradesInheritance, string.Empty);
							break;
						case "Min Stock":
						case "Max Stock":
						case "Min Ad":
							VelocityMinMaxesChangesMade = true;
							InheritanceProvider.SetError(this.lblVelocityMinMaxesInheritance, string.Empty);
							break;
					}
				}
				//End TT#505 - JScott - Velocity - Apply Min/Max
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_AfterRowInsert(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				e.Row.Cells["RowPosition"].Value = this.ugVelocityGrades.Rows.Count;
                if (_velocityGradesIsPopulated)
                {
                    ChangePending = true;
                }
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_AfterRowsDeleted(object sender, System.EventArgs e)
		{
			try
			{
				if (_velocityGradesIsPopulated)
				{
					VelocityGradesChangesMade = true;
					//Begin TT#505 - JScott - Velocity - Apply Min/Max
					VelocityMinMaxesChangesMade = true;
					//End TT#505 - JScott - Velocity - Apply Min/Max
					ugVelocityGrades.UpdateData();
                    ChangePending = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityVelocity.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        VelocityGrades_Populate(cbList.ClipboardProfile.Key, true);
                        VelocityGradesChangesMade = true;
						//Begin TT#505 - JScott - Velocity - Apply Min/Max
						VelocityMinMaxesChangesMade = true;
						//Begin TT#505 - JScott - Velocity - Apply Min/Max
					}
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugVelocityGrades.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugVelocityGrades.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugVelocityGrades, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugVelocityGrades, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (ugVelocityGrades.ActiveCell != null)
					{
						switch (this.ugVelocityGrades.ActiveCell.Column.Key)
						{
							case "Grade":
								if (!VelocityGradeValid(ugVelocityGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Boundary":
								if (!VelocityBoundaryValid(ugVelocityGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							//Begin TT#505 - JScott - Velocity - Apply Min/Max
							case "Min Stock":
								if (!MinStockValid(ugVelocityGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Max Stock":
								if (!MaxStockValid(ugVelocityGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							case "Min Ad":
								if (!MinAdValid(ugVelocityGrades.ActiveCell, ref errorMessage))
								{
									MessageBox.Show(errorMessage, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
							//End TT#505 - JScott - Velocity - Apply Min/Max
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_BeforeRowUpdate(object sender, Infragistics.Win.UltraWinGrid.CancelableRowEventArgs e)
		{
			try
			{
				// if row is completely empty, cancel the update
				if (e.Row.Cells["Grade"].Text.Length == 0 &&
					//Begin TT#505 - JScott - Velocity - Apply Min/Max
					//e.Row.Cells["Boundary"].Text.Length == 0)
					e.Row.Cells["Boundary"].Text.Length == 0 &&
					e.Row.Cells["Min Stock"].Text.Length == 0 &&
					e.Row.Cells["Max Stock"].Text.Length == 0 &&
					e.Row.Cells["Min Ad"].Text.Length == 0)
				//End TT#505 - JScott - Velocity - Apply Min/Max
				{
					e.Cancel = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugVelocityGrades_AfterRowUpdate(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_sellThruPctsIsPopulated)
				{
					SellThruPctsChangesMade = true;
					InheritanceProvider.SetError (this.lblSellThruPctsInheritance,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_AfterRowInsert(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				e.Row.Cells["RowPosition"].Value = this.ugSellThruPcts.Rows.Count;
                if (_sellThruPctsIsPopulated)
                {
                    ChangePending = true;
                }
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_AfterRowsDeleted(object sender, System.EventArgs e)
		{
			try
			{
				if (_sellThruPctsIsPopulated)
				{
					SellThruPctsChangesMade = true;
					ugSellThruPcts.UpdateData();
                    ChangePending = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (this._securityVelocity.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        SellThruPcts_Populate(cbList.ClipboardProfile.Key, true);
                        SellThruPctsChangesMade = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugSellThruPcts.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugSellThruPcts.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;

						this.mnuGridColHeader.Show(this.ugSellThruPcts, point);

					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugSellThruPcts, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				if (DoValueByValueEdits)
				{
					if (ugSellThruPcts.ActiveCell != null)
					{
						switch (this.ugSellThruPcts.ActiveCell.Column.Key)
						{
							case "Sell Thru %":
								if (!VelocitySellThruValid(ugSellThruPcts.ActiveCell, ref errorMessage))
								{
									MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
									e.Cancel = true;
								}
								break;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_BeforeRowUpdate(object sender, Infragistics.Win.UltraWinGrid.CancelableRowEventArgs e)
		{
			try
			{
				// if row is completely empty, cancel the update
				if (e.Row.Cells["Sell Thru %"].Text.Length == 0)
				{
					e.Cancel = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugSellThruPcts_AfterRowUpdate(object sender, Infragistics.Win.UltraWinGrid.RowEventArgs e)
		{
			try
			{
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("Sell Thru %", true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool VelocityGradeValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					// make sure grades are unique
					foreach(  UltraGridRow gridRow in this.ugVelocityGrades.Rows )
					{
						if (gridCell.Row != gridRow)
						{
							if ((string)gridCell.Text == (string)gridRow.Cells["Grade"].Text)
							{
								errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_VelocityGradesNotUnique);
								errorFound = true;
								break;
							}
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool VelocityBoundaryValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					{
						// make sure boundaries are unique
						foreach(  UltraGridRow gridRow in this.ugVelocityGrades.Rows )
						{
							if (gridCell.Row != gridRow)	// Don't check yourself
							{
								if (Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture) == Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture))
								{
									errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_GradeBoundariesNotUnique);
									errorFound = true;
									break;
								}
							}
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool VelocitySellThruValid(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				else
				{
					int cellValue = Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture);
					if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					{
						// make sure sell thrus are unique
						foreach(  UltraGridRow gridRow in this.ugSellThruPcts.Rows )
						{
							if (gridCell.Row != gridRow)	// Don't check yourself
							{
								if (Convert.ToInt32(gridCell.Value, CultureInfo.CurrentUICulture) == Convert.ToInt32(gridRow.Cells["Sell Thru %"].Value, CultureInfo.CurrentUICulture))
								{
									errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeUnique);
									errorFound = true;
									break;
								}
							}
						}
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeInteger);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool ValidTabVelocityGrades(ref EditMsgs em)
		{
			if (FormIsClosing && !SaveOnClose)
			{
				return true;
			}

			ValidVelocityGrades(ref em);
			ValidSellThruPcts(ref em);

			if (em.ErrorFound)
			{
				return false;
			}
			else
			{
				return true;
			}
		}

		private bool ValidVelocityGrades(ref EditMsgs em)
		{
			int lastBoundary = 0;
			string errorMessage = null;
			// sort in descending order by boundary
			this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
			this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
			UltraGridRow lastRow = null;
			
			foreach(  UltraGridRow gridRow in ugVelocityGrades.Rows )
			{
				lastRow = gridRow;
				if (!VelocityGradeValid(gridRow.Cells["Grade"], ref errorMessage))
				{
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
				}
				
				if (!VelocityBoundaryValid(gridRow.Cells["Boundary"], ref errorMessage))
				{
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());

				}
				else
				{
					lastBoundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture);
				}
				//Begin TT#505 - JScott - Velocity - Apply Min/Max

				if (gridRow.Cells["Min Stock"].Text != string.Empty)
				{
					if (!MinStockValid(gridRow.Cells["Min Stock"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
					}
				}

				if (gridRow.Cells["Max Stock"].Text != string.Empty)
				{
					if (!MaxStockValid(gridRow.Cells["Max Stock"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
					}
				}

				if (gridRow.Cells["Min Ad"].Text != string.Empty)
				{
					if (!MinAdValid(gridRow.Cells["Min Ad"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage, this.ToString());
					}
				}
				//End TT#505 - JScott - Velocity - Apply Min/Max
			}

			if (lastBoundary != 0)
			{
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_LastBoundaryNotZero);
				em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
				lastRow.Cells["Boundary"].Appearance.Image = ErrorImage;
				lastRow.Cells["Boundary"].Tag = errorMessage;
			}

			if (em.ErrorFound)
			{
				return false;
			}
			else
			{
				return true;
			}
		}

		private bool ValidSellThruPcts(ref EditMsgs em)
		{
			try
			{
				int lastPct = 0;
				UltraGridRow lastRow = null;
				string errorMessage = null;
				// sort in descending order by sell thru %
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("Sell Thru %", true);
			
				foreach(  UltraGridRow gridRow in ugSellThruPcts.Rows )
				{
					lastRow = gridRow;
					if (!VelocitySellThruValid(gridRow.Cells["Sell Thru %"], ref errorMessage))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						lastPct = Convert.ToInt32(gridRow.Cells["Sell Thru %"].Value, CultureInfo.CurrentUICulture);
					}
				}

				if (lastPct != 0)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_LastSellThruPctNotZero);
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					lastRow.Cells["Sell Thru %"].Appearance.Image = ErrorImage;
					lastRow.Cells["Sell Thru %"].Tag = errorMessage;
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				em.AddMsg(eMIDMessageLevel.Error, exception.Message,  this.ToString());
				HandleException(exception);
			}
			
			return false;
		}

		private void cbxVGInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				VelocityGradesChangesMade = true;
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				VelocityMinMaxesChangesMade = true;
				//End TT#505 - JScott - Velocity - Apply Min/Max
				SellThruPctsChangesMade = true;
			}
		}

		private void cbxVGApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
		{
			if (FormLoaded &&
				!_processingSave &&
				!_rebuildScreen)
			{
				VelocityGradesChangesMade = true;
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				VelocityMinMaxesChangesMade = true;
				//End TT#505 - JScott - Velocity - Apply Min/Max
				SellThruPctsChangesMade = true;
			}
		}

        //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation issue
        private void cbxApplyMinToZeroTolerance_CheckChanged(object sender, EventArgs e)
        {
            try
            {
                if (!_loadingSizeCurvesToleranceTab)
                {
                    SizeCurvesMinPctToleranceChangesMade = true;
                    ChangePending = true;
                    _sizeCurveToleranceProfile.ApplyMinToZeroTolerance = cbxApplyMinToZeroTolerance.Checked;
                }
            }
            catch (Exception ex)
            {
                HandleException(ex, "cbxApplyMinToZeroTolerance_CheckChanged");
            }
        }
        //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation issue

		#endregion Velocity Grades Tab

		#region Purge Criteria Tab

		private void PurgeCriteriaTab_Load()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				string inheritMsg = null;
				HierarchyNodeProfile inheritanceProfile = null;
				_purgeCriteriaIsPopulated = false;
				if (_hnp.PurgeDailyHistoryAfter > Include.Undefined)
				{
					this.txtPurgeDailyHistory.Text = _hnp.PurgeDailyHistoryAfter.ToString();
					switch (_hnp.PurgeDailyCriteriaInherited)
					{
						case eInheritedFrom.Node:
							if (inheritanceProfile == null || 
								inheritanceProfile.Key != _hnp.PurgeDailyCriteriaInheritedFrom)
							{
								inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeDailyCriteriaInheritedFrom);
							}
							inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
							InheritanceProvider.SetError (this.lblPurgeDailyHistoryTimeframe,inheritMsg);
							break;
						case eInheritedFrom.HierarchyLevel:
                            // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                            //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.PurgeDailyCriteriaInheritedFrom];
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeDailyCriteriaInheritedFrom];
                            // End TT#1959
							inheritMsg = _txtInheritedFrom + hlp.LevelID;
							InheritanceProvider.SetError (this.lblPurgeDailyHistoryTimeframe,inheritMsg);
							break;
						default:
							InheritanceProvider.SetError (this.lblPurgeDailyHistoryTimeframe,string.Empty);
							break;
					}
				}
                else
                {
                    this.txtPurgeDailyHistory.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblPurgeDailyHistoryTimeframe, string.Empty);
                }
			
				if (_hnp.PurgeWeeklyHistoryAfter > Include.Undefined)
				{
					this.txtPurgeWeeklyHistory.Text = _hnp.PurgeWeeklyHistoryAfter.ToString();
					switch (_hnp.PurgeWeeklyCriteriaInherited)
					{
						case eInheritedFrom.Node:
							if (inheritanceProfile == null || 
								inheritanceProfile.Key != _hnp.PurgeWeeklyCriteriaInheritedFrom)
							{
								inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeWeeklyCriteriaInheritedFrom);
							}
							inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
							InheritanceProvider.SetError (this.lblPurgeWeeklyHistoryTimeframe,inheritMsg);
							break;
						case eInheritedFrom.HierarchyLevel:
                            // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                            //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.PurgeWeeklyCriteriaInheritedFrom];
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeWeeklyCriteriaInheritedFrom];
                            // End TT#1959
							inheritMsg = _txtInheritedFrom + hlp.LevelID;
							InheritanceProvider.SetError (this.lblPurgeWeeklyHistoryTimeframe,inheritMsg);
							break;
						default:
							InheritanceProvider.SetError (this.lblPurgeWeeklyHistoryTimeframe,string.Empty);
							break;
					}
				}
                else
                {
                    this.txtPurgeWeeklyHistory.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblPurgeWeeklyHistoryTimeframe, string.Empty);
                }

				if (_hnp.PurgeOTSPlansAfter > Include.Undefined)
				{
					this.txtPurgePlans.Text = _hnp.PurgeOTSPlansAfter.ToString();
					switch (_hnp.PurgeOTSCriteriaInherited)
					{
						case eInheritedFrom.Node:
							if (inheritanceProfile == null || 
								inheritanceProfile.Key != _hnp.PurgeOTSCriteriaInheritedFrom)
							{
								inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeOTSCriteriaInheritedFrom);
							}
							inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
							InheritanceProvider.SetError (this.lblPurgePlansTimeframe,inheritMsg);
							break;
						case eInheritedFrom.HierarchyLevel:
                            // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                            //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.PurgeOTSCriteriaInheritedFrom];
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeOTSCriteriaInheritedFrom];
                            // End TT#1959
							inheritMsg = _txtInheritedFrom + hlp.LevelID;
							InheritanceProvider.SetError (this.lblPurgePlansTimeframe,inheritMsg);
							break;
						default:
							InheritanceProvider.SetError (this.lblPurgePlansTimeframe,string.Empty);
							break;
					}
				}
                else
                {
                    this.txtPurgePlans.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblPurgePlansTimeframe, string.Empty);
                }

                //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                //if (_hnp.PurgeHeadersAfter > Include.Undefined)
                //{
                //    this.txtPurgeHeaders.Text = _hnp.PurgeHeadersAfter.ToString();
                //    switch (_hnp.PurgeHeadersCriteriaInherited)
                //    {
                //        case eInheritedFrom.Node:
                //            if (inheritanceProfile == null || 
                //                inheritanceProfile.Key != _hnp.PurgeHeadersCriteriaInheritedFrom)
                //            {
                //                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHeadersCriteriaInheritedFrom);
                //            }
                //            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                //            InheritanceProvider.SetError (this.lblPurgeHeadersTimeframe,inheritMsg);
                //            break;
                //        case eInheritedFrom.HierarchyLevel:
                //            // Begin TT#1959 - JSmith - Multiple Node Property Error Messages
                //            //HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hpHome.HierarchyLevels[_hnp.PurgeHeadersCriteriaInheritedFrom];
                //            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                //            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHeadersCriteriaInheritedFrom];
                //            // End TT#1959
                //            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                //            InheritanceProvider.SetError (this.lblPurgeHeadersTimeframe,inheritMsg);
                //            break;
                //        default:
                //            InheritanceProvider.SetError (this.lblPurgeHeadersTimeframe,string.Empty);
                //            break;
                //    }
                //}
                //else
                //{
                //    this.txtPurgeHeaders.Text = string.Empty;
                //    InheritanceProvider.SetError(this.lblPurgeHeadersTimeframe, string.Empty);
                //}
                
                if (_hnp.PurgeHtASNAfter > Include.Undefined)
                {
                    this.txtHtASN.Text = _hnp.PurgeHtASNAfter.ToString();
                    switch (_hnp.PurgeHtASNCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtASNCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtASNCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtASNTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtASNCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtASNTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtASNTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtASN.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtASNTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtDropShipAfter > Include.Undefined)
                {
                    this.txtHtDropShip.Text = _hnp.PurgeHtDropShipAfter.ToString();
                    switch (_hnp.PurgeHtDropShipCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtDropShipCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtDropShipCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtDropShipTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtDropShipCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtDropShipTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtDropShipTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtDropShip.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtDropShipTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtDummyAfter > Include.Undefined)
                {
                    this.txtHtDummy.Text = _hnp.PurgeHtDummyAfter.ToString();
                    switch (_hnp.PurgeHtDummyCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtDummyCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtDummyCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtDummyTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtDummyCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtDummyTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtDummyTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtDummy.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtDummyTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtReceiptAfter > Include.Undefined)
                {
                    this.txtHtReceipt.Text = _hnp.PurgeHtReceiptAfter.ToString();
                    switch (_hnp.PurgeHtReceiptCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtReceiptCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtReceiptCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtReceiptTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtReceiptCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtReceiptTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtReceiptTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtReceipt.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtReceiptTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtPurchaseOrderAfter > Include.Undefined)
                {
                    this.txtHtPurchase.Text = _hnp.PurgeHtPurchaseOrderAfter.ToString();
                    switch (_hnp.PurgeHtPurchaseOrderCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtPurchaseOrderCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtPurchaseOrderCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtPurchaseOrderTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtPurchaseOrderCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtPurchaseOrderTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtPurchaseOrderTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtPurchase.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtPurchaseOrderTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtReserveAfter > Include.Undefined)
                {
                    this.txtHtReserve.Text = _hnp.PurgeHtReserveAfter.ToString();
                    switch (_hnp.PurgeHtReserveCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtReserveCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtReserveCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtReserveTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtReserveCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtReserveTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtReserveTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtReserve.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtReserveTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtVSWAfter > Include.Undefined)
                {
                    this.txtHtVSW.Text = _hnp.PurgeHtVSWAfter.ToString();
                    switch (_hnp.PurgeHtVSWCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtVSWCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtVSWCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtVSWTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtVSWCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtVSWTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtVSWTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtVSW.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtVSWTimeframe, string.Empty);
                }

                if (_hnp.PurgeHtWorkUpTotAfter > Include.Undefined)
                {
                    this.txtHtWorkupTotBy.Text = _hnp.PurgeHtWorkUpTotAfter.ToString();
                    switch (_hnp.PurgeHtWorkUpTotCriteriaInherited)
                    {
                        case eInheritedFrom.Node:
                            if (inheritanceProfile == null ||
                                inheritanceProfile.Key != _hnp.PurgeHtWorkUpTotCriteriaInheritedFrom)
                            {
                                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(_hnp.PurgeHtWorkUpTotCriteriaInheritedFrom);
                            }
                            inheritMsg = _txtInheritedFrom + inheritanceProfile.Text;
                            InheritanceProvider.SetError(this.lblHtWorkUpTotTimeframe, inheritMsg);
                            break;
                        case eInheritedFrom.HierarchyLevel:
                            HierarchyProfile mainHierProf = _SAB.HierarchyServerSession.GetMainHierarchyData();
                            HierarchyLevelProfile hlp = (HierarchyLevelProfile)mainHierProf.HierarchyLevels[_hnp.PurgeHtWorkUpTotCriteriaInheritedFrom];
                            inheritMsg = _txtInheritedFrom + hlp.LevelID;
                            InheritanceProvider.SetError(this.lblHtWorkUpTotTimeframe, inheritMsg);
                            break;
                        default:
                            InheritanceProvider.SetError(this.lblHtWorkUpTotTimeframe, string.Empty);
                            break;
                    }
                }
                else
                {
                    this.txtHtWorkupTotBy.Text = string.Empty;
                    InheritanceProvider.SetError(this.lblHtWorkUpTotTimeframe, string.Empty);
                }
                /* END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type */
                
                if (!_newNode)
				{
					SetControlReadOnly(this.tabPurgeCriteria, !_securityPurge.AllowUpdate);
				}
                //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
                //  Purge Criteria
                //  apply the initial values to the changes list
                //ChangeProfilePurge purgeChange = new ChangeProfilePurge("", this.txtPurgeWeeklyHistory.Text, "PURGE_WEEKLY_HISTORY");
                //KeyValuePair<int, object> _kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Weekly_History, purgeChange);
                //_nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);

                //purgeChange = new ChangeProfilePurge("", this.txtPurgeDailyHistory.Text, "PURGE_DAILY_HISTORY");
                //_kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Daily_History, purgeChange);
                //_nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);

                //purgeChange = new ChangeProfilePurge("", this.txtPurgeHeaders.Text, "PURGE_HEADERS");
                //_kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Headers, purgeChange);
                //_nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);

                //purgeChange = new ChangeProfilePurge("", this.txtPurgePlans.Text, "PURGE_PLANS");
                //_kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Headers, purgeChange);
                //_nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);

                //purgeChange = null;

                //  END TT#2015 - gtaylor - apply changes to lower levels
				_purgeCriteriaIsPopulated = true;
				DailyPurgeCriteriaChangesMade = false;
				WeeklyPurgeCriteriaChangesMade = false;
				OTSPurgeCriteriaChangesMade = false;
                //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                //HeadersPurgeCriteriaChangesMade = false;
                ASNHTPurgeCriteriaChangesMade = false;
                DropShipHTPurgeCriteriaChangesMade = false;
                DummyHTPurgeCriteriaChangesMade = false;
                ReceiptHTPurgeCriteriaChangesMade = false; 
                PurchaseOrderHTPurgeCriteriaChangesMade = false;
                ReserveHTPurgeCriteriaChangesMade = false;
                VSWHTPurgeCriteriaChangesMade = false;
                WorkUpTotHTPurgeCriteriaChangesMade = false;
                //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
            }
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

        //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
        void txtPurgeDailyHistory_Leave(object sender, System.EventArgs e)
        {
            //// if the text is different than before, update the change and mark as changed
            //if (!this.txtPurgeDailyHistory.Text.Equals(_purgeDailyHistoryPreviousValue))
            //{
            //    // create the change profile and add it to the list
            //    ChangeProfilePurge purgeChange = new ChangeProfilePurge("", this.txtPurgeDailyHistory.Text, "PURGE_DAILY_HISTORY");

            //    //  create keyvaluepair and populate
            //    KeyValuePair<int, object> _kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Daily_History, purgeChange);

            //    //  add to nodechangeprofile list
            //    _nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);
            //}
        }
        void txtPurgeDailyHistory_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeDailyHistoryPreviousValue = this.txtPurgeDailyHistory.Text;
        }

        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        //void txtPurgeHeaders_Enter(object sender, System.EventArgs e)
        //{
        //    //  save the previous version of the text
        //    _purgeHeadersPreviousValue = this.txtPurgeHeaders.Text;
        //}
        //void txtPurgeHeaders_Leave(object sender, System.EventArgs e)
        //{
        //    //// if the text is different than before, update the change and mark as changed
        //    //if (!this.txtPurgeHeaders.Text.Equals(_purgeHeadersPreviousValue))
        //    //{
        //    //    // create the change profile and add it to the list
        //    //    ChangeProfilePurge purgeChange = new ChangeProfilePurge("", this.txtPurgeHeaders.Text, "PURGE_HEADERS");

        //    //    //  create keyvaluepair and populate
        //    //    KeyValuePair<int, object> _kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Headers, purgeChange);

        //    //    //  add to nodechangeprofile list
        //    //    _nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);
        //    //}
        //}
        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type

        void txtPurgePlans_Leave(object sender, System.EventArgs e)
        {
            //// if the text is different than before, update the change and mark as changed
            //if (!this.txtPurgePlans.Text.Equals(_purgePlansPreviousValue))
            //{
            //    // create the change profile and add it to the list
            //    ChangeProfilePurge purgeChange = new ChangeProfilePurge("", this.txtPurgePlans.Text, "PURGE_PLANS");

            //    //  create keyvaluepair and populate
            //    KeyValuePair<int, object> _kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Plans, purgeChange);

            //    //  add to nodechangeprofile list
            //    _nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);
            //}
        }
        void txtPurgePlans_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgePlansPreviousValue = this.txtPurgePlans.Text;
        }

        void txtPurgeWeeklyHistory_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text

            _purgeWeeklyHistoryPreviousValue = this.txtPurgeWeeklyHistory.Text;
        }
        void txtPurgeWeeklyHistory_Leave(object sender, System.EventArgs e)
        {
            //// if the text is different than before, update the change and mark as changed
            //if (!this.txtPurgeWeeklyHistory.Text.Equals(_purgeWeeklyHistoryPreviousValue))
            //{
            //    // create the change profile and add it to the list
            //    ChangeProfilePurge purgeChange = new ChangeProfilePurge("", this.txtPurgeWeeklyHistory.Text, "PURGE_WEEKLY_HISTORY");

            //    //  create keyvaluepair and populate
            //    KeyValuePair<int, object> _kvp = new KeyValuePair<int, object>((int)eMIDTextCode.lbl_Purge_Weekly_History, purgeChange);

            //    //  add to nodechangeprofile list
            //    _nodeChangeProfile.Add(eProfileType.PurgeCriteria, _kvp);
            //}
        }
        //  END TT#2015 - gtaylor - apply changes to lower levels

		private void txtPurgeDailyHistory_TextChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (_purgeCriteriaIsPopulated)
				{
					DailyPurgeCriteriaChangesMade = true;
					InheritanceProvider.SetError (this.lblPurgeDailyHistoryTimeframe,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtPurgeWeeklyHistory_TextChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (_purgeCriteriaIsPopulated)
				{
					WeeklyPurgeCriteriaChangesMade = true;
					InheritanceProvider.SetError (this.lblPurgeWeeklyHistoryTimeframe,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtPurgePlans_TextChanged(object sender, System.EventArgs e)
		{
			try
			{
				if (_purgeCriteriaIsPopulated)
				{
					OTSPurgeCriteriaChangesMade = true;
					InheritanceProvider.SetError (this.lblPurgePlansTimeframe,string.Empty);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
        //private void txtPurgeHeaders_TextChanged(object sender, System.EventArgs e)
        //{
        //    try
        //    {
        //        if (_purgeCriteriaIsPopulated)
        //        {
        //            HeadersPurgeCriteriaChangesMade = true;
        //            InheritanceProvider.SetError (this.lblPurgeHeadersTimeframe,string.Empty);
        //        }
        //    }
        //    catch( Exception exception )
        //    {
        //        HandleException(exception);
        //    }
        //}

        private void txtHTASN_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    ASNHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtASNTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTDropShip_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    DropShipHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtDropShipTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTDummy_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    DummyHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtDummyTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTReceipt_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    ReceiptHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtReceiptTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTPurchase_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    PurchaseOrderHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtPurchaseOrderTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTReserve_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    ReserveHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtReserveTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTVSW_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    VSWHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtVSWTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void txtHTWorkupTotBy_TextChanged(object sender, System.EventArgs e)
        {
            try
            {
                if (_purgeCriteriaIsPopulated)
                {
                    WorkUpTotHTPurgeCriteriaChangesMade = true;
                    InheritanceProvider.SetError(this.lblHtWorkUpTotTimeframe, string.Empty);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        void txtHTASN_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeASN = this.txtHtASN.Text;
        }

        void txtHTDropShip_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeDropShip = this.txtHtDropShip.Text;
        }

        void txtHTDummy_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeDummy = this.txtHtDummy.Text;
        }

        void txtHTReceipt_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeReceipt = this.txtHtReceipt.Text;
        }

        void txtHTPurchase_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypePurchase = this.txtHtPurchase.Text;
        }

        void txtHTReserve_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeReserve = this.txtHtReserve.Text;
        }

        void txtHTVSW_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeVSW = this.txtHtVSW.Text;
        }

        void txtHTWorkupTotBy_Enter(object sender, System.EventArgs e)
        {
            //  save the previous version of the text
            _purgeHeaderTypeVSW = this.txtHtWorkupTotBy.Text;
        }

        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type

		private bool ValidTabPurgeCriteria(ref EditMsgs em)
		{
			if (FormIsClosing && !SaveOnClose)
			{
				return true;
			}
            //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
			bool validValues;
		    validValues = true;
            //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type

		    if (!ValidatePurgeCriteria(this.txtPurgeDailyHistory))
			{
				validValues = false;
			}
			if (!ValidatePurgeCriteria(this.txtPurgeWeeklyHistory))
			{
				validValues = false;
			}
			if (!ValidatePurgeCriteria(this.txtPurgePlans))
			{
				validValues = false;
			}
            //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
            //if (!ValidatePurgeCriteria(this.txtPurgeHeaders))
            //{
            //    validValues = false;
            //}
            if (!ValidatePurgeCriteria(txtHtASN))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtDropShip))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtDummy))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtReceipt))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtPurchase))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtReserve))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtVSW))
            {
                validValues = false;
            }
            if (!ValidatePurgeCriteria(txtHtWorkupTotBy))
            {
                validValues = false;
            }
            //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
			return validValues;
		}

		private bool ValidatePurgeCriteria(TextBox aPurgeField)
		{
			try
			{
				if (aPurgeField.Text.Length > 0)
				{
					try
					{
						int purgeValue = Convert.ToInt32(aPurgeField.Text, CultureInfo.CurrentUICulture);
						if (purgeValue < 0)
						{
							string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
							ErrorProvider.SetError (aPurgeField,error);
							return false;
						}
						else
						{
							ErrorProvider.SetError (aPurgeField,string.Empty);
							return true;
						}
					}
					catch
					{
						string error = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						ErrorProvider.SetError (aPurgeField,error);
						return false;
					}
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			return false;
		}

        private void cbxPCInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
        {
            if (FormLoaded &&
                !_processingSave &&
                !_rebuildScreen &&
                _securityNodes.AllowUpdate // TT#2015 - gtaylor - apply changes to lower levels
                )
            {
                DailyPurgeCriteriaChangesMade = true;
                WeeklyPurgeCriteriaChangesMade = true;
                OTSPurgeCriteriaChangesMade = true;
                //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                //HeadersPurgeCriteriaChangesMade = true;
                //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                ChangePending = true;       //  TT#2015 - gtaylor - apply changes to lower levels
                btnApply.Enabled = true;    //  TT#2015 - gtaylor - apply changes to lower levels

                //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                ASNHTPurgeCriteriaChangesMade = true;
                DropShipHTPurgeCriteriaChangesMade = true;
                DummyHTPurgeCriteriaChangesMade = true;
                ReceiptHTPurgeCriteriaChangesMade = true;
                PurchaseOrderHTPurgeCriteriaChangesMade = true;
                ReserveHTPurgeCriteriaChangesMade = true;
                VSWHTPurgeCriteriaChangesMade = true;
                WorkUpTotHTPurgeCriteriaChangesMade = true;
                //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
            }
        }

        //private void cbxPCApplyToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
        //{
        //    if (FormLoaded &&
        //        !_processingSave &&
        //        !_rebuildScreen &&
        //        _securityNodes.AllowUpdate // TT#2015 - gtaylor - apply changes to lower levels
        //        )
        //    {
        //        DailyPurgeCriteriaChangesMade = true;
        //        WeeklyPurgeCriteriaChangesMade = true;
        //        OTSPurgeCriteriaChangesMade = true;
        //        HeadersPurgeCriteriaChangesMade = true;
        //        ChangePending = true;       //  TT#2015 - gtaylor - apply changes to lower levels
        //        btnApply.Enabled = true;    //  TT#2015 - gtaylor - apply changes to lower levels
        //    }
        //}

		#endregion Purge Criteria Tab

		#region Daily Percentages Tab

		private void ugDailyPercentages_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_dailyPercentagesGridBuilt)
				{
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.dailyPercentagesGrid);
					if (layout.LayoutLength > 0)
					{
						ugDailyPercentages.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultDailyPercentagesGridLayout();
					}
					// always set column headings incase application text is changed
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["SetID"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["DisplayDate"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Date_Range);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Total%"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Total_Percent);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day1"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day1);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day2"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day2);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day3"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day3);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day4"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day4);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day5"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day5);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day6"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day6);
					this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day7"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day7);

					this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DateRangeRID"].Hidden = true;

					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Store"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_ST_ID);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["DisplayDate"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Date_Range);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Total%"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Total_Percent);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day1"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day1);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day2"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day2);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day3"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day3);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day4"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day4);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day5"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day5);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day6"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day6);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day7"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Day7);
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Inherited"].Hidden = true;
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Inherited RID"].Hidden = true;
					this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Store"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

					this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["SetID"].Hidden = true;
					this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DateRangeRID"].Hidden = true;
                    // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["StartDateKey"].Hidden = true;
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["EndDateKey"].Hidden = true;
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Clear();
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("StartDateKey", false);
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("EndDateKey", true);
                    // End TT#2621 - JSmith - Duplicate weeks in daily sales
                    // Begin TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
                    if (_securityDailyPcts.AllowUpdate)
                    {
                        this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                        this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].AutoEdit = true;
                        this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].AutoEdit = true;
                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    }
                    // End TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
					_dailyPercentagesGridBuilt = true;
				}

				if (!_securityDailyPcts.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugDailyPercentages.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugDailyPercentages.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DefaultDailyPercentagesGridLayout()
		{
			try
			{
				this.ugDailyPercentages.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugDailyPercentages.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugDailyPercentages.DisplayLayout.AddNewBox.Hidden = true;
				this.ugDailyPercentages.DisplayLayout.GroupByBox.Hidden = true;
				this.ugDailyPercentages.DisplayLayout.GroupByBox.Prompt = string.Empty;
				this.ugDailyPercentages.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;
				this.ugDailyPercentages.DisplayLayout.Override.AllowColMoving = AllowColMoving.NotAllowed;
 
				// Set
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].AddButtonCaption = "Set";
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["SetID"].Width = 100;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["DisplayDate"].Width = 125;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Total%"].Width = 50;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Total%"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day1"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day1"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day2"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day2"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day3"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day3"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day4"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day4"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day5"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day5"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day6"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day6"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day7"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["Day7"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				// Set dates
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["SetID"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DateRange"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].ColHeadersVisible = false;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].AddButtonCaption = "Add Set Date Range";
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["SetID"].Width = 100;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["ApplyButton"].Width = 5;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["ApplyButton"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Center;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].Width = 125;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Total%"].Width = 50;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Total%"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day1"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day1"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day2"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day2"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day3"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day3"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day4"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day4"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day5"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day5"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day6"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day6"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day7"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["Day7"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
				this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["ApplyButton"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.Button;

				// Stores
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Updated"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["SetID"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Store RID"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Store"].Width = 100;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["DisplayDate"].Width = 125;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Total%"].Width = 50;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Total%"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day1"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day1"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day2"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day2"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day3"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day3"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day4"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day4"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day5"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day5"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day6"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day6"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day7"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["Day7"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;

				// Store Dates
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Store"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DateRange"].Hidden = true;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].ColHeadersVisible = false;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["ApplyButton"].Hidden = false;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].AddButtonCaption = "Add Store Date Range";
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Store"].Width = 100;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["ApplyButton"].Width = 5;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["ApplyButton"].CellAppearance.BackColor = this.BackColor;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["ApplyButton"].CellAppearance.BorderColor = this.BackColor;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].Width = 125;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Total%"].Width = 50;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Total%"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day1"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day1"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day2"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day2"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day3"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day3"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day4"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day4"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day5"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day5"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day6"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day6"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day7"].Width = 40;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["Day7"].CellAppearance.TextHAlign =  Infragistics.Win.HAlign.Right;
				this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].Style  = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;

				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugDailyPercentages);
                //End TT#169

			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DailyPercentagesTab_Load()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				DailyPercentages_Attributes_Populate();
			
				if (_hnp.Key == Include.NoRID)
				{
					_storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, _hnp.HomeHierarchyParentRID);
				}
				else
				{
					_storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, _hnp.Key);
				}
				DailyPercentages_Populate(false);
				AddReoccurringImage();

				BuildDailyPercentagesContextmenu();
				this.ugDailyPercentages.ContextMenu = mnuDailyPercentagesGrid;

				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugDailyPercentages);
                //End TT#169

                // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Clear();
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("StartDateKey", false);
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("EndDateKey", true);
                // End TT#2621 - JSmith - Duplicate weeks in daily sales

				Resize_DPcolumns();
				_dailyPercentagesIsPopulated = true;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void DailyPercentages_Attributes_Populate()
		{
			try
			{
				StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_dailyPercentagesGroupList.FindKey(_SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID);
				_groupRID = storeGroup.Key;

                cbDPStoreAttribute.Initialize(SAB, _securityDailyPcts, _dailyPercentagesGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbDPStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

				_groupRID = storeGroup.Key;
				this.cbDPStoreAttribute.SelectedValue = storeGroup.Key;
                _dailyPercentagesGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DailyPercentages_Define()
		{
			try
			{
                _dailyPercentagesDataSet = MIDEnvironment.CreateDataSet("DailyPercentagesDataSet");

				DataTable setTable = _dailyPercentagesDataSet.Tables.Add("Sets");

				DataColumn dataColumn;

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Total%";
				dataColumn.Caption = "Total %";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day1";
				dataColumn.Caption = "Day 1";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day2";
				dataColumn.Caption = "Day 2";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day3";
				dataColumn.Caption = "Day 3";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day4";
				dataColumn.Caption = "Day 4";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day5";
				dataColumn.Caption = "Day 5";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day6";
				dataColumn.Caption = "Day 6";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day7";
				dataColumn.Caption = "Day 7";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setTable.Columns.Add(dataColumn);

				DataTable setDateTable = _dailyPercentagesDataSet.Tables.Add("SetDates");

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Store_Set);
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "ApplyButton";
				dataColumn.Caption = "ApplyButton";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "DateRangeRID";
				dataColumn.Caption = "Date Range RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Object");
				dataColumn.ColumnName = "DateRange";
				dataColumn.Caption = "Date Range";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Total%";
				dataColumn.Caption = "Total %";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day1";
				dataColumn.Caption = "Day 1";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day2";
				dataColumn.Caption = "Day 2";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day3";
				dataColumn.Caption = "Day 3";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day4";
				dataColumn.Caption = "Day 4";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day5";
				dataColumn.Caption = "Day 5";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day6";
				dataColumn.Caption = "Day 6";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day7";
				dataColumn.Caption = "Day 7";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				setDateTable.Columns.Add(dataColumn);

				DataTable storeTable = _dailyPercentagesDataSet.Tables.Add("Stores");

				//Create Columns and rows for datatable
				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Updated";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.Caption = "Set ID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Inherited";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Inherited RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Store RID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = true;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Store";
				dataColumn.Caption = "Store ID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Total%";
				dataColumn.Caption = "Total %";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day1";
				dataColumn.Caption = "Day 1";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day2";
				dataColumn.Caption = "Day 2";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day3";
				dataColumn.Caption = "Day 3";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day4";
				dataColumn.Caption = "Day 4";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day5";
				dataColumn.Caption = "Day 5";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day6";
				dataColumn.Caption = "Day 6";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day7";
				dataColumn.Caption = "Day 7";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeTable.Columns.Add(dataColumn);

				DataTable storeDateTable = _dailyPercentagesDataSet.Tables.Add("StoreDates");

				//Create Columns and rows for datatable

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "SetID";
				dataColumn.Caption = "Set ID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Store";
				dataColumn.Caption = "Store ID";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "ApplyButton";
				dataColumn.Caption = "ApplyButton";
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "DateRangeRID";
				dataColumn.Caption = "Date Range RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Object");
				dataColumn.ColumnName = "DateRange";
				dataColumn.Caption = "Date Range";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "DisplayDate";
				dataColumn.Caption = "Display Date";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

                // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
                dataColumn.ColumnName = "StartDateKey";
                dataColumn.Caption = "StartDateKey";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeDateTable.Columns.Add(dataColumn);

                dataColumn = new DataColumn();
                dataColumn.DataType = System.Type.GetType("System.Int32");
                dataColumn.ColumnName = "EndDateKey";
                dataColumn.Caption = "EndDateKey";
                dataColumn.ReadOnly = false;
                dataColumn.Unique = false;
                storeDateTable.Columns.Add(dataColumn);
                // End TT#2621 - JSmith - Duplicate weeks in daily sales

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Total%";
				dataColumn.Caption = "Total %";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day1";
				dataColumn.Caption = "Day 1";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day2";
				dataColumn.Caption = "Day 2";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day3";
				dataColumn.Caption = "Day 3";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day4";
				dataColumn.Caption = "Day 4";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day5";
				dataColumn.Caption = "Day 5";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day6";
				dataColumn.Caption = "Day 6";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //dataColumn.DataType = System.Type.GetType("System.String");
                dataColumn.DataType = System.Type.GetType("System.Double");
                //End TT#169
                dataColumn.ColumnName = "Day7";
				dataColumn.Caption = "Day 7";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				storeDateTable.Columns.Add(dataColumn);

				// add relationship between stores and sets
				_dailyPercentagesDataSet.Relations.Add("SetDates",
					_dailyPercentagesDataSet.Tables["Sets"].Columns["SetID"],
					_dailyPercentagesDataSet.Tables["SetDates"].Columns["SetID"]);
				_dailyPercentagesDataSet.Relations.Add("Stores",
					_dailyPercentagesDataSet.Tables["Sets"].Columns["SetID"],
					_dailyPercentagesDataSet.Tables["Stores"].Columns["SetID"]);
				_dailyPercentagesDataSet.Relations.Add("StoreDates",
					_dailyPercentagesDataSet.Tables["Stores"].Columns["Store"],
					_dailyPercentagesDataSet.Tables["StoreDates"].Columns["Store"]);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}


		private void BuildDailyPercentagesContextmenu()
		{
			try
			{
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuDailyPercentagesGrid.MenuItems.Clear();
                // End TT#2138
				MenuItem mnuItemInsert = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Add_Date_Range));
				MenuItem mnuItemCut= new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Cut));
				MenuItem mnuItemCopy = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Copy));
				MenuItem mnuItemPaste = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Paste));
				MenuItem mnuItemDelete = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Delete_Date_Range));
				MenuItem mnuItemApply = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Apply));
				MenuItem mnuItemExpandAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_ExpandAll));
				MenuItem mnuItemCollapseAll = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_CollapseAll));
				MenuItem mnuItemClear = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Clear_Values));
				MenuItem mnuItemReset = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Reset_Messages));
				MenuItem mnuItemBalance = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_BalanceTo100));
				if (!_securityDailyPcts.AllowUpdate)
				{
					mnuItemInsert.Enabled = false;
					mnuItemCut.Enabled = false;
					mnuItemCopy.Enabled = false;
					mnuItemPaste.Enabled = false;
					mnuItemDelete.Enabled = false;
					mnuItemApply.Enabled = false;
					mnuItemClear.Enabled = false;
					mnuItemReset.Enabled = false;
					mnuItemBalance.Enabled = false;
				}
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemInsert);
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemDelete);
				mnuDailyPercentagesGrid.MenuItems.Add("-");
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemApply);
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemClear);
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemBalance);
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemReset);
				mnuDailyPercentagesGrid.MenuItems.Add("-");
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemExpandAll);
				mnuDailyPercentagesGrid.MenuItems.Add(mnuItemCollapseAll);
				mnuItemInsert.Click += new System.EventHandler(this.mnuDPItemInsert_Click);
				mnuItemDelete.Click += new System.EventHandler(this.mnuDPItemDelete_Click);
				mnuItemApply.Click += new System.EventHandler(this.mnuDPItemApply_Click);
				mnuItemExpandAll.Click += new System.EventHandler(this.mnuDPItemExpandAll_Click);
				mnuItemCollapseAll.Click += new System.EventHandler(this.mnuDPItemCollapseAll_Click);
				mnuItemClear.Click += new System.EventHandler(this.mnuDPItemClear_Click);
				mnuItemReset.Click += new System.EventHandler(this.mnuDPItemReset_Click);
				mnuItemBalance.Click += new System.EventHandler(this.mnuDPItemBalance_Click);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuDailyPercentagesGrid_Popup(object sender, System.EventArgs e)
		{
			try
			{
				if (_securityDailyPcts.AllowUpdate)
				{
					if (this.ugDailyPercentages.ActiveRow == null ||
						this.ugDailyPercentages.ActiveRow.Band.Key == "Stores" ||
						this.ugDailyPercentages.ActiveRow.Band.Key == "StoreDates")
					{
						mnuDailyPercentagesGrid.MenuItems[3].Enabled = false;	// apply
					}
					else
					{
						mnuDailyPercentagesGrid.MenuItems[3].Enabled = true;	// apply
					}
                    // Begin TT#2610 - JSmith - Daily %s delete date range
                    if (this.ugDailyPercentages.ActiveRow.Band.Key == "Stores" &&
                        this.ugDailyPercentages.ActiveRow.Cells["Inherited"].Text == "True")
                    {
                        mnuDailyPercentagesGrid.MenuItems[4].Enabled = false;	// clear values
                    }
                    else if (this.ugDailyPercentages.ActiveRow.Band.Key == "StoreDates" &&
                        this.ugDailyPercentages.ActiveRow.ParentRow.Cells["Inherited"].Text == "True")
                    {
                        mnuDailyPercentagesGrid.MenuItems[4].Enabled = false;	// clear values
                    }
                    // End TT#2610 - JSmith - Daily %s delete date range
				} 
				//Begin TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                else if (!_allowEdit)
                {
                    if (this.ugDailyPercentages.ActiveRow == null ||
                        this.ugDailyPercentages.ActiveRow.Band.Key == "Stores" ||
                        this.ugDailyPercentages.ActiveRow.Band.Key == "StoreDates")
                    {
                        mnuDailyPercentagesGrid.MenuItems[3].Enabled = false;	// apply
                    }
                }
				//End TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuDPItemInsert_Click(object sender, System.EventArgs e)
		{
			try
			{
				AddDateRange();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void btnAddDateRange_Click(object sender, System.EventArgs e)
		{
			try
			{
				AddDateRange();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void AddDateRange()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				DailyPercentagesChangesMade = true;
				Infragistics.Win.UltraWinGrid.UltraGridBand band = this.ugDailyPercentages.ActiveRow.Band;
				if (band.Key == "Sets")
				{
					UltraGridRow addedRow = this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].AddNew();
					addedRow.Cells["DisplayDate"].Activate();
					addedRow.Cells["ApplyButton"].Value = _lblApply;
				}
				else
					if (band.Key == "SetDates")
				{
					this.ugDailyPercentages.ActiveRow = this.ugDailyPercentages.ActiveRow.ParentRow;
					UltraGridRow addedRow = this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].AddNew();
					addedRow.Cells["DisplayDate"].Activate();
					addedRow.Cells["ApplyButton"].Value = _lblApply;
				}
				else
					if (band.Key == "Stores")
				{
					UltraGridRow addedRow = this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].AddNew();
					addedRow.Cells["ApplyButton"].Appearance.BackColor = this.BackColor;
                    // Begin TT#2610 - JSmith - Daily %s delete date range
                    addedRow.Cells["ApplyButton"].Activation = Infragistics.Win.UltraWinGrid.Activation.Disabled;
                    // End TT#2610 - JSmith - Daily %s delete date range
				}
				else
					if (band.Key == "StoreDates")
				{
					this.ugDailyPercentages.ActiveRow = this.ugDailyPercentages.ActiveRow.ParentRow;
					UltraGridRow addedRow = this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].AddNew();
					addedRow.Cells["ApplyButton"].Appearance.BackColor = this.BackColor;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuDPItemCut_Cut(object sender, System.EventArgs e)
		{
		}

		private void mnuDPItemCopy_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuDPItemPaste_Click(object sender, System.EventArgs e)
		{
		}

		private void mnuDPItemClear_Click(object sender, System.EventArgs e)
		{
			try
			{
				ArrayList al;
				this.Cursor = Cursors.WaitCursor;
                // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                this.ugDailyPercentages.BeginUpdate();
                ugDailyPercentages.PerformAction(UltraGridAction.ExitEditMode);
                // End TT#2611 - JSmith - Clearing daily %s leaves a value
				DailyPercentagesChangesMade = true;
				_displayDeletePrompt = false;
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugDailyPercentages.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugDailyPercentages.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridSetDateBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;
                // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                _processAfterCellUpdate = false;
                // End TT#2611 - JSmith - Clearing daily %s leaves a value
				switch (activeRowBand.Key)
				{
					case "Sets":
					{
						ultraGridSetDateBand = activeRow.ChildBands["SetDates"];	// get "SetDates" band
						al = new ArrayList();
						foreach(  UltraGridRow setDateRow in ultraGridSetDateBand.Rows )	// delete each set date 
						{
							al.Add(setDateRow);
						}
						foreach( UltraGridRow setDateRow in al )	
						{
							setDateRow.Delete();
						}
						// reset set defaults
                        activeRow.Cells["Total%"].Value = System.DBNull.Value;
                        activeRow.Cells["Total%"].Appearance.Image = null;
                        activeRow.Cells["Total%"].Tag = null;
                        activeRow.Cells["Day1"].Value = System.DBNull.Value;
                        activeRow.Cells["Day1"].Appearance.Image = null;
                        activeRow.Cells["Day1"].Tag = null;
                        activeRow.Cells["Day2"].Value = System.DBNull.Value;
                        activeRow.Cells["Day2"].Appearance.Image = null;
                        activeRow.Cells["Day2"].Tag = null;
                        activeRow.Cells["Day3"].Value = System.DBNull.Value;
                        activeRow.Cells["Day3"].Appearance.Image = null;
                        activeRow.Cells["Day3"].Tag = null;
                        activeRow.Cells["Day4"].Value = System.DBNull.Value;
                        activeRow.Cells["Day4"].Appearance.Image = null;
                        activeRow.Cells["Day4"].Tag = null;
                        activeRow.Cells["Day5"].Value = System.DBNull.Value;
                        activeRow.Cells["Day5"].Appearance.Image = null;
                        activeRow.Cells["Day5"].Tag = null;
                        activeRow.Cells["Day6"].Value = System.DBNull.Value;
                        activeRow.Cells["Day6"].Appearance.Image = null;
                        activeRow.Cells["Day6"].Tag = null;
                        activeRow.Cells["Day7"].Value = System.DBNull.Value;
                        activeRow.Cells["Day7"].Appearance.Image = null;
                        activeRow.Cells["Day7"].Tag = null;

						ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
						foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows ) 
						{
							ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
							al = new ArrayList();
							foreach( UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )	// delete each store date
							{
								al.Add(storeDateRow);
							}
							foreach( UltraGridRow storeDateRow in al )	
							{
								storeDateRow.Delete();
							}
							// reset store defaults
                            storeRow.Cells["Updated"].Value = true;
                            storeRow.Cells["Total%"].Value = System.DBNull.Value;
                            storeRow.Cells["Total%"].Appearance.Image = null;
                            storeRow.Cells["Total%"].Tag = null;
                            storeRow.Cells["Day1"].Value = System.DBNull.Value;
                            storeRow.Cells["Day1"].Appearance.Image = null;
                            storeRow.Cells["Day1"].Tag = null;
                            storeRow.Cells["Day2"].Value = System.DBNull.Value;
                            storeRow.Cells["Day2"].Appearance.Image = null;
                            storeRow.Cells["Day2"].Tag = null;
                            storeRow.Cells["Day3"].Value = System.DBNull.Value;
                            storeRow.Cells["Day3"].Appearance.Image = null;
                            storeRow.Cells["Day3"].Tag = null;
                            storeRow.Cells["Day4"].Value = System.DBNull.Value;
                            storeRow.Cells["Day4"].Appearance.Image = null;
                            storeRow.Cells["Day4"].Tag = null;
                            storeRow.Cells["Day5"].Value = System.DBNull.Value;
                            storeRow.Cells["Day5"].Appearance.Image = null;
                            storeRow.Cells["Day5"].Tag = null;
                            storeRow.Cells["Day6"].Value = System.DBNull.Value;
                            storeRow.Cells["Day6"].Appearance.Image = null;
                            storeRow.Cells["Day6"].Tag = null;
                            storeRow.Cells["Day7"].Value = System.DBNull.Value;
                            storeRow.Cells["Day7"].Appearance.Image = null;
                            storeRow.Cells["Day7"].Tag = null;
                        }
						break;
					}
					case "SetDates":
					{
						// reset set defaults
                        activeRow.Cells["Total%"].Value = System.DBNull.Value;
                        activeRow.Cells["Total%"].Appearance.Image = null;
                        activeRow.Cells["Total%"].Tag = null;
                        activeRow.Cells["Day1"].Value = System.DBNull.Value;
                        activeRow.Cells["Day1"].Appearance.Image = null;
                        activeRow.Cells["Day1"].Tag = null;
                        activeRow.Cells["Day2"].Value = System.DBNull.Value;
                        activeRow.Cells["Day2"].Appearance.Image = null;
                        activeRow.Cells["Day2"].Tag = null;
                        activeRow.Cells["Day3"].Value = System.DBNull.Value;
                        activeRow.Cells["Day3"].Appearance.Image = null;
                        activeRow.Cells["Day3"].Tag = null;
                        activeRow.Cells["Day4"].Value = System.DBNull.Value;
                        activeRow.Cells["Day4"].Appearance.Image = null;
                        activeRow.Cells["Day4"].Tag = null;
                        activeRow.Cells["Day5"].Value = System.DBNull.Value;
                        activeRow.Cells["Day5"].Appearance.Image = null;
                        activeRow.Cells["Day5"].Tag = null;
                        activeRow.Cells["Day6"].Value = System.DBNull.Value;
                        activeRow.Cells["Day6"].Appearance.Image = null;
                        activeRow.Cells["Day6"].Tag = null;
                        activeRow.Cells["Day7"].Value = System.DBNull.Value;
                        activeRow.Cells["Day7"].Appearance.Image = null;
                        activeRow.Cells["Day7"].Tag = null;

						break;
					}
					case "Stores":
					{
						ultraGridStoreDateBand = activeRow.ChildBands["StoreDates"];	// get "StoreDates" band
						al = new ArrayList();
						foreach( UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )	// delete each store date
						{
							al.Add(storeDateRow);
						}
						foreach( UltraGridRow storeDateRow in al )	
						{
							storeDateRow.Delete();
						}
						// reset store defaults
                        activeRow.Cells["Updated"].Value = true;
                        activeRow.Cells["Total%"].Value = System.DBNull.Value;
                        activeRow.Cells["Total%"].Appearance.Image = null;
                        activeRow.Cells["Total%"].Tag = null;
                        activeRow.Cells["Day1"].Value = System.DBNull.Value;
                        activeRow.Cells["Day1"].Appearance.Image = null;
                        activeRow.Cells["Day1"].Tag = null;
                        activeRow.Cells["Day2"].Value = System.DBNull.Value;
                        activeRow.Cells["Day2"].Appearance.Image = null;
                        activeRow.Cells["Day2"].Tag = null;
                        activeRow.Cells["Day3"].Value = System.DBNull.Value;
                        activeRow.Cells["Day3"].Appearance.Image = null;
                        activeRow.Cells["Day3"].Tag = null;
                        activeRow.Cells["Day4"].Value = System.DBNull.Value;
                        activeRow.Cells["Day4"].Appearance.Image = null;
                        activeRow.Cells["Day4"].Tag = null;
                        activeRow.Cells["Day5"].Value = System.DBNull.Value;
                        activeRow.Cells["Day5"].Appearance.Image = null;
                        activeRow.Cells["Day5"].Tag = null;
                        activeRow.Cells["Day6"].Value = System.DBNull.Value;
                        activeRow.Cells["Day6"].Appearance.Image = null;
                        activeRow.Cells["Day6"].Tag = null;
                        activeRow.Cells["Day7"].Value = System.DBNull.Value;
                        activeRow.Cells["Day7"].Appearance.Image = null;
                        activeRow.Cells["Day7"].Tag = null;

						activeRow.Cells["Inherited RID"].Value = Include.NoRID;
						activeRow.Cells["Store"].Appearance.Image = null;
						break;
					}
					case "StoreDates":
					{
						// reset set defaults
                        activeRow.Cells["Total%"].Value = System.DBNull.Value;
						activeRow.Cells["Total%"].Appearance.Image = null;
						activeRow.Cells["Total%"].Tag = null;
						activeRow.Cells["Day1"].Value = System.DBNull.Value;
						activeRow.Cells["Day1"].Appearance.Image = null;
						activeRow.Cells["Day1"].Tag = null;
						activeRow.Cells["Day2"].Value = System.DBNull.Value;
						activeRow.Cells["Day2"].Appearance.Image = null;
						activeRow.Cells["Day2"].Tag = null;
						activeRow.Cells["Day3"].Value = System.DBNull.Value;
						activeRow.Cells["Day3"].Appearance.Image = null;
						activeRow.Cells["Day3"].Tag = null;
						activeRow.Cells["Day4"].Value = System.DBNull.Value;
						activeRow.Cells["Day4"].Appearance.Image = null;
						activeRow.Cells["Day4"].Tag = null;
						activeRow.Cells["Day5"].Value = System.DBNull.Value;
						activeRow.Cells["Day5"].Appearance.Image = null;
						activeRow.Cells["Day5"].Tag = null;
						activeRow.Cells["Day6"].Value = System.DBNull.Value;
						activeRow.Cells["Day6"].Appearance.Image = null;
						activeRow.Cells["Day6"].Tag = null;
						activeRow.Cells["Day7"].Value = System.DBNull.Value;
						activeRow.Cells["Day7"].Appearance.Image = null;
						activeRow.Cells["Day7"].Tag = null;

						break;
					}
				}
				_displayDeletePrompt = true;

                // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                this.ugDailyPercentages.EndUpdate();
                // End TT#2611 - JSmith - Clearing daily %s leaves a value
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
                // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                _processAfterCellUpdate = true;
                // End TT#2611 - JSmith - Clearing daily %s leaves a value
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuDPItemReset_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugDailyPercentages.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugDailyPercentages.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridSetDateBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;
				switch (activeRowBand.Key)
				{
					case "Sets":
					{
						ultraGridSetDateBand = activeRow.ChildBands["SetDates"];	// get "SetDates" band
						foreach(  UltraGridRow setDateRow in ultraGridSetDateBand.Rows )	// delete each set date 
						{
							ResetRowMessages(setDateRow);
						}
						ResetRowMessages(activeRow);
					
						ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
						foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows ) 
						{
							ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
							foreach( UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )	// delete each store date
							{
								ResetRowMessages(storeDateRow);
							}
							ResetRowMessages(storeRow);
						}
						break;
					}
					case "SetDates":
					{
						ResetRowMessages(activeRow);

						break;
					}
					case "Stores":
					{
						ultraGridStoreDateBand = activeRow.ChildBands["StoreDates"];	// get "StoreDates" band
						foreach(  UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )	// delete each store date 
						{
							ResetRowMessages(storeDateRow);
						}
						break;
					}
					case "StoreDates":
					{
						ResetRowMessages(activeRow);
						break;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void ResetRowMessages(Infragistics.Win.UltraWinGrid.UltraGridRow gridRow)
		{
			try
			{
				gridRow.Cells["DisplayDate"].Appearance.Image = null;
				gridRow.Cells["DisplayDate"].Tag = null;
				gridRow.Cells["Total%"].Appearance.Image = null;
				gridRow.Cells["Total%"].Tag = null;
				gridRow.Cells["Day1"].Appearance.Image = null;
				gridRow.Cells["Day1"].Tag = null;
				gridRow.Cells["Day2"].Appearance.Image = null;
				gridRow.Cells["Day2"].Tag = null;
				gridRow.Cells["Day3"].Appearance.Image = null;
				gridRow.Cells["Day3"].Tag = null;
				gridRow.Cells["Day4"].Appearance.Image = null;
				gridRow.Cells["Day4"].Tag = null;
				gridRow.Cells["Day5"].Appearance.Image = null;
				gridRow.Cells["Day5"].Tag = null;
				gridRow.Cells["Day6"].Appearance.Image = null;
				gridRow.Cells["Day6"].Tag = null;
				gridRow.Cells["Day7"].Appearance.Image = null;
				gridRow.Cells["Day7"].Tag = null;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuDPItemBalance_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugDailyPercentages.BeginUpdate();
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugDailyPercentages.ActiveRow;
				if (activeRow == null)
				{
					MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NoActiveRow),
						this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					BasicSpread spreader = new BasicSpread();
					ArrayList inValues = new ArrayList();
					ArrayList outValues;

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day1"].Value) ||
                    //    (string)activeRow.Cells["Day1"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day1"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day1"].Value, CultureInfo.CurrentUICulture));
					}

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day2"].Value) ||
                    //    (string)activeRow.Cells["Day2"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day2"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day2"].Value, CultureInfo.CurrentUICulture));
					}
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day3"].Value) ||
                    //    (string)activeRow.Cells["Day3"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day3"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day3"].Value, CultureInfo.CurrentUICulture));
					}

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day4"].Value) ||
                    //    (string)activeRow.Cells["Day4"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day4"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day4"].Value, CultureInfo.CurrentUICulture));
					}

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day5"].Value) ||
                    //    (string)activeRow.Cells["Day5"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day5"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day5"].Value, CultureInfo.CurrentUICulture));
					}

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day6"].Value) ||
                    //    (string)activeRow.Cells["Day6"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day6"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day6"].Value, CultureInfo.CurrentUICulture));
					}

                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //if (Convert.IsDBNull(activeRow.Cells["Day7"].Value) ||
                    //    (string)activeRow.Cells["Day7"].Value == string.Empty)	// cell is empty
                    if (Convert.IsDBNull(activeRow.Cells["Day7"].Value))	// cell is empty
                    //End TT#169
                    {
						inValues.Add(0);
					}
					else
					{
						inValues.Add(Convert.ToDouble(activeRow.Cells["Day7"].Value, CultureInfo.CurrentUICulture));
					}
					try
					{
						spreader.ExecuteSimpleSpread(100, inValues, 3, out outValues);

						activeRow.Cells["Day1"].Value = outValues[0];
						activeRow.Cells["Day2"].Value = outValues[1];
						activeRow.Cells["Day3"].Value = outValues[2];
						activeRow.Cells["Day4"].Value = outValues[3];
						activeRow.Cells["Day5"].Value = outValues[4];
						activeRow.Cells["Day6"].Value = outValues[5];
						activeRow.Cells["Day7"].Value = outValues[6];
						double total = 0; 
						foreach(double dailyValue in outValues)
						{
							total += Convert.ToDouble(Convert.ToDecimal(dailyValue, CultureInfo.CurrentUICulture));
						}
						activeRow.Cells["Total%"].Value = total;
						// turn off inheritance image
						if (activeRow.Band.Key == "Stores")
						{
							activeRow.Cells["Store"].Appearance.Image = null;
							activeRow.Cells["Store"].Tag = null;
						}
						else
							if (activeRow.Band.Key == "StoreDates")
						{
							Infragistics.Win.UltraWinGrid.UltraGridRow storeRow = activeRow.ParentRow;
							storeRow.Cells["Store"].Appearance.Image = null;
							storeRow.Cells["Store"].Tag = null;
						}

						if (activeRow.Band.Key == "Stores")
						{
							DailyPercentagesChangesMade = true;
							activeRow.Cells["Updated"].Value = true;
						}
						else
							if (activeRow.Band.Key == "StoreDates")
						{
							DailyPercentagesChangesMade = true;
							Infragistics.Win.UltraWinGrid.UltraGridRow storeRow = activeRow.ParentRow;
							storeRow.Cells["Updated"].Value = true;
						}

						Resize_DPcolumns();
						this.ugDailyPercentages.EndUpdate();
					}
					catch ( Exception error)
					{
						MessageBox.Show(error.Message);
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void Resize_DPcolumns()
		{
			try
			{
				this.ugDailyPercentages.DisplayLayout.AutoFitStyle = AutoFitStyle.ResizeAllColumns;

				foreach ( Infragistics.Win.UltraWinGrid.UltraGridBand band in this.ugDailyPercentages.DisplayLayout.Bands )
				{
					foreach ( Infragistics.Win.UltraWinGrid.UltraGridColumn column in band.Columns )
					{
						switch (column.Header.Column.Key)
						{
							case "Total%":
							case "Day1":
							case "Day2":
							case "Day3":
							case "Day4":
							case "Day5":
							case "Day6":
							case "Day7":
								column.PerformAutoResize(Infragistics.Win.UltraWinGrid.PerformAutoSizeType.AllRowsInBand);
								break;
						}
					}
				}
				this.ugDailyPercentages.DisplayLayout.AutoFitStyle = AutoFitStyle.None;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuDPItemDelete_Click(object sender, System.EventArgs e)
		{
			try
			{
				DeleteDateRange();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void btnDeleteDateRange_Click(object sender, System.EventArgs e)
		{
			try
			{
				DeleteDateRange();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void DeleteDateRange()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugDailyPercentages.BeginUpdate();
				this.ugDailyPercentages.SuspendRowSynchronization();
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugDailyPercentages.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridBand band = this.ugDailyPercentages.ActiveRow.Band;
				if (band.Key == "SetDates")
				{
					_displayDeletePrompt = false;
					DateRangeProfile dateRange = null;
					string setID = null;
					if (!Convert.IsDBNull(activeRow.Cells["DateRange"].Value))
					{
						dateRange = (DateRangeProfile)activeRow.Cells["DateRange"].Value;
						setID = (string) activeRow.Cells["SetID"].Value;
					}
					this.ugDailyPercentages.ActiveRow.Delete();
					if (dateRange != null)
					{
						string selExpression = "SetID = '" + setID + "' AND DateRangeRID = " + dateRange.Key.ToString(CultureInfo.CurrentUICulture);
						DataRow[] storeDateRows = _dailyPercentagesDataSet.Tables["StoreDates"].Select(selExpression);
						foreach (DataRow dr in storeDateRows)
						{
							dr.Delete();
						}
					}

					_displayDeletePrompt = true;
				}
				else
					if (band.Key == "StoreDates")
				{
					DailyPercentagesChangesMade = true;
					this.ugDailyPercentages.ActiveRow.Delete();
				}
				_dailyPercentagesDataSet.AcceptChanges();
				this.ugDailyPercentages.ResumeRowSynchronization();
				this.ugDailyPercentages.EndUpdate();
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				this.Cursor = Cursors.Default;
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuDPItemExpandAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugDailyPercentages.Rows.ExpandAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuDPItemCollapseAll_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugDailyPercentages.Rows.CollapseAll(true);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuDPItemApply_Click(object sender, System.EventArgs e)
		{
			try
			{
				ApplyDailyPercentages();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ApplyDailyPercentages()
		{
            // Begin TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores
            //// Begin TT#2621 - JSmith - Duplicate weeks in daily sales
            //ArrayList alOverlapRow = new ArrayList();
            //// End TT#2621 - JSmith - Duplicate weeks in daily sales
            // End TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores

			try
			{
				this.Cursor = Cursors.WaitCursor;
				this.ugDailyPercentages.BeginUpdate();
				this.ugDailyPercentages.SuspendRowSynchronization();
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = this.ugDailyPercentages.ActiveRow.Band;
				Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugDailyPercentages.ActiveRow;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;
				Infragistics.Win.UltraWinGrid.UltraGridRow visibleRow = this.ugDailyPercentages.Rows.GetRowAtVisibleIndex( 0 );

				if (activeRowBand.Key == "Sets")		// apply defaults to all stores in set
				{
					DailyPercentagesChangesMade = true;
					ultraGridStoreBand = activeRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRow.Cells["Store"].Appearance.Image = null;
						storeRow.Cells["Store"].Tag = null;
						storeRow.Cells["Updated"].Value = true;
                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        storeRow.Cells["Inherited"].Value = false;
                        // End TT#2610 - JSmith - Daily %s delete date range
						storeRow.Cells["Total%"].Value = activeRow.Cells["Total%"].Value;
						storeRow.Cells["Day1"].Value = activeRow.Cells["Day1"].Value;
						storeRow.Cells["Day2"].Value = activeRow.Cells["Day2"].Value;
						storeRow.Cells["Day3"].Value = activeRow.Cells["Day3"].Value;
						storeRow.Cells["Day4"].Value = activeRow.Cells["Day4"].Value;
						storeRow.Cells["Day5"].Value = activeRow.Cells["Day5"].Value;
						storeRow.Cells["Day6"].Value = activeRow.Cells["Day6"].Value;
						storeRow.Cells["Day7"].Value = activeRow.Cells["Day7"].Value;
					}
				}
				else
					if (activeRowBand.Key == "SetDates")
				{
					string errorMessage = null;
					bool dateRangeFound = false;
					bool dateRangeOverlapFound = false;
					int dateRangeOverlapCount = 0;
					Infragistics.Win.UltraWinGrid.UltraGridRow storeDateUpdateRow = null;
					DateRangeProfile storeDateRange = null;
					DailyPercentagesChangesMade = true;
					if (Convert.IsDBNull(activeRow.Cells["DateRange"].Value))
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DateRequiredToApply);
						activeRow.Cells["DisplayDate"].Appearance.Image = ErrorImage;
						activeRow.Cells["DisplayDate"].Tag = errorMessage;
						MessageBox.Show(errorMessage,
							this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						return;
					}
					else
					{
						activeRow.Cells["DisplayDate"].Appearance.Image = null;
						activeRow.Cells["DisplayDate"].Tag = null;
					
						DateRangeProfile dateRange = (DateRangeProfile)activeRow.Cells["DateRange"].Value;
						string SetID = (string)activeRow.Cells["SetID"].Value;
						ProfileList setWeekProfileList = _SAB.ClientServerSession.Calendar.GetWeekRange(dateRange, null);
						double convertedValue=0,total=0,day1=0,day2=0,day3=0,day4=0,day5=0,day6=0,day7=0;
						if (ValidDailyPercentageValue(activeRow.Cells["Total%"], ref errorMessage, ref convertedValue))
						{
							total = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day1"], ref errorMessage, ref convertedValue))
						{
							day1 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day2"], ref errorMessage, ref convertedValue))
						{
							day2 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day3"], ref errorMessage, ref convertedValue))
						{
							day3 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day4"], ref errorMessage, ref convertedValue))
						{
							day4 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day5"], ref errorMessage, ref convertedValue))
						{
							day5 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day6"], ref errorMessage, ref convertedValue))
						{
							day6 = convertedValue;
						}
						if (ValidDailyPercentageValue(activeRow.Cells["Day7"], ref errorMessage, ref convertedValue))
						{
							day7 = convertedValue;
						}

						if (Convert.ToDecimal(day1, CultureInfo.CurrentUICulture)+Convert.ToDecimal(day2, CultureInfo.CurrentUICulture)+Convert.ToDecimal(day3, CultureInfo.CurrentUICulture)+
							Convert.ToDecimal(day4, CultureInfo.CurrentUICulture)+Convert.ToDecimal(day5)+Convert.ToDecimal(day6, CultureInfo.CurrentUICulture)+
							Convert.ToDecimal(day7, CultureInfo.CurrentUICulture) != 100)
						{
							MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBe100ToApply),
								this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
						else
						{
							Infragistics.Win.UltraWinGrid.UltraGridRow setRow = activeRow.ParentRow;	//  get the set row
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
								dateRangeFound = false;
								dateRangeOverlapFound = false;
								ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
								foreach(  UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )	// search to see if date range already in store
								{
                                    // Begin TT#341-MD - JSmith - Client Application Process Error
                                    if (storeDateRow.Cells["DateRange"].Value == DBNull.Value)
                                    {
                                        continue;
                                    }
                                    // End TT#341-MD - JSmith - Client Application Process Error

									storeDateRange = (DateRangeProfile)storeDateRow.Cells["DateRange"].Value;
									if (storeDateRange.Key == dateRange.Key)
									{
										storeDateUpdateRow = storeDateRow;
										dateRangeFound = true;
										break;
									}
									else
									{
										ProfileList storeWeekProfileList = _SAB.ClientServerSession.Calendar.GetWeekRange(storeDateRange, null);
                                        // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                                        if (setWeekProfileList.Count == storeWeekProfileList.Count &&
                                            ((WeekProfile)setWeekProfileList[0]).Key == ((WeekProfile)storeWeekProfileList[0]).Key &&
                                            ((WeekProfile)setWeekProfileList[setWeekProfileList.Count - 1]).Key == ((WeekProfile)storeWeekProfileList[storeWeekProfileList.Count - 1]).Key)
                                        {
                                            // Begin TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores
                                            //dateRangeOverlapFound = true;
                                            //++dateRangeOverlapCount;
                                            //storeDateRow.Cells["DisplayDate"].Appearance.Image = ErrorImage;
                                            //storeDateRow.Cells["DisplayDate"].Tag = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DailyPercentDateOverlap);
                                            //alOverlapRow.Add(storeDateRow);
                                            storeDateUpdateRow = storeDateRow;
                                            dateRangeFound = true;
                                            // End TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores
                                        }
                                        //foreach (WeekProfile weekProfile in setWeekProfileList)
                                        //{
                                        //    if (storeWeekProfileList.Contains(weekProfile.Key))
                                        //    {
                                        //        dateRangeOverlapFound = true;
                                        //        ++dateRangeOverlapCount;
                                        //        storeDateRow.Cells["DisplayDate"].Appearance.Image = ErrorImage;
                                        //        storeDateRow.Cells["DisplayDate"].Tag = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DailyPercentDateOverlap);
                                        //        break;
                                        //    }
                                        //}
                                        // End TT#2621 - JSmith - Duplicate weeks in daily sales
									}
								}
								if (dateRangeFound)
								{
									storeDateUpdateRow.Cells["Total%"].Value = activeRow.Cells["Total%"].Value;
									storeDateUpdateRow.Cells["Day1"].Value = activeRow.Cells["Day1"].Value;
									storeDateUpdateRow.Cells["Day2"].Value = activeRow.Cells["Day2"].Value;
									storeDateUpdateRow.Cells["Day3"].Value = activeRow.Cells["Day3"].Value;
									storeDateUpdateRow.Cells["Day4"].Value = activeRow.Cells["Day4"].Value;
									storeDateUpdateRow.Cells["Day5"].Value = activeRow.Cells["Day5"].Value;
									storeDateUpdateRow.Cells["Day6"].Value = activeRow.Cells["Day6"].Value;
									storeDateUpdateRow.Cells["Day7"].Value = activeRow.Cells["Day7"].Value;
									storeRow.Cells["DisplayDate"].Appearance.Image = null;
									storeRow.Cells["DisplayDate"].Tag = null;
								}
								else
									if (!dateRangeOverlapFound)
								{
									this.ugDailyPercentages.ActiveRow = storeRow;
									string StoreId = (string)storeRow.Cells["Store"].Value;
									DateRangeProfile drp = dateRange.Clone();
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(dateRange.Key);
									}
									// Begin TT#2615 - JSmith - Daily Percents - Using the Apply button for a set
									//_dailyPercentagesDataSet.Tables["StoreDates"].Rows.Add(new object[] { SetID, StoreId, " ", drp.Key, drp, drp.DisplayDate, total,day1,day2,day3,day4,day5,day6,day7});
                                    UltraGridRow addedRow = this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].AddNew();
                                    addedRow.Cells["SetID"].Value = SetID;
                                    addedRow.Cells["Store"].Value = StoreId;
                                    addedRow.Cells["ApplyButton"].Value = " ";
                                    addedRow.Cells["DateRangeRID"].Value = drp.Key;
                                    addedRow.Cells["DateRange"].Value = drp;
                                    addedRow.Cells["DisplayDate"].Value = drp.DisplayDate;
                                    addedRow.Cells["StartDateKey"].Value = drp.StartDateKey;
                                    addedRow.Cells["EndDateKey"].Value = drp.EndDateKey;
                                    addedRow.Cells["Total%"].Value = total;
                                    addedRow.Cells["Day1"].Value = day1;
                                    addedRow.Cells["Day2"].Value = day2;
                                    addedRow.Cells["Day3"].Value = day3;
                                    addedRow.Cells["Day4"].Value = day4;
                                    addedRow.Cells["Day5"].Value = day5;
                                    addedRow.Cells["Day6"].Value = day6;
                                    addedRow.Cells["Day7"].Value = day7;
									// End TT#2615 - JSmith - Daily Percents - Using the Apply button for a set
                                    // Begin TT#2610 - JSmith - Daily %s delete date range
                                    storeRow.Cells["Updated"].Value = true;
                                    storeRow.Cells["Store"].Appearance.Image = null;
                                    storeRow.Cells["Store"].Tag = null;
                                    storeRow.Cells["Inherited"].Value = false;
                                    // End TT#2610 - JSmith - Daily %s delete date range
                                    // Begin TT#2615 - JSmith - Daily Percents - Using the Apply button for a set
								}
							}

							if (dateRangeOverlapCount > 0)
							{
								string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DailyPercentageOverlapCount);
								text = text.Replace("{0}", dateRangeOverlapCount.ToString(CultureInfo.CurrentUICulture));
								MessageBox.Show (text,  this.Text,
									MessageBoxButtons.OK, MessageBoxIcon.Error);
							}
						}
					}
				}
				AddReoccurringImage();
				// Begin TT#2615 - JSmith - Daily Percents - Using the Apply button for a set
                //_dailyPercentagesDataSet.AcceptChanges();
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Clear();
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("StartDateKey", false);
                this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("EndDateKey", true);
				// End TT#2615 - JSmith - Daily Percents - Using the Apply button for a set
				this.ugDailyPercentages.ActiveRow = visibleRow;
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.ugDailyPercentages.ResumeRowSynchronization();
				this.ugDailyPercentages.EndUpdate();
                // Begin TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores
                //// Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                //foreach (UltraGridRow overlapRow in alOverlapRow)
                //{
                //    overlapRow.Cells["DisplayDate"].Appearance.Image = ErrorImage;
                //    overlapRow.Cells["DisplayDate"].Tag = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DailyPercentDateOverlap);
                //}
                //// End TT#2621 - JSmith - Duplicate weeks in daily sales
                // End TT#347-MD - JSmith - Daily % will not update same date range from the Set level to the Stores
				this.Cursor = Cursors.Default;
			}

		}
		
		private void DailyPercentages_Populate(bool doingCopy)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				bool updated = false;
				double total = 0;
				StoreDailyPercentagesProfile sdpp;

				DailyPercentages_Define();
				foreach(StoreGroupLevelListViewProfile sglp in _dailyPercentagesGroupLevelList)
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //_dailyPercentagesDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, "(Defaults)", string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty});
                    _dailyPercentagesDataSet.Tables["Sets"].Rows.Add(new object[] { sglp.Name, "(Defaults)", null, null, null, null, null, null, null, null });
                    //End TT#169

					foreach(StoreProfile storeProfile in sglp.Stores)
					{
						updated = false;
						if (_storeDailyPercentagesList.Contains(storeProfile.Key))
						{
							sdpp = (StoreDailyPercentagesProfile)_storeDailyPercentagesList.FindKey(storeProfile.Key);
							if (doingCopy ||
								sdpp.StoreDailyPercentagesDefaultChangeType != eChangeType.none)
							{
								updated = true;
							}
							if (sdpp.HasDefaultValues)
							{
								total = sdpp.Day1Default + sdpp.Day2Default + sdpp.Day3Default + sdpp.Day4Default + sdpp.Day5Default
									+ sdpp.Day6Default + sdpp.Day7Default;
								_dailyPercentagesDataSet.Tables["Stores"].Rows.Add(new object[] { updated, sglp.Name, sdpp.StoreDailyPercentagesIsInherited,
																									sdpp.StoreDailyPercentagesInheritedFromNodeRID,
																									storeProfile.Key, storeProfile.Text, "(Defaults)", total,sdpp.Day1Default,sdpp.Day2Default,sdpp.Day3Default,sdpp.Day4Default,sdpp.Day5Default,sdpp.Day6Default,sdpp.Day7Default});
							}
							else
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //_dailyPercentagesDataSet.Tables["Stores"].Rows.Add(new object[] { updated, sglp.Name, sdpp.StoreDailyPercentagesIsInherited,
                                //                                                                    sdpp.StoreDailyPercentagesInheritedFromNodeRID
                                //                                                                    , storeProfile.Key, storeProfile.Text, "(Defaults)", string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty});
                                _dailyPercentagesDataSet.Tables["Stores"].Rows.Add(new object[] { updated, sglp.Name, sdpp.StoreDailyPercentagesIsInherited,
																									sdpp.StoreDailyPercentagesInheritedFromNodeRID
																									, storeProfile.Key, storeProfile.Text, "(Defaults)", null,null,null,null,null,null,null,null});
                                //End TT#169
                            }
							foreach (DailyPercentagesProfile dpp in sdpp.DailyPercentagesList)
							{
								total = dpp.Day1 + dpp.Day2 + dpp.Day3 + dpp.Day4 + dpp.Day5 + dpp.Day6 + dpp.Day7;
								DateRangeProfile drp = dpp.DateRange;
								if (doingCopy)
								{
									if (drp.Name == null ||
										drp.Name.Trim().Length == 0)  // only dup date ranges that DON'T have a name
									{
										drp = _SAB.ClientServerSession.Calendar.GetDateRangeClone(drp.Key);
									}
								}
                                // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                                //_dailyPercentagesDataSet.Tables["StoreDates"].Rows.Add(new object[] { sglp.Name, storeProfile.Text, " ", drp.Key, drp, drp.DisplayDate, total,dpp.Day1,dpp.Day2,dpp.Day3,dpp.Day4,dpp.Day5,dpp.Day6,dpp.Day7});
                                _dailyPercentagesDataSet.Tables["StoreDates"].Rows.Add(new object[] { sglp.Name, storeProfile.Text, " ", drp.Key, drp, drp.DisplayDate, drp.StartDateKey, drp.EndDateKey, total, dpp.Day1, dpp.Day2, dpp.Day3, dpp.Day4, dpp.Day5, dpp.Day6, dpp.Day7 });
                                // End TT#2621 - JSmith - Duplicate weeks in daily sales
							}
						}
						else
						{
                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //_dailyPercentagesDataSet.Tables["Stores"].Rows.Add(new object[] { updated, sglp.Name, false, Include.NoRID,
                            //                                                                    storeProfile.Key, storeProfile.Text, 
                            //                                                                    "(Defaults)", string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty,string.Empty});
                            _dailyPercentagesDataSet.Tables["Stores"].Rows.Add(new object[] { updated, sglp.Name, false, Include.NoRID,
																								storeProfile.Key, storeProfile.Text, 
																								"(Defaults)", null,null,null,null,null,null,null,null});
                            //End TT#169
                        }
					}
				}
				this.ugDailyPercentages.DataSource = _dailyPercentagesDataSet;

				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityDailyPcts;
					SetControlReadOnly(this.tabDailyPercentages, !_securityDailyPcts.AllowUpdate);
				}
				
				DailyPercentages_SetRowProperties(securityProfile, doingCopy);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void DailyPercentages_SetRowProperties(FunctionSecurityProfile securityProfile, bool aDoingCopy)
		{
			try
			{
				HierarchyNodeProfile hnp = null;
				int inheritedRID;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				foreach(  UltraGridRow setRow in this.ugDailyPercentages.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if(storeRow.Cells["Inherited"].Text == "True" &&
							!aDoingCopy)
						{
							inheritedRID = Convert.ToInt32(storeRow.Cells["Inherited RID"].Value, CultureInfo.CurrentUICulture);
							if (hnp == null || hnp.Key != inheritedRID)
							{
								hnp = _SAB.HierarchyServerSession.GetNodeData(inheritedRID);
							}
							string inheritMsg = _txtInheritedFrom + hnp.Text;
							storeRow.Cells["Store"].Appearance.Image = InheritanceImage;
							storeRow.Cells["Store"].Tag = inheritMsg;
						}
						else
						{
							storeRow.Cells["Store"].Appearance.Image = null;
							storeRow.Cells["Store"].Tag = null;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void AddReoccurringImage()
		{
			try
			{
				// put reoccurring image in cells
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridSetDatesBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;

				foreach(  UltraGridRow setRow in this.ugDailyPercentages.Rows )
				{
					ultraGridSetDatesBand = setRow.ChildBands["SetDates"];	// get "SetDates" band
					foreach(  UltraGridRow setDateRow in ultraGridSetDatesBand.Rows )
					{
						if (setDateRow.Cells["DateRange"].Value == DBNull.Value)
						{
							continue;
						}
						DateRangeProfile DateRange = (DateRangeProfile)setDateRow.Cells["DateRange"].Value;
						if (DateRange.DateRangeType == eCalendarRangeType.Reoccurring)
						{
							setDateRow.Cells["DisplayDate"].Appearance.Image = ReoccurringImage;
						}
						else
						{
							setDateRow.Cells["DisplayDate"].Appearance.Image = null;
						}
					}

					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
						foreach(  UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )
						{
							if (storeDateRow.Cells["DateRange"].Value == DBNull.Value)
							{
								continue;
							}
							DateRangeProfile DateRange = (DateRangeProfile)storeDateRow.Cells["DateRange"].Value;
							if (DateRange.DateRangeType == eCalendarRangeType.Reoccurring)
							{
								storeDateRow.Cells["DisplayDate"].Appearance.Image = ReoccurringImage;
							}
							else
							{
								storeDateRow.Cells["DisplayDate"].Appearance.Image = null;
							}
                            // Begin TT#2610 - JSmith - Daily %s delete date range
                            storeDateRow.Cells["ApplyButton"].Activation = Infragistics.Win.UltraWinGrid.Activation.Disabled;
                            // End TT#2610 - JSmith - Daily %s delete date range
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugDailyPercentages, e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				if (_dailyPercentagesIsPopulated)
				{
					DailyPercentagesChangesMade = true;
					Infragistics.Win.UltraWinGrid.UltraGridBand band = e.Cell.Row.Band;
					if (band.Key == "Stores")
					{
						e.Cell.Row.Cells["Updated"].Value = true;
						e.Cell.Row.Cells["Store"].Appearance.Image = null;
						e.Cell.Row.Cells["Store"].Tag = null;
                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        e.Cell.Row.Cells["Inherited"].Value = false;
                        // End TT#2610 - JSmith - Daily %s delete date range
					}
					else
						if (band.Key == "StoreDates")
					{
						e.Cell.Row.ParentRow.Cells["Updated"].Value = true;
                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        e.Cell.Row.ParentRow.Cells["Inherited"].Value = false;
                        e.Cell.Row.ParentRow.Cells["Store"].Appearance.Image = null;
                        e.Cell.Row.ParentRow.Cells["Store"].Tag = null;
                        // End TT#2610 - JSmith - Daily %s delete date range
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_BeforeExitEditMode(object sender, Infragistics.Win.UltraWinGrid.BeforeExitEditModeEventArgs e)
		{
			try
			{
				string errorMessage = null;
				Infragistics.Win.UltraWinGrid.UltraGridBand band = ugDailyPercentages.ActiveCell.Band;
				if (DoValueByValueEdits)
				{
					switch (ugDailyPercentages.ActiveCell.Column.Header.Column.Key)
					{
						case "Day1":
						case "Day2":
						case "Day3":
						case "Day4":
						case "Day5":
						case "Day6":
						case "Day7":
						{
							double convertedValue = 0;
							if (!ValidDailyPercentageValue(ugDailyPercentages.ActiveCell, ref errorMessage, ref convertedValue))
							{
								MessageBox.Show (errorMessage,  this.Text, 	MessageBoxButtons.OK, MessageBoxIcon.Error);
								e.Cancel = true;
							}
							break;
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}
		
		private void ugDailyPercentages_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
                // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                if (!_processAfterCellUpdate)
                {
                    return;
                }
                // End TT#2611 - JSmith - Clearing daily %s leaves a value

				if (e.Cell.Column.Key != "Total%")
				{
					Infragistics.Win.UltraWinGrid.UltraGridBand band = e.Cell.Band;
					switch (e.Cell.Column.Header.Column.Key)
					{
						case "Day1":
						case "Day2":
						case "Day3":
						case "Day4":
						case "Day5":
						case "Day6":
						case "Day7":
						{
							double convertedValue = 0;
							string errorMessage = null;
							if (!ValidDailyPercentageValue(e.Cell, ref errorMessage, ref convertedValue))
							{
							}
							else
							{
								decimal totalValue = 0;
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY1"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY2"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY3"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY4"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY5"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY6"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}
								if (ValidDailyPercentageValue(e.Cell.Row.Cells["DAY7"], ref errorMessage, ref convertedValue))
								{
									totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
								}

								if (totalValue == 0)
								{
                                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                    //e.Cell.Row.Cells["Total%"].Value = string.Empty;
                                    e.Cell.Row.Cells["Total%"].Value = System.DBNull.Value;
                                    //End TT#169
                                }
								else
								{
									e.Cell.Row.Cells["Total%"].Value = Convert.ToDouble(totalValue, CultureInfo.CurrentUICulture);
								}
							}
							break;
						}
					}
                    if (e.Cell.Row.Band.Key == "Stores")
                    {
                        if (e.Cell.Column.Key.ToString() != "Updated")
                        {
                            //BEGIN TT#2015 - gtaylor - Apply Changes to Lower Levels
                            // create the change profile and add it to the list
                            ChangeProfileDailyPct dpChange = new ChangeProfileDailyPct(
                                Convert.ToInt16(e.Cell.Row.Cells["Store RID"].Value), // storeRID
                                e.Cell.Row.Cells["Store"].Value.ToString(), // storeID
                                e.Cell.Text.ToString(), // new value
                                e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                                e.Cell.Column.Header.Caption.ToString(),
                                e.Cell.Column.Index
                            );
                            // create keyvaluepair and populate
                            KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(dpChange.ChangeProfileKey, dpChange);
                            //  add to nodechangeprofile list
                            _nodeChangeProfile.Add(eProfileType.DailyPercentages, _kvp);
                            //END TT#2015 - gtaylor - Apply Changes to Lower Levels
                        }
                    }
                    if (e.Cell.Row.Band.Key == "StoreDates")
                    {
                        e.Cell.Row.ParentRow.Cells["Updated"].Value = true;
                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        e.Cell.Row.ParentRow.Cells["Inherited"].Value = false;
                        e.Cell.Row.ParentRow.Cells["Store"].Appearance.Image = null;
                        e.Cell.Row.ParentRow.Cells["Store"].Tag = null;
                        // End TT#2610 - JSmith - Daily %s delete date range
                        if (e.Cell.Column.Key.ToString() != "Updated")
                        {
                            //BEGIN TT#2015 - gtaylor - Apply Changes to Lower Levels
                            // create the change profile and add it to the list
                            ChangeProfileDailyPct dpChange = new ChangeProfileDailyPct(
                                Convert.ToInt16(e.Cell.Row.ParentRow.Cells["Store RID"].Value), // storeRID
                                e.Cell.Row.Cells["Store"].Value.ToString(), // storeID
                                e.Cell.Text.ToString(), // new value
                                e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                                e.Cell.Column.Header.Caption.ToString(),
                                e.Cell.Column.Index
                            );
                            // create keyvaluepair and populate
                            KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(dpChange.ChangeProfileKey, dpChange);
                            //  add to nodechangeprofile list
                            _nodeChangeProfile.Add(eProfileType.DailyPercentages, _kvp);
                            //END TT#2015 - gtaylor - Apply Changes to Lower Levels
                        }
                    }
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_BeforeRowsDeleted(object sender, Infragistics.Win.UltraWinGrid.BeforeRowsDeletedEventArgs e)
		{
			try
			{
				if (_displayDeletePrompt)
				{
					e.DisplayPromptMsg = true;
				}
				else
				{
					e.DisplayPromptMsg = false;
				}

                // Begin TT#2610 - JSmith - Daily %s delete date range
                _gridRow = null;
                if (e.Rows[0].Band.Key == "Stores")
                {
                    _gridRow = e.Rows[0];
                }
                else if (e.Rows[0].Band.Key == "StoreDates")
                {
                    _gridRow = e.Rows[0].ParentRow;
                }
                // End TT#2610 - JSmith - Daily %s delete date range
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        // Begin TT#2610 - JSmith - Daily %s delete date range
        void ugDailyPercentages_AfterRowsDeleted(object sender, System.EventArgs e)
        {
            if (_gridRow != null)
            {
                _gridRow.Cells["Updated"].Value = true;
                _gridRow.Cells["Inherited"].Value = false;
                _gridRow.Cells["Store"].Appearance.Image = null;
                _gridRow.Cells["Store"].Tag = null;
            }
        }
        // End TT#2610 - JSmith - Daily %s delete date range

		private void cbDPStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
		{
			try
			{
				EditMsgs em = new EditMsgs();
		
				if (_dailyPercentagesIsPopulated)
				{
					if (ValidTabDailyPercentages (ref em))
					{
						UpdateDailyPercentagesData();
						StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_dailyPercentagesGroupList[cbDPStoreAttribute.SelectedIndex];
						_groupRID = storeGroup.Key;
                        _dailyPercentagesGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
						DailyPercentages_Populate(false);
						AddReoccurringImage();
					}
					else
					{
						if (Convert.ToInt32(cbDPStoreAttribute.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
						{
							cbDPStoreAttribute.SelectedValue = _groupRID;
							_errors = null;
							for (int i=0; i<em.EditMessages.Count; i++)
							{
								EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
								AddErrorMessage(emm);
							}
							MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        private void cbDPStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {

        }

        private void cbDPStoreAttribute_DragDrop(object sender, DragEventArgs e)
        {
            try
            {
                bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

                if (isSuccessfull)
                {
                    ChangePending = true;
                }
            }
            catch (Exception exc)
            {
                HandleException(exc);
            }
        }

		private void ugDailyPercentages_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			try
			{
				switch (e.Cell.Column.Key)
				{
					case "ApplyButton":
						if (_securityDailyPcts.AllowUpdate)
						{
							ApplyDailyPercentages();
						}
						break;
					case "DisplayDate":
						if (_securityDailyPcts.AllowUpdate)
						{
							CalendarDateSelector frmCalDtSelector = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[]{_SAB});
							frmCalDtSelector.AllowReoccurring = true;
							frmCalDtSelector.AllowDynamic = false;
							if (e.Cell.Row.Cells["DateRangeRID"].Value != null &&
								e.Cell.Row.Cells["DateRangeRID"].Value != System.DBNull.Value)
							{
								frmCalDtSelector.DateRangeRID = Convert.ToInt32(e.Cell.Row.Cells["DateRangeRID"].Value, CultureInfo.CurrentUICulture);
							}
							DialogResult DateRangeResult = frmCalDtSelector.ShowDialog();
							if (DateRangeResult == DialogResult.OK)
							{
								DateRangeProfile SelectedDateRange = (DateRangeProfile)frmCalDtSelector.Tag;
                                // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                                e.Cell.Appearance.Image = null;
                                e.Cell.Tag = null;
                                if (ValidDateRange(e.Cell, SelectedDateRange))
                                {
                                // End TT#2621 - JSmith - Duplicate weeks in daily sales
                                    e.Cell.Value = SelectedDateRange.DisplayDate;
                                    e.Cell.Row.Cells["DateRangeRID"].Value = SelectedDateRange.Key;
                                    e.Cell.Row.Cells["DateRange"].Value = SelectedDateRange;
                                    if (SelectedDateRange.DateRangeType == eCalendarRangeType.Reoccurring)
                                    {
                                        e.Cell.Appearance.Image = ReoccurringImage;
                                    }
                                    else
                                    {
                                        e.Cell.Appearance.Image = null;
                                    }
                                    // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                                    if (e.Cell.Band.Key == "StoreDates")
                                    {
                                        e.Cell.Row.Cells["StartDateKey"].Value = SelectedDateRange.StartDateKey;
                                        e.Cell.Row.Cells["EndDateKey"].Value = SelectedDateRange.EndDateKey;
                                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Clear();
                                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("StartDateKey", false);
                                        this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].SortedColumns.Add("EndDateKey", true);
                                    }
                                    // End TT#2621 - JSmith - Duplicate weeks in daily sales
                                    DailyPercentagesChangesMade = true;
                                // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
                                }
                                else
                                {
                                    e.Cell.Value = System.DBNull.Value;
                                    e.Cell.Row.Cells["DateRangeRID"].Value = System.DBNull.Value;
                                    e.Cell.Row.Cells["DateRange"].Value = System.DBNull.Value;
                                    e.Cell.Row.Cells["StartDateKey"].Value = 9999999;
                                    e.Cell.Row.Cells["EndDateKey"].Value = 0000000;
                                    if (SelectedDateRange.DateRangeType == eCalendarRangeType.Reoccurring)
                                    {
                                        e.Cell.Appearance.Image = ReoccurringImage;
                                    }
                                    else
                                    {
                                        e.Cell.Appearance.Image = null;
                                    }
                                    e.Cell.Appearance.Image = ErrorImage;
                                    e.Cell.Tag = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_DateRangesOverlap, SelectedDateRange.DisplayDate);
                                }
                                // End TT#2621 - JSmith - Duplicate weeks in daily sales
							}
							frmCalDtSelector.Dispose();
						}
						break;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        // Begin TT#2621 - JSmith - Duplicate weeks in daily sales
        private bool ValidDateRange(UltraGridCell aCell, DateRangeProfile aSelectedDateRange)
        {
            bool validDateRange = true;

            if (aCell.Band.Key == "StoreDates")
            {
                DateRangeProfile storeDateRange = null;
                UltraGridRow storeRow = aCell.Row.ParentRow;
                ProfileList storeWeekProfileList = _SAB.ClientServerSession.Calendar.GetWeekRange(aSelectedDateRange, null);
                UltraGridChildBand ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];
                foreach (UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows)
                {
                    if (storeDateRow.Cells["DateRange"].Value == DBNull.Value ||
                        aCell.Row == storeDateRow)
                    {
                        continue;
                    }

                    storeDateRange = (DateRangeProfile)storeDateRow.Cells["DateRange"].Value;
                    if (aSelectedDateRange.StartDateKey == storeDateRange.StartDateKey &&
                        aSelectedDateRange.EndDateKey == storeDateRange.EndDateKey)
                    {
                        validDateRange = false;

                    }
                }
            }

            return validDateRange;
        }
        // End TT#2621 - JSmith - Duplicate weeks in daily sales

		private void ugDailyPercentages_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList = null;
            HierarchyNodeClipboardList hnList = null;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityDailyPcts.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        _storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, cbList.ClipboardProfile.Key);
                        DailyPercentages_Populate(true);
                        AddReoccurringImage();
                        DailyPercentagesChangesMade = true;
                    }
                }
                else if (e.Data.GetDataPresent(typeof(HierarchyNodeClipboardList)))
                {
                    hnList = (HierarchyNodeClipboardList)e.Data.GetData(typeof(HierarchyNodeClipboardList));
                    if (_securityDailyPcts.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        _storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, hnList.ClipboardProfile.Key);
                        DailyPercentages_Populate(true);
                        AddReoccurringImage();
                        DailyPercentagesChangesMade = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugDailyPercentages_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugDailyPercentages.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if ( mouseUIElement == null ) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if(null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugDailyPercentages.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if ( headerUIElement.GetType() == typeof(HeaderUIElement) )
					{
						headerUI = (HeaderUIElement)headerUIElement;
						Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
						_gridCol = null;
						colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
						_gridCol = colHeader.Column;
						if ( _gridCol == null )
							return;

						_gridBand = colHeader.Band;
		
						this.mnuGridColHeader.Show(this.ugDailyPercentages, point);
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}
		
		private bool ValidTabDailyPercentages(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}
				
				int storeRID;
				Infragistics.Win.UltraWinGrid.UltraGridBand band;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridSetDateBand;

				foreach(  UltraGridRow setRow in this.ugDailyPercentages.Rows )
				{
					// edit set values.
					ValidateDailyPercentageRow(setRow, ref em);

					band = setRow.Band;

					ultraGridSetDateBand = setRow.ChildBands["SetDates"];	// get "Stores" band
					foreach(  UltraGridRow setDateRow in ultraGridSetDateBand.Rows )
					{
						ValidateDailyPercentageRow(setDateRow, ref em);
					}

					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRID = (int)storeRow.Cells["Store RID"].Value;
						ValidateDailyPercentageRow(storeRow, ref em);

						ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
						foreach(  UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )
						{
							ValidateDailyPercentageRow(storeDateRow, ref em);
						}
					}
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				em.AddMsg(eMIDMessageLevel.Error, exception.Message,  this.ToString());
				HandleException(exception);
			}
			
			return false;
		}

		private void ValidateDailyPercentageRow(UltraGridRow gridRow, ref EditMsgs em)
		{
			try
			{
				string errorMessage = null;
				decimal totalValue = 0;
				double convertedValue = 0;
				if (gridRow.Cells["DAY1"].Text.Length > 0 ||
					gridRow.Cells["DAY2"].Text.Length > 0 ||
					gridRow.Cells["DAY3"].Text.Length > 0 ||
					gridRow.Cells["DAY4"].Text.Length > 0 ||
					gridRow.Cells["DAY5"].Text.Length > 0 ||
					gridRow.Cells["DAY6"].Text.Length > 0 ||
					gridRow.Cells["DAY7"].Text.Length > 0 )
				{
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY1"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY2"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY3"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY4"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY5"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY6"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (!ValidDailyPercentageValue(gridRow.Cells["DAY7"], ref errorMessage, ref convertedValue))
					{
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					}
					else
					{
						totalValue += Convert.ToDecimal(convertedValue, CultureInfo.CurrentUICulture);
					}
					if (totalValue != 100)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustEqual100);
						em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						gridRow.Cells["Total%"].Appearance.Image = ErrorImage;
						gridRow.Cells["Total%"].Tag = errorMessage;
					}
					else
					{
						gridRow.Cells["Total%"].Appearance.Image = null;
						gridRow.Cells["Total%"].Tag = null;
					}

					if (gridRow.Band.Key == "SetDates" ||
						gridRow.Band.Key == "StoreDates")
					{
						if (!ValidDailyPercentageDate(gridRow.Cells["DateRange"], ref errorMessage))
						{
							em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
						}
					}

				}
				else
					if ((gridRow.Band.Key == "SetDates" ||
					gridRow.Band.Key == "StoreDates") &&
					gridRow.Cells["DateRange"].Text.Length > 0)
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustEqual100);
					em.AddMsg(eMIDMessageLevel.Edit, errorMessage,  this.ToString());
					gridRow.Cells["Total%"].Appearance.Image = ErrorImage;
					gridRow.Cells["Total%"].Tag = errorMessage;
				}
				else
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //gridRow.Cells["Total%"].Value = string.Empty;
                    gridRow.Cells["Total%"].Value = System.DBNull.Value;
                    //End TT#169
                    gridRow.Cells["Total%"].Appearance.Image = null;
					gridRow.Cells["Total%"].Tag = null;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private bool ValidDailyPercentageValue(UltraGridCell gridCell, ref string errorMessage, ref double convertedValue)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					convertedValue = 0;
				}
				else
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    //double cellValue = Convert.ToDouble(gridCell.Text, CultureInfo.CurrentUICulture);
                    double cellValue = Convert.ToDouble(gridCell.Value, CultureInfo.CurrentUICulture);
                    //End TT#169
                    if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
					else
					{
						convertedValue = cellValue;
					}
				}
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}

		private bool ValidDailyPercentageDate(UltraGridCell gridCell, ref string errorMessage)
		{
			bool errorFound = false;
			try
			{
				if (gridCell.Text.Length == 0)	// cell is empty
				{
					errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FieldIsRequired);
					errorFound = true;
				}
				
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = error.Message;
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Row.Cells["DisplayDate"].Appearance.Image = ErrorImage;
				gridCell.Row.Cells["DisplayDate"].Tag = errorMessage;
				return false;
			}
			else
			{
				gridCell.Row.Cells["DisplayDate"].Appearance.Image = null;
				gridCell.Row.Cells["DisplayDate"].Tag = null;
				return true;
			}
		}
		#endregion Daily Percentages Tab

		#region Characterisitcs Tab

		private void ugCharacteristics_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
		{
			try
			{
				if (!_characteristicsBuilt)
				{
					// check for saved layout
					InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
					InfragisticsLayout layout = layoutData.InfragisticsLayout_Read(_SAB.ClientServerSession.UserRID, eLayoutID.productCharacteristicsGrid);
					if (layout.LayoutLength > 0)
					{
						ugCharacteristics.DisplayLayout.Load(layout.LayoutStream);
					}
					else
					{	// DEFAULT grid layout
                        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                        //MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults();
                        //ugld.ApplyDefaults(e);
                        MIDRetail.Windows.Controls.UltraGridLayoutDefaults ugld = new MIDRetail.Windows.Controls.UltraGridLayoutDefaults(ErrorImage);
                        // Begin TT#1164 - JSmith - When going in to some methods or Admin features the columns are appearing too wide.
                        //ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, true);
                        ugld.ApplyDefaults((Infragistics.Win.UltraWinGrid.UltraGrid)sender, e, true, 2, false);
                        // End TT#1164
                        //End TT#169

						DefaultCharacteristicGridLayout();
					}
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Group"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Characteristic);
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Value"].Header.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Value);
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Inherited"].Hidden = true;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Inherited RID"].Hidden = true;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Updated"].Hidden = true;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Group RID"].Hidden = true;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Value RID"].Hidden = true;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Group"].Width = (int)(ugCharacteristics.Size.Width / 2) - 3;
					this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Value"].Width = (int)(ugCharacteristics.Size.Width / 2) - 3;
					_characteristicsBuilt = true;
				}

				if (!_securityCharacteristics.AllowUpdate)
				{
					foreach (UltraGridBand ugb in this.ugCharacteristics.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.False;
					}
				}
				else
				{
					foreach (UltraGridBand ugb in this.ugCharacteristics.DisplayLayout.Bands)
					{
						ugb.Override.AllowDelete = DefaultableBoolean.True;
					}
				}

			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

        private void DefaultCharacteristicGridLayout()
		{
			try
			{
                this.ugCharacteristics.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
				this.ugCharacteristics.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
				this.ugCharacteristics.DisplayLayout.AddNewBox.Hidden = true;
				this.ugCharacteristics.DisplayLayout.GroupByBox.Hidden = true;
				this.ugCharacteristics.DisplayLayout.GroupByBox.Prompt = " ";
				this.ugCharacteristics.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.OutlookGroupBy;

				this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Value"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.DropDownList;
				this.ugCharacteristics.DisplayLayout.Bands["Characteristics"].Columns["Value"].AutoEdit = true;
				//Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                //FormatColumns(this.ugCharacteristics);
                //End TT#169

			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void CharacteristicsTab_Load()
		{
			try
			{
				_nodeCharProfileList = SAB.HierarchyServerSession.GetProductCharacteristics(_nodeRID, true);
				Characteristics_Populate(false);

				BuildCharacteristicsContextmenu();
				ugCharacteristics.ContextMenuStrip = cmsCharacteristics;

				ugCharacteristics.ActiveRow = ugCharacteristics.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);

				_characteristicsIsPopulated = true;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void BuildCharacteristicsContextmenu()
		{
			try
			{
				
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		
		private void Characteristics_Define()
		{
			try
			{
				_characteristicsDataSet = MIDEnvironment.CreateDataSet("_characteristicsDataSet");

				DataTable characteristicTable = _characteristicsDataSet.Tables.Add("Characteristics");

				DataColumn dataColumn;
				//Create Columns and rows for datatable

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Group";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Characteristic);
				dataColumn.ReadOnly = true;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Group RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Inherited";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Inherited RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Boolean");
				dataColumn.ColumnName = "Updated";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.Int32");
				dataColumn.ColumnName = "Value RID";
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);

				dataColumn = new DataColumn();
				dataColumn.DataType = System.Type.GetType("System.String");
				dataColumn.ColumnName = "Value";
				dataColumn.Caption = MIDText.GetTextOnly(eMIDTextCode.lbl_Value);
				dataColumn.ReadOnly = false;
				dataColumn.Unique = false;
				characteristicTable.Columns.Add(dataColumn);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void Characteristics_Populate(bool doingCopy)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				bool updated = false;
				bool isInherited = false;
				int inheritedRID = Include.NoRID;
				int valueRID = Include.NoRID;
				string value = string.Empty; 

				Characteristics_Define();

				ProductCharProfileList productCharProfileList = SAB.HierarchyServerSession.GetProductCharacteristics();
				foreach (ProductCharProfile pcp in productCharProfileList)
				{
					updated = false;
					isInherited = false;
					inheritedRID = Include.NoRID;
					NodeCharProfile ncp = (NodeCharProfile)_nodeCharProfileList.FindKey(pcp.Key);
					if (ncp != null &&
						ncp.ProductCharValueRID != Include.NoRID)
					{
						valueRID = ncp.ProductCharValueRID;
						value = ncp.ProductCharValue;
						if (ncp.TypeInherited != eInheritedFrom.None &&
							!doingCopy)
						{
							isInherited = true;
							inheritedRID = ncp.InheritedFrom;
						}
					}
					else
					{
						valueRID = Include.NoRID;
						value = string.Empty;
					}
                    // Begin RO#1573 - JSmith - Product characteristic value through Hierarchy Load API
                    // The key of the characteristic must be the value to get the correct value from the valuelist.
                    if (valueRID != Include.NoRID)
                    {
                        value = valueRID.ToString();
                    }
                    // End RO#1573 - JSmith - Product characteristic value through Hierarchy Load API
					_characteristicsDataSet.Tables["Characteristics"].Rows.Add(new object[] { pcp.ProductCharID, pcp.Key, isInherited, inheritedRID, 
				                                                                         updated, valueRID, value});
				}

                //BEGIN tt#1066 - Product Characteristics are not displayed in alphabetical order
                DataView _characteristicDataSetView = new DataView(_characteristicsDataSet.Tables["Characteristics"]);
                _characteristicDataSetView.Sort = "GROUP asc";
                ugCharacteristics.DataSource = _characteristicDataSetView;
                //END tt#1066 - Product Characteristics are not displayed in alphabetical order
                
				FunctionSecurityProfile securityProfile = _securityNodeProperties;
				if (!_newNode)
				{
					securityProfile = _securityCharacteristics;
					SetControlReadOnly(this.tabCharacteristics, !securityProfile.AllowUpdate);
				}
				Characteristics_SetRowProperties(productCharProfileList, securityProfile);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void Characteristics_SetRowProperties(ProductCharProfileList aProductCharProfileList, FunctionSecurityProfile securityProfile)
		{
			try
			{
				HierarchyNodeProfile hnp = null;
				int inheritedRID;

				foreach (UltraGridRow characteristicRow in this.ugCharacteristics.Rows)
				{
					int productCharRID = Convert.ToInt32(characteristicRow.Cells["Group RID"].Value, CultureInfo.CurrentUICulture);
					Populate_CharacteristicValues_ValueList(aProductCharProfileList, productCharRID, characteristicRow.Cells["Value"]);
					if (characteristicRow.Cells["Inherited"].Text == "True")
					{
						inheritedRID = Convert.ToInt32(characteristicRow.Cells["Inherited RID"].Value, CultureInfo.CurrentUICulture);
						if (hnp == null || hnp.Key != inheritedRID)
						{
							hnp = _SAB.HierarchyServerSession.GetNodeData(inheritedRID);
						}
						string inheritMsg = _txtInheritedFrom + hnp.Text;
						characteristicRow.Cells["Value"].Appearance.Image = InheritanceImage;
						characteristicRow.Cells["Value"].Tag = inheritMsg;
					}
					else
					{
						characteristicRow.Cells["Value"].Appearance.Image = null;
						characteristicRow.Cells["Value"].Tag = null;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void Populate_CharacteristicValues_ValueList(ProductCharProfileList aProductCharProfileList, int aProductCharRID, UltraGridCell aCell)
		{
			try
			{
				Infragistics.Win.ValueList valueList = null;

				if (aCell.ValueList == null)
				{
					valueList = new Infragistics.Win.ValueList();
					valueList.SortStyle = ValueListSortStyle.Ascending;
					aCell.ValueList = valueList;
				}
				else
				{
					valueList = (Infragistics.Win.ValueList)aCell.ValueList;
					// make sure valuelist is empty
					((Infragistics.Win.ValueList)aCell.ValueList).ValueListItems.Clear();
				}

				valueList.ValueListItems.Add(0, "<none>");
				ProductCharProfile pcp = (ProductCharProfile)aProductCharProfileList.FindKey(aProductCharRID);

				foreach (ProductCharValueProfile pcvp in pcp.ProductCharValues)
				{
					valueList.ValueListItems.Add(pcvp.Key, pcvp.ProductCharValue);
				}
			}
			catch (Exception ex)
			{
				HandleException(ex);
			}
		}

		private void ugCharacteristics_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
		{
			try
			{
				Infragistics.Win.UIElement mouseUIElement;
				Infragistics.Win.UIElement headerUIElement;
				Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
				HeaderUIElement headerUI = null;
				Point point = new Point(e.X, e.Y);

				if (e.Button == MouseButtons.Right)
				{
					// retrieve the UIElement from the location of the mouse 
					mouseUIElement = ugCharacteristics.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
					if (mouseUIElement == null) { return; }

					headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
					if (null == headerUIElement)
					{
						// retrieve the Cell from the UIElement 
						mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

						// if there is a cell object reference, set to active cell and edit
						if (mouseCell != null)
						{
							ugCharacteristics.ActiveCell = mouseCell;	// set the cell under the mouse as active
						}
					}
					else
						if (headerUIElement.GetType() == typeof(HeaderUIElement))
						{
							headerUI = (HeaderUIElement)headerUIElement;
							Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
							_gridCol = null;
							colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
							_gridCol = colHeader.Column;
							if (_gridCol == null)
								return;

							_gridBand = colHeader.Band;

							this.mnuGridColHeader.Show(this.ugCharacteristics, point);

						}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugCharacteristics_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
		{
			bool changeCancelled = false;
			try
			{
				Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = e.Cell.Row.Band;
				_cancelUpdate = false;
				if (_characteristicsIsPopulated)
				{
					CharacteristicsChangesMade = true;
					// set the value if the use deletes the text in the cell
					if (e.Cell.Text.Length == 0)
					{
						if (MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_ReestablishInheritance), this.Text,
							MessageBoxButtons.YesNo, MessageBoxIcon.Question)
							== DialogResult.Yes)
						{
							// if already inheriting, cancel change
							if (Convert.ToInt32(e.Cell.Row.Cells["Value RID"].Value, CultureInfo.CurrentCulture) == Include.NoRID)
							{
								changeCancelled = true;
							}
							else
							{
								e.Cell.Row.Cells["Value RID"].Value = Include.NoRID;
							}
						}
						else
						{
							e.Cell.Value = e.Cell.OriginalValue;
							changeCancelled = true;
						}
					}

					if (!changeCancelled)
					{
						int valueRID = (int)ugCharacteristics.ActiveCell.ValueListResolved.GetValue(ugCharacteristics.ActiveCell.ValueListResolved.SelectedItemIndex);
						ugCharacteristics.ActiveCell.Row.Cells["Value RID"].Value = valueRID;

						e.Cell.Row.Cells["Inherited"].Value = false;
						e.Cell.Row.Cells["Inherited RID"].Value = Include.NoRID;
						e.Cell.Row.Cells["Value"].Appearance.Image = null;
						e.Cell.Row.Cells["Value"].Tag = null;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

        //  BEGIN TT#2015 - gtaylor - apply changes to lower levels
        void ugCharacteristics_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            if (e.Cell.Row.Band.Key == "Stores")
            {
                if (e.Cell != e.Cell.Row.Cells["Updated"])
                {
                    // create the change profile and add it to the list
                    ChangeProfileChar charChange = new ChangeProfileChar(
                        Convert.ToInt16(e.Cell.Row.Cells["Value RID"].Value),
                        Convert.ToInt16(e.Cell.Row.Cells["Group RID"].Value),
                        e.Cell.Text.ToString(), // new value
                        e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                        e.Cell.Column.Header.Caption.ToString(),
                        e.Cell.Column.Index
                    );

                    // create keyvaluepair and populate
                    KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(charChange.ChangeProfileKey, charChange);

                    //  add to nodechangeprofile list
                    _nodeChangeProfile.Add(eProfileType.StoreCharacteristics, _kvp);
                }
            }
        }
        //  END TT#2015 - gtaylor - apply changes to lower levels

		private void ugCharacteristics_BeforeCellUpdate(object sender, Infragistics.Win.UltraWinGrid.BeforeCellUpdateEventArgs e)
		{
			try
			{
				if (_cancelUpdate)
				{
					e.Cancel = true;
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugCharacteristics_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
		{
			try
			{
				ShowUltraGridToolTip(ugCharacteristics, e);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ApplyCharacteristic(int aGroupRID, int aValueRID, string aValue)
		{
			try
			{
				foreach (UltraGridRow characteristicRow in this.ugCharacteristics.Rows)
				{
					if (aGroupRID == Convert.ToInt32(characteristicRow.Cells["Group RID"].Value, CultureInfo.CurrentUICulture))
					{
						characteristicRow.Cells["Value RID"].Value = aValueRID;
						characteristicRow.Cells["Value"].Value = aValue;
						characteristicRow.Cells["Inherited"].Value = false;
						characteristicRow.Cells["Inherited RID"].Value = Include.NoRID;
						characteristicRow.Cells["Value"].Appearance.Image = null;
						characteristicRow.Cells["Value"].Tag = null;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugCharacteristics_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList;
            HierarchyNodeClipboardList hnList;
            ProductCharacteristicClipboardList pcList;
			try
			{
				if (_securityCharacteristics.IsReadOnly)
				{
					MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

				}
				else
				{
                    if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
					{
                        cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                        if (cbList.ClipboardDataType == eProfileType.HierarchyNode)
						{
                            _nodeCharProfileList = SAB.HierarchyServerSession.GetProductCharacteristics(cbList.ClipboardProfile.Key, true);
							Characteristics_Populate(true);
							CharacteristicsChangesMade = true;
						}
                        
					}
                    else if (e.Data.GetDataPresent(typeof(HierarchyNodeClipboardList)))
                    {
                        hnList = (HierarchyNodeClipboardList)e.Data.GetData(typeof(HierarchyNodeClipboardList));
                        _nodeCharProfileList = SAB.HierarchyServerSession.GetProductCharacteristics(hnList.ClipboardProfile.Key, true);
                        Characteristics_Populate(true);
                        CharacteristicsChangesMade = true;
                    }
                    else if (e.Data.GetDataPresent(typeof(ProductCharacteristicClipboardList)))
                    {
                        pcList = (ProductCharacteristicClipboardList)e.Data.GetData(typeof(ProductCharacteristicClipboardList));
                        foreach (ProductCharacteristicClipboardProfile item in pcList.ClipboardItems)
                        {
                            ApplyCharacteristic(item.ProductCharGroupKey, item.Key, item.Text);
                        }
                        CharacteristicsChangesMade = true;
                    }
				}
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void ugCharacteristics_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
                if (e.Data.GetDataPresent(typeof(ProductCharacteristicClipboardList)))
                {
                    e.Effect = DragDropEffects.All;
                }
                else
                {
                    ObjectDragEnter(e);
                }
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void uddCharacteristics_RowSelected(object sender, RowSelectedEventArgs e)
		{

		}

		private bool ValidTabCharacteristics(ref EditMsgs em)
		{
			try
			{
				if (FormIsClosing && !SaveOnClose)
				{
					return true;
				}

				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch (Exception exception)
			{
				em.AddMsg(eMIDMessageLevel.Error, exception.Message, this.ToString());
				HandleException(exception);
			}

			return false;
		}

        // BEGIN TT#2015 - gtaylor - apply changes to lower levels
        private void cbxCHInheritFromHigherLevel_CheckedChanged(object sender, EventArgs e)
        {
            if (FormLoaded &&
                !_processingSave &&
                !_rebuildScreen &&
                _securityNodes.AllowUpdate
                )
            {
                this.CharacteristicsChangesMade = true;
            }
        }
        // END TT#2015 - gtaylor - apply changes to lower levels
		
		#endregion Characteristics Tab

        //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
        #region ChainSetPct Tab

        private void ChainSetPctsTab_Load()
        {
            try
            {
                ChainSetPercent_GetUserSettings();
                ChainSetPcts_Attributes_Populate();
                //_storeList = _SAB.StoreServerSession.GetStoreGroupLevelList(_groupRID);

                if ((_CSPweeks != null) || (cbCSPStoreAttribute.SelectedIndex > 0))
                {
                    ChainSetPercent_Populate(false);
                }
                //Begin TT#1740 - DOConnell - Chain Set Percent Missing Sub Menu
                BuildChainSetPercentContextmenu();
                this.ugChainSetPercent.ContextMenu = mnuChainSetPercentGrid;
                //End TT#1740 - DOConnell - Chain Set Percent Missing Sub Menu

                ugChainSetPercent.ActiveRow = ugChainSetPercent.GetRow(Infragistics.Win.UltraWinGrid.ChildRow.First);

                _chainSetPercentIsPopulated = true;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        // Begin TT#1700 - JSmith - Chain Set Percentages need to retain last settings in Node Properties
        private void ChainSetPercent_GetUserSettings()
        {
            MerchandiseHierarchyData merchandiseData;
            DataTable dt;
            try
            {
                _groupRID = _SAB.ClientServerSession.GlobalOptions.OTSPlanStoreGroupRID;
                _hnp.Begin_CDR_RID = Include.UndefinedCalendarDateRange;
                _Begin_CDR_RID = Include.UndefinedCalendarDateRange;
                Begdr = null;

                merchandiseData = new MerchandiseHierarchyData();
                dt = merchandiseData.ChainSetPercentUser_Read(_SAB.ClientServerSession.UserRID);
                if (dt.Rows.Count > 0)
                {
                    _groupRID = Convert.ToInt32(dt.Rows[0]["SG_RID"]);
                    _hnp.Begin_CDR_RID = Convert.ToInt32(dt.Rows[0]["CDR_RID"]);
                    _Begin_CDR_RID = _hnp.Begin_CDR_RID;
                    Begdr = _SAB.ClientServerSession.Calendar.GetDateRange(_Begin_CDR_RID);
                }

            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ChainSetPercent_UpdateUserSettings()
        {
            MerchandiseHierarchyData merchandiseData = null;
            try
            {
                //Begin TT#1401 - DOConnell - VSW - Reservation Stores
                if (_hnp.Begin_CDR_RID <= 1 ||
                    _groupRID <= 1)
                //if (_hnp.Begin_CDR_RID == 1 ||
                //    _groupRID == 1)
                //End TT#1401 - DOConnell - VSW - Reservation Stores
                {
                    return;
                }
                    
                merchandiseData = new MerchandiseHierarchyData();
                merchandiseData.OpenUpdateConnection();
                merchandiseData.ChainSetPercentUser_Update(_SAB.ClientServerSession.UserRID, _hnp.Begin_CDR_RID, _groupRID);
                merchandiseData.CommitData();
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                if (merchandiseData != null)
                {
                    merchandiseData.CloseUpdateConnection();

                }
            }
        }
        // End TT#1700

        //Begin TT#1740 - DOConnell - Chain Set Percent Missing Sub Menu
        private void BuildChainSetPercentContextmenu()
        {
            try
            {
                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                mnuChainSetPercentGrid.MenuItems.Clear();
                // End TT#2138
                MenuItem mnuItemClear = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_Clear_Values));
                MenuItem mnuItemBalance = new MenuItem(MIDText.GetTextOnly(eMIDTextCode.lbl_BalanceTo100));
                if (!_securityChainSetPercent.AllowUpdate)
                {
                    mnuItemClear.Enabled = false;
                    mnuItemBalance.Enabled = false;
                }
                mnuChainSetPercentGrid.MenuItems.Add(mnuItemClear);
                mnuChainSetPercentGrid.MenuItems.Add(mnuItemBalance);
                mnuItemClear.Click += new System.EventHandler(this.mnuCSPItemClear_Click);
                mnuItemBalance.Click += new System.EventHandler(this.mnuCSPItemBalance_Click);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void mnuChainSetPercentGrid_Popup(object sender, System.EventArgs e)
        {
            try
            {
			//Begin TT#1401 - DOConnell - VSW - Reservation Stores
				//if (_securityChainSetPercent.AllowUpdate)
                if (_securityChainSetPercent.AllowUpdate && this.ugChainSetPercent.ActiveCell != null)
                {
			//End TT#1401 - DOConnell - VSW - Reservation Stores
                    string name = Convert.ToString(this.ugChainSetPercent.ActiveCell.Row.Cells[0]);
                    //Begin TT#1757 - DOConnell - Chain Set Percent\Node Properties: System.NullReferenceException Error
                    //if (this.ugChainSetPercent.ActiveRow == null ||
                        if (this.ugChainSetPercent.ActiveCell == null ||
                        Convert.ToString(this.ugChainSetPercent.ActiveCell.Column) == "Stores" ||
                            Convert.ToString(this.ugChainSetPercent.ActiveCell.Row.Cells[0].Text) == "Chain"
                        || this.ugChainSetPercent.ActiveCell.Column.CellActivation == Activation.Disabled)
                    //End TT#1757 - DOConnell - Chain Set Percent\Node Properties: System.NullReferenceException Error
                    {
                        mnuChainSetPercentGrid.MenuItems[0].Enabled = false;	// apply
                        mnuChainSetPercentGrid.MenuItems[1].Enabled = false;	// apply
                    }
                    else
                    {
                        mnuChainSetPercentGrid.MenuItems[0].Enabled = true;	// apply
                        mnuChainSetPercentGrid.MenuItems[1].Enabled = true;	// apply
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void mnuCSPItemBalance_Click(object sender, System.EventArgs e)
        {
            try
            {
                this.Cursor = Cursors.WaitCursor;
                this.ugChainSetPercent.BeginUpdate();
                Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugChainSetPercent.ActiveRow;
                Infragistics.Win.UltraWinGrid.UltraGridCell activeCell = this.ugChainSetPercent.ActiveCell;
                
                if (activeRow == null)
                {
                    MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NoActiveRow),
                        this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
                else
                {
                    BasicSpread spreader = new BasicSpread();
                    ArrayList inValues = new ArrayList();
                    ArrayList outValues;

                    foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                    {
                        for (int r = 0; r < row.Cells.Count; ++r)
                        {
                            if (row.Cells[r].Column.Key == this.ugChainSetPercent.ActiveCell.Column.Key &&
                                Convert.ToString(row.Cells[0].Value) != "Chain")
                            {
                                double pctValue;
                                if (Convert.ToString(row.Cells[r].Value) == string.Empty || Convert.ToDouble(row.Cells[r].Value) < 0)
                                {
                                    pctValue = 0;
                                }
                                else
                                {
                                    pctValue = Convert.ToDouble(row.Cells[r].Value); 
                                }
                                    inValues.Add(pctValue);
                            }
                        }
                    }

                    try
                    {
                        spreader.ExecuteSimpleSpread(100, inValues, 3, out outValues);

                        _cancelUpdate = false;  //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 

                        foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                        {
                            for (int r = 0; r < row.Cells.Count; ++r)
                            {
                                if (row.Cells[r].Column.Key == this.ugChainSetPercent.ActiveCell.Column.Key &&
                                    Convert.ToString(row.Cells[0].Value) != "Chain")
                                {
                                    row.Cells[r].Value = outValues[0];
                                    if (row.Cells[r + 2].Column.Key.Contains("IsInherited"))
                                        row.Cells[r + 2].Value = false;
                                    if (row.Cells[r + 3].Column.Key.Contains("IsInherited"))
                                        row.Cells[r + 3].Value = Include.NoRID;
                                    if (row.Cells[r + 5].Column.Key.Contains("Updated"))
                                        row.Cells[r + 5].Value = true;

                                    InheritanceProvider.SetError((System.Windows.Forms.Label)_htChainSetPercentInheritance[activeCell.Column.Key], null);
                                    outValues.RemoveAt(0);
                                }
                            }
                        }

                        this.ugChainSetPercent.EndUpdate();
                        ChainSetPercentChangesMade = true;
                        ChainSetPercent_SetGridProperties(_securityNodeProperties);

                    }

                    catch (Exception error)
                    {
                        this.ugChainSetPercent.EndUpdate();
                        ChainSetPercentChangesMade = false;
                        MessageBox.Show(error.Message);
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                this.Cursor = Cursors.Default;
            }
        }

        private void mnuCSPItemClear_Click(object sender, System.EventArgs e)
        {
            try
            {
                this.Cursor = Cursors.WaitCursor;
                this.ugChainSetPercent.BeginUpdate();
                Infragistics.Win.UltraWinGrid.UltraGridRow activeRow = this.ugChainSetPercent.ActiveRow;
                Infragistics.Win.UltraWinGrid.UltraGridCell activeCell = this.ugChainSetPercent.ActiveCell;

                if (activeRow == null)
                {
                    MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NoActiveRow),
                        this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
                else
                {
                    BasicSpread spreader = new BasicSpread();
                    ArrayList inValues = new ArrayList();

                    foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                    {
                        for (int r = 0; r < row.Cells.Count; ++r)
                        {
                            if (row.Cells[r].Column.Key == this.ugChainSetPercent.ActiveCell.Column.Key &&
                                Convert.ToString(row.Cells[0].Value) != "Chain")
                            {
                                if (Convert.ToString(row.Cells[r].Value) != string.Empty )
                                {
                                    row.Cells[r].Value = 0;
                                    if (row.Cells[r + 2].Column.Key.Contains("IsInherited"))
                                        row.Cells[r + 2].Value = false;
                                    if (row.Cells[r + 3].Column.Key.Contains("IsInherited"))
                                        row.Cells[r + 3].Value = Include.NoRID;
                                    if (row.Cells[r + 5].Column.Key.Contains("Updated"))
                                        row.Cells[r + 5].Value = true;
                                    InheritanceProvider.SetError((System.Windows.Forms.Label)_htChainSetPercentInheritance[activeCell.Column.Key], null);
                                }
                            }
                        }
                    }

                    this.ugChainSetPercent.EndUpdate();
                    ChainSetPercentChangesMade = true;
                    ChainSetPercent_SetGridProperties(_securityNodeProperties);
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                this.Cursor = Cursors.Default;
            }
        }

        private bool validateChainSetPercentValue(UltraGridCell gridCell)
		{
			bool errorFound = false;
            string errorMessage = "";
			try
			{
                //Begin TT#1756 - DOConnell - Chain Set Percent/Node Properties: Application Crashes
				if (gridCell.Text.Length == 0 && gridCell.Value != System.DBNull.Value)	// cell is empty
				{
                    gridCell.Value = System.DBNull.Value;
					//convertedValue = 0;
				}
                else if (gridCell.Value != null )  //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                //    else if (gridCell.Value != System.DBNull.Value)  // //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                //End TT#1756 - DOConnell - Chain Set Percent/Node Properties: Application Crashes
				{
                    //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                    double cellValue = Convert.ToDouble(gridCell.Value, CultureInfo.CurrentUICulture);
                    //End TT#169
                    if (cellValue < 0)
					{
						errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
						errorFound = true;
					}
				}
                //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                else
                {
                    return false;
                }
                //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
			}
			catch( Exception error)
			{
				string exceptionMessage = error.Message;
				errorMessage = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
				errorFound = true;
			}

			if (errorFound)
			{
				gridCell.Appearance.Image = ErrorImage;
				gridCell.Tag = errorMessage;
                
				return false;
			}
			else
			{
				gridCell.Appearance.Image = null;
				gridCell.Tag = null;
				return true;
			}
		}


        //End TT#1740 - DOConnell - Chain Set Percent Missing Sub Menu

        private void ChainSetPcts_Attributes_Populate()
        {
            try
            {
                //Load Store Groups
                StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_chainSetPercentGroupList.FindKey(_groupRID);

                cbCSPStoreAttribute.Initialize(SAB, _securityChainSetPercent, _chainSetPercentGroupList.ArrayList, true);

                AdjustTextWidthComboBox_DropDown(cbCSPStoreAttribute);     //TT#7 - RBeck - Dynamic dropdowns

                _groupRID = storeGroup.Key;

                this.cbCSPStoreAttribute.SelectedValue = storeGroup.Key;
                _chainSetPercentPreviousIndex = cbCSPStoreAttribute.SelectedIndex;
                _CSPStoreGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);


                //Load Date Range
                if (_hnp.Begin_CDR_RID <= Include.UndefinedCalendarDateRange)
                {

                }
                else
                {
                    //Begin TT#1708 - DOConnell - Chain Set % Node Properties: Recieved a Serialization Exception Error

                    //BEGIN TT#436-MD -jsobek -Add the new items to the Node Properties Overrides Report
                    //Removing unused variable
                    //DateRangeProfile drp = _SAB.ClientServerSession.Calendar.GetDateRange(_Begin_CDR_RID);
                    //END TT#436-MD -jsobek -Add the new items to the Node Properties Overrides Report

                    //_CSPweeks = _SAB.HierarchyServerSession.GetWeeks(_Begin_CDR_RID);
                    _CSPweeks = _SAB.ApplicationServerSession.Calendar.GetWeekRange(Begdr, null);
                    //End TT#1708 - DOConnell - Chain Set % Node Properties: Recieved a Serialization Exception Error
                    LoadDateRangeText(Begdr, midDateRangeSelector1);
                    _origBegdr = Begdr;
                    _Begin_CDR_RID = _CSPweeks.MinValue;
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void LoadDateRangeText(DateRangeProfile dr, Controls.MIDDateRangeSelector midDRSel)
        {
            try
            {
                if (dr.DisplayDate != null)
                {
                    midDRSel.Text = dr.DisplayDate;
                }
                else
                {
                    midDRSel.Text = string.Empty;
                }
                //Add RID to Control's Tag (for later use)
                int lAddTag = dr.Key;
                
                midDRSel.Tag = lAddTag;


                CheckDynPictures();

            }
            catch (Exception ex)
            {
                HandleException(ex);
            }
        }

        private void CheckDynPictures()
        {
            //Display Dynamic picture or not
            if (Begdr != null)
                if (Begdr.DateRangeType == eCalendarRangeType.Dynamic)
                    midDateRangeSelector1.SetImage(ReoccurringImage);
                else
                    midDateRangeSelector1.SetImage(null);
            else
                midDateRangeSelector1.SetImage(null);

        }

        private void midDateRangeSelector1_ClickCellButton(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            if (midDateRangeSelector1.Tag != null)
            {
                ((CalendarDateSelector)midDateRangeSelector1.DateRangeForm).DateRangeRID = (int)midDateRangeSelector1.Tag;
            }
            midDateRangeSelector1.ShowSelector();
        }

        private void midDateRangeSelector1_Load(object sender, System.EventArgs e)
        {
            try
            {
                CalendarDateSelector frm = (CalendarDateSelector)CreateControl(typeof(CalendarDateSelector), new object[] { SAB });
                midDateRangeSelector1.DateRangeForm = frm;
                frm.RestrictToSingleDate = false;
                frm.AllowDynamicToCurrent = true;
                frm.AllowDynamicToPlan = false;
                frm.AllowDynamicToStoreOpen = false;
            }
            catch (Exception ex)
            {
                HandleException(ex, "midDateRangeSelector1_Load");
            }

        }

        private void midDateRangeSelector1_OnSelection(object sender, MIDRetail.Windows.Controls.DateRangeSelectorEventArgs e)
        {
            try
            {
                if (!e.SelectionCanceled)
                {
                    //ChangePending = true;
                    Begdr = e.SelectedDateRange;
                    _hnp.Begin_CDR_RID = Begdr.Key;
                    LoadDateRangeText(Begdr, midDateRangeSelector1);
					//Begin TT#1401 - DOConnell - VSW - Reservation Stores
                    _CSPweeks = null;
                    if (Begdr.SelectedDateType != 0) 
					//End TT#1401 - DOConnell - VSW - Reservation Stores
                        _CSPweeks = _SAB.ApplicationServerSession.Calendar.GetWeekRange(Begdr, null);

                        //UpdateChainSetPercentData();
                        StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_chainSetPercentGroupList[cbCSPStoreAttribute.SelectedIndex];
                        _groupRID = storeGroup.Key;
                        _chainSetPercentNewWeeks = true;
                        ChainSetPercent_Populate(false);
                        //if (FormLoaded)
                        //    ChainSetPercentChangesMade = true;
                    

                }
            }
            catch (Exception ex)
            {
                HandleException(ex, "midDateRangeSelector1_OnSelection");
            }
        }

        private void ChainSetPercent_Define()
        {

            try
            {
                _chainSetPercentDataSet = MIDEnvironment.CreateDataSet("_chainSetPercentDataSet");
                DataTable WeekTable = _chainSetPercentDataSet.Tables.Add("Week");
                DataColumn strCol = new DataColumn();
                
                DataColumn[] PrimaryKeyColumn = new DataColumn[1];

                strCol.ColumnName = "Stores";
                strCol.Caption = "";
                strCol.DataType = System.Type.GetType("System.String");
                if (!WeekTable.Columns.Contains("Stores"))
                    WeekTable.Columns.Add(strCol);


                foreach (string key in _CSPGroupHash.Keys)
                {
                    SortedList groupLevelCells = new SortedList();
                    groupLevelCells = (SortedList)_CSPGroupHash[key];

                    foreach (int glc in groupLevelCells.Keys)
                    {
                        ChainSetPercentValues pct = (ChainSetPercentValues)groupLevelCells[glc];
                        string SGLRID = ("StoreGroupRID " + (Convert.ToString(pct.Week)));
                        string isInh = ("IsInherited " + (Convert.ToString(pct.Week)));
                        string InhRID = ("InheritedRID " + (Convert.ToString(pct.Week)));
                        string strUpd = ("Updated " + (Convert.ToString(pct.Week)));
                        string cdrRID = ("CDRRID " + (Convert.ToString(pct.TimeID)));
                        string seqId = ("Sequence " + (Convert.ToString(pct.TimeID)));

                        DataColumn seqCol = new DataColumn();
                        seqCol.ColumnName = seqId;
                        seqCol.DataType = System.Type.GetType("System.Int32");
                        
                        if (!WeekTable.Columns.Contains(seqId))
                            WeekTable.Columns.Add(seqCol);

                        DataColumn pctCol = new DataColumn();
                        pctCol.ColumnName = Convert.ToString(pct.Week);
                        pctCol.DataType = System.Type.GetType("System.Decimal");
                        if (!WeekTable.Columns.Contains(Convert.ToString(pct.Week)))
                            WeekTable.Columns.Add(pctCol);

                        DataColumn sglRID = new DataColumn();
                        sglRID.ColumnName = SGLRID;
                        sglRID.DataType = System.Type.GetType("System.Int32");
                        if (!WeekTable.Columns.Contains(SGLRID))
                            WeekTable.Columns.Add(sglRID);

                        DataColumn isInhCol = new DataColumn();
                        isInhCol.ColumnName = isInh;
                        isInhCol.DataType = System.Type.GetType("System.Boolean");
                        if (!WeekTable.Columns.Contains(isInh))
                            WeekTable.Columns.Add(isInhCol);

                        DataColumn inhRID = new DataColumn();
                        inhRID.ColumnName = InhRID;
                        inhRID.DataType = System.Type.GetType("System.Int32");
                        if (!WeekTable.Columns.Contains(InhRID))
                            WeekTable.Columns.Add(inhRID);

                        DataColumn CdrRID = new DataColumn();
                        CdrRID.ColumnName = cdrRID;
                        CdrRID.DataType = System.Type.GetType("System.Int32");
                        if (!WeekTable.Columns.Contains(cdrRID))
                            WeekTable.Columns.Add(CdrRID);

                        DataColumn updCol = new DataColumn();
                        updCol.ColumnName = strUpd;
                        updCol.DataType = System.Type.GetType("System.Boolean");
                        if (!WeekTable.Columns.Contains(strUpd))
                            WeekTable.Columns.Add(updCol);
                    }
                }

                //PrimaryKeyColumn[0] = WeekTable.Columns["Stores"];


            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ChainSetPercent_Populate(bool chgMade)
        {
            this.Cursor = Cursors.WaitCursor;
            bool updated = false;
            bool isInherited = false;
            int inheritedRID = Include.NoRID;
            string storeGroupID = null;
            decimal? percentage = null;
            int yearWeekKey;
            int yearWeek;
            int seqId = 0;
            string strId = null;
            int strRID = 0;
            string stringWeek;
            _CSPGroupHash = new Hashtable();
            SortedList weekKeySL;
            SortedList pctKeySL;

            try
            {
                //Begin TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                if (!_cancelUpdate)
                {
				//Begin TT#1401 - DOConnell - VSW - Reservation Stores
                    if (_CSPweeks != null)
                    {
                        if (((_groupRID != Include.NoRID) || (_chainSetPercentNewGroup) || (_chainSetPercentNewWeeks)))
                        {
                            // Begin TT#2219 - JSmith - Values in Node Properties go Blank when selecting one tab to the next and is related to Chain Set Percent.
                            //_storeList = _SAB.StoreServerSession.GetStoreGroupLevelList(_groupRID);
                            ProfileList storeGroupLevelList = StoreMgmt.StoreGroup_GetLevelListFilled(_groupRID); //_SAB.StoreServerSession.GetStoreGroupLevelList(_groupRID);
                            // End TT#2219

                            if (_hnp.Key == Include.NoRID)
                            {
                                _orgNodeId = _hnp.HomeHierarchyParentRID;
                                // Begin TT#2219 - JSmith - Values in Node Properties go Blank when selecting one tab to the next and is related to Chain Set Percent.
                                //_chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(_storeList, _hnp.HomeHierarchyParentRID, false, false, true, _CSPweeks);
                                _chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(storeGroupLevelList, _hnp.HomeHierarchyParentRID, false, false, true, _CSPweeks);
                                // End TT#2219
                            }
                            else if (_orgNodeId == Include.NoRID)
                            {
                                // Begin TT#2219 - JSmith - Values in Node Properties go Blank when selecting one tab to the next and is related to Chain Set Percent.
                                //_chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(_storeList, _hnp.Key, false, false, true, _CSPweeks);
                                _chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(storeGroupLevelList, _hnp.Key, false, false, true, _CSPweeks);
                                // End TT#2219
                                _orgNodeId = _hnp.Key;
                            }
                            else if (Convert.ToString(_orgNodeId) != this.txtNodeID.Text)
                            {
                                // Begin TT#2219 - JSmith - Values in Node Properties go Blank when selecting one tab to the next and is related to Chain Set Percent.
                                //_chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(_storeList, _hnp.Key, false, false, true, _CSPweeks);
                                _chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(storeGroupLevelList, _hnp.Key, false, false, true, _CSPweeks);
                                // End TT#2219
                                _orgNodeId = _hnp.Key;
                            }
                            else
                            {
                                // Begin TT#2219 - JSmith - Values in Node Properties go Blank when selecting one tab to the next and is related to Chain Set Percent.
                                //_chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(_storeList, _orgNodeId, false, false, true, _CSPweeks);
                                _chainSetPercentList = _SAB.HierarchyServerSession.GetChainSetPercentList(storeGroupLevelList, _orgNodeId, false, false, true, _CSPweeks);
                                // End TT#2219
                                _orgNodeId = _hnp.Key;
                            }



                            foreach (StoreGroupLevelListViewProfile sglp in _CSPStoreGroupLevelList)
                            {
                                weekKeySL = new SortedList();
                                strId = sglp.Name;
                                strRID = sglp.Key;
                                seqId = sglp.Sequence;

                                foreach (WeekProfile wp in _CSPweeks)
                                {
                                    stringWeek = Convert.ToString(wp);
                                    pctKeySL = new SortedList();
                                    yearWeek = Convert.ToInt32(Convert.ToString(wp.YearWeek));
                                    // Begin TT#1719 - JSmith - Chain Set Pct:  System Overflow exception in Node Properties
                                    //yearWeekKey = Convert.ToInt32(Convert.ToString(wp.YearWeek) + Convert.ToString(sglp.Key));
                                    yearWeekKey = Convert.ToInt32(Convert.ToString(wp.YearWeek - 200000) + Convert.ToString(sglp.Key));
                                    // End TT#1719
                                    ChainSetPercentProfiles yearWeekObj = new ChainSetPercentProfiles(yearWeekKey);
                                    if (!_chainSetPercentList.ArrayList.Contains(yearWeekObj))
                                    {
                                        isInherited = false;
                                        inheritedRID = Include.NoRID;
                                        percentage = null;

                                    }
                                    else
                                    {
                                        foreach (ChainSetPercentProfiles cspp in _chainSetPercentList)
                                        {
                                            if (cspp.TimeID == wp.YearWeek)
                                            {
                                                if (cspp.StoreGroupLevelRID == sglp.Key)
                                                {
                                                    storeGroupID = cspp.StoreGroupID;
                                                    isInherited = cspp.ChainSetPercentIsInherited;
                                                    inheritedRID = cspp.ChainSetPercentInheritedFromNodeRID;
                                                    strRID = cspp.StoreGroupLevelRID;
                                                    strId = cspp.StoreGroupLevelID;
                                                    yearWeek = cspp.TimeID;
                                                    if (cspp.NodeRID > Include.Undefined)
                                                    {
                                                        percentage = cspp.ChainSetPercent;

                                                        if (cspp.ChainSetPercentChangeType != eChangeType.none)
                                                        {
                                                            updated = true;
                                                        }
                                                    }

                                                }
                                            }
                                        }
                                    }
                                    ChainSetPercentValues pctValueList = new ChainSetPercentValues(stringWeek, storeGroupID, strRID, strId, percentage, isInherited, inheritedRID, yearWeek, updated, seqId);

                                    if (!weekKeySL.ContainsKey(wp.YearWeek))
                                        weekKeySL.Add(wp.YearWeek, pctValueList);

                                }
                                if (!_CSPGroupHash.ContainsKey(sglp.Key))
                                    _CSPGroupHash.Add(sglp.Name, weekKeySL);

                            }

                            //Define the columns in the dataTable for each week
                            ChainSetPercent_Define();


                            DataTable WeekTable = _chainSetPercentDataSet.Tables["Week"];
                            foreach (string key in _CSPGroupHash.Keys)
                            {
                                object[] pctObj = new object[WeekTable.Columns.Count];
                                int pctObjId = 1;
                                pctObj[0] = key;

                                SortedList groupLevelCells = new SortedList();
                                groupLevelCells = (SortedList)_CSPGroupHash[key];
                                foreach (int glc in groupLevelCells.Keys)
                                {
                                    ChainSetPercentValues pct = (ChainSetPercentValues)groupLevelCells[glc];
                                    foreach (WeekProfile wp in _CSPweeks)
                                    {
                                        if ((pct.Week == Convert.ToString(wp)) && (pct.SGL_ID == key))
                                        {
                                            pctObj[pctObjId] = pct.seqId;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.Percentage;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.SGL_RID;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.ChainSetPercentIsInherited;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.ChainSetPercentInheritedFromNodeRID;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.TimeID;
                                            pctObjId++;
                                            pctObj[pctObjId] = pct.Updated;
                                            //strId = pct.SGL_ID;
                                            pctObjId++;
                                        }
                                    }
                                }
                                WeekTable.Rows.Add(pctObj);
                            }


                            //Calculate and Add the total percentage row
                            CalculateTotalPercent(true);
                            //Begin TT#1676 - DOConnell - Weeks are rearranged and placed out of order after re-selecting the date range.
                            ugChainSetPercent.DataSource = null;
                            //End TT#1676 - DOConnell - Weeks are rearranged and placed out of order after re-selecting the date range.



                            ugChainSetPercent.DataSource = _chainSetPercentDataSet;
                            FunctionSecurityProfile securityProfile = _securityNodeProperties;
                            if (!_newNode)
                            {
                                securityProfile = _securityChainSetPercent;
                                SetControlReadOnly(this.tabChainSetPct, !securityProfile.AllowUpdate);
                            }
                            ChainSetPercent_SetGridProperties(securityProfile);
                            ChainSetPercent_SetInheritanceLabels();

                            ChainSetPercent_UpdateUserSettings();
                        }
                    }
                    else
                    {

                        if (_chainSetPercentDataSet != null)
                        {
                            _chainSetPercentDataSet.Clear();
                            ugChainSetPercent.DataSource = null;
                            FunctionSecurityProfile securityProfile = _securityNodeProperties;
                            if (!_newNode)
                            {
                                securityProfile = _securityChainSetPercent;
                                SetControlReadOnly(this.tabChainSetPct, !securityProfile.AllowUpdate);
                            }
                            ChainSetPercent_SetGridProperties(securityProfile);
                            ChainSetPercent_SetInheritanceLabels();

                            ChainSetPercent_UpdateUserSettings();
                        }
                    }
				//End TT#1401 - DOConnell - VSW - Reservation Stores
                }
                //End TT#1682 - DOConnell - Clicking "OK" button clears all percentages
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                _chainSetPercentNewWeeks = false;
                _chainSetPercentNewGroup = false;
                this.Cursor = Cursors.Default;
                if (chgMade)
                    ChainSetPercentChangesMade = true;
            }
        }

        private void ChainSetPercent_Validate()
        {
            DataTable WeekTable = _chainSetPercentDataSet.Tables["Week"];
            int rowcount = 0;
            double cellValue;
            try
            { 
                rowcount = 0;
                foreach (DataRow row in WeekTable.Rows)
                {
                    rowcount++;
                    if (rowcount != WeekTable.Rows.Count)
                    {
                        foreach (DataColumn col in WeekTable.Columns)
                        {
                            if (!col.ColumnName.Contains("Stores") && (!col.ColumnName.Contains("IsInherited"))
                                && (!col.ColumnName.Contains("InheritedRID")) && (!col.ColumnName.Contains("Updated"))
                                && (!col.ColumnName.Contains("StoreGroupRID")) && (!col.ColumnName.Contains("CDRRID")) && (!col.ColumnName.Contains("Sequence")))
                            {
                                if (row[col] == System.DBNull.Value)
                                {
                                    cellValue = 0;
                                }
                                else
                                {
                                    cellValue = Convert.ToDouble(row[col], CultureInfo.CurrentUICulture);
                                    //End TT#169
                                }
                                if (cellValue < 0)
                                {
                                    string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNonNegative);
                                    MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                                    _cancelUpdate = true;
                                }
                            }
                        }

                    }
                    else
                    {
                        foreach (DataColumn col in WeekTable.Columns)
                        {
                            if (!col.ColumnName.Contains("Stores") && (!col.ColumnName.Contains("IsInherited"))
                                && (!col.ColumnName.Contains("InheritedRID")) && (!col.ColumnName.Contains("Updated"))
                                && (!col.ColumnName.Contains("StoreGroupRID")) && (!col.ColumnName.Contains("CDRRID")) && (!col.ColumnName.Contains("Sequence")))
                            {
                                decimal pctValue;
                                
                                if (decimal.TryParse(Convert.ToString(row[col]), out pctValue))
                                {
                                    if ((pctValue != 100 && pctValue != 0))
                                    {
                                        string text = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_InvalidChainSetPercentCriteriaPctage);
                                        text = text.Replace("{0}", col.ColumnName);
                                        MessageBox.Show(text, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                                        //Begin TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                                        _cancelUpdate = true;
                                        //End TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void CalculateTotalPercent(bool isNewTable)
        {
            DataTable WeekTable = _chainSetPercentDataSet.Tables["Week"];
            int rowcount = 0;
            try
            {
                //If this is not a new dataset then clear the last row
                if (!isNewTable)
                {
                    rowcount = 0;
                    foreach (DataRow row in WeekTable.Rows)
                    {
                        rowcount++;
                        if (rowcount == WeekTable.Rows.Count)
                        {
                            WeekTable.Rows.Remove(row);
                            break;
                        }
                    }
                }
                //Begin TT#1695 - DOConnell - Chain Set % Node Properties: The Order in which the attribute sets display in Chain Set % don't match up with the order in Store Explorer
                else
                {
                    DataView view = new DataView(WeekTable);
                    view.Sort = Convert.ToString(WeekTable.Columns[1].ColumnName);
                    WeekTable = view.ToTable();
                }
                //End TT#1695 - DOConnell - Chain Set % Node Properties: The Order in which the attribute sets display in Chain Set % don't match up with the order in Store Explorer
                
                Hashtable pctTotals = new Hashtable();
                _ChainSetPercentTotal = new SortedList();
                
                object[] weekObj = new object[WeekTable.Columns.Count];
                int weekObjId = 0;
                decimal totPct = 0;
                foreach (WeekProfile wp in _CSPweeks)
                {
                    foreach (DataColumn col in WeekTable.Columns)
                    {
                        if (!col.ColumnName.Contains("Stores") && (!col.ColumnName.Contains("IsInherited")) 
                            && (!col.ColumnName.Contains("InheritedRID")) && (!col.ColumnName.Contains("Updated"))
                            && (!col.ColumnName.Contains("StoreGroupRID")) && (!col.ColumnName.Contains("CDRRID")) && (!col.ColumnName.Contains("Sequence")))
                        {
                            if (col.ColumnName == Convert.ToString(wp))
                            {
                                
                                foreach (DataRow row in WeekTable.Rows)
                                {
                                    decimal pctValue;
                                    if (decimal.TryParse(Convert.ToString(row[col]), out pctValue))
                                    {
                                        totPct = totPct + pctValue;
                                    }
                                }
                                weekObj[weekObjId] = totPct;
                                if (!_ChainSetPercentTotal.Contains(wp.Key))
                                    _ChainSetPercentTotal.Add(wp.Key, totPct);
                                totPct = 0;
                                weekObjId++;
                            }
                        }
                    }
                    if (!_ChainSetPercentTotal.Contains(wp.Key))
                        _ChainSetPercentTotal.Add(wp.Key, weekObj);
                }

                object[] totPctObj = new object[WeekTable.Columns.Count];
                int totObjId = 1;
                totPctObj[0] = "Chain";
                foreach (DataColumn col in WeekTable.Columns)
                {
                    if (!col.ColumnName.Contains("Stores"))
                    {
                        if ((!col.ColumnName.Contains("IsInherited")) && (!col.ColumnName.Contains("InheritedRID"))
                            && (!col.ColumnName.Contains("Updated")) && (!col.ColumnName.Contains("StoreGroupRID"))
                            && (!col.ColumnName.Contains("CDRRID")) && (!col.ColumnName.Contains("Sequence")))
                        {
                            foreach (WeekProfile wp in _CSPweeks)
                            {
                                if (col.ColumnName == Convert.ToString(wp))
                                {
                                    foreach (int i in _ChainSetPercentTotal.Keys)
                                    {
                                        if (i == wp.Key)
                                        {
                                            if (Convert.ToInt32(_ChainSetPercentTotal[i]) != 0)
                                            {
                                                totPctObj[totObjId] = _ChainSetPercentTotal[i];
                                            }
                                            else
                                            {
                                                totPctObj[totObjId] = null;
                                            }
                                            totObjId++;
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                        else if (col.ColumnName.Contains("StoreGroupRID"))
                        {
                            totPctObj[totObjId] = null;
                            totObjId++;
                        }
                        else if (col.ColumnName.Contains("IsInherited"))
                        {
                            totPctObj[totObjId] = null;
                            totObjId++;
                        }
                        else if (col.ColumnName.Contains("InheritedRID"))
                        {
                            totPctObj[totObjId] = null;
                            totObjId++;
                        }
                        else if (col.ColumnName.Contains("CDRRID"))
                        {
                            foreach (WeekProfile wp in _CSPweeks)
                            {
                                if (col.ColumnName.Contains(Convert.ToString(wp.YearWeek)))
                                {
                                    totPctObj[totObjId] = wp.YearWeek;
                                    totObjId++;
                                    break;
                                }
                            }
                        }
                        else if (col.ColumnName.Contains("Sequence"))
                        {
                            totPctObj[totObjId] = null;
                            totObjId++;
                        }
                        else if (col.ColumnName.Contains("Updated"))
                        {
                            totPctObj[totObjId] = null;
                            totObjId++;
                        }
                    }
                }

                WeekTable.Rows.Add(totPctObj);
                WeekTable.AcceptChanges();
                //Begin TT#1695 - DOConnell - Chain Set % Node Properties: The Order in which the attribute sets display in Chain Set % don't match up with the order in Store Explorer
                if (isNewTable)
                {
                    _chainSetPercentDataSet.Tables.Remove("Week");
                    _chainSetPercentDataSet.Tables.Add(WeekTable);
                }
                //End TT#1695 - DOConnell - Chain Set % Node Properties: The Order in which the attribute sets display in Chain Set % don't match up with the order in Store Explorer
            }
                
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void UpdateChainSetPercentProfiles(int CellRow, int CellCol)
        {
            try
            {
                //Begin TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                if (!_cancelUpdate)
                {
                    int rowCount = (_chainSetPercentDataSet.Tables["Week"].Rows.Count - 1);
                    foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                    {
                        if (CellRow != 0 || CellCol != 0)
                        {
                            if (row.Index != this.ugChainSetPercent.Rows.Count - 1)
                            {
                                for (int r = 0; r < row.Cells.Count; ++r)
                                {
                                    if ((row.Cells[r].Column.Index == CellCol) && (row.Index == CellRow))
                                    {
                                        if ((!Convert.ToString(row.Cells[r].Column).Contains("Stores")) && (!Convert.ToString(row.Cells[r].Column).Contains("IsInherited"))
                                            && (!Convert.ToString(row.Cells[r].Column).Contains("InheritedRID")) && (!Convert.ToString(row.Cells[r].Column).Contains("CDRRID"))
                                            && (!Convert.ToString(row.Cells[r].Column).Contains("StoreGroupRID")) && (!Convert.ToString(row.Cells[r].Column).Contains("Updated"))
                                            && (!Convert.ToString(row.Cells[r].Column).Contains("Sequence")))
                                        {
                                            int yearWeek = Convert.ToInt32(row.Cells[r + 4].Value);
                                            int StoreGroupRID = Convert.ToInt32(row.Cells[r + 1].Value);
                                            // Begin TT#1719 - JSmith - Chain Set Pct:  System Overflow exception in Node Properties
                                            //int yearWeekKey = Convert.ToInt32((Convert.ToString(yearWeek) + Convert.ToString(StoreGroupRID)));
                                            int yearWeekKey = Convert.ToInt32((Convert.ToString(yearWeek - 200000) + Convert.ToString(StoreGroupRID)));
                                            // End TT#1719

                                            ChainSetPercentProfiles cspp = new ChainSetPercentProfiles(yearWeekKey);

                                            cspp.TimeID = yearWeek;
                                            cspp.NodeRID = _hnp.Key;
                                            cspp.NodeID = _hnp.NodeID;

                                            StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_sizeCurvesSimilarStoreGroupList.FindKey(_groupRID);
                                            cspp.StoreGroupID = storeGroup.GroupId;
                                            cspp.StoreGroupRID = _groupRID;
                                            cspp.StoreGroupVersion = StoreMgmt.StoreGroup_GetVersion(cspp.StoreGroupRID);  // TT#1935-MD - JSmith - SVC - Node Properties- Chain Set Percent - Select Str Attribute, Date Range and type in % by week.  Select the Apply button and receive a DB Error.
                                            cspp.StoreGroupLevelID = Convert.ToString(row.Cells[0].Value);
                                            cspp.StoreGroupLevelRID = StoreGroupRID;

                                            decimal pctValue;
                                            if (decimal.TryParse(Convert.ToString(row.Cells[r].Value), out pctValue))
                                                cspp.ChainSetPercent = pctValue;


                                                if (Convert.ToString(_priorPercentageValue) == string.Empty)
                                                {
                                                    cspp.NewRecord = true;
                                                    cspp.ChainSetPercentChangeType = eChangeType.add;
                                                }
                                                else if (pctValue != Convert.ToInt32(_priorPercentageValue))
                                                {
                                                    cspp.ChainSetPercentChangeType = eChangeType.update;
                                                }

                                            if (_chainSetPercentList.Contains(cspp.Key))
                                                _chainSetPercentList.Update(cspp);
                                            if (!_chainSetPercentList.Contains(cspp.Key))
                                                _chainSetPercentList.Add(cspp);

                                                //CalculateTotalPercent(false);
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    CalculateTotalPercent(false);
                }
                //End TT#1682 - DOConnell - Clicking "OK" button clears all percentages
            }

            catch (Exception exception)
            {
                HandleException(exception);
            }
            finally
            {
                //Begin TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                //if (_processingSave)
                if (_processingSave && !_cancelUpdate)
                //End TT#1682 - DOConnell - Clicking "OK" button clears all percentages
                {
                    
                    _SAB.HierarchyServerSession.ChainSetPercentUpdate(_hnp.Key, _chainSetPercentList, Begdr.Key, false); // TT#2015 - gtaylor - apply changes to lower levels
                    //ChainSetPercent_Populate(true);
                    //ChainSetPercentChangesMade = false;
                }
            }
        }

        private void DefaultChainSetPercentGridLayout()
        {
            try
            {
                this.ugChainSetPercent.DisplayLayout.Override.RowSelectors = Infragistics.Win.DefaultableBoolean.False;
                this.ugChainSetPercent.DisplayLayout.Appearance.ImageBackgroundStyle = Infragistics.Win.ImageBackgroundStyle.Stretched;
                this.ugChainSetPercent.DisplayLayout.AddNewBox.Hidden = true;
                this.ugChainSetPercent.DisplayLayout.GroupByBox.Hidden = true;
                this.ugChainSetPercent.DisplayLayout.GroupByBox.Prompt = " ";
                this.ugChainSetPercent.DisplayLayout.ViewStyleBand = Infragistics.Win.UltraWinGrid.ViewStyleBand.Horizontal;
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_InitializeLayout(object sender, Infragistics.Win.UltraWinGrid.InitializeLayoutEventArgs e)
        {
            try
            {
                if (!_chainSetPercentGridBuilt)
                {

                        DefaultChainSetPercentGridLayout();

                    _chainSetPercentGridBuilt = true;
                }

                if (!this._securityChainSetPercent.AllowUpdate)
                {
                    foreach (UltraGridBand ugb in this.ugChainSetPercent.DisplayLayout.Bands)
                    {
                        ugb.Override.AllowDelete = DefaultableBoolean.False;
                    }
                }
                else
                {
                    foreach (UltraGridBand ugb in this.ugChainSetPercent.DisplayLayout.Bands)
                    {
                        ugb.Override.AllowDelete = DefaultableBoolean.True;
                    }
                }

            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ChainSetPercent_SetGridProperties(FunctionSecurityProfile securityProfile)
        {
            try
            {

            //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                this.ugChainSetPercent.DisplayLayout.Override.AllowColMoving = AllowColMoving.NotAllowed;  
                this.ugChainSetPercent.DisplayLayout.Bands[0].Override.FixedRowSortOrder = FixedRowSortOrder.FixOrder;   
                this.ugChainSetPercent.DisplayLayout.Bands[0].Override.FixedRowStyle = FixedRowStyle.Bottom;   
            //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 

                foreach (Infragistics.Win.UltraWinGrid.UltraGridBand band in this.ugChainSetPercent.DisplayLayout.Bands)
				{
                    foreach (Infragistics.Win.UltraWinGrid.UltraGridColumn column in band.Columns)
                    {
                        string name = Convert.ToString(column);
                        if (name != "Stores")
                        {
                            if ((name.Contains("IsInherited")) || (name.Contains("InheritedRID"))
                                || (name.Contains("Updated")) || name.Contains("StoreGroupRID")
                                || (name.Contains("CDRRID")) || name.Contains("Sequence"))
                            {
                                column.Hidden = true;
                            }
                            else
                            {
                                column.CellAppearance.TextHAlign = HAlign.Right;
                                column.TabStop = true;
                                
                            }
                        }
                        else
                        {
                            column.CellAppearance.BackColor = System.Drawing.Color.GhostWhite;
                            column.TabStop = false;
                        }

                    }
                    foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                    {
                        int rowCount = (_chainSetPercentDataSet.Tables["Week"].Rows.Count - 1);
                        if ((row.Index + 1) == this.ugChainSetPercent.Rows.Count)
                        {
                            row.Appearance.FontData.Bold = DefaultableBoolean.True;
                            row.Appearance.BackColor = System.Drawing.Color.LemonChiffon;
                        }

                        if (row.Index == rowCount)
                        {
                            for (int r = 0; r < row.Cells.Count; ++r)
                            {
                                if ((!Convert.ToString(row.Cells[r].Column).Contains("Stores")) && (!Convert.ToString(row.Cells[r].Column).Contains("IsInherited"))
                                    && (!Convert.ToString(row.Cells[r].Column).Contains("InheritedRID")) && (!Convert.ToString(row.Cells[r].Column).Contains("CDRRID"))
                                    && (!Convert.ToString(row.Cells[r].Column).Contains("Updated")) && (!Convert.ToString(row.Cells[r].Column).Contains("Sequence")))
                                {

                                    decimal value;
                                    if (decimal.TryParse(Convert.ToString(row.Cells[r].Value), out value))
                                        if (value != 100)
                                        {
                                            row.Cells[r].Appearance.ForeColor = System.Drawing.Color.Red;
                                        }
                                }
                            }
                        }
                //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                        row.Cells[0].Activation = Activation.NoEdit;
                        for (int cn = 1; cn < row.Cells.Count; ++cn)
                        {
                            if (!row.Cells[cn].Column.Hidden)
                            {
                                if (row.Index == this.ugChainSetPercent.Rows.Count - 1)
                                {
                                    row.Cells[cn].Activation = Activation.NoEdit;
                                    row.Fixed = true; 
                                }
                            }
                        }
                //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                    }
                }
                _chainSetPercentIsPopulated = true;

            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ChainSetPercent_SetInheritanceLabels()
        {
            int x = 130;
            int y = 110;
            string inheritMsg;
            string InheritedFrom = null;
            string diffAttribute = null;
            bool broken = false;
            try 
            {
                //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                _htChainSetPercentInheritance = new Hashtable();
                //End TT#1699
                if (_isCSPInhLabelList != null)
                {
                    foreach (Label l in _isCSPInhLabelList)
                    {
                        l.Dispose();
                    }
                    _isCSPInhLabelList.Clear();
                }
                _isCSPInhLabelList = new List<Label>();

                int lblIndex = 0;
				//Begin TT#1401 - DOConnell - VSW - Reservation Stores
                Label[] weekLabel = null;
                Label[] errorLabel = null;

                if (_CSPweeks != null)
                {
                    weekLabel = new Label[_CSPweeks.Count];
                    errorLabel = new Label[_CSPweeks.Count];

                    foreach (WeekProfile wp in _CSPweeks)
                    {
                        weekLabel[lblIndex] = new System.Windows.Forms.Label();
                        weekLabel[lblIndex].Name = "lblChainSetPercentInheritance " + Convert.ToString(wp);
                        weekLabel[lblIndex].Text = string.Empty;
                        weekLabel[lblIndex].Location = new System.Drawing.Point(x, 50);
                        weekLabel[lblIndex].Size = new System.Drawing.Size(32, 16);

                        errorLabel[lblIndex] = new System.Windows.Forms.Label();
                        errorLabel[lblIndex].Name = "lblAttributeDifference " + Convert.ToString(wp);
                        errorLabel[lblIndex].Text = string.Empty;
                        errorLabel[lblIndex].Location = new System.Drawing.Point(y, 50);
                        errorLabel[lblIndex].Size = new System.Drawing.Size(32, 16);

                        //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                        _htChainSetPercentInheritance.Add(wp.ToString(), weekLabel[lblIndex]);
                        //End TT#1699

                        foreach (string key in _CSPGroupHash.Keys)
                        {
                            SortedList groupLevelCells = new SortedList();
                            groupLevelCells = (SortedList)_CSPGroupHash[key];

                            foreach (int glc in groupLevelCells.Keys)
                            {
                                if (glc == wp.YearWeek)
                                {
                                    ChainSetPercentValues pct = (ChainSetPercentValues)groupLevelCells[glc];
                                    //if (pct.ChainSetPercentIsInherited && pct.ChainSetPercentInheritedFromNodeRID != Include.NoRID)
                                    if (pct.ChainSetPercentIsInherited)
                                    {
                                        //Begin TT#1675 - DOConnell - Chain Set Percent Node Properties: System.NullReference Exception after clicking "Ok" button
                                        if (pct.ChainSetPercentInheritedFromNodeRID > 0)
                                        {
                                            HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(pct.ChainSetPercentInheritedFromNodeRID, false);
                                            InheritedFrom = hnp.LevelText;
                                            inheritMsg = _txtInheritedFrom + InheritedFrom;
                                            InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                            broken = true;
                                            //break;
                                        }
                                        else
                                        {
                                            InheritedFrom = "Node Identification Error [" + pct.ChainSetPercentInheritedFromNodeRID + "]";
                                            inheritMsg = _txtInheritedFrom + InheritedFrom;
                                            InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                            broken = true;
                                        }
                                        //End TT#1675 - DOConnell - Chain Set Percent Node Properties: System.NullReference Exception after clicking "Ok" button
                                    }
                                    else
                                    {
                                        InheritedFrom = string.Empty;
                                        inheritMsg = string.Empty;
                                        InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                        broken = true;
                                        //break;
                                    }

                                    foreach (ChainSetPercentProfiles cspp in _chainSetPercentList)
                                    {
                                        if ((cspp.TimeID == wp.YearWeek) && (cspp.StoreGroupRID != ((StoreGroupListViewProfile)cbCSPStoreAttribute.SelectedItem).Key))
                                        {
                                            diffAttribute = "Node/Week using " + cspp.StoreGroupID + " Attribute";
                                            ErrorProvider.SetError(errorLabel[lblIndex], diffAttribute);
                                            if (cspp.ChainSetPercentIsInherited)
                                            {
                                                //Begin TT#1675 - DOConnell - Chain Set Percent Node Properties: System.NullReference Exception after clicking "Ok" button
                                                if (cspp.ChainSetPercentInheritedFromNodeRID > 0)
                                                {
                                                    HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(cspp.ChainSetPercentInheritedFromNodeRID, false);
                                                    InheritedFrom = hnp.LevelText;
                                                    inheritMsg = _txtInheritedFrom + InheritedFrom;
                                                    InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                                    broken = true;
                                                    //break;
                                                }
                                                else
                                                {
                                                    InheritedFrom = "Node Identification Error [" + cspp.ChainSetPercentInheritedFromNodeRID + "]";
                                                    inheritMsg = _txtInheritedFrom + InheritedFrom;
                                                    InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                                    broken = true;
                                                }
                                                //End TT#1675 - DOConnell - Chain Set Percent Node Properties: System.NullReference Exception after clicking "Ok" button
                                            }
                                            else
                                            {
                                                InheritedFrom = string.Empty;
                                                inheritMsg = string.Empty;
                                                InheritanceProvider.SetError(weekLabel[lblIndex], inheritMsg);
                                                broken = true;
                                                //break;
                                            }

                                            //Begin TT#1691 - DOConnell - Chain Set Percent - Node Prop allowing multiple % entered for same weeks/different attributes
                                            foreach (Infragistics.Win.UltraWinGrid.UltraGridBand band in this.ugChainSetPercent.DisplayLayout.Bands)
                                            {
                                                foreach (Infragistics.Win.UltraWinGrid.UltraGridColumn column in band.Columns)
                                                {
                                                    string name = Convert.ToString(column);
                                                    if (name != "Stores")
                                                    {
                                                        if (name.Contains(Convert.ToString(wp)))
                                                        {
                                                            if ((!name.Contains("IsInherited")) && (!name.Contains("InheritedRID"))
                                                                && (!name.Contains("Updated")) && !name.Contains("StoreGroupRID")
                                                                && (!name.Contains("CDRRID")) && (!name.Contains("Sequence")))
                                                            {

                                                                column.CellActivation = Activation.Disabled;

                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            //End TT#1691 - DOConnell - Chain Set Percent - Node Prop allowing multiple % entered for same weeks/different attributes
                                            break;
                                        }
                                    }
                                }
                            }
                            if (broken)
                                break;
                        }

                        this.tabChainSetPct.Controls.Add(weekLabel[lblIndex]);
                        _isCSPInhLabelList.Add(weekLabel[lblIndex]);
                        this.tabChainSetPct.Controls.Add(errorLabel[lblIndex]);
                        _isCSPInhLabelList.Add(errorLabel[lblIndex]);
                        x = x + 90;
                        y = y + 90;
                        lblIndex++;
                    }
					//End TT#1401 - DOConnell - VSW - Reservation Stores
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            try
            {
                Infragistics.Win.UIElement mouseUIElement;
                Infragistics.Win.UIElement headerUIElement;
                Infragistics.Win.UltraWinGrid.UltraGridCell mouseCell;
                HeaderUIElement headerUI = null;
                Point point = new Point(e.X, e.Y);

                if (e.Button == MouseButtons.Right)
                {
                    // retrieve the UIElement from the location of the mouse 
                    mouseUIElement = ugChainSetPercent.DisplayLayout.UIElement.ElementFromPoint(new Point(e.X, e.Y));
                    if (mouseUIElement == null) { return; }

                    headerUIElement = mouseUIElement.GetAncestor(typeof(HeaderUIElement));
                    if (null == headerUIElement)
                    {
                        // retrieve the Cell from the UIElement 
                        mouseCell = (Infragistics.Win.UltraWinGrid.UltraGridCell)mouseUIElement.GetContext(typeof(Infragistics.Win.UltraWinGrid.UltraGridCell));

                        // if there is a cell object reference, set to active cell and edit
                        if (mouseCell != null)
                        {
                            ugChainSetPercent.ActiveCell = mouseCell;	// set the cell under the mouse as active
                        }
                    }
                    else
                        if (headerUIElement.GetType() == typeof(HeaderUIElement))
                        {
                            headerUI = (HeaderUIElement)headerUIElement;
                            Infragistics.Win.UltraWinGrid.ColumnHeader colHeader = null;
                            _gridCol = null;
                            colHeader = (Infragistics.Win.UltraWinGrid.ColumnHeader)headerUI.SelectableItem;
                            _gridCol = colHeader.Column;
                            if (_gridCol == null)
                                return;

                            _gridBand = colHeader.Band;

                            this.mnuGridColHeader.Show(this.ugChainSetPercent, point);

                        }
                }
                
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_BeforeCellActivate(object sender, Infragistics.Win.UltraWinGrid.CancelableCellEventArgs e)
        {
            try
            {
                if (_chainSetPercentIsPopulated)
                {
                    for (int r = 0; r < e.Cell.Row.Cells.Count; ++r)
                    {
                        if (Convert.ToString(e.Cell.Row.Cells[r].Column) == Convert.ToString(e.Cell.Column))
                        {
                            if ((!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("Stores")) && (!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("IsInherited"))
                                && (!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("InheritedRID")) && (!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("CDRRID"))
                                && (!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("Updated")) && (!Convert.ToString(e.Cell.Row.Cells[r].Column).Contains("Sequence")))
                            _priorPercentageValue = e.Cell.Row.Cells[r].Value;
                            break;
                        }
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_CellChange(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {  
            try
            {
                Infragistics.Win.UltraWinGrid.UltraGridBand activeRowBand = e.Cell.Row.Band;
                _cancelUpdate = false;

                if (_chainSetPercentIsPopulated)
                {
                    foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                    {
                        for (int r = 0; r < row.Cells.Count; ++r)
                        {
                            if (e.Cell.Column.Key == Convert.ToString(row.Cells[r].Column))
                            {
                                if ((!Convert.ToString(row.Cells[r].Column).Contains("Stores")) && (!Convert.ToString(row.Cells[r].Column).Contains("IsInherited"))
                                    && (!Convert.ToString(row.Cells[r].Column).Contains("InheritedRID")) && (!Convert.ToString(row.Cells[r].Column).Contains("CDRRID"))
                                    && (!Convert.ToString(row.Cells[r].Column).Contains("Updated")) && (!Convert.ToString(row.Cells[r].Column).Contains("Sequence")))
                                {
                                    if (Convert.ToString(_priorPercentageValue) == string.Empty ||  Convert.ToString(e.Cell.Value) == string.Empty)
                                    {
                                        if (row.Cells[r + 5].Column.Key.Contains("Updated"))
                                            //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                                            row.Cells[r + 5].Value = true;
                                            //e.Cell.Row.Cells[r + 5].Value = true;
                                            //End TT#1699
                                        ChainSetPercentChangesMade = true;
                                        //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                                        InheritanceProvider.SetError((System.Windows.Forms.Label)_htChainSetPercentInheritance[e.Cell.Column.Key], null);
                                        //End TT#1699
                                    }
                                    else if (e.Cell.Value != _priorPercentageValue)
                                    {
                                        if (row.Cells[r + 5].Column.Key.Contains("Updated"))
                                            //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                                            row.Cells[r + 5].Value = true;
                                            //e.Cell.Row.Cells[r + 5].Value = true;
                                            //End TT#1699
                                        ChainSetPercentChangesMade = true;
                                        //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                                        InheritanceProvider.SetError((System.Windows.Forms.Label)_htChainSetPercentInheritance[e.Cell.Column.Key], null);
                                        //End TT#1699
                                    }
                                }
                                //Begin TT#1699 - JSmith - Chain Set % Node Properties: Unchanged Sets did not break their inheritance nor take possession of values as their own.
                                //break;
                                //End TT#1699
                            }
                        }
                    }
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_BeforeCellUpdate(object sender, Infragistics.Win.UltraWinGrid.BeforeCellUpdateEventArgs e)
        {
            try
            {
                if (_cancelUpdate)
                {
                    e.Cancel = true;
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_AfterCellUpdate(object sender, Infragistics.Win.UltraWinGrid.CellEventArgs e)
        {
            try
            {
                if ((!Convert.ToString(e.Cell.Column).Contains("Stores")) && (!Convert.ToString(e.Cell.Column).Contains("IsInherited"))
                        && (!Convert.ToString(e.Cell.Column).Contains("InheritedRID")) && (!Convert.ToString(e.Cell.Column).Contains("CDRRID"))
                        && (!Convert.ToString(e.Cell.Column).Contains("Updated")) && (!Convert.ToString(e.Cell.Column).Contains("Sequence"))
                        && validateChainSetPercentValue(e.Cell))
                            UpdateChainSetPercentProfiles(e.Cell.Row.Index, e.Cell.Column.Index);
                            ChainSetPercent_SetGridProperties(_securityNodeProperties);

                //BEGIN TT#2015 - gtaylor - Apply Changes to Lower Levels
                // create the change profile and add it to the list
                if (e.Cell.Row.Band.Key == "Week")
                {
                    if ((!Convert.ToString(e.Cell.Column).Contains("Stores")) && (!Convert.ToString(e.Cell.Column).Contains("IsInherited"))
                        && (!Convert.ToString(e.Cell.Column).Contains("InheritedRID")) && (!Convert.ToString(e.Cell.Column).Contains("CDRRID"))
                        && (!Convert.ToString(e.Cell.Column).Contains("Updated")) && (!Convert.ToString(e.Cell.Column).Contains("Sequence"))
                        && validateChainSetPercentValue(e.Cell))
                    {
                        ChangeProfileChainSet cspChange = new ChangeProfileChainSet(
                            e.Cell.Text.ToString(), // new value
                            e.Cell.Row.Cells[e.Cell.Column].OriginalValue.ToString(), // old value
                            e.Cell.Column.Header.Caption.ToString(),
                            Convert.ToInt16(e.Cell.Row.Cells[e.Cell.Column.Index + 1].Value), // storeGroupListRID
                            e.Cell.Column.Index,
                            Convert.ToInt32(e.Cell.Row.Cells[e.Cell.Column.Index + 4].Value)
                        );

                        // create keyvaluepair and populate
                        KeyValuePair<long, object> _kvp = new KeyValuePair<long, object>(cspChange.ChangeProfileKey, cspChange);

                        //  add to nodechangeprofile list
                        _nodeChangeProfile.Add(eProfileType.ChainSetPercent, _kvp);
                    }
                }
                //END TT#2015 - gtaylor - Apply Changes to Lower Levels
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_MouseEnterElement(object sender, Infragistics.Win.UIElementEventArgs e)
        {
            try
            {
                ShowUltraGridToolTip(ugChainSetPercent, e);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        private void ugChainSetPercent_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
        {

        }

        private void ugChainSetPercent_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
        {

        }

        private void cbCSPStoreAttribute_SelectionChangeCommitted(object sender, System.EventArgs e)
        {
            try
            {
                EditMsgs em = new EditMsgs();

                if (_chainSetPercentIsPopulated)
                {
                    //Begin TT#1713 - DOConnell - Chain Set Percent Node Properties - Save option box not appearing when % changes are made and a new attribute is selected
                    if (ChainSetPercent_CheckForPendingChanges())
                    {
                        if (!_cancelUpdate)
                        {
                            if (ValidTabChainSetPercent(ref em))
                            {
                                StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_chainSetPercentGroupList[cbCSPStoreAttribute.SelectedIndex];
                                _groupRID = storeGroup.Key;
                                _CSPStoreGroupLevelList = StoreMgmt.StoreGroup_GetLevelListViewList(_groupRID, true); //_SAB.StoreServerSession.GetStoreGroupLevelListViewList(_groupRID, true);
                                _chainSetPercentNewGroup = true;
                                ChainSetPercent_Populate(false);
                                //if (FormLoaded)
                                //    ChainSetPercentChangesMade = true;
                            }
                            else
                            {
                                if (Convert.ToInt32(cbCSPStoreAttribute.SelectedValue, CultureInfo.CurrentUICulture) != _groupRID)
                                {
                                    cbCSPStoreAttribute.SelectedValue = _groupRID;
                                    for (int i = 0; i < em.EditMessages.Count; i++)
                                    {
                                        EditMsgs.Message emm = (EditMsgs.Message)em.EditMessages[i];
                                        AddErrorMessage(emm);
                                    }
                                    MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
                                }
                            }
                        }
                        else
                        {
                            if (cbCSPStoreAttribute.SelectedIndex != _chainSetPercentPreviousIndex)
                            {
                                cbCSPStoreAttribute.SelectedIndex = _chainSetPercentPreviousIndex;
                                _chainSetPercentPreviousIndex = cbCSPStoreAttribute.SelectedIndex;
                                _cancelUpdate = false;
                            }
                        }
                    }
                    else
                    {
                        if (cbCSPStoreAttribute.SelectedIndex != _chainSetPercentPreviousIndex)
                        {
                            _cancelUpdate = true;
                            cbCSPStoreAttribute.SelectedIndex = _chainSetPercentPreviousIndex;
                            _chainSetPercentPreviousIndex = cbCSPStoreAttribute.SelectedIndex;
                            _cancelUpdate = false;
                        }
                    }
                    //End TT#1713 - DOConnell - Chain Set Percent Node Properties - Save option box not appearing when % changes are made and a new attribute is selected
                }
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }

        //Begin TT#1713 - DOConnell - Chain Set Percent Node Properties - Save option box not appearing when % changes are made and a new attribute is selected
        private bool ChainSetPercent_CheckForPendingChanges()
            {
                if (ChainSetPercentChangesMade && !_cancelUpdate)
                {
                    ResultSaveChanges = MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SavePendingChanges), "Save Changes",
                        MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question);

                    switch(ResultSaveChanges) 
                    {
                        case DialogResult.Yes:
                            if (SaveChanges())
                            {
                                ChangePending = false;
                                return true;
                            }
                            else
                            {
                                return false;
                            }

                        case DialogResult.No:
                            UndoSaveChanges();
                            ChainSetPercentChangesMade = false;
                            return true;
                    
                        case DialogResult.Cancel:
                            return false;
                    }
                }
                if (_cancelUpdate)
                    return false;
                else
                return true;
            }
        //End TT#1713 - DOConnell - Chain Set Percent Node Properties - Save option box not appearing when % changes are made and a new attribute is selected

        private void cbCSPStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {

        }

        private void cbCSPStoreAttribute_DragDrop(object sender, DragEventArgs e)
        {
            try
            {
                bool isSuccessfull = ((MIDComboBoxTag)(((ComboBox)sender).Tag)).ComboBox_DragDrop(sender, e);

                if (isSuccessfull)
                {
                    ChangePending = true;
                }
            }
            catch (Exception exc)
            {
                HandleException(exc);
            }
        }

        private bool ValidTabChainSetPercent(ref EditMsgs em)
        {
            try
            {
                if (FormIsClosing && !SaveOnClose)
                {
                    return true;
                }

                if (em.ErrorFound)
                {
                    return false;
                }
                else
                {
                    return true;
                }
            }
            catch (Exception exception)
            {
                em.AddMsg(eMIDMessageLevel.Error, exception.Message, this.ToString());
                HandleException(exception);
            }

            return false;
        }

        #endregion ChainSetPct Tab
        //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3

		private void btnCancel_Click(object sender, System.EventArgs e)
		{
			try
			{
				Cancel_Click();
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void btnApply_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;

                // Begin TT#2138 - JSmith - Open Node Properties Read Only
                if (!_editEnabled)
                {
                    if (LockNode())
                    {
                        this.btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);
                        // Begin TT#2747 - JSmith - Store Grade Tab in Node Properties
                        this.ugStoreGrades.DisplayLayout.AddNewBox.Hidden = false;
                        
                        //BEGIN TT#5114-VStuart-Boundary Does Not Allow Nulls in Stock MinMax-MID
                        //this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Hidden = false;
                        this.ugSizeCurvesCriteria.DisplayLayout.AddNewBox.Hidden = false;
                        //this.ugStockMinMax.DisplayLayout.AddNewBox.Hidden = false;
                        this.ugStockMinMax.DisplayLayout.AddNewBox.Hidden = false;
                        this.ugStockMinMax.DisplayLayout.Bands[0].Override.AllowAddNew = AllowAddNew.No;
                        //END TT#5114-VStuart-Boundary Does Not Allow Nulls in Stock MinMax-MID

                        this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = false;
                        this.ugSellThruPcts.DisplayLayout.AddNewBox.Hidden = false;
                        this.ugVelocityGrades.DisplayLayout.AddNewBox.Hidden = false;
                        // End TT#2747 - JSmith - Store Grade Tab in Node Properties
                        _editEnabled = true;
                    }
                    return;
                }
                // Begin TT#2138 - JSmith - Open Node Properties Read Only

				SaveChanges();
				// reset update flags
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
			
				if (!ErrorFound)
				{
					if (EligibilityChangesMade)
					{
						// reset eligibility update flags
						foreach(  UltraGridRow setRow in this.ugStoreEligibility.Rows )
						{
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
								storeRow.Cells["Updated"].Value = false;
							}
						}
						EligibilityChangesMade = false;
					}

					StoreGradesChangesMade = false;
					MinMaxesChangesMade = false;
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					SizeCurvesCriteriaChangesMade = false;
					SizeCurvesMinAvgToleranceChangesMade = false;
					SizeCurvesHighLevelToleranceChangesMade = false;
					SizeCurvesSalesToleranceChangesMade = false;
					SizeCurvesIndexToleranceChangesMade = false;
					SizeCurvesMinPctToleranceChangesMade = false;
					SizeCurvesMaxPctToleranceChangesMade = false;

					if (SizeCurvesSimilarStoreChangesMade)
					{
						// reset size curves similar store update flags
						foreach (UltraGridRow setRow in this.ugSizeCurvesSimilarStore.Rows)
						{
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
							{
								storeRow.Cells["Updated"].Value = false;
							}
						}
						SizeCurvesSimilarStoreChangesMade = false;
					}
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing

					SizeOutOfStockSizeGroupChangesMade = false;
					SizeOutOfStockStoreGroupChangesMade = false;
					SizeOutOfStockQuantityChangesMade = false;
					SizeSellThruChangesMade = false;
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing

					if (StoreCapacityChangesMade)
					{
						// reset store capacity update flags
						foreach(  UltraGridRow setRow in this.ugStoreCapacity.Rows )
						{
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
								storeRow.Cells["Updated"].Value = false;
							}
						}
						StoreCapacityChangesMade = false;
					}

					VelocityGradesChangesMade = false;
					//Begin TT#505 - JScott - Velocity - Apply Min/Max
					VelocityMinMaxesChangesMade = false;
					//End TT#505 - JScott - Velocity - Apply Min/Max
			
					if ((DailyPercentagesChangesMade) || (this.cbxDPInheritFromHigherLevel.Checked)) // TT#2015 - gtaylor - apply changes to lower levels
					{
						// reset store daily percentages update flags
						foreach(  UltraGridRow setRow in this.ugDailyPercentages.Rows )
						{
							ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
							foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
							{
								storeRow.Cells["Updated"].Value = false;
							}
						}
						DailyPercentagesChangesMade = false;
					}

                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                    if ((ChainSetPercentChangesMade) || (this.cbxCSPInheritFromHigherLevel.Checked)) // TT#2015 - gtaylor - apply changes to lower levels
                    {
                        // reset chain set percentages update flags
                        int rowCount = (_chainSetPercentDataSet.Tables["Week"].Rows.Count - 1);
                        foreach (Infragistics.Win.UltraWinGrid.UltraGridRow row in this.ugChainSetPercent.Rows)
                        {
                            for (int r = 0; r < row.Cells.Count; ++r)
                            {
                                //if (!Convert.ToString(row.Cells[r].Column).Contains("Updated"))
                                if (Convert.ToString(row.Cells[r].Column).Contains("Updated"))
                                {
                                    row.Cells[r].Value = false;
                                }
                            }
                        }
                        ChainSetPercentChangesMade = false;
                    }
                    //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3


					Format_Title(eDataState.Updatable, eMIDTextCode.frm_NodeProperties,_hnp.Text);

					if ( _rebuildScreen)
					{
						repopulateData();
						cbxSEInheritFromHigherLevel.Checked = false;
						cbxVGInheritFromHigherLevel.Checked = false;
						cbxSGInheritFromHigherLevel.Checked = false;
						cbxSMMInheritFromHigherLevel.Checked = false;
						cbxSCInheritFromHigherLevel.Checked = false;
						cbxDPInheritFromHigherLevel.Checked = false;
						cbxPCInheritFromHigherLevel.Checked = false;
                        cbxCHInheritFromHigherLevel.Checked = false;
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						cbxSZCriteriaInheritFromHigherLevel.Checked = false;
						cbxSZToleranceInheritFromHigherLevel.Checked = false;
						cbxSZSimilarStoreInheritFromHigherLevel.Checked = false;
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#442 --  Node properties - Apply to lower levels - received the question on deleting when select Apply and again when selecting OK.
						cbxSEApplyToLowerLevels.Checked = false;
						cbxVGApplyToLowerLevels.Checked = false;
						cbxSGApplyToLowerLevels.Checked = false;
						cbxSMMApplyToLowerLevels.Checked = false;
						cbxSCApplyToLowerLevels.Checked = false;
						cbxDPApplyToLowerLevels.Checked = false;
						cbxPCApplyToLowerLevels.Checked = false;
						cbxCHApplyToLowerLevels.Checked = false;
						cbxSZCriteriaApplyToLowerLevels.Checked = false;
						cbxSZToleranceApplyToLowerLevels.Checked = false;
						cbxSZSimilarStoreApplyToLowerLevels.Checked = false;
                        //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                        cbxCSPApplyToLowerLevels.Checked = false;
                        cbxCSPInheritFromHigherLevel.Checked = false;
                        //End TT#1671 - DOConnell - Chain Set Percent Node Properties
                        rbApplyChangesToLowerLevelsIMO.Checked = false; //TT#2015 - Apply Changes to Lower Levels - gtaylor
                        cbxApplyToLowerLevels.Checked = false; //TT#1401 - Reservation Stores - gtaylor
                        cbxRsrvInheritFromHigherLevel.Checked = false; //TT#1401 - Reservation Stores - gtaylor
						//End TT#442 --  Node properties - Apply to lower levels - received the question on deleting when select Apply and again when selecting OK.
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						cbxSZOOSInheritFromHigherLevel.Checked = false;
						cbxSZSellThruInheritFromHigherLevel.Checked = false;
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					}
					_rebuildScreen = false;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

        // Begin TT#2138 - JSmith - Open Node Properties Read Only
        private bool LockNode()
        {
            // don't lock hierarchy if already locked
            if (_hnp == null ||
               _hnp.NodeLockStatus != eLockStatus.Locked)
            {
                _hnp = _SAB.HierarchyServerSession.GetNodeDataForUpdate(_hnp.Key, true);
                if (_hnp.NodeLockStatus == eLockStatus.ReadOnly)
                {
                    _nodeSecurity.SetReadOnly();
                }
                else if (_hnp.NodeLockStatus == eLockStatus.Cancel)
                {
                    return false;
                }
                else
                {
                    ToggleControlsForUpdate();
                    btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);
                    btnApply.Enabled = false;
                }
            }
            return true;
        }

        private void ToggleControlsForUpdate()
        {
            _nodeSecurity = _SAB.ClientServerSession.GetMyUserNodeSecurityAssignment(_hnp.Key, (int)eSecurityTypes.All);
            LoadCommon(false);

            eDataState dataState;
            if (_nodeSecurity.AllowUpdate)
            {
                dataState = eDataState.Updatable;
            }
            else
            {
                dataState = eDataState.ReadOnly;
            }
            Format_Title(dataState, eMIDTextCode.frm_NodeProperties, _hnp.Text);

            SetReadOnly(_nodeSecurity.AllowUpdate);
            SetControlReadOnly(this.tabProfile, !_securityProfile.AllowUpdate);
            // Begin TT#3132 - JSmith - Node Properties - Hierarchy Issue
            this.txtDescription.Enabled = false;
            this.txtNodeID.Enabled = false;
            this.txtColorGroup.Enabled = false;
            this.txtNodeName.Enabled = false;
            if (_hnp.NodeLevel == 0)  // hierarchy so don't allow changing name, ID, or description here
            {
                this.txtNodeName.Enabled = false;
                this.txtDescription.Enabled = false;
                this.txtNodeID.Enabled = false;
            }
            else
                if (_hnp.LevelType == eHierarchyLevelType.Color)
                {
                    if (_securityNodes.AllowUpdate)
                    {
                        this.txtDescription.Enabled = true;
                    }
                    this.txtNodeID.Enabled = false;
                    this.txtColorGroup.Enabled = false;
                    this.txtNodeName.Enabled = false;
                }
                else
                    if (_hnp.LevelType == eHierarchyLevelType.Size)
                    {
                        // Begin TT#3307 - JSmith - Size Node Description should not be allowed to be changed.
                        //if (_securityNodes.AllowUpdate)
                        //{
                        //    this.txtDescription.Enabled = true;
                        //}
                        // End TT#3307 - JSmith - Size Node Description should not be allowed to be changed.
                        this.txtNodeID.Enabled = false;
                        this.txtNodeName.Enabled = false;
                    }
                    else
                    {
                        if (_securityNodes.AllowUpdate)
                        {
                            this.txtDescription.Enabled = true;
                            this.txtNodeID.Enabled = true;
                            this.txtNodeName.Enabled = true;
                        }
                    }
            // End TT#3132 - JSmith - Node Properties - Hierarchy Issue
            SetControlReadOnly(this.tabPurgeCriteria, !_securityPurge.AllowUpdate);

            if (_eligibilityIsPopulated)
            {
                //  BEGIN TT#2015 - GTaylor - Apply Changes to Lower Levels    
                SetControlReadOnly(this.tabStoreEligibility, !_securityEligibility.AllowUpdate);
                //  refresh the Similar Store column button when AllowUpdate = true
                if (_securityEligibility.AllowUpdate)
                {
                    this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].AutoEdit = true;
                    this.ugStoreEligibility.DisplayLayout.Bands["Sets"].Columns["Similar Store"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].AutoEdit = true;
                    this.ugStoreEligibility.DisplayLayout.Bands["Stores"].Columns["Similar Store"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                }
                //  END TT#2015 - GTaylor - Apply Changes to Lower Levels    
            }
            if (_storeGradesIsPopulated)
            {
                SetControlReadOnly(this.tabStoreGrades, !_securityStoreGrades.AllowUpdate);
                BuildStoreGradesContextmenu();
            }

            if (_sizeCurvesCriteriaIsPopulated)
            {
                SetControlReadOnly(this.tabSizeCurvesCriteria, !_securitySizeCurves.AllowUpdate);
                BuildSizeCurvesCriteriaContextmenu();
                // Begin TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
                if (_securitySizeCurves.AllowUpdate)
                {
                    this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.Disabled;
                    this.ugSizeCurvesInheritedCriteria.DisplayLayout.Bands[0].Columns["Date Range"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;

                    this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].CellActivation = Activation.NoEdit;
                    this.ugSizeCurvesCriteria.DisplayLayout.Bands[0].Columns["Date Range"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                }
                // End TT#377-MD - JSmith - Size Curve Tab-> calendar is not available when adding new size curve option (in edit mode)
            }

            if (_sizeCurvesToleranceIsPopulated)
            {
                SetControlReadOnly(this.tabSizeCurvesTolerance, !_securitySizeCurves.AllowUpdate);
            }
            if (_sizeCurvesSimilarStoreIsPopulated)
            {
                SetControlReadOnly(this.tabSizeCurvesSimilarStore, !_securitySizeCurves.AllowUpdate);
            }
            if (_storeCapacityIsPopulated)
            {
                SetControlReadOnly(this.tabStoreCapacity, !_securityCapacity.AllowUpdate);
                BuildStoreCapacityContextmenu();
            }
            if (_velocityGradesIsPopulated ||
                _sellThruPctsIsPopulated)
            {
                SetControlReadOnly(this.tabVelocityGrades, !_securityVelocity.AllowUpdate);
                BuildVelocityGradesContextmenu();
                BuildSellThruPctsContextmenu();
            }
            if (_dailyPercentagesIsPopulated)
            {
                SetControlReadOnly(this.tabDailyPercentages, !_securityDailyPcts.AllowUpdate);
                BuildDailyPercentagesContextmenu();
                //  BEGIN TT#2015 - GTaylor - Apply Changes to Lower Levels    
                //  refresh the Similar Store column button when AllowUpdate = true
                if (_securityDailyPcts.AllowUpdate)
                {
                    //this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    //this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["DisplayDate"].AutoEdit = true;
                    //this.ugDailyPercentages.DisplayLayout.Bands["Sets"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].AutoEdit = true;
                    this.ugDailyPercentages.DisplayLayout.Bands["SetDates"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    //this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    //this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["DisplayDate"].AutoEdit = true;
                    //this.ugDailyPercentages.DisplayLayout.Bands["Stores"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].AutoEdit = true;
                    this.ugDailyPercentages.DisplayLayout.Bands["StoreDates"].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                }
                //  END TT#2015 - GTaylor - Apply Changes to Lower Levels    
            }
            if (_stockMinMaxIsPopulated)
            {
                //BEGIN TT#3981 - DOConnell - No Calendar Date Selector button for Stock Min/Max Date Range
                ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].Style = Infragistics.Win.UltraWinGrid.ColumnStyle.EditButton;
                ugStockMinMax.DisplayLayout.Bands[1].Columns["DisplayDate"].ButtonDisplayStyle = Infragistics.Win.UltraWinGrid.ButtonDisplayStyle.OnMouseEnter;
                //END TT#3981 - DOConnell - No Calendar Date Selector button for Stock Min/Max Date Range

                SetControlReadOnly(this.tabStockMinMax, !_securityStockMinMax.AllowUpdate);
                BuildStockMinMaxContextmenu();
            }
            if (_characteristicsIsPopulated)
            {
                SetControlReadOnly(this.tabCharacteristics, !_securityCharacteristics.AllowUpdate);
            }
            if (_reservationIsPopulated)
            {
                SetControlReadOnly(this.tabReservation, !_securityIMO.AllowUpdate);
            }
            if (_chainSetPercentIsPopulated)
            {
                SetControlReadOnly(this.tabChainSetPct, !_securityChainSetPercent.AllowUpdate);
 
                BuildChainSetPercentContextmenu();
            }
            // Begin TT#234 MD - JSmith - Node Properties Out of Stock Tab appearance not as expected, save and hieracey service not available, tab says read only but security is full control, able to make changes when tab is read only.
            if (_sizeOutOfStockIsPopulated)
            {
                SetControlReadOnly(this.tabSizeOutOfStockParms, !_securitySizeOutOfStock.AllowUpdate);
            }
            // End TT#234 MD
        }
        // End TT#2138

		private void repopulateData()
		{
			_eligibilityIsPopulated = false;
			_storeGradesIsPopulated = false;
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			_sizeCurvesInheritedCriteriaIsPopulated = false;
			_sizeCurvesCriteriaIsPopulated = false;
			_sizeCurvesToleranceIsPopulated = false;
			_sizeCurvesSimilarStoreIsPopulated = false;
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			_sizeOutOfStockIsPopulated = false;
			_sizeSellThruIsPopulated = false;
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
			_storeCapacityIsPopulated = false;
			_velocityGradesIsPopulated = false;
			_sellThruPctsIsPopulated = false;
			_dailyPercentagesIsPopulated = false;
			_stockMinMaxIsPopulated = false;
			if (tabNodeProperties.SelectedTab.Name == tabStoreEligibility.Name)
			{
				_storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, _hnp.Key, true, false);
				StoreEligibility_Populate(false);
				_eligibilityIsPopulated = true;
			}
			else if (tabNodeProperties.SelectedTab.Name == tabStoreGrades.Name)
			{
				StoreGrades_Populate(_hnp.Key, true);
				_storeGradesIsPopulated = true;
			}
			//Begin TT#155 - JScott - Add Size Curve info to Node Properties
			else if (tabNodeProperties.SelectedTab.Name == tabSizeCurves.Name)
			{
				if (tabSizeCurvesProperties.SelectedTab.Name == tabSizeCurvesCriteria.Name)
				{
					SizeCurvesCriteria_Populate(true);
					_sizeCurvesInheritedCriteriaIsPopulated = true;
					_sizeCurvesCriteriaIsPopulated = true;
				}
				else if (tabSizeCurvesProperties.SelectedTab.Name == tabSizeCurvesTolerance.Name)
				{
					SizeCurvesTolerance_Populate(true);
					_sizeCurvesToleranceIsPopulated = true;
				}
				else if (tabSizeCurvesProperties.SelectedTab.Name == tabSizeCurvesSimilarStore.Name)
				{
					_sizeCurveSimilarStoreList = _SAB.HierarchyServerSession.GetSizeCurveSimilarStoreList(_storeList, _hnp.Key, true, false);
					SizeCurvesSimilarStore_Populate(true);
					_sizeCurvesSimilarStoreIsPopulated = true;
				}
			}
			//End TT#155 - JScott - Add Size Curve info to Node Properties
			//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
			else if (tabNodeProperties.SelectedTab.Name == tabSizeOutOfStock.Name)
			{
				if (tabSizeOutOfStockProperties.SelectedTab.Name == tabSizeOutOfStockParms.Name)
				{
					SizeOutOfStock_Populate(true, Include.NoRID, Include.NoRID);
					_sizeOutOfStockIsPopulated = true;
				}
				else if (tabSizeOutOfStockProperties.SelectedTab.Name == tabSizeSellThru.Name)
				{
					SizeSellThru_Populate(true);
					_sizeSellThruIsPopulated = true;
				}
			}
			//End TT#483 - JScott - Add Size Lost Sales criteria and processing
			else if (tabNodeProperties.SelectedTab.Name == tabStockMinMax.Name)
			{
				_promptAttributeChange = false;
				StockMinMax_Populate(_hnp.Key, false, false);
				_stockMinMaxIsPopulated = true;
				_promptAttributeChange = true;
			}
			else if (tabNodeProperties.SelectedTab.Name == tabStoreCapacity.Name)
			{
				_storeCapacityList = _SAB.HierarchyServerSession.GetStoreCapacityList(_storeList, _hnp.Key, false, false);
				StoreCapacity_Populate(false);
				_storeCapacityIsPopulated = true;
			}
			else if (tabNodeProperties.SelectedTab.Name == tabVelocityGrades.Name)
			{
				TabVelocityGrades_Populate(_hnp.Key);
				_velocityGradesIsPopulated = true;
				_sellThruPctsIsPopulated = true;
			}
			else if (tabNodeProperties.SelectedTab.Name == tabDailyPercentages.Name)
			{
				_storeDailyPercentagesList = _SAB.HierarchyServerSession.GetStoreDailyPercentagesList(_storeList, _hnp.Key);
				DailyPercentages_Populate(false);
				AddReoccurringImage();
				_dailyPercentagesIsPopulated = true;
			}
			else if (tabNodeProperties.SelectedTab.Name == tabPurgeCriteria.Name)
			{
                // Begin TT#569-MD - JSmith - Hierarchy Node Conflict Error when editing node properties
                HierarchyNodeProfile hnp = (HierarchyNodeProfile)_hnp.Clone();
                // End TT#569-MD - JSmith - Hierarchy Node Conflict Error when editing node properties
				_hnp = _SAB.HierarchyServerSession.GetNodeData(_hnp.Key, true);
                // Begin TT#569-MD - JSmith - Hierarchy Node Conflict Error when editing node properties
                _hnp.NodeLockStatus = hnp.NodeLockStatus;
                // End TT#569-MD - JSmith - Hierarchy Node Conflict Error when editing node properties
				PurgeCriteriaTab_Load();
			}
            else if (tabNodeProperties.SelectedTab.Name == tabReservation.Name)			
            {
                _imoProfileList = _SAB.HierarchyServerSession.GetNodeIMOList(_storeList, _hnp.Key);
                Reservation_Populate(false);
                _reservationIsPopulated = true;
			}
		}

		private void btnOK_Click(object sender, System.EventArgs e)
		{
			try
			{
				_OKButtonClicked = true;
                //BEGIN TT#5112-VStuart-Stock MinMax not updated if rows are deleted-MID
                btnApply_Click(sender, e);
                //END TT#5112-VStuart-Stock MinMax not updated if rows are deleted-MID
                SaveChanges();
				if (!ErrorFound && !_progressVisible)
				{
					this.Close();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		override protected bool SaveChanges()
		{
            bool cacheCleared = false;
			ErrorFound = false;
			_errors = _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_FollowingErrors, false);
			_processingSave = true;
			
			try
			{
				this.Cursor = Cursors.WaitCursor;
				// validate a tab at a time taking the user to the tab if errors
				EditMsgs em = new EditMsgs();
				
                //BEGIN TT#2015 - Apply Changes To Lower Levels - gtaylor
                string text = "";
                bool continueAfterApplyChanges = true;

                DialogResult dr;
                if (applyChangesToLowerLevelsSelected)
                {
                    try
                    {
                        //  do we have changes?
                        if (_nodeChangeProfile.NodeChanges.Count > 0)
                        {
                            //  can I lock the branch?
                            if (_SAB.HierarchyServerSession.LockHierarchyBranchForUpdate(_hnp.HomeHierarchyRID, NodeRID, false))
                            {
                                _nodeChangeProfile.TotalNumberOfDescendants = _SAB.HierarchyServerSession.TotalAffectedDescendants(
                                    _nodeChangeProfile.NodeRID,
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.IMO) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.StoreEligibility) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.StoreCharacteristics) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.StoreCapacity) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.DailyPercentages) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.PurgeCriteria) ? 1 : 0),
                                    (_nodeChangeProfile.NodeChanges.ContainsKey((int)eProfileType.ChainSetPercent) ? 1 : 0)
                                );
                                int totalChangeCount = _nodeChangeProfile.TotalNumberOfDescendants * _nodeChangeProfile.ChangesTotal();
                                if (totalChangeCount > 0)
                                {
                                    text = MIDText.GetText(eMIDTextCode.msg_ApplyToDescendants) + Environment.NewLine
                                        + MIDText.GetTextOnly(eMIDTextCode.msg_NumberOfDescendants) + (char)32 +
                                        totalChangeCount.ToString(CultureInfo.CurrentUICulture);
                                    dr = MessageBox.Show(text, this.Text, MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                                    switch (dr)
                                    {
                                        case DialogResult.Yes:
                                            //  apply the changes
                                            if (_SAB.HierarchyServerSession.UpdateLowerLevelNodes(_nodeChangeProfile))  // this call should not update THIS level
                                            {
                                                //  if the Lower Levels were updated properly, update the profile data
                                                _SAB.HierarchyServerSession.ClearCache(_nodeChangeProfile.NodeChanges);
                                                cacheCleared = true;
                                                _nodeChangeProfile.NodeChanges.Clear();
                                                //UpdateProfileData(em);
                                                MessageBox.Show(MIDText.GetText(eMIDTextCode.lbl_ACLL_ActionCompletedSuccessfully));
                                                //continueAfterApplyChanges = true;
                                            }
                                            break;
                                        default:
                                            //  the answer was no or something else - do not apply the changes
                                            dr = MessageBox.Show(MIDText.GetText(eMIDTextCode.lbl_ACLL_NoChangesHaveBeenMade), this.Text, MessageBoxButtons.OK, MessageBoxIcon.Information);
                                            continueAfterApplyChanges = false;
                                            break;
                                    }
                                }
                                else
                                {
                                    dr = MessageBox.Show(MIDText.GetText(eMIDTextCode.lbl_ACLL_NoLowLevelProcessingRequired), this.Text, MessageBoxButtons.OK, MessageBoxIcon.Information);
                                    //_SAB.HierarchyServerSession.ClearCache(_nodeChangeProfile.NodeChanges);
                                    //cacheCleared = true;
                                    //_nodeChangeProfile.NodeChanges.Clear();
                                    //continueAfterApplyChanges = true;
                                    //continueAfterApplyChanges = false;
                                }
                            }
                            else
                            {
                                //  ACK lock failed
                                //  we didn't get our lock, notify user of the failure
                                dr = MessageBox.Show(MIDText.GetText(eMIDTextCode.lbl_ACLL_LockAttemptFailed), this.Text, MessageBoxButtons.OK, MessageBoxIcon.Information);
                                continueAfterApplyChanges = false;
                            }
                        }
                        else
                        {
                            dr = MessageBox.Show(MIDText.GetText(eMIDTextCode.lbl_ACLL_NoChangesHaveBeenMade), this.Text, MessageBoxButtons.OK, MessageBoxIcon.Information);
                            //continueAfterApplyChanges = false;
                        }
                    }
                    catch
                    {
                        throw;
                    }
                    finally
                    {
                        _SAB.HierarchyServerSession.DequeueBranch(_hnp.HomeHierarchyRID, NodeRID);
                    }
                }

                if (!continueAfterApplyChanges)
                {
                    return true; //  if the user declined the changes or the changes failed, do not update.
                }
                
                //END TT#2015 - Apply Changes To Lower Levels - gtaylor

				if (ValidTabPurgeCriteria(ref em))
				{
					
				}
				else
				{
					ErrorFound = true;
					this.tabNodeProperties.SelectedTab = this.tabPurgeCriteria;
				}
				if (ValidTabProfile(ref em))
				{
					UpdateProfileData(ref em);
				}
				else
				{
					ErrorFound = true;
					this.tabNodeProperties.SelectedTab = this.tabProfile;
				}
				if (EligibilityChangesMade && !ErrorFound)
				{
					if (ValidTabStoreEligibility(ref em))
					{
						UpdateEligibilityData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabStoreEligibility;
					}
				}
				if ((StoreGradesChangesMade || MinMaxesChangesMade) && !ErrorFound)
				{
					if (ValidTabStoreGrades(ref em))
					{
						UpdateStoreGradeData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabStoreGrades;
					}
				}
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				if (SizeCurvesCriteriaChangesMade && !ErrorFound)
				{
					if (ValidTabSizeCurveCriteria(ref em))
					{
						UpdateSizeCurvesCriteriaData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
						this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesCriteria;
					}
				}
				if (SizeCurvesToleranceChangesMade &&
					!ErrorFound)
				{
					if (ValidTabSizeCurveTolerance(ref em))
					{
						UpdateSizeCurvesToleranceData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
						this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesTolerance;
					}
				}
				if (SizeCurvesSimilarStoreChangesMade && !ErrorFound)
				{
					if (ValidTabSizeCurvesSimilarStore(ref em))
					{
					    UpdateSizeCurvesSimilarStoreData();
					}
					else
					{
					    ErrorFound = true;
					    this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
					    this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesSimilarStore;
					}
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (SizeOutOfStockChangesMade && !ErrorFound)
				{
					if (ValidTabSizeOutOfStock(ref em))
					{
						UpdateSizeOutOfStockData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabSizeOutOfStock;
						this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeOutOfStockParms;
					}
				}
				if (SizeSellThruChangesMade && !ErrorFound)
				{
					if (ValidTabSizeSellThru(ref em))
					{
						UpdateSizeSellThruData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabSizeOutOfStock;
						this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeSellThru;
					}
				}
				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				if ((StockMinMaxChangesMade) && !ErrorFound)
				{
					if (ValidTabStockMinMax(ref em))
					{
						UpdateStockMinMaxData(Convert.ToInt32(cbSMMStoreAttributeSet.SelectedValue));
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabStockMinMax;
					}
				}
				if (StoreCapacityChangesMade && !ErrorFound)
				{
					if (ValidTabStoreCapacity(ref em))
					{
						UpdateCapacityData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabStoreCapacity;
					}
				}

				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				//if ((VelocityGradesChangesMade || SellThruPctsChangesMade) && !ErrorFound)
				if ((VelocityGradesChangesMade || VelocityMinMaxesChangesMade || SellThruPctsChangesMade) && !ErrorFound)
				//End TT#505 - JScott - Velocity - Apply Min/Max
				{
					if (ValidTabVelocityGrades(ref em))
					{
						//Begin TT#505 - JScott - Velocity - Apply Min/Max
						//if (VelocityGradesChangesMade)
						if (VelocityGradesChangesMade || VelocityMinMaxesChangesMade)
						//End TT#505 - JScott - Velocity - Apply Min/Max
						{
							UpdateVelocityGradeData(ref em);
						}
						if (SellThruPctsChangesMade)
						{
							UpdateSellThruPctsData(ref em);
						}
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabVelocityGrades;
					}
				}

				if (DailyPercentagesChangesMade && !ErrorFound)
				{
					if (ValidTabDailyPercentages(ref em))
					{
						UpdateDailyPercentagesData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabDailyPercentages;
					}
				}

				if (CharacteristicsChangesMade && !ErrorFound)
				{
					if (ValidTabCharacteristics(ref em))
					{
						UpdateCharacteristicsData();
					}
					else
					{
						ErrorFound = true;
						this.tabNodeProperties.SelectedTab = this.tabCharacteristics;
					}
				}

                //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
                if ((ChainSetPercentChangesMade) || (this.cbxCSPInheritFromHigherLevel.Checked))
                {
                    if (this.cbxCSPInheritFromHigherLevel.Checked)
                    {
                        _rebuildScreen = true;
                        foreach (WeekProfile wp in _CSPweeks)
                        {
                            foreach (ChainSetPercentProfiles cspp in _chainSetPercentList)
                            {
                                if (cspp.NodeID == _hnp.NodeName && cspp.TimeID == wp.YearWeek)
                                    cspp.ChainSetPercentChangeType = eChangeType.delete;
                            }
                        }
                        _SAB.HierarchyServerSession.ChainSetPercentUpdate(_hnp.Key, _chainSetPercentList, Begdr.Key, 
                                (cacheCleared && rbApplyChangesToLowerLevelsChainSet.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
                    }
                    if (ValidTabChainSetPercent(ref em))
                    {
                        ChainSetPercent_Validate();
                        UpdateChainSetPercentData();
                    }
                    else
                    {
                        ErrorFound = true;
                        this.tabNodeProperties.SelectedTab = this.tabCharacteristics;
                    }
                }
                //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
				
                //BEGIN TT#1401 - gtaylor - Reservation (IMO) Stores
                if (ReservationChangesMade && !ErrorFound)
                {
                    //if (this.cbxRsrvInheritFromHigherLevel.Checked)
                    //{
                    //    _rebuildScreen = true;
                    //    foreach (IMOProfile imop in _imoProfileList)
                    //    {
                    //        if (imop.IMONodeRID == _hnp.Key)
                    //            imop.IMOChangeType = eChangeType.delete;
                    //    }
                    //    _SAB.HierarchyServerSession.IMOUpdate(_hnp.Key, _imoProfileList);
                    //}
                    //_SAB.HierarchyServerSession.IMOUpdate(_hnp.Key, _imoProfileList);
                    if (ValidTabReservation(ref em))
                    {
                        UpdateIMOData();
                    }
                    else
                    {
                        ErrorFound = true;
                        this.tabNodeProperties.SelectedTab = this.tabReservation;
                    }
                }
                //END TT#1401 - gtaylor - Reservation (IMO) Stores

				if (em.ErrorFound ||
					ErrorFound)
				{
					_errors = null;
					DoValueByValueEdits = true;
					if (em.EditMessages.Count == 1)
					{
						EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[0];
						AddErrorMessage(emm);
					}
					else
					{
						AddErrorMessage(eMIDTextCode.msg_ErrorsFoundReviewCorrect);
					}
					//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
					if (em.ErrorToDisplay)
					{
					//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
						MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
					}
					//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
				}
				else
				{
					if (ProfileChangesMade || 
						OTSTypeChangesMade ||
						OTSLevelChangesMade ||
						ProductTypeChangesMade ||
						PurgeChangesMade)
					{
						UpdateProfileData(em);  
					}
					if(em.ErrorFound)	// stop if error update profile information
					{
						ErrorFound = true;
						for (int i=0; i<em.EditMessages.Count; i++)
						{
							EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
							AddErrorMessage(emm);
						}
						//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
						if (em.ErrorToDisplay)
						{
						//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
							MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
						//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
						}
						//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
					}
					else
					{
                        //BEGIN TT#1401 - gtaylor - Reservation Stores
                        if (ReservationChangesMade || this.cbxRsrvInheritFromHigherLevel.Checked)   // TT#2015 - gtaylor - apply changes to lower levels
                        {
                            _rebuildScreen = true;
                            if (this.cbxRsrvInheritFromHigherLevel.Checked)
                            {
                                foreach (IMOProfile imop in _imoProfileList)
                                {
                                    if (!imop.IMOIsInherited)
                                        imop.IMOChangeType = eChangeType.delete;
                                }
                            }
                            _SAB.HierarchyServerSession.IMOUpdate(_hnp.Key, _imoProfileList, 
                                    (cacheCleared && this.rbApplyChangesToLowerLevelsIMO.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
                            foreach (IMOProfile imop in _imoProfileList)
                            {
                                imop.IMOChangeType = eChangeType.none;
                                imop.IMOIsInherited = false;
                                imop.IMOInheritedFromNodeRID = Include.NoRID;
                                _imoProfileList.Update(imop);
                            }
                        }
                        //END TT#1401 - gtaylor - Reservation Stores
                        if (EligibilityChangesMade || this.cbxSEInheritFromHigherLevel.Checked) // TT#2015 - gtaylor - apply changes to lower levels
						{
							if (this.cbxSEInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (StoreEligibilityProfile sep in _storeEligList)
								{
									sep.StoreEligChangeType = eChangeType.delete;
								}
							}
							if (_eligibilityIsCopied)
							{
								//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
								//Begin TT#155 - JScott - Add Size Curve info to Node Properties
								//_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, true, false, false,
								//    false, false, false, false, false, false);
								//_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, true, false, false,
									//false, false, false, false, false, false, false, false, false);
								//End TT#155 - JScott - Add Size Curve info to Node Properties
								//Begin TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3 
								//_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, true, false, false,
								//	false, false, false, false, false, false, false, false, false, false, false);
                                _SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, true, false, false,
									false, false, false, false, false, false, false, false, false, false, false, false, false);
                                //End TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
								//End TT#483 - JScott - Add Size Lost Sales criteria and processing
							}
                            _SAB.HierarchyServerSession.StoreEligibilityUpdate(_hnp.Key, _storeEligList, 
                                    (cacheCleared && this.rbApplyChangesToLowerLevelsElig.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
							_eligibilityIsCopied = false;
							// update the record exists flag after the save
							foreach (StoreEligibilityProfile sep in _storeEligList)
							{
								if (sep.StoreEligChangeType == eChangeType.add)
								{
									sep.RecordExists = true;
									_storeEligList.Update(sep);
								}
							}
						}

                        if (StoreGradesChangesMade || MinMaxesChangesMade || this.cbxSGInheritFromHigherLevel.Checked)
						{
							if (this.cbxSGInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (StoreGradeProfile sgp in _storeGradeList)
								{
									sgp.StoreGradeChangeType = eChangeType.delete;
									sgp.MinMaxChangeType = eChangeType.delete; 
								}
							}

							_SAB.HierarchyServerSession.StoreGradesUpdate(_hnp.Key, _storeGradeList);
							// update the change type after the save
							foreach (StoreGradeProfile sgp in _storeGradeList)
							{
								sgp.StoreGradeChangeType = eChangeType.update;
								sgp.MinMaxChangeType = eChangeType.update; 
								sgp.StoreGradesIsInherited = false;
								sgp.MinMaxesIsInherited = false;
								_storeGradeList.Update(sgp);
							}
						}

						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						if (SizeCurvesCriteriaChangesMade || this.cbxSZCriteriaInheritFromHigherLevel.Checked)
						{
							_rebuildScreen = true;

							if (this.cbxSZCriteriaInheritFromHigherLevel.Checked)
							{
								//Begin TT#430 - JScott - Size Curve - Node Properties - Apply to lower levels - delete all node settings below the node being applied.  (blindly clean out lower levels)
								foreach (SizeCurveCriteriaProfile sccp in _sizeCurvesCriteriaList)
								{
									if (!sccp.CriteriaIsInherited)
									{
										sccp.CriteriaChangeType = eChangeType.delete;
									}
								}

								//End TT#430 - JScott - Size Curve - Node Properties - Apply to lower levels - delete all node settings below the node being applied.  (blindly clean out lower levels)
								if (_sizeCurveDefaultCriteriaProfile.DefaultRID != Include.NoRID && !_sizeCurveDefaultCriteriaProfile.DefaultRIDIsInherited)
								{
									_sizeCurveDefaultCriteriaProfile.DefaultRID = Include.NoRID;
									_sizeCurveDefaultCriteriaProfile.DefaultChangeType = eChangeType.update;
								}
							}

							_SAB.HierarchyServerSession.SizeCurveCriteriaUpdate(_hnp.Key, _sizeCurvesCriteriaList);

							_SAB.HierarchyServerSession.SizeCurveDefaultCriteriaUpdate(_hnp.Key, _sizeCurveDefaultCriteriaProfile);
						}

                        if (SizeCurvesToleranceChangesMade || this.cbxSZToleranceInheritFromHigherLevel.Checked)
						{
							if (this.cbxSZToleranceInheritFromHigherLevel.Checked)
							{
								_rebuildScreen = true;
								if (_sizeCurveToleranceProfile.ToleranceMinAvg != Include.Undefined && !_sizeCurveToleranceProfile.ToleranceMinAvgIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceMinAvg = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
								if (_sizeCurveToleranceProfile.ToleranceLevelType != eLowLevelsType.None && !_sizeCurveToleranceProfile.ToleranceLevelIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceLevelType = eLowLevelsType.None;
									_sizeCurveToleranceProfile.ToleranceLevelRID = Include.NoRID;
									_sizeCurveToleranceProfile.ToleranceLevelSeq = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceLevelOffset = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
								if (_sizeCurveToleranceProfile.ToleranceSalesTolerance != Include.Undefined && !_sizeCurveToleranceProfile.ToleranceSalesToleranceIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceSalesTolerance = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
								if (_sizeCurveToleranceProfile.ToleranceIdxUnitsInd != eNodeChainSalesType.None && !_sizeCurveToleranceProfile.ToleranceIdxUnitsIndIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceIdxUnitsInd = eNodeChainSalesType.None;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
								if (_sizeCurveToleranceProfile.ToleranceMinTolerance != Include.Undefined && !_sizeCurveToleranceProfile.ToleranceMinToleranceIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceMinTolerance = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
								if (_sizeCurveToleranceProfile.ToleranceMaxTolerance != Include.Undefined && !_sizeCurveToleranceProfile.ToleranceMaxToleranceIsInherited)
								{
									_sizeCurveToleranceProfile.ToleranceMaxTolerance = Include.Undefined;
									_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
								}
							}

							// update the change type after the save
							_SAB.HierarchyServerSession.SizeCurveToleranceUpdate(_hnp.Key, _sizeCurveToleranceProfile);
							_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
						}

                        if (SizeCurvesSimilarStoreChangesMade || this.cbxSZSimilarStoreInheritFromHigherLevel.Checked)
						{
							if (this.cbxSZSimilarStoreInheritFromHigherLevel.Checked)
							{
								_rebuildScreen = true;
								foreach (SizeCurveSimilarStoreProfile scssp in _sizeCurveSimilarStoreList)
								{
									scssp.SimilarStoreChangeType = eChangeType.delete;
								}
							}
							if (_sizeCurvesSimilarStoreIsCopied)
							{
								//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
								//_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, false, false, false,
								//    false, false, false, false, false, false, false, true, false);
								//Begin TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
								//_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, false, false, false,
								//	false, false, false, false, false, false, false, true, false, false, false);
								_SAB.HierarchyServerSession.DeleteNodeData(_hnp.Key, false, false, false, false,
                                    false, false, false, false, false, false, false, true, false, false, false, false, false);
                                //End TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
								//End TT#483 - JScott - Add Size Lost Sales criteria and processing
							}
							_SAB.HierarchyServerSession.SizeCurveSimilarStoreUpdate(_hnp.Key, _sizeCurveSimilarStoreList);
							_sizeCurvesSimilarStoreIsCopied = false;
							// update the record exists flag after the save
							foreach (SizeCurveSimilarStoreProfile scssp in _sizeCurveSimilarStoreList)
							{
								if (scssp.SimilarStoreChangeType == eChangeType.add)
								{
									scssp.RecordExists = true;
									_sizeCurveSimilarStoreList.Update(scssp);
								}
							}
						}

						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						if (SizeOutOfStockChangesMade)
						{
							_rebuildScreen = true;

							if (this.cbxSZOOSInheritFromHigherLevel.Checked)
							{
								_sizeOutOfStockProfile.ChangeType = eChangeType.delete;
							}

							_SAB.HierarchyServerSession.SizeOutOfStockUpdate(_hnp.Key, _sizeOutOfStockProfile);
						}

						if (SizeSellThruChangesMade)
						{
							if (this.cbxSZSellThruInheritFromHigherLevel.Checked)
							{
								_rebuildScreen = true;
								_sizeSellThruProfile.ChangeType = eChangeType.delete;
							}

							_SAB.HierarchyServerSession.SizeSellThruUpdate(_hnp.Key, _sizeSellThruProfile);
						}

						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
                        if (StockMinMaxChangesMade || this.cbxSMMInheritFromHigherLevel.Checked)
						{
							if (this.cbxSMMInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.delete;
							}
							_SAB.HierarchyServerSession.StockMinMaxUpdate(_hnp.Key, _nodeStockMinMaxesProfile);
							// update the change type after the save
							_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.update;
							_nodeStockMinMaxesProfile.NodeStockMinMaxsIsInherited = false;
						}

                        if (StoreCapacityChangesMade || this.cbxSCInheritFromHigherLevel.Checked)
						{
							if (this.cbxSCInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (StoreCapacityProfile scp in _storeCapacityList)
								{
									scp.StoreCapacityChangeType = eChangeType.delete;
								}
							}
                            _SAB.HierarchyServerSession.StoreCapacityUpdate(_hnp.Key, _storeCapacityList, 
                                    (cacheCleared && this.rbApplyChangesToLowerLevelsSC.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
							// update the change type after the save
							foreach (StoreCapacityProfile scp in _storeCapacityList)
							{
								scp.StoreCapacityChangeType = eChangeType.update;
								scp.NewRecord = false; 
								scp.StoreCapacityIsInherited = false;
								_storeCapacityList.Update(scp);
							}
						}

						//Begin TT#505 - JScott - Velocity - Apply Min/Max
						//if (VelocityGradesChangesMade)
                        if (VelocityGradesChangesMade || VelocityMinMaxesChangesMade || this.cbxVGInheritFromHigherLevel.Checked)
						//End TT#505 - JScott - Velocity - Apply Min/Max
						{
							if (this.cbxVGInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (VelocityGradeProfile vgp in _velocityGradeList)
								{
									vgp.VelocityGradeChangeType = eChangeType.delete;
									//Begin TT#505 - JScott - Velocity - Apply Min/Max
									vgp.VelocityMinMaxChangeType = eChangeType.delete;
									//End TT#505 - JScott - Velocity - Apply Min/Max
								}
							}
							_SAB.HierarchyServerSession.VelocityGradesUpdate(_hnp.Key, _velocityGradeList);
							// update the change type after the save
							foreach (VelocityGradeProfile vgp in _velocityGradeList)
							{
								vgp.VelocityGradeChangeType = eChangeType.update;
								//Begin TT#505 - JScott - Velocity - Apply Min/Max
								vgp.VelocityMinMaxChangeType = eChangeType.update;
								vgp.VelocityGradeIsInherited = false;
								vgp.VelocityMinMaxesIsInherited = false;
								//End TT#505 - JScott - Velocity - Apply Min/Max
								_velocityGradeList.Update(vgp);
							}
						}

                        if (SellThruPctsChangesMade || this.cbxVGInheritFromHigherLevel.Checked)
						{
							if (this.cbxVGInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (SellThruPctProfile stpp in _sellThruPctList)
								{
									stpp.SellThruPctChangeType = eChangeType.delete;
								}
							}
							_SAB.HierarchyServerSession.SellThruPctsUpdate(_hnp.Key, _sellThruPctList);
							// update the change type after the save
							foreach (SellThruPctProfile stpp in _sellThruPctList)
							{
								stpp.SellThruPctChangeType = eChangeType.update;
								_sellThruPctList.Update(stpp);
							}
						}

                        if (DailyPercentagesChangesMade || this.cbxDPInheritFromHigherLevel.Checked)
						{
							if (this.cbxDPInheritFromHigherLevel.Checked)
							{
								 _rebuildScreen = true;
								foreach (StoreDailyPercentagesProfile sdpp in _storeDailyPercentagesList)
								{
									sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.delete;
									foreach (DailyPercentagesProfile dpp in sdpp.DailyPercentagesList)
									{
										dpp.DailyPercentagesChangeType = eChangeType.delete;
									}
								}
							}
                            _SAB.HierarchyServerSession.StoreDailyPercentagesUpdate(_hnp.Key, _storeDailyPercentagesList, 
                                    (cacheCleared && this.rbApplyChangesToLowerLevelsDailyPct.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
                            // update the change type after the save
                            foreach (StoreDailyPercentagesProfile sdpp in _storeDailyPercentagesList)
                            {
                                // Begin TT#345 - JSmith - Daily Percentage date range not deleted if added, applied, and deleted in same session
                                //sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.update;
                                sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.none;
                                // End TT#345 - JSmith - Daily Percentage date range not deleted if added, applied, and deleted in same session
                                foreach (DailyPercentagesProfile dpp in sdpp.DailyPercentagesList)
                                {
                                    // Begin TT#345 - JSmith - Daily Percentage date range not deleted if added, applied, and deleted in same session
                                    //dpp.DailyPercentagesChangeType = eChangeType.update;
                                    dpp.DailyPercentagesChangeType = eChangeType.none;
                                    // End TT#345 - JSmith - Daily Percentage date range not deleted if added, applied, and deleted in same session
                                    sdpp.DailyPercentagesList.Update(dpp);
                                }
                                _storeDailyPercentagesList.Update(sdpp);
                            }
						}
                        if (CharacteristicsChangesMade || this.cbxCHInheritFromHigherLevel.Checked)
						{
                            if (this.cbxCHInheritFromHigherLevel.Checked)
                            {
                                _rebuildScreen = true;
                                foreach (NodeCharProfile ncp in _nodeCharProfileList)
                                {
                                    ncp.ProductCharChangeType = eChangeType.delete;
                                }
                            }
                            _SAB.HierarchyServerSession.UpdateProductCharacteristics(_hnp.Key, _nodeCharProfileList);
							// update the change type after the save
							foreach (NodeCharProfile ncp in _nodeCharProfileList)
							{
								ncp.ProductCharChangeType = eChangeType.update;
								_nodeCharProfileList.Update(ncp);
							}
						}
                        //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                        if (ChainSetPercentChangesMade || this.cbxCSPApplyToLowerLevels.Checked)
                        {
                            if (this.cbxCSPApplyToLowerLevels.Checked)
                            {
                                _rebuildScreen = true;
                                //Begin TT#1687 - DOConnell - Chain Set % Node Properties:  The "Apply to Lower Levels" checkbox is not functioning correctly.
                                //NodeInfo ni = HierarchyServerGlobal.GetNodeInfoByRID(_hnp.Key, false);
                                //NodeAncestorList nal = _SAB.HierarchyServerSession.GetNodeAncestorList(_hnp.Key, ni.HomeHierarchyRID);
                                NodeAncestorList nal = _SAB.HierarchyServerSession.GetNodeAncestorList(_hnp.Key, _hnp.HomeHierarchyRID);
                                //End TT#1687 - DOConnell - Chain Set % Node Properties:  The "Apply to Lower Levels" checkbox is not functioning correctly.
                                ChainSetPercentList cspl = new ChainSetPercentList(eProfileType.ChainSetPercent);
                                foreach (NodeAncestorProfile nap in nal)
                                {
                                    foreach (WeekProfile wp in _CSPweeks)
                                    {

                                        foreach (ChainSetPercentProfiles scp in _chainSetPercentList)
                                        {
                                            if (Convert.ToString(nap) == _hnp.NodeName && scp.TimeID == wp.YearWeek)
                                                scp.ChainSetPercentChangeType = eChangeType.delete;
                                        }
                                    }
                                }
                                _SAB.HierarchyServerSession.ChainSetPercentUpdate(_hnp.Key, _chainSetPercentList, Begdr.Key, 
                                        (cacheCleared && this.rbApplyChangesToLowerLevelsChainSet.Checked)); // TT#2015 - gtaylor - apply changes to lower levels
                                // update the change type after the save
                                foreach (ChainSetPercentProfiles scp in _chainSetPercentList)
                                {
                                    scp.ChainSetPercentChangeType = eChangeType.update;
                                    scp.NewRecord = false;
                                    scp.ChainSetPercentIsInherited = false;
                                    _chainSetPercentList.Update(scp);
                                }
                            }
                            
                        }
                        //End TT#1671 - DOConnell - Chain Set Percent Node Properties

                        // BEGIN TT#1399
                        //  Hierarchy Changes Made
                        if ((HierarchyChangesMade) && 
                            (!applyChangesToLowerLevelsSelected)) // TT#2015 - if the user selected  Apply Changes to Lower Levels, do not update yet
                        {
                            UpdateProfileData(em);
                        }
                        // END TT#1399
						ApplyToLowerLevels();
                        ChainSetPercentChangesMade = false;
                        ChainSetPercent_Populate(false);
					}

                    if (!ErrorFound)
                    {
                        cbxSEInheritFromHigherLevel.Checked = false;
                        cbxSGInheritFromHigherLevel.Checked = false;
                        cbxSMMInheritFromHigherLevel.Checked = false;
                        cbxSCInheritFromHigherLevel.Checked = false;
                        cbxVGInheritFromHigherLevel.Checked = false;
                        cbxVGInheritFromHigherLevel.Checked = false;
                        cbxDPInheritFromHigherLevel.Checked = false;
                        cbxCHInheritFromHigherLevel.Checked = false;
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						cbxSZCriteriaInheritFromHigherLevel.Checked = false;
						cbxSZToleranceInheritFromHigherLevel.Checked = false;
						cbxSZSimilarStoreInheritFromHigherLevel.Checked = false;
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#442 --  Node properties - Apply to lower levels - received the question on deleting when select Apply and again when selecting OK.
						cbxSEApplyToLowerLevels.Checked = false;
						cbxVGApplyToLowerLevels.Checked = false;
						cbxSGApplyToLowerLevels.Checked = false;
						cbxSMMApplyToLowerLevels.Checked = false;
						cbxSCApplyToLowerLevels.Checked = false;
						cbxDPApplyToLowerLevels.Checked = false;
						cbxPCApplyToLowerLevels.Checked = false;
						cbxCHApplyToLowerLevels.Checked = false;
						cbxSZCriteriaApplyToLowerLevels.Checked = false;
						cbxSZToleranceApplyToLowerLevels.Checked = false;
						cbxSZSimilarStoreApplyToLowerLevels.Checked = false;
                        //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                        cbxCSPInheritFromHigherLevel.Checked = false;
                        cbxCSPApplyToLowerLevels.Checked = false;
                        //End TT#1671 - DOConnell - Chain Set Percent Node Properties
                        cbxApplyToLowerLevels.Checked = false; //TT#1401 - Reservation Stores - gtaylor
                        cbxRsrvInheritFromHigherLevel.Checked = false; //TT#1401 - Reservation Stores - gtaylor
						//End TT#442 --  Node properties - Apply to lower levels - received the question on deleting when select Apply and again when selecting OK.
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						cbxSZOOSInheritFromHigherLevel.Checked = false;
						cbxSZSellThruInheritFromHigherLevel.Checked = false;
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
						ChangePending = false;
                        btnApply.Enabled = false;
                        ProfileChangesMade = false;
                        OTSTypeChangesMade = false;
                        OTSLevelChangesMade = false;
                        ProductTypeChangesMade = false;
                        EligibilityChangesMade = false;
                        StoreGradesChangesMade = false;
                        StockMinMaxChangesMade = false;
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						SizeCurvesCriteriaChangesMade = false;
						SizeCurvesMinAvgToleranceChangesMade = false;
						SizeCurvesHighLevelToleranceChangesMade = false;
						SizeCurvesSalesToleranceChangesMade = false;
						SizeCurvesIndexToleranceChangesMade = false;
						SizeCurvesMinPctToleranceChangesMade = false;
						SizeCurvesMaxPctToleranceChangesMade = false;
						SizeCurvesSimilarStoreChangesMade = false;
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						SizeOutOfStockSizeGroupChangesMade = false;
						SizeOutOfStockStoreGroupChangesMade = false;
						SizeOutOfStockQuantityChangesMade = false;
						SizeSellThruChangesMade = false;
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
						MinMaxesChangesMade = false;
                        StoreCapacityChangesMade = false;
                        VelocityGradesChangesMade = false;
						//Begin TT#505 - JScott - Velocity - Apply Min/Max
						VelocityMinMaxesChangesMade = false;
						//End TT#505 - JScott - Velocity - Apply Min/Max
						SellThruPctsChangesMade = false;
                        DailyPercentagesChangesMade = false;
                        DailyPurgeCriteriaChangesMade = false;
                        WeeklyPurgeCriteriaChangesMade = false;
                        OTSPurgeCriteriaChangesMade = false;
                        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                        //HeadersPurgeCriteriaChangesMade = false;
                        ASNHTPurgeCriteriaChangesMade = false; 
                        DropShipHTPurgeCriteriaChangesMade = false;
                        DummyHTPurgeCriteriaChangesMade = false;
                        ReceiptHTPurgeCriteriaChangesMade = false;
                        PurchaseOrderHTPurgeCriteriaChangesMade = false;
                        ReserveHTPurgeCriteriaChangesMade = false;
                        VSWHTPurgeCriteriaChangesMade = false;
                        WorkUpTotHTPurgeCriteriaChangesMade = false;
                        //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                        CharacteristicsChangesMade = false;
                        // Begin TT#1399
                        HierarchyChangesMade = false;
                        // End TT#1399
                        this.btnApply.Text = MIDText.GetTextOnly(eMIDTextCode.lbl_Button_Apply);
                    }
				}
			}
			catch ( Exception err )
			{
				string message = err.ToString();
				throw;
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
			
			if (!ErrorFound && _nameChanged)
			{
                NodePropertyChangeEventArgs ea = new NodePropertyChangeEventArgs(_node, _hnp);
				if (OnNodePropertyChangeHandler != null)  // throw event to explorer to make changes
				{
					OnNodePropertyChangeHandler(this, ea);
					_changeEventThrown = true;
					_nameChanged = false;
				}
			}
            // BEGIN TT#2015 - gtaylor - apply changes to lower levels
            SetNoAction();  //  TT#2260 - gtaylor - reset radio buttons
            //this.rbNoActionChar.Checked = true;
            //this.rbNoActionCSP.Checked = true;
            //this.rbNoActionDP.Checked = true;
            //this.rbNoActionIMO.Checked = true;
            //this.rbNoActionPC.Checked = true;
            //this.rbNoActionSC.Checked = true;
            //this.rbNoActionSE.Checked = true;
            // END TT#2015 - gtaylor - apply changes to lower levels
			_processingSave = false;

			return true;
		}

		private void ApplyToLowerLevels()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				bool continueProcessing = false;
				bool deleteEligibility = false; 
				bool deleteStoreGrades = false;
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				bool deleteSizeCurveCriteria = false;
				bool deleteSizeCurveTolerance = false;
				bool deleteSizeCurveSimilarStore = false;
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				bool deleteSizeOutOfStock = false;
				bool deleteSizeSellThru = false;
				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				bool deleteVelocityGrades = false;
				bool deleteSellThruPcts = false;
				bool deleteStoreCapacity = false;
				bool deletePurgeCriteria = false; 
				bool deleteDailyPercentages = false;
				bool deleteStockMinMaxes = false;
				bool deleteCharacteristics = false;
                //Begin TT#1671 - DOConnell - 
                bool deleteChainSetPercentages = false;
                //End TT#1671 - DOConnell - 
                bool deleteIMO = false; //TT#1401 - Reservation Stores - gtaylor

				int descendantCount = 0;

                //BEGIN TT#1401 - Reservation Stores - gtaylor
                if (this.cbxApplyToLowerLevels.Checked)
                {
                    deleteIMO = true;
                }
                //END TT#1401 - Reservation Stores - gtaylor
				
                if (this.cbxSEApplyToLowerLevels.Checked)
				{
					deleteEligibility = true;
				}
				if (this.cbxSGApplyToLowerLevels.Checked)
				{
					deleteStoreGrades = true;
				}
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				if (this.cbxSZCriteriaApplyToLowerLevels.Checked)
				{
					deleteSizeCurveCriteria = true;
				}
				if (this.cbxSZToleranceApplyToLowerLevels.Checked)
				{
					deleteSizeCurveTolerance = true;
				}
				if (this.cbxSZSimilarStoreApplyToLowerLevels.Checked)
				{
					deleteSizeCurveSimilarStore = true;
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (this.cbxSZOOSApplyToLowerLevels.Checked)
				{
					deleteSizeOutOfStock = true;
				}
				if (this.cbxSZSellThruApplyToLowerLevels.Checked)
				{
					deleteSizeSellThru = true;
				}
				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (this.cbxVGApplyToLowerLevels.Checked)
				{
					deleteVelocityGrades = true;
					deleteSellThruPcts = true;
				}
				if (this.cbxSCApplyToLowerLevels.Checked)
				{
					deleteStoreCapacity = true;
				}
				if (this.cbxPCApplyToLowerLevels.Checked)
				{
					deletePurgeCriteria = true;
				}
				if (this.cbxDPApplyToLowerLevels.Checked)
				{
					deleteDailyPercentages = true;
				}
				if (this.cbxSMMApplyToLowerLevels.Checked)
				{
					deleteStockMinMaxes = true;
				}
				if (this.cbxCHApplyToLowerLevels.Checked)
				{
					deleteCharacteristics = true;
				}
                //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                if (this.cbxCSPApplyToLowerLevels.Checked) 
                {
                    deleteChainSetPercentages = true;
                }
                //End TT#1671 - DOConnell - Chain Set Percent Node Properties
				if (_hnp.HasChildren &&
					(deleteEligibility || 
					deleteStoreGrades ||
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					deleteSizeCurveCriteria ||
					deleteSizeCurveTolerance ||
					deleteSizeCurveSimilarStore ||
					//End TT#155 - JScott - Add Size Curve info to Node Properties
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					deleteSizeOutOfStock ||
					deleteSizeSellThru ||
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					deleteVelocityGrades ||
					deleteSellThruPcts ||
					deleteStoreCapacity ||
					deletePurgeCriteria || 
					deleteDailyPercentages ||
					deleteStockMinMaxes ||
					deleteCharacteristics
                    //Begin TT#1671 - DOConnell - Chain Set Percent Node Properties
                    || deleteChainSetPercentages
                    //End TT#1671 - DOConnell - Chain Set Percent Node Properties
                    || deleteIMO    //TT#1401 - Reservation Stores - gtaylor
                    ))
				{
					descendantCount = _SAB.HierarchyServerSession.GetDescendantCount(_hnp.HomeHierarchyRID, _hnp.Key);
					string text = MIDText.GetText(eMIDTextCode.msg_ApplyToDescendants) + Environment.NewLine
						+ MIDText.GetTextOnly(eMIDTextCode.msg_NumberOfDescendants) + descendantCount.ToString(CultureInfo.CurrentUICulture);
					DialogResult dr = MessageBox.Show (text,  this.Text,
						MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question);
					if (dr == DialogResult.Yes) 
					{
						continueProcessing = true;
					}
					else
						if (dr == DialogResult.No) 
					{
						continueProcessing = false;
					}
				}
				else
				{
					continueProcessing = false;
				}

				if (continueProcessing)
				{
					string applyMsg = MIDText.GetText(eMIDTextCode.msg_ApplyStatus);
					applyMsg = applyMsg.Replace("{1}", descendantCount.ToString(CultureInfo.CurrentUICulture));
					_progress = new frmProgress(0, descendantCount);
					_progress.OnProgressOKClickedHandler += new frmProgress.ProgressOKClickedEventHandler(OnProgressOKClicked);
					_progress.Title = MIDText.GetTextOnly(eMIDTextCode.msg_Applying);
					_progressVisible = true;
					_progress.Show();
					int count = 0;  
					_progress.SetValue = count;
					_progress.labelText = applyMsg.Replace("{0}", count.ToString(CultureInfo.CurrentUICulture));
					EditMsgs em = new EditMsgs();
					HierarchyNodeList hierarchyChildrenList = _SAB.HierarchyServerSession.GetHierarchyChildren(_hnp.NodeLevel, _hnp.HierarchyRID, _hnp.HomeHierarchyRID, _hnp.Key, false, eNodeSelectType.All);
					foreach(HierarchyNodeProfile hnp in hierarchyChildrenList) // apply to children
					{
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						//ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel, 
						//    hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades, 
						//    deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts,
						//    deleteStockMinMaxes, deleteCharacteristics);
						//ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel,
							//hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades,
							//deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts,
						//	deleteStockMinMaxes, deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore, deleteCharacteristics);
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel,
							hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades,
							deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts,
							deleteStockMinMaxes, deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore,
							deleteSizeOutOfStock, deleteSizeSellThru, deleteCharacteristics, deleteChainSetPercentages, 
                            deleteIMO //TT#1401 - Reservation Stores - gtaylor
                            );
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					}
					_progress.SetValue = descendantCount;
					_progress.labelText = MIDText.GetTextOnly(eMIDTextCode.msg_ApplyComplete);
					_progress.EnableOKButton();
					_progress.BringToFront();
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		//private void ApplyToDescendant(ref EditMsgs em, string applyMsg, ref int count, int descendantCount, 
		//    int applyNodeRID, int applyNodeLevel, int applyNodeHierarchyRID, int applyNodeHomeHierarchyRID, bool deleteEligibility, 
		//    bool deleteStoreGrades,	bool deleteVelocityGrades, bool deleteStoreCapacity, bool deletePurgeCriteria,
		//    bool deleteDailyPercentages, bool deleteSellThruPcts, bool deleteStockMinMaxes, bool deleteCharacteristics)
		//private void ApplyToDescendant(ref EditMsgs em, string applyMsg, ref int count, int descendantCount,
		//	int applyNodeRID, int applyNodeLevel, int applyNodeHierarchyRID, int applyNodeHomeHierarchyRID, bool deleteEligibility,
		//	bool deleteStoreGrades, bool deleteVelocityGrades, bool deleteStoreCapacity, bool deletePurgeCriteria,
		//	bool deleteDailyPercentages, bool deleteSellThruPcts, bool deleteStockMinMaxes,
		//	bool deleteSizeCurveCriteria, bool deleteSizeCurveTolerance, bool deleteSizeCurveSimilarStore, bool deleteCharacteristics)
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		private void ApplyToDescendant(ref EditMsgs em, string applyMsg, ref int count, int descendantCount,
			int applyNodeRID, int applyNodeLevel, int applyNodeHierarchyRID, int applyNodeHomeHierarchyRID, bool deleteEligibility,
			bool deleteStoreGrades, bool deleteVelocityGrades, bool deleteStoreCapacity, bool deletePurgeCriteria,
			bool deleteDailyPercentages, bool deleteSellThruPcts, bool deleteStockMinMaxes,
			bool deleteSizeCurveCriteria, bool deleteSizeCurveTolerance, bool deleteSizeCurveSimilarStore,
			bool deleteSizeOutOfStock, bool deleteSizeSellThru, bool deleteCharacteristics, bool deleteChainSetPercentages, bool deleteIMO //TT#1401 - Reservation Stores - gtaylor
			)
		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		{
			try
			{
				++count;
				_progress.SetValue = count;
				_progress.labelText = applyMsg.Replace("{0}", count.ToString(CultureInfo.CurrentUICulture));

				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				//_SAB.HierarchyServerSession.DeleteNodeData(applyNodeRID, false, deleteEligibility,
				//    deleteStoreGrades, deleteVelocityGrades, deleteStoreCapacity, deletePurgeCriteria,
				//    deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes, deleteCharacteristics);
				//_SAB.HierarchyServerSession.DeleteNodeData(applyNodeRID, false, deleteEligibility,
				//	deleteStoreGrades, deleteVelocityGrades, deleteStoreCapacity, deletePurgeCriteria,
				//	deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes,
				//	deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore, deleteCharacteristics);
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				_SAB.HierarchyServerSession.DeleteNodeData(applyNodeRID, false, deleteEligibility,
					deleteStoreGrades, deleteVelocityGrades, deleteStoreCapacity, deletePurgeCriteria,
					deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes,
					deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore,
					deleteSizeOutOfStock, deleteSizeSellThru, deleteCharacteristics, deleteChainSetPercentages, deleteIMO //TT#1401 - Reservation Stores - gtaylor
                    );
                //End TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				HierarchyNodeList hierarchyChildrenList = _SAB.HierarchyServerSession.GetHierarchyChildren(applyNodeLevel, applyNodeHierarchyRID, 
                    applyNodeHomeHierarchyRID, applyNodeRID, false, eNodeSelectType.All);
				foreach(HierarchyNodeProfile hnp in hierarchyChildrenList)
				{
					//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
					//Begin TT#155 - JScott - Add Size Curve info to Node Properties
					//ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel, 
					//    hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades, 
					//    deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes,
					//    deleteCharacteristics);
                    //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
                    //ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel,
                    //    hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades,
                    //    deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes,
                    //    deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore, deleteCharacteristics);
					//End TT#155 - JScott - Add Size Curve info to Node Properties
                    ApplyToDescendant(ref em, applyMsg, ref count, descendantCount, hnp.Key, hnp.NodeLevel,
                        hnp.HierarchyRID, hnp.HomeHierarchyRID, deleteEligibility, deleteStoreGrades, deleteVelocityGrades,
                        deleteStoreCapacity, deletePurgeCriteria, deleteDailyPercentages, deleteSellThruPcts, deleteStockMinMaxes,
                        deleteSizeCurveCriteria, deleteSizeCurveTolerance, deleteSizeCurveSimilarStore, 
						deleteSizeOutOfStock, deleteSizeSellThru, deleteCharacteristics, deleteChainSetPercentages, deleteIMO //TT#1401 - Reservation Stores - gtaylor
                        );
					//End TT#483 - JScott - Add Size Lost Sales criteria and processing
					//End TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
					//End TT#155 - JScott - Add Size Curve info to Node Properties
				}
			}
			catch( Exception error)
			{
				MessageBox.Show(error.Message);
			}
		}

		void OnProgressOKClicked(object source, ProgressOKClickedEventArgs e)
		{
            try
            {
                if (!ErrorFound && _OKButtonClicked)
                {
                    //Begin TT#1707 - DOConnell - Clicking OK button does not close the Node properties window.
                    _progressVisible = false;
                    this.Close();
                }
                else if (!ErrorFound && !_OKButtonClicked)
                {
                    _progressVisible = false;
                }
                //End TT#1707 - DOConnell - Clicking OK button does not close the Node properties window.
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
		}

		private bool UpdateProfileData(ref EditMsgs em)
		{
			bool dataIsValid = true;
			try
			{
				string error = null;
				if (this.txtNodeName.Text.Length == 0)
				{
					error = AddErrorMessage(eMIDTextCode.msg_NameRequired);
					dataIsValid = false;
					ErrorProvider.SetError (this.txtNodeName,error);
				}
				else
				{
					ErrorProvider.SetError (this.txtNodeName,string.Empty);
				}


				if (this.txtNodeID.Text == string.Empty)
				{
					error = AddErrorMessage(eMIDTextCode.msg_IDRequired);
					dataIsValid = false;
					ErrorProvider.SetError (this.txtNodeID,error);
				}
				else
				{
					ErrorProvider.SetError (this.txtNodeID,string.Empty);
				}

				if ((_hnp.LevelType == eHierarchyLevelType.Color) &&
					!_colorFound)
				{
					DialogResult result = MessageBox.Show (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_AutoAddColorCode),  this.Text,
						MessageBoxButtons.YesNo, MessageBoxIcon.Question);
					if(result == DialogResult.Yes)
					{
						if (this.txtNodeID.Text.Length > Include.ColorIDMaxSize)
						{
							error = AddErrorMessage(eMIDTextCode.msg_ColorCodeNotValid);
							dataIsValid = false;
							ErrorProvider.SetError (this.txtNodeID,error);
						}
						else
						{
							ErrorProvider.SetError (this.txtNodeID,string.Empty);
							ColorCodeProfile ccp = new ColorCodeProfile(Include.NoRID);
							ccp.ColorCodeChangeType = eChangeType.add;
							ccp.ColorCodeID = this.txtNodeID.Text;
							ccp.ColorCodeName = this.txtNodeName.Text;
							ccp.ColorCodeGroup = this.txtColorGroup.Text;
							ccp = _hm.ColorCodeUpdate(ref em, ccp);
							if (em.ErrorFound)
							{
								dataIsValid = false;
								for (int i=0; i<em.EditMessages.Count; i++)
								{
									EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
									error += _SAB.ClientServerSession.Audit.GetText(emm.code);
								}
								ErrorProvider.SetError (this.txtNodeID,error);
							}
							else
							{
								_colorFound = true;
							}
						}
					}
					else
					{
						dataIsValid = false;
					}
				}

				return dataIsValid;
			}
			catch( Exception exception )
			{
				HandleException(exception);
				return dataIsValid;
			}
		}

		private string AddErrorMessage(eMIDTextCode textCode)
		{
			string error = null;
			try
			{
				error = _SAB.ClientServerSession.Audit.GetText(textCode);
				_errors += Environment.NewLine + "     "  + error;
				return error;
			}
			catch( Exception exception )
			{
				error = exception.Message;
				HandleException(exception);
				return error;
			}
		}

		private string AddErrorMessage(EditMsgs.Message emm)
		{
			string error = null;
			try
			{
				if (emm.code != 0)
				{
					error = _SAB.ClientServerSession.Audit.GetText(emm.code);
				}
				else
				{
					error = emm.msg;
				}
				_errors += Environment.NewLine + "     "  + error;
				return error;
			}
			catch( Exception exception )
			{
				HandleException(exception);
				error = exception.Message;
				return error;
			}
		}

		private bool NodeIDIsValid(ref EditMsgs em, string nodeName)
		{
			try
			{
				_hm.NodeIDValid(ref em,_hnp.HierarchyRID, _hnp.HomeHierarchyParentRID, nodeName);
				if (em.ErrorFound)
				{
					return false;
				}
				else
				{
					return true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
				return false;
			}
		}


		private void UpdateProfileData(EditMsgs em)
		{
			try
			{
				if (NodeIDIsValid(ref em, txtNodeID.Text))
				{
					if (_newNode)
					{
						_hnp.NodeChangeType = eChangeType.add;
					}
					else
						if (_hnp.NodeChangeType == eChangeType.none)
					{
						_hnp.NodeChangeType = eChangeType.update;
					}
					if (_hp.HierarchyType == eHierarchyType.organizational)
					{
						HierarchyLevelProfile hlp = (HierarchyLevelProfile)_hp.HierarchyLevels[_parent.HomeHierarchyLevel + 1];
						if (hlp.LevelType == eHierarchyLevelType.Size)
						{
							SizeCodeProfile scp = _SAB.HierarchyServerSession.GetSizeCodeProfile(txtNodeID.Text);
							_hnp.NodeName = scp.SizeCodeName;
						}
						else
						{
							_hnp.NodeName = txtNodeName.Text;
						}
					}
					else
					{
						_hnp.NodeName = txtNodeName.Text;
					}
					_hnp.NodeID = txtNodeID.Text;
					_hnp.NodeDescription = txtDescription.Text;

                    // BEGIN TT#1399
                    if (HierarchyChangesMade)
                    {
                        if (this.txtApplyNodePropsFrom.Text != null &&
                            this.txtApplyNodePropsFrom.Text.Trim().Length > 0)
                        {
                            try
                            {
                                if (txtApplyNodePropsFrom.Tag != null)
                                {
                                    switch (txtApplyNodePropsFrom.Tag.GetType().ToString())
                                    {
                                        case "MIDRetail.Windows.MIDMerchandiseTextBoxTag":
                                            if (((MIDTag)(txtApplyNodePropsFrom.Tag)).MIDTagData != null)
                                            {
                                                HierarchyNodeProfile rHNP =
                                                    (((HierarchyNodeProfile)((MIDTag)(txtApplyNodePropsFrom.Tag)).MIDTagData));
                                                _hnp.ApplyHNRIDFrom = rHNP.Key;
                                                HierarchyChangesMade = true;
                                            }
                                            else
                                            {
                                                _hnp.ApplyHNRIDFrom = Include.NoRID;
                                            }
                                            break;
                                        case "MIDRetail.DataCommon.HierarchyNodeProfile":
                                            if (((HierarchyNodeProfile)(txtApplyNodePropsFrom.Tag)) != null)
                                            {
                                                HierarchyNodeProfile rHNP = ((HierarchyNodeProfile)(txtApplyNodePropsFrom.Tag));
                                                _hnp.ApplyHNRIDFrom = rHNP.Key;
                                                HierarchyChangesMade = true;
                                            }
                                            else
                                            {
                                                _hnp.ApplyHNRIDFrom = Include.NoRID;
                                            }
                                            break;
                                        default:
                                            _hnp.ApplyHNRIDFrom = Include.NoRID;
                                            break;
                                    }
                                }
                                else
                                {
                                    _hnp.ApplyHNRIDFrom = Include.NoRID;
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                        }
                    }
                    // END TT#1399

					if (ProductTypeChangesMade)
					{
						if (radTypeHardline.Checked)
						{
							_hnp.ProductType = eProductType.Hardline;
							_hnp.ProductTypeIsOverridden = true;
						}
						else
							if (radTypeSoftline.Checked)
						{
							_hnp.ProductType = eProductType.Softline;
							_hnp.ProductTypeIsOverridden = true;
						}
						else
						{
							_hnp.ProductType = eProductType.Undefined;
							_hnp.ProductTypeIsOverridden = false;
						}
					}

					if (OTSLevelChangesMade)
					{
						if (this.txtOTSAnchorNode.Text != null &&
							this.txtOTSAnchorNode.Text.Trim().Length > 0)
						{
							_hnp.OTSPlanLevelAnchorNode = Convert.ToInt32(txtOTSAnchorNode.Tag);
						}
						else
						{
							_hnp.OTSPlanLevelAnchorNode = Include.NoRID;
						}

						if (cboOTSLevel.SelectedIndex > -1)
						{
							HierarchyLevelComboObject hlco = (HierarchyLevelComboObject)cboOTSLevel.SelectedItem;
							_hnp.OTSPlanLevelLevelType = hlco.PlanLevelLevelType;
							_hnp.OTSPlanLevelHierarchyRID = ((HierarchyLevelComboObject)cboOTSLevel.SelectedItem).HierarchyRID;
							_hnp.OTSPlanLevelHierarchyLevelSequence = ((HierarchyLevelComboObject)cboOTSLevel.SelectedItem).Level;
						}
						if (this.radOTSContainsName.Checked)
						{
							_hnp.OTSPlanLevelMaskField = eMaskField.Name;
						}
						else if (this.radOTSContainsDescription.Checked)
						{
							_hnp.OTSPlanLevelMaskField = eMaskField.Description;
						}
						else
						{
							_hnp.OTSPlanLevelMaskField = eMaskField.Id;
						}
						_hnp.OTSPlanLevelMask = this.txtOTSLevelString.Text;

						if (this.radOTSLevel.Checked)
						{
							_hnp.OTSPlanLevelSelectType = ePlanLevelSelectType.HierarchyLevel;

							if(_hnp.OTSPlanLevelHierarchyRID != Include.NoRID && _hnp.OTSPlanLevelHierarchyLevelSequence != Include.Undefined)
							{
								_hnp.OTSPlanLevelIsOverridden = true;
							}
							else
							{
								_hnp.OTSPlanLevelIsOverridden = false;
							}
						}
						else if (this.radOTSNode.Checked)
						{
							_hnp.OTSPlanLevelSelectType = ePlanLevelSelectType.Node;
							_hnp.OTSPlanLevelIsOverridden = true;
						}
						else 
						{
							_hnp.OTSPlanLevelSelectType = ePlanLevelSelectType.Undefined;
							_hnp.OTSPlanLevelIsOverridden = false;
						}
					}

					if (OTSTypeChangesMade)
					{
						if(chkOTSTypeOverrideRegular.Checked)
						{
							_hnp.OTSPlanLevelType = eOTSPlanLevelType.Regular;
							_hnp.OTSPlanLevelTypeIsOverridden = true;
						}
						else if(chkOTSTypeOverrideTotal.Checked)
						{
							_hnp.OTSPlanLevelType = eOTSPlanLevelType.Total;
							_hnp.OTSPlanLevelTypeIsOverridden = true;
						}
						else
						{
							_hnp.OTSPlanLevelType = eOTSPlanLevelType.Undefined;
							_hnp.OTSPlanLevelTypeIsOverridden = false;
						}
					}

					if (radBasicReplenishmentYes.Checked)
					{
						_hnp.UseBasicReplenishment = true;
					}
					else
					{
						_hnp.UseBasicReplenishment = false;
					}

					if (DailyPurgeCriteriaChangesMade ||
						WeeklyPurgeCriteriaChangesMade ||
						OTSPurgeCriteriaChangesMade ||
                        //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                        //HeadersPurgeCriteriaChangesMade ||
                        ASNHTPurgeCriteriaChangesMade ||
                        DropShipHTPurgeCriteriaChangesMade ||
                        DummyHTPurgeCriteriaChangesMade ||
                        ReceiptHTPurgeCriteriaChangesMade ||
                        PurchaseOrderHTPurgeCriteriaChangesMade ||
                        ReserveHTPurgeCriteriaChangesMade ||
                        VSWHTPurgeCriteriaChangesMade ||
                        WorkUpTotHTPurgeCriteriaChangesMade)
                    //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
					{
						if (this.cbxPCInheritFromHigherLevel.Checked)
						{
							 _rebuildScreen = true;
							_hnp.PurgeCriteriaChangeType = eChangeType.delete;
							_hnp.PurgeDailyHistoryAfter = Include.Undefined;
							_hnp.PurgeWeeklyHistoryAfter = Include.Undefined;
							_hnp.PurgeOTSPlansAfter = Include.Undefined;
                            //Begin TT#400-MD - JSmith - Add Header Purge Criteria by Header Type
                            //_hnp.PurgeHeadersAfter = Include.Undefined;
                            _hnp.PurgeHtASNAfter = Include.Undefined;
                            _hnp.PurgeHtDropShipAfter = Include.Undefined;
                            _hnp.PurgeHtDummyAfter = Include.Undefined;
                            _hnp.PurgeHtReceiptAfter = Include.Undefined;
                            _hnp.PurgeHtPurchaseOrderAfter = Include.Undefined;
                            _hnp.PurgeHtReserveAfter = Include.Undefined;
                            _hnp.PurgeHtVSWAfter = Include.Undefined;
                            _hnp.PurgeHtWorkUpTotAfter = Include.Undefined;
                            //End TT#400-MD - JSmith - Add Header Purge Criteria by Header Type
						}
						else
						{
							if ((_hnp.PurgeDailyCriteriaInherited != eInheritedFrom.None || _hnp.PurgeDailyHistoryAfter == Include.Undefined) &&	// if all values inherited
								(_hnp.PurgeWeeklyCriteriaInherited != eInheritedFrom.None || _hnp.PurgeWeeklyHistoryAfter == Include.Undefined) &&
								(_hnp.PurgeOTSCriteriaInherited != eInheritedFrom.None || _hnp.PurgeOTSPlansAfter == Include.Undefined) &&
                                //Begin TT#400-MD - JSmith - Add Header Purge Criteria by Header Type
                                //(_hnp.PurgeHeadersCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHeadersAfter == Include.Undefined))
                                (_hnp.PurgeHtASNCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtASNAfter == Include.Undefined) &&
                                (_hnp.PurgeHtDropShipCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtDropShipAfter == Include.Undefined) &&
                                (_hnp.PurgeHtDummyCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtDummyAfter == Include.Undefined) &&
                                (_hnp.PurgeHtReceiptCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtReceiptAfter == Include.Undefined) &&
                                (_hnp.PurgeHtPurchaseOrderCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtPurchaseOrderAfter == Include.Undefined) &&
                                (_hnp.PurgeHtReserveCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtReserveAfter == Include.Undefined) &&
                                (_hnp.PurgeHtVSWCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtVSWAfter == Include.Undefined) &&
                                (_hnp.PurgeHtWorkUpTotCriteriaInherited != eInheritedFrom.None || _hnp.PurgeHtWorkUpTotAfter == Include.Undefined))
                            //End TT#400-MD - JSmith - Add Header Purge Criteria by Header Type
							{
								_hnp.PurgeCriteriaChangeType = eChangeType.add;
							}
							else
							{
								_hnp.PurgeCriteriaChangeType = eChangeType.update;
							}

							if (DailyPurgeCriteriaChangesMade)
							{
								if (txtPurgeDailyHistory.Text.Length > 0)
								{
									_hnp.PurgeDailyHistoryAfter = Convert.ToInt32(this.txtPurgeDailyHistory.Text);
								}
								else
								{
									_hnp.PurgeDailyHistoryAfter = Include.Undefined;
								}
								_hnp.PurgeDailyCriteriaInherited = eInheritedFrom.None;
							}
							else
								if (_hnp.PurgeDailyCriteriaInherited !=  eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
							{
								_hnp.PurgeDailyHistoryAfter = Include.Undefined;
							}

							if (WeeklyPurgeCriteriaChangesMade)
							{
								if (txtPurgeWeeklyHistory.Text.Length > 0)
								{
									_hnp.PurgeWeeklyHistoryAfter = Convert.ToInt32(this.txtPurgeWeeklyHistory.Text);
								}
								else
								{
									_hnp.PurgeWeeklyHistoryAfter = Include.Undefined;
								}
								_hnp.PurgeWeeklyCriteriaInherited =  eInheritedFrom.None;
							}
							else
								if (_hnp.PurgeWeeklyCriteriaInherited !=  eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
							{
								_hnp.PurgeWeeklyHistoryAfter = Include.Undefined;
							}

							if (OTSPurgeCriteriaChangesMade)
							{
								if (txtPurgePlans.Text.Length > 0)
								{
									_hnp.PurgeOTSPlansAfter = Convert.ToInt32(this.txtPurgePlans.Text);
								}
								else
								{
									_hnp.PurgeOTSPlansAfter = Include.Undefined;
								}
								_hnp.PurgeOTSCriteriaInherited  =  eInheritedFrom.None;
							}
							else
								if (_hnp.PurgeOTSCriteriaInherited  !=  eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
							{
								_hnp.PurgeOTSPlansAfter = Include.Undefined;
							}

                            //BEGIN TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                            //if (HeadersPurgeCriteriaChangesMade)
                            //{
                            //    if (txtPurgeHeaders.Text.Length > 0)
                            //    {
                            //        _hnp.PurgeHeadersAfter = Convert.ToInt32(this.txtPurgeHeaders.Text);
                            //    }
                            //    else
                            //    {
                            //        _hnp.PurgeHeadersAfter = Include.Undefined;
                            //    }
                            //    _hnp.PurgeHeadersCriteriaInherited  =  eInheritedFrom.None;
                            //}
                            //else
                            //    if (_hnp.PurgeHeadersCriteriaInherited  !=  eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                            //{
                            //    _hnp.PurgeHeadersAfter = Include.Undefined;
                            //}
                            
                            if (ASNHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtASN.Text.Length > 0)
                                {
                                    _hnp.PurgeHtASNAfter = Convert.ToInt32(this.txtHtASN.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtASNAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtASNCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtASNCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtASNAfter = Include.Undefined;
                                }
                            
                            if (DropShipHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtDropShip.Text.Length > 0)
                                {
                                    _hnp.PurgeHtDropShipAfter = Convert.ToInt32(this.txtHtDropShip.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtDropShipAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtDropShipCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtDropShipCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtDropShipAfter = Include.Undefined;
                                }

                            if (DummyHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtDummy.Text.Length > 0)
                                {
                                    _hnp.PurgeHtDummyAfter = Convert.ToInt32(this.txtHtDummy.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtDummyAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtDummyCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtDummyCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtDummyAfter = Include.Undefined;
                                }

                            if (ReceiptHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtReceipt.Text.Length > 0)
                                {
                                    _hnp.PurgeHtReceiptAfter = Convert.ToInt32(this.txtHtReceipt.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtReceiptAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtReceiptCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtReceiptCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtReceiptAfter = Include.Undefined;
                                }

                            if (PurchaseOrderHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtPurchase.Text.Length > 0)
                                {
                                    _hnp.PurgeHtPurchaseOrderAfter = Convert.ToInt32(this.txtHtPurchase.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtPurchaseOrderAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtPurchaseOrderCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtPurchaseOrderCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtPurchaseOrderAfter = Include.Undefined;
                                }

                            if (ReserveHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtReserve.Text.Length > 0)
                                {
                                    _hnp.PurgeHtReserveAfter = Convert.ToInt32(this.txtHtReserve.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtReserveAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtReserveCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtReserveCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtReserveAfter = Include.Undefined;
                                }

                            if (VSWHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtVSW.Text.Length > 0)
                                {
                                    _hnp.PurgeHtVSWAfter = Convert.ToInt32(this.txtHtVSW.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtVSWAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtVSWCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtVSWCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtVSWAfter = Include.Undefined;
                                }

                            if (WorkUpTotHTPurgeCriteriaChangesMade)
                            {
                                if (txtHtWorkupTotBy.Text.Length > 0)
                                {
                                    _hnp.PurgeHtWorkUpTotAfter = Convert.ToInt32(this.txtHtWorkupTotBy.Text);
                                }
                                else
                                {
                                    _hnp.PurgeHtWorkUpTotAfter = Include.Undefined;
                                }
                                _hnp.PurgeHtWorkUpTotCriteriaInherited = eInheritedFrom.None;
                            }
                            else
                                if (_hnp.PurgeHtWorkUpTotCriteriaInherited != eInheritedFrom.None)	// if inherited, replace with Include.Undefined to maintain inheritence
                                {
                                    _hnp.PurgeHtWorkUpTotAfter = Include.Undefined;
                                }
                            //END TT#400-MD-VStuart-Add Header Purge Criteria by Header Type
                        }
					}
	
					_hnp.Key = _hm.ProcessNodeProfileInfo(ref em, _hnp);

                    if (_newNode &&
                        _hnp.Key > Include.NoRID)
                    {
                        _hnp = _SAB.HierarchyServerSession.GetNodeData(_hnp.Key, false);
                        _hnp.NodeChangeType = eChangeType.add;
                    }
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //BEGIN TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service

		private void UpdateEligibilityData()
		{
			try
			{
				int storeRID;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				string exceptionMessage = string.Empty;
                HierarchyNodeProfile hierNodeProf;
                ArrayList ErrorList = new ArrayList();

                hierNodeProf = SAB.HierarchyServerSession.GetNodeData(_nodeRID);
                
				ugStoreEligibility.PerformAction(UltraGridAction.ExitEditMode);

                ErrorList = _hm.ValidEligibilityData(_storeList, _storeEligibilityDataSet, _storeEligList, ErrorList);

                if (ErrorList.Count > 0)
                {
                    for (int i = 0; i < ErrorList.Count; i++)
                    {
                        StoreEligibilityErrors see = (StoreEligibilityErrors)ErrorList[i];
                        if (see.typeErr == true || see.simStoreErr == true)
                        {
                            foreach (UltraGridRow setRow in this.ugStoreEligibility.Rows)
                            {
                                ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                                foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                                {
                                    storeRID = (int)storeRow.Cells["Store RID"].Value;

                                    if (see.storeRID == storeRID)
                                    {
                                        exceptionMessage = see.message;
                                        ErrorFound = true;
                                        ugStoreEligibility.ActiveCell = storeRow.Cells[see.type];
                                        break;
                                    }

                                }
                                if (ugStoreEligibility.ActiveCell != null)
                                {
                                    if (ErrorFound)
                                    {
                                        ugStoreEligibility.ActiveCell.Appearance.Image = ErrorImage;
                                        ugStoreEligibility.ActiveCell.Tag = exceptionMessage;
                                    }
                                    else
                                    {
                                        ugStoreEligibility.ActiveCell.Appearance.Image = null;
                                        ugStoreEligibility.ActiveCell.Tag = null;
                                    }
                                }
                            }
                        }
                        else 
                        {
                            _storeEligList = see.sel;
                            
                        
                        }
                    }
                }
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}
        
        //private void UpdateEligibilityData()
        //{
        //    try
        //    {
        //        bool profileFound = false;
        //        int storeRID;
        //        StoreEligibilityProfile sep;
        //        Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
        //        string exceptionMessage = string.Empty;

        //        ugStoreEligibility.PerformAction(UltraGridAction.ExitEditMode);

        //        foreach (UltraGridRow setRow in this.ugStoreEligibility.Rows)
        //        {
        //            ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
        //            foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
        //            {
        //                if ((bool)storeRow.Cells["Updated"].Value)
        //                {
        //                    storeRID = (int)storeRow.Cells["Store RID"].Value;
        //                    if (_storeEligList.Contains(storeRID))
        //                    {
        //                        sep = (StoreEligibilityProfile)_storeEligList.FindKey(storeRID);
        //                        profileFound = true;
        //                    }
        //                    else
        //                    {
        //                        sep = new StoreEligibilityProfile(storeRID);
        //                        profileFound = false;
        //                    }
        //                    // set change type to update if found profile and something not inherited
        //                    if (profileFound &&
        //                        sep.RecordExists)
        //                    {
        //                        sep.StoreEligChangeType = eChangeType.update;
        //                    }
        //                    else
        //                    {
        //                        sep.StoreEligChangeType = eChangeType.add;
        //                    }

        //                    // update eligibility fields based on inheritance
        //                    if (Convert.ToInt32(storeRow.Cells["Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
        //                    {
        //                        sep.EligModelRID = Include.NoRID;
        //                        sep.EligModelName = string.Empty;
        //                        sep.StoreIneligible = false;
        //                        sep.EligIsInherited = true;
        //                    }
        //                    else
        //                    {
        //                        sep.EligModelRID = (int)storeRow.Cells["Eligibility RID"].Value;
        //                        sep.EligModelName = storeRow.Cells["Eligibility"].Text;
        //                        sep.StoreIneligible = (bool)storeRow.Cells["Ineligible"].Value;
        //                        if (Convert.ToBoolean(storeRow.Cells["Inherited"].Value, CultureInfo.CurrentCulture))
        //                        {
        //                            sep.EligIsInherited = true;
        //                        }
        //                        else
        //                        {
        //                            sep.EligIsInherited = false;
        //                            sep.EligInheritedFromNodeRID = Include.NoRID;
        //                        }
        //                    }

        //                    // update stock model fields based on inheritance
        //                    if (Convert.ToInt32(storeRow.Cells["Stock Modifier Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
        //                    {
        //                        sep.StkModModelRID = Include.NoRID;
        //                        sep.StkModModelName = string.Empty;
        //                        sep.StkModType = eModifierType.None;
        //                        sep.StkModPct = Include.Undefined;
        //                        sep.StkModIsInherited = true;
        //                        //sep.StkLeadWeeks = Include.Undefined; //TT#44 - MD - DOConnell - New Store Forecasting Enhancement
        //                    }
        //                    else
        //                    {
        //                        sep.StkModModelRID = (int)storeRow.Cells["Stock Modifier RID"].Value;
        //                        sep.StkModModelName = storeRow.Cells["Stock Modifier"].Text;
        //                        sep.StkModType = eModifierType.None;
        //                        sep.StkModIsInherited = false;
        //                        sep.StkModInheritedFromNodeRID = Include.NoRID;
        //                        if (sep.StkModModelName != null &&
        //                            sep.StkModModelName.Trim().Length > 0)
        //                        {
        //                            if (sep.StkModModelRID == Include.NoRID)
        //                            {
        //                                try
        //                                {
        //                                    sep.StkModPct = Convert.ToDouble(storeRow.Cells["Stock Modifier"].Value, CultureInfo.CurrentUICulture);
        //                                    sep.StkModType = eModifierType.Percent;
        //                                    sep.StkModModelName = string.Empty;
        //                                }
        //                                catch (Exception error)
        //                                {
        //                                    exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                    ErrorFound = true;
        //                                    ugStoreEligibility.ActiveCell = storeRow.Cells["Stock Modifier"];
        //                                    break;
        //                                }
        //                            }
        //                            else
        //                            {
        //                                sep.StkModType = eModifierType.Model;
        //                            }
        //                        }
        //                        //BEGIN TT#44 - MD - DOConnell - New Store Forecasting Enhancement
        //                        //if (Convert.ToInt32(storeRow.Cells["Stock Lead Weeks"].Value) != Include.NoRID)
        //                        //{
        //                        //    sep.StkLeadWeeks = Convert.ToInt32(storeRow.Cells["Stock Lead Weeks"].Value, CultureInfo.CurrentUICulture);
        //                        //}
        //                        //END TT#44 - MD - DOConnell - New Store Forecasting Enhancement
        //                    }

        //                    // update sales model fields based on inheritance
        //                    if (Convert.ToInt32(storeRow.Cells["Sales Modifier Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
        //                    {
        //                        sep.SlsModModelRID = Include.NoRID;
        //                        sep.SlsModModelName = string.Empty;
        //                        sep.SlsModType = eModifierType.None;
        //                        sep.SlsModPct = Include.Undefined;
        //                        sep.SlsModIsInherited = true;
        //                    }
        //                    else
        //                    {
        //                        sep.SlsModModelRID = (int)storeRow.Cells["Sales Modifier RID"].Value;
        //                        sep.SlsModModelName = storeRow.Cells["Sales Modifier"].Text;
        //                        sep.SlsModType = eModifierType.None;
        //                        sep.SlsModIsInherited = false;
        //                        sep.SlsModInheritedFromNodeRID = Include.NoRID;
        //                        if (sep.SlsModModelName != null &&
        //                            sep.SlsModModelName.Trim().Length > 0)
        //                        {
        //                            if (sep.SlsModModelRID == Include.NoRID)
        //                            {
        //                                try
        //                                {
        //                                    sep.SlsModPct = Convert.ToDouble(storeRow.Cells["Sales Modifier"].Value, CultureInfo.CurrentUICulture);
        //                                    sep.SlsModType = eModifierType.Percent;
        //                                    sep.SlsModModelName = string.Empty;
        //                                }
        //                                catch (Exception error)
        //                                {
        //                                    exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                    ErrorFound = true;
        //                                    ugStoreEligibility.ActiveCell = storeRow.Cells["Sales Modifier"];
        //                                    break;
        //                                }
        //                            }
        //                            else
        //                            {
        //                                sep.SlsModType = eModifierType.Model;
        //                            }
        //                        }
        //                    }

        //                    // update FWOS model fields based on inheritance
        //                    if (Convert.ToInt32(storeRow.Cells["FWOS Modifier Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
        //                    {
        //                        sep.FWOSModModelRID = Include.NoRID;
        //                        sep.FWOSModModelName = string.Empty;
        //                        sep.FWOSModType = eModifierType.None;
        //                        sep.FWOSModPct = Include.Undefined;
        //                        sep.FWOSModIsInherited = true;
        //                    }
        //                    else
        //                    {
        //                        sep.FWOSModModelRID = (int)storeRow.Cells["FWOS Modifier RID"].Value;
        //                        sep.FWOSModModelName = storeRow.Cells["FWOS Modifier"].Text;
        //                        sep.FWOSModType = eModifierType.None;
        //                        sep.FWOSModIsInherited = false;
        //                        sep.FWOSModInheritedFromNodeRID = Include.NoRID;
        //                        if (sep.FWOSModModelName != null &&
        //                            sep.FWOSModModelName.Trim().Length > 0)
        //                        {
        //                            if (sep.FWOSModModelRID == Include.NoRID)
        //                            {
        //                                try
        //                                {
        //                                    sep.FWOSModPct = Convert.ToDouble(storeRow.Cells["FWOS Modifier"].Value, CultureInfo.CurrentUICulture);
        //                                    sep.FWOSModType = eModifierType.Percent;
        //                                    sep.FWOSModModelName = string.Empty;
        //                                }
        //                                catch (Exception error)
        //                                {
        //                                    exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                    ErrorFound = true;
        //                                    ugStoreEligibility.ActiveCell = storeRow.Cells["FWOS Modifier"];
        //                                    break;
        //                                }
        //                            }
        //                            else
        //                            {
        //                                sep.FWOSModType = eModifierType.Model;
        //                            }
        //                        }
        //                    }

        //                    // update similar store fields based on inheritance
        //                    if (Convert.ToInt32(storeRow.Cells["Similar Store Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
        //                    {
        //                        sep.SimStoresChanged = false;
        //                        sep.SimStoreType = eSimilarStoreType.None;
        //                        sep.SimStores = null;
        //                        sep.SimStoreRatio = Include.Undefined;
        //                        sep.SimStoreUntilDateRangeRID = Include.NoRID;
        //                        sep.SimStoreIsInherited = false;
        //                    }
        //                    else
        //                        if (storeRow.Cells["Similar Store"].Text.Length > 0 ||
        //                        storeRow.Cells["Ratio"].Text.Length > 0 ||
        //                        storeRow.Cells["Until"].Text.Length > 0)
        //                        {
        //                            sep.SimStoreIsInherited = false;
        //                            sep.SimStoreInheritedFromNodeRID = Include.NoRID;
        //                            if (Convert.ToBoolean(storeRow.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
        //                            {
        //                                sep.SimStoresChanged = true;
        //                                sep.SimStoreType = eSimilarStoreType.Stores;
        //                                if (Convert.ToBoolean(storeRow.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
        //                                {
        //                                    sep.SimStores = (ArrayList)storeRow.Cells["SimilarStoresArrayList"].Value;
        //                                }
        //                                else
        //                                    if (storeRow.Cells["Similar Store"].Text.Length > 0)
        //                                    {
        //                                        bool simStoreError = false;
        //                                        ArrayList SimilarStoresList = new ArrayList();
        //                                        string[] fields = storeRow.Cells["Similar Store"].Text.Split(',');
        //                                        for (int i = 0; i < fields.Length; i++)
        //                                        {
        //                                            StoreProfile sp = _SAB.StoreServerSession.GetStoreProfile(fields[i].Trim());
        //                                            if (sp.ActiveInd)
        //                                            {
        //                                                if (sp.Key == Include.NoRID)
        //                                                {
        //                                                    sp.Key = 1;
        //                                                }
        //                                                SimilarStoresList.Add(sp.Key);
        //                                            }
        //                                            else
        //                                            {
        //                                                simStoreError = true;
        //                                            }
        //                                        }
        //                                        if (simStoreError)
        //                                        {
        //                                            MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreNotFound), this.Text,
        //                                                MessageBoxButtons.OK, MessageBoxIcon.Error);
        //                                            ErrorFound = true;
        //                                        }
        //                                        else
        //                                        {
        //                                            sep.SimStores = SimilarStoresList;
        //                                        }
        //                                    }
        //                                    else
        //                                    {
        //                                        sep.SimStores = null;
        //                                    }
        //                            }

        //                            if (storeRow.Cells["Ratio"].Text != string.Empty)
        //                            {
        //                                try
        //                                {
        //                                    sep.SimStoreRatio = Convert.ToDouble(storeRow.Cells["Ratio"].Value, CultureInfo.CurrentUICulture);
        //                                }
        //                                catch (Exception error)
        //                                {
        //                                    exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                    ErrorFound = true;
        //                                    ugStoreEligibility.ActiveCell = storeRow.Cells["Ratio"];
        //                                    break;
        //                                }
        //                            }
        //                            else
        //                            {
        //                                sep.SimStoreRatio = Include.DefaultSimilarStoreRatio;
        //                            }

        //                            if (storeRow.Cells["Until"].Text != string.Empty)
        //                            {
        //                                try
        //                                {
        //                                    sep.SimStoreUntilDateRangeRID = Convert.ToInt32(storeRow.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
        //                                    sep.SimStoreDisplayDate = storeRow.Cells["Until"].Text;
        //                                }
        //                                catch (Exception error)
        //                                {
        //                                    exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                    ErrorFound = true;
        //                                    ugStoreEligibility.ActiveCell = storeRow.Cells["Until RID"];
        //                                    break;
        //                                }
        //                            }
        //                            else
        //                            {
        //                                sep.SimStoreUntilDateRangeRID = Include.NoRID;
        //                            }
        //                        }
        //                        else if (sep.SimStoreType != eSimilarStoreType.None)
        //                        {
        //                            sep.SimStoresChanged = true;
        //                            sep.SimStoreType = eSimilarStoreType.None;
        //                            sep.SimStores = null;
        //                            sep.SimStoreRatio = Include.Undefined;
        //                            sep.SimStoreUntilDateRangeRID = Include.NoRID;
        //                            sep.SimStoreIsInherited = false;
        //                            sep.SimStoreInheritedFromNodeRID = Include.NoRID;
        //                        }

        //                    if (storeRow.Cells["PMPlusSales"].Value == System.DBNull.Value)
        //                    {
        //                        sep.PresPlusSalesInd = false;
        //                        sep.PresPlusSalesIsSet = true;
        //                        sep.PresPlusSalesInheritedFromNodeRID = Include.NoRID;
        //                        sep.PresPlusSalesIsInherited = false;
        //                    }
        //                    else if (Convert.ToBoolean(storeRow.Cells["PMPlusSales"].Value))
        //                    {
        //                        sep.PresPlusSalesInd = true;
        //                        sep.PresPlusSalesIsSet = true;
        //                        sep.PresPlusSalesInheritedFromNodeRID = Include.NoRID;
        //                        sep.PresPlusSalesIsInherited = false;
        //                    }
        //                    else
        //                    {
        //                        sep.PresPlusSalesInd = false;
        //                        sep.PresPlusSalesIsSet = false;
        //                        sep.PresPlusSalesInheritedFromNodeRID = Include.NoRID;
        //                        sep.PresPlusSalesIsInherited = false;
        //                    }

        //                    // alter change type if record does not contain any data needed to be saved
        //                    if (sep.EligIsInherited == false &&
        //                        sep.StkModIsInherited == false &&
        //                        sep.SlsModIsInherited == false &&
        //                        sep.SimStoreIsInherited == false &&
        //                        sep.EligModelRID == Include.NoRID &&
        //                        !sep.StoreIneligible &&
        //                        (sep.SlsModModelRID == Include.NoRID && sep.SlsModType == eModifierType.Model) &&
        //                        (sep.StkModModelRID == Include.NoRID && sep.StkModType == eModifierType.Model) &&
        //                        (sep.SimStores == null || sep.SimStores.Count == 0)
        //                        )
        //                    {
        //                        if (sep.StoreEligChangeType == eChangeType.update)
        //                        {
        //                            sep.StoreEligChangeType = eChangeType.delete;
        //                        }
        //                        else
        //                            if (sep.StoreEligChangeType == eChangeType.add)
        //                            {
        //                                sep.StoreEligChangeType = eChangeType.none;
        //                            }
        //                    }

        //                    if (!profileFound)
        //                    {
        //                        if (sep.StoreEligChangeType != eChangeType.none)
        //                        {
        //                            _storeEligList.Add(sep);
        //                        }
        //                    }
        //                    else
        //                    {
        //                        _storeEligList.Update(sep);
        //                    }
        //                }
        //            }
        //            if (ugStoreEligibility.ActiveCell != null)
        //            {
        //                if (ErrorFound)
        //                {
        //                    ugStoreEligibility.ActiveCell.Appearance.Image = ErrorImage;
        //                    ugStoreEligibility.ActiveCell.Tag = exceptionMessage;
        //                }
        //                else
        //                {
        //                    ugStoreEligibility.ActiveCell.Appearance.Image = null;
        //                    ugStoreEligibility.ActiveCell.Tag = null;
        //                }
        //            }
        //        }
        //    }
        //    catch (Exception exception)
        //    {
        //        HandleException(exception);
        //    }
        //}

        //END TT#796 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateStoreEligibilityData to hierarchy service

        //BEGIN TT#1401 - gtaylor - Reservation Stores (IMO)
        //  convert this to IMO
        private void UpdateIMOData()
        {
            try
            {
                bool profileFound = false;
                int storeRID;
                int nodeRID;
                IMOProfile imop;
                Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
                string exceptionMessage = string.Empty;

                ugReservation.PerformAction(UltraGridAction.ExitEditMode);

	//BEGIN TT#798 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateIMOData to hierarchy service 
                ArrayList ErrorList = new ArrayList();
                ErrorList = _hm.ValidIMOData(this.NodeRID, _storeList, _imoDataSet, _imoProfileList, ErrorList);

                if (ErrorList.Count > 0)
                {
                    for (int i = 0; i < ErrorList.Count; i++)
                    {
                        IMOErrors IMOe = (IMOErrors)ErrorList[i];
                        if (IMOe.Error == true)
                        {
                            foreach (UltraGridRow setRow in this.ugReservation.Rows)
                            {
                                ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                                foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                                {
                                    storeRID = (int)storeRow.Cells["Store RID"].Value;
                                    if (IMOe.StoreRID == storeRID)
                                    {
                                        exceptionMessage = IMOe.Message;
                                        ErrorFound = true;
                                        ugReservation.ActiveCell = storeRow.Cells[IMOe.type];
                                        break;
                                    }
                                }
                            }
                            if (ugReservation.ActiveCell != null)
                            {
                                if (ErrorFound)
                                {
                                    ugReservation.ActiveCell.Appearance.Image = ErrorImage;
                                    ugReservation.ActiveCell.Tag = exceptionMessage;
                                    ugReservation.ActiveCell.ToolTipText = exceptionMessage;  // TT#3680 - JSmith - VSW fields accepting invalid values
                                }
                                else
                                {
                                    ugReservation.ActiveCell.Appearance.Image = null;
                                    ugReservation.ActiveCell.Tag = null;
                                    ugReservation.ActiveCell.ToolTipText = null;  // TT#3680 - JSmith - VSW fields accepting invalid values
                                }
                            }
                        }
                    }
                }



                //foreach (UltraGridRow setRow in this.ugReservation.Rows)
                //{
                //    ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
                //    foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
                //    {
                //        if ((bool)storeRow.Cells["Updated"].Value)
                //        {
                //            storeRID = (int)storeRow.Cells["Store RID"].Value;
                //            nodeRID = this.NodeRID;
                //            if ((_imoProfileList != null) && (_imoProfileList.Contains(storeRID)))
                //            {
                //                imop = (IMOProfile)_imoProfileList.FindKey(storeRID);
                //                imop.IMONodeRID = nodeRID;
                //                imop.IMOChangeType = eChangeType.update;
                //                profileFound = true;
                //            }
                //            else
                //            {
                //                profileFound = false;
                //                imop = new IMOProfile(storeRID);
                //                imop.IMOStoreRID = storeRID;
                //                imop.IMONodeRID = nodeRID;
                //                imop.IMOChangeType = eChangeType.add;
                //            }
                //            if (storeRow.Cells["Item Max"].Text != string.Empty)
                //            {
                //                imop.IMOMaxValue = Convert.ToInt32(storeRow.Cells["Item Max"].Value, CultureInfo.CurrentUICulture);
                //            }
                //            else
                //            {
                //                imop.IMOMaxValue = int.MaxValue;
                //            }
                //            if (storeRow.Cells["Min Ship Qty"].Text != string.Empty)
                //            {
                //                imop.IMOMinShipQty = Convert.ToInt32(storeRow.Cells["Min Ship Qty"].Value, CultureInfo.CurrentUICulture);
                //            }
                //            else
                //            {
                //                imop.IMOMinShipQty = 0;
                //            }
                //            // Begin TT#492-MD - JSmith - FWOS Max errors when removed with space bar
                //            //if (storeRow.Cells["FWOS Max"].Text != string.Empty)
                //            if (storeRow.Cells["FWOS Max"].Text != string.Empty &&
                //                storeRow.Cells["FWOS Max"].Text.Trim().Length > 0)
                //            // End TT#492-MD - JSmith - FWOS Max errors when removed with space bar
                //            {
                //            //BEGIN TT#108 - MD - DOConnell - FWOS Max Model 
                //                bool modelYes = false; 

                //                try
                //                {
                //                    double FWOSMax = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentCulture);
                //                    modelYes = false;
                //                    imop.IMOFWOS_Max = FWOSMax;
                //                    imop.IMOFWOS_MaxModelRID = Include.NoRID;
                //                    imop.IMOFWOS_MaxModelName = string.Empty;
                //                    imop.IMOFWOS_MaxType = eModifierType.Percent;
                //                }
                //                catch
                //                {
                //                    modelYes = true;
                //                }

                //                if (modelYes)
                //                {
                //                    imop.IMOFWOS_MaxType = eModifierType.Model;
                //                    imop.IMOFWOS_MaxModelName = storeRow.Cells["FWOS Max"].Text;
                //                    imop.IMOFWOS_MaxModelRID = Convert.ToInt32(storeRow.Cells["FWOS Max RID"].Value);
                //                    if (imop.IMOFWOS_MaxModelName != null &&
                //                        imop.IMOFWOS_MaxModelName.Trim().Length > 0)
                //                    {
                //                        if (imop.IMOFWOS_MaxModelRID == Include.NoRID)
                //                        {
                //                            try
                //                            {
                //                                imop.IMOFWOS_Max = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentUICulture);
                //                                imop.IMOFWOS_MaxType = eModifierType.Percent;
                //                                imop.IMOFWOS_MaxModelName = storeRow.Cells["FWOS Max"].Text;
                //                            }
                //                            catch (Exception error)
                //                            {
                //                                exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
                //                                ErrorFound = true;
                //                                ugStoreEligibility.ActiveCell = storeRow.Cells["FWOS Max"];
                //                                break;
                //                            }
                //                        }
                //                        else
                //                        {
                //                            imop.IMOFWOS_MaxType = eModifierType.Model;
                //                        }
                //                    }
                //                }


                //                //imop.IMOFWOS_Max = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentUICulture);
                //            //END TT#108 - MD - DOConnell - FWOS Max Model 
                //            }
                //            else
                //            {
                //                imop.IMOFWOS_Max = int.MaxValue;
                //                // Begin TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
                //                imop.IMOFWOS_MaxModelRID = Include.NoRID;
                //                imop.IMOFWOS_MaxType = eModifierType.None;
                //                // End TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
                //            }
                //            if (storeRow.Cells["Pct Pack Threshold"].Text != string.Empty)
                //            {
                //                imop.IMOPackQty = (Convert.ToDouble(storeRow.Cells["Pct Pack Threshold"].Value, CultureInfo.CurrentUICulture) / 100);
                //            }
                //            else
                //            {
                //                imop.IMOPackQty = Include.PercentPackThresholdDefault;
                //            }
                //            if (storeRow.Cells["Push to Backstock"].Text != string.Empty)
                //            {
                //                imop.IMOPshToBackStock = Convert.ToInt32(storeRow.Cells["Push to Backstock"].Value, CultureInfo.CurrentUICulture);
                //            }
                //            else
                //            {
                //                imop.IMOPshToBackStock = Include.NoRID;
                //            }
                //            if (imop.IsDefaultValues)
                //                imop.IMOChangeType = eChangeType.delete;

                //            imop.IMOIsInherited = false;
                //            imop.IMOInheritedFromNodeRID = Include.NoRID;
                //            if (!profileFound)
                //            {
                //                _imoProfileList.Add(imop);
                //            }
                //            else
                //            {
                //                _imoProfileList.Update(imop);
                //            }
                //        }
                //    }
                //    if (ugReservation.ActiveCell != null)
                //    {
                //        if (ErrorFound)
                //        {
                //            ugReservation.ActiveCell.Appearance.Image = ErrorImage;
                //            ugReservation.ActiveCell.Tag = exceptionMessage;
                //        }
                //        else
                //        {
                //            ugReservation.ActiveCell.Appearance.Image = null;
                //            ugReservation.ActiveCell.Tag = null;
                //        }
                //    }
                //}
            }
	//END TT#798 - MD - DOConnell - Node Properties Maintenance Enhancement - Phase 1 -  Relocate UpdateIMOData to hierarchy service 
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }
        //END TT#1401 - gtaylor - Reservation Stores

        //private void UpdateIMOData()
        //{
        //    try
        //    {
        //        bool profileFound = false;
        //        int storeRID;
        //        int nodeRID;
        //        IMOProfile imop;
        //        Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
        //        string exceptionMessage = string.Empty;

        //        ugReservation.PerformAction(UltraGridAction.ExitEditMode);

        //        foreach (UltraGridRow setRow in this.ugReservation.Rows)
        //        {
        //            ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
        //            foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
        //            {
        //                if ((bool)storeRow.Cells["Updated"].Value)
        //                {
        //                    storeRID = (int)storeRow.Cells["Store RID"].Value;
        //                    nodeRID = this.NodeRID;
        //                    if ((_imoProfileList != null) && (_imoProfileList.Contains(storeRID)))
        //                    {
        //                        imop = (IMOProfile)_imoProfileList.FindKey(storeRID);
        //                        imop.IMONodeRID = nodeRID;
        //                        imop.IMOChangeType = eChangeType.update;
        //                        profileFound = true;
        //                    }
        //                    else
        //                    {
        //                        profileFound = false;
        //                        imop = new IMOProfile(storeRID);
        //                        imop.IMOStoreRID = storeRID;
        //                        imop.IMONodeRID = nodeRID;
        //                        imop.IMOChangeType = eChangeType.add;
        //                    }
        //                    if (storeRow.Cells["Item Max"].Text != string.Empty)
        //                    {
        //                        imop.IMOMaxValue = Convert.ToInt32(storeRow.Cells["Item Max"].Value, CultureInfo.CurrentUICulture);
        //                    }
        //                    else
        //                    {
        //                        imop.IMOMaxValue = int.MaxValue;
        //                    }
        //                    if (storeRow.Cells["Min Ship Qty"].Text != string.Empty)
        //                    {
        //                        imop.IMOMinShipQty = Convert.ToInt32(storeRow.Cells["Min Ship Qty"].Value, CultureInfo.CurrentUICulture);
        //                    }
        //                    else
        //                    {
        //                        imop.IMOMinShipQty = 0;
        //                    }
        //                    // Begin TT#492-MD - JSmith - FWOS Max errors when removed with space bar
        //                    //if (storeRow.Cells["FWOS Max"].Text != string.Empty)
        //                    if (storeRow.Cells["FWOS Max"].Text != string.Empty &&
        //                        storeRow.Cells["FWOS Max"].Text.Trim().Length > 0)
        //                    // End TT#492-MD - JSmith - FWOS Max errors when removed with space bar
        //                    {
        //                        //BEGIN TT#108 - MD - DOConnell - FWOS Max Model 
        //                        bool modelYes = false;

        //                        try
        //                        {
        //                            double FWOSMax = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentCulture);
        //                            modelYes = false;
        //                            imop.IMOFWOS_Max = FWOSMax;
        //                            imop.IMOFWOS_MaxModelRID = Include.NoRID;
        //                            imop.IMOFWOS_MaxModelName = string.Empty;
        //                            imop.IMOFWOS_MaxType = eModifierType.Percent;
        //                        }
        //                        catch
        //                        {
        //                            modelYes = true;
        //                        }

        //                        if (modelYes)
        //                        {
        //                            imop.IMOFWOS_MaxType = eModifierType.Model;
        //                            imop.IMOFWOS_MaxModelName = storeRow.Cells["FWOS Max"].Text;
        //                            imop.IMOFWOS_MaxModelRID = Convert.ToInt32(storeRow.Cells["FWOS Max RID"].Value);
        //                            if (imop.IMOFWOS_MaxModelName != null &&
        //                                imop.IMOFWOS_MaxModelName.Trim().Length > 0)
        //                            {
        //                                if (imop.IMOFWOS_MaxModelRID == Include.NoRID)
        //                                {
        //                                    try
        //                                    {
        //                                        imop.IMOFWOS_Max = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentUICulture);
        //                                        imop.IMOFWOS_MaxType = eModifierType.Percent;
        //                                        imop.IMOFWOS_MaxModelName = storeRow.Cells["FWOS Max"].Text;
        //                                    }
        //                                    catch (Exception error)
        //                                    {
        //                                        exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
        //                                        ErrorFound = true;
        //                                        ugStoreEligibility.ActiveCell = storeRow.Cells["FWOS Max"];
        //                                        break;
        //                                    }
        //                                }
        //                                else
        //                                {
        //                                    imop.IMOFWOS_MaxType = eModifierType.Model;
        //                                }
        //                            }
        //                        }


        //                        //imop.IMOFWOS_Max = Convert.ToDouble(storeRow.Cells["FWOS Max"].Value, CultureInfo.CurrentUICulture);
        //                        //END TT#108 - MD - DOConnell - FWOS Max Model 
        //                    }
        //                    else
        //                    {
        //                        imop.IMOFWOS_Max = int.MaxValue;
        //                        // Begin TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
        //                        imop.IMOFWOS_MaxModelRID = Include.NoRID;
        //                        imop.IMOFWOS_MaxType = eModifierType.None;
        //                        // End TT#270-MD - JSmith -  FWOS Max Model not holding in Node Properties
        //                    }
        //                    if (storeRow.Cells["Pct Pack Threshold"].Text != string.Empty)
        //                    {
        //                        imop.IMOPackQty = (Convert.ToDouble(storeRow.Cells["Pct Pack Threshold"].Value, CultureInfo.CurrentUICulture) / 100);
        //                    }
        //                    else
        //                    {
        //                        imop.IMOPackQty = Include.PercentPackThresholdDefault;
        //                    }
        //                    if (storeRow.Cells["Push to Backstock"].Text != string.Empty)
        //                    {
        //                        imop.IMOPshToBackStock = Convert.ToInt32(storeRow.Cells["Push to Backstock"].Value, CultureInfo.CurrentUICulture);
        //                    }
        //                    else
        //                    {
        //                        imop.IMOPshToBackStock = Include.NoRID;
        //                    }
        //                    if (imop.IsDefaultValues)
        //                        imop.IMOChangeType = eChangeType.delete;

        //                    imop.IMOIsInherited = false;
        //                    imop.IMOInheritedFromNodeRID = Include.NoRID;
        //                    if (!profileFound)
        //                    {
        //                        _imoProfileList.Add(imop);
        //                    }
        //                    else
        //                    {
        //                        _imoProfileList.Update(imop);
        //                    }
        //                }
        //            }
        //            if (ugReservation.ActiveCell != null)
        //            {
        //                if (ErrorFound)
        //                {
        //                    ugReservation.ActiveCell.Appearance.Image = ErrorImage;
        //                    ugReservation.ActiveCell.Tag = exceptionMessage;
        //                }
        //                else
        //                {
        //                    ugReservation.ActiveCell.Appearance.Image = null;
        //                    ugReservation.ActiveCell.Tag = null;
        //                }
        //            }
        //        }
        //    }
        //    catch (Exception exception)
        //    {
        //        HandleException(exception);
        //    }
        //}


		private void UpdateStoreGradeData()
		{
			try
			{
				int index = 0;
				// rebuild grades each time
				_storeGradeList.Clear();
				bool deleteMinMaxValues = true;
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugStoreGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
				foreach (UltraGridRow gridRow in ugStoreGrades.Rows)
				{
					StoreGradeProfile sgp = new StoreGradeProfile(index);

					if (StoreGradesChangesMade)
					{
						sgp.StoreGradeChangeType = eChangeType.add;
						sgp.MinMaxChangeType = eChangeType.update;			// if change store grade, then update min/maxes
					}
					else
						if (MinMaxesChangesMade)
						{
							if (_storeGradesInherited)
							{
								sgp.StoreGradesIsInherited = true;
								sgp.MinMaxChangeType = eChangeType.add;	// if store grades don't exist, must add min/maxes
							}
							else
							{
								sgp.MinMaxChangeType = eChangeType.update;	// if store grades exist, then min/maxes are updated
							}
						}

					sgp.StoreGrade = (string)gridRow.Cells["Grade"].Value;
					sgp.Boundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture);
                    // Begin TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review
                    if (Convert.IsDBNull(gridRow.Cells["OriginalBoundary"].Value))
                    {
                        sgp.OriginalBoundary = sgp.Boundary; 
                    }
                    else
                    {
                        sgp.OriginalBoundary = Convert.ToInt32(gridRow.Cells["OriginalBoundary"].Value, CultureInfo.CurrentUICulture); 
                    }
                    // End TT#2404 - JSmith - Questions on Store Grades in OTS Forecast Review
					sgp.WosIndex = Convert.ToInt32(gridRow.Cells["WOS Index"].Value, CultureInfo.CurrentUICulture);

					if (gridRow.Cells["Min Stock"].Text != string.Empty)
					{
						sgp.MinStock = Convert.ToInt32(gridRow.Cells["Min Stock"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.MinStock = Include.Undefined;
					}

					if (gridRow.Cells["Max Stock"].Text != string.Empty)
					{
						sgp.MaxStock = Convert.ToInt32(gridRow.Cells["Max Stock"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.MaxStock = Include.Undefined;
					}

					if (gridRow.Cells["Min Ad"].Text != string.Empty)
					{
						sgp.MinAd = Convert.ToInt32(gridRow.Cells["Min Ad"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.MinAd = Include.Undefined;
					}

					if (gridRow.Cells["Color Min"].Text != string.Empty)
					{
						sgp.MinColor = Convert.ToInt32(gridRow.Cells["Color Min"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.MinColor = Include.Undefined;
					}

					if (gridRow.Cells["Color Max"].Text != string.Empty)
					{
						sgp.MaxColor = Convert.ToInt32(gridRow.Cells["Color Max"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.MaxColor = Include.Undefined;
					}

					// BEGIN TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)
					if (gridRow.Cells["Ship Up To"].Text != string.Empty)
					{
						sgp.ShipUpTo = Convert.ToInt32(gridRow.Cells["Ship Up To"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						sgp.ShipUpTo = Include.Undefined;
					}
					// END TT#617 - AGallagher - Allocation Override - Ship Up To Rule (#36, #39)

					_storeGradeList.Add(sgp);

					++index;
				}

				// if all settings are undefined, delete entry so inheritance will be established
				if (deleteMinMaxValues)
				{
					foreach (StoreGradeProfile sgp in _storeGradeList)
					{
						sgp.MinMaxChangeType = eChangeType.delete;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private void UpdateSizeCurvesCriteriaData()
		{
			try
			{
				int key;
				SizeCurveCriteriaProfile sccp;

				_sizeCurveDefaultCriteriaProfile.DefaultRID = Include.NoRID;

				foreach (UltraGridRow row in this.ugSizeCurvesInheritedCriteria.Rows)
				{
					if ((bool)row.Cells["Updated"].Value)
					{
						_sizeCurveDefaultCriteriaProfile.DefaultChangeType = eChangeType.update;
					}

					if (Convert.ToBoolean(row.Cells["Default"].Value))
					{
						_sizeCurveDefaultCriteriaProfile.DefaultRID = Convert.ToInt32(row.Cells["CriteriaRID"].Value);
						_sizeCurveDefaultCriteriaProfile.DefaultRIDIsInherited = Convert.ToBoolean(row.Cells["DefaultIsInherited"].Value);
						_sizeCurveDefaultCriteriaProfile.DefaultRIDIsInheritedFromRID = Convert.ToInt32(row.Cells["DefaultIsInheritedFromRID"].Value);
					}
				}

				foreach (UltraGridRow row in this.ugSizeCurvesCriteria.Rows)
				{
					if ((bool)row.Cells["Updated"].Value)
					{
						key = (int)row.Cells["CriteriaRID"].Value;

						if (_sizeCurvesCriteriaList.Contains(key))
						{
							sccp = (SizeCurveCriteriaProfile)_sizeCurvesCriteriaList.FindKey(key);
							sccp.CriteriaChangeType = eChangeType.update;
							_sizeCurvesCriteriaList.Update(sccp);
						}
						else
						{
							sccp = new SizeCurveCriteriaProfile(key);
							sccp.CriteriaChangeType = eChangeType.add;
							_sizeCurvesCriteriaList.Add(sccp);
						}

						sccp.CriteriaSequence = Convert.ToInt32(row.Cells["Sequence"].Value);
						sccp.CriteriaLevelType = (eLowLevelsType)Convert.ToInt32(row.Cells["LevelType"].Value);
						sccp.CriteriaLevelRID = Convert.ToInt32(row.Cells["LevelRID"].Value);
						sccp.CriteriaLevelSequence = Convert.ToInt32(row.Cells["LevelSeq"].Value);
						sccp.CriteriaLevelOffset = Convert.ToInt32(row.Cells["LevelOff"].Value);
						sccp.CriteriaDateRID = Convert.ToInt32(row.Cells["DateRangeRID"].Value);
						sccp.CriteriaApplyLostSalesInd = Convert.ToBoolean(row.Cells["Lost Sales"].Value);
						sccp.CriteriaOLLRID = Convert.ToInt32(row.Cells["OLLRID"].Value);
						sccp.CriteriaCustomOLLRID = Convert.ToInt32(row.Cells["CustomOLLRID"].Value);
						sccp.CriteriaSizeGroupRID = Convert.ToInt32(row.Cells["SizeGroupRID"].Value);
						sccp.CriteriaCurveName = Convert.ToString(row.Cells["Curve Name"].Value);
						//Begin TT#1076 - JScott - Size Curves by Set
						sccp.CriteriaSgRID = Convert.ToInt32(row.Cells["SGRID"].Value);
						//End TT#1076 - JScott - Size Curves by Set

						_sizeCurveDefaultCriteriaProfile.DefaultChangeType = eChangeType.update;
					}

					if (Convert.ToBoolean(row.Cells["Default"].Value))
					{
						_sizeCurveDefaultCriteriaProfile.DefaultRID = Convert.ToInt32(row.Cells["CriteriaRID"].Value);
						_sizeCurveDefaultCriteriaProfile.DefaultRIDIsInherited = Convert.ToBoolean(row.Cells["DefaultIsInherited"].Value);
						_sizeCurveDefaultCriteriaProfile.DefaultRIDIsInheritedFromRID = Convert.ToInt32(row.Cells["DefaultIsInheritedFromRID"].Value);
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void UpdateSizeCurvesToleranceData()
		{
			MerchandiseLevelValueItem valueItem;

			try
			{
				if (SizeCurvesMinAvgToleranceChangesMade)
				{
					if (txtSCTMinimumAvgPerSize.Text.Length > 0)
					{
						_sizeCurveToleranceProfile.ToleranceMinAvg = Convert.ToDouble(this.txtSCTMinimumAvgPerSize.Text);
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceMinAvg = Include.Undefined;
					}
					_sizeCurveToleranceProfile.ToleranceMinAvgIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceMinAvgIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceMinAvg = Include.Undefined;
					}

				if (SizeCurvesHighLevelToleranceChangesMade)
				{
					if (Convert.ToInt32(cboSCTHighestLevel.SelectedValue) >= 0)
					{
						valueItem = (MerchandiseLevelValueItem)_sizeCurveToleranceLevelList[Convert.ToInt32(cboSCTHighestLevel.SelectedValue)];
						_sizeCurveToleranceProfile.ToleranceLevelType = valueItem.LevelType;
						_sizeCurveToleranceProfile.ToleranceLevelRID = valueItem.HierarchyRID;
						_sizeCurveToleranceProfile.ToleranceLevelSeq = valueItem.LevelRID;
						_sizeCurveToleranceProfile.ToleranceLevelOffset = valueItem.Offset;
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceLevelType = eLowLevelsType.None;
						_sizeCurveToleranceProfile.ToleranceLevelRID = Include.NoRID;
						_sizeCurveToleranceProfile.ToleranceLevelSeq = Include.Undefined;
						_sizeCurveToleranceProfile.ToleranceLevelOffset = Include.Undefined;
					}
					_sizeCurveToleranceProfile.ToleranceLevelIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceLevelIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceLevelType = eLowLevelsType.None;
						_sizeCurveToleranceProfile.ToleranceLevelRID = Include.NoRID;
						_sizeCurveToleranceProfile.ToleranceLevelSeq = Include.Undefined;
						_sizeCurveToleranceProfile.ToleranceLevelOffset = Include.Undefined;
					}

				if (SizeCurvesSalesToleranceChangesMade)
				{
					if (txtSCTSalesTolerance.Text.Length > 0)
					{
                        _sizeCurveToleranceProfile.ToleranceSalesTolerance = Convert.ToDouble(this.txtSCTSalesTolerance.Text);
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceSalesTolerance = Include.Undefined;
					}
					_sizeCurveToleranceProfile.ToleranceSalesToleranceIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceSalesToleranceIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceSalesTolerance = Include.Undefined;
					}

				if (SizeCurvesIndexToleranceChangesMade)
				{
					if (rdoSCTIndexToAverage.Checked)
					{
						_sizeCurveToleranceProfile.ToleranceIdxUnitsInd = eNodeChainSalesType.IndexToAverage;
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceIdxUnitsInd = eNodeChainSalesType.Units;
					}
					_sizeCurveToleranceProfile.ToleranceIdxUnitsIndIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceIdxUnitsIndIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceIdxUnitsInd = eNodeChainSalesType.None;
					}

				if (SizeCurvesMinPctToleranceChangesMade)
				{
					if (txtSCTMinimumPct.Text.Length > 0)
					{
                        _sizeCurveToleranceProfile.ToleranceMinTolerance = Convert.ToDouble(this.txtSCTMinimumPct.Text);
                        //Begin TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
                        cbxApplyMinToZeroTolerance.Enabled = true;
                        //End TT#2079 - DOConnell - Size - Minimum % Tolerance Calculation Issue
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceMinTolerance = Include.Undefined;
					}
					_sizeCurveToleranceProfile.ToleranceMinToleranceIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceMinToleranceIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceMinTolerance = Include.Undefined;
					}

				if (SizeCurvesMaxPctToleranceChangesMade)
				{
					if (txtSCTMaximumPct.Text.Length > 0)
					{
                        _sizeCurveToleranceProfile.ToleranceMaxTolerance = Convert.ToDouble(this.txtSCTMaximumPct.Text);
					}
					else
					{
						_sizeCurveToleranceProfile.ToleranceMaxTolerance = Include.Undefined;
					}
					_sizeCurveToleranceProfile.ToleranceMaxToleranceIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceMaxToleranceIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceMaxTolerance = Include.Undefined;
					}

				_sizeCurveToleranceProfile.ToleranceChangeType = eChangeType.update;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void UpdateSizeCurvesSimilarStoreData()
		{
			try
			{
				bool profileFound = false;
				int storeRID;
				SizeCurveSimilarStoreProfile scsp;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				string exceptionMessage = string.Empty;

				ugSizeCurvesSimilarStore.PerformAction(UltraGridAction.ExitEditMode);

				foreach (UltraGridRow setRow in this.ugSizeCurvesSimilarStore.Rows)
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach (UltraGridRow storeRow in ultraGridStoreBand.Rows)
					{
						if ((bool)storeRow.Cells["Updated"].Value)
						{
							storeRID = (int)storeRow.Cells["Store RID"].Value;
							if (_sizeCurveSimilarStoreList.Contains(storeRID))
							{
								scsp = (SizeCurveSimilarStoreProfile)_sizeCurveSimilarStoreList.FindKey(storeRID);
								profileFound = true;
							}
							else
							{
								scsp = new SizeCurveSimilarStoreProfile(storeRID);
								profileFound = false;
							}
							// set change type to update if found profile and something not inherited
							if (profileFound &&
								scsp.RecordExists)
							{
								scsp.SimilarStoreChangeType = eChangeType.update;
							}
							else
							{
								scsp.SimilarStoreChangeType = eChangeType.add;
							}

							// update similar store fields based on inheritance
							if (Convert.ToInt32(storeRow.Cells["Similar Store Inherited RID"].Value, CultureInfo.CurrentCulture) != Include.NoRID)
							{
								scsp.SimStoreRID = Include.NoRID;
								scsp.SimStoreUntilDateRangeRID = Include.NoRID;
								scsp.SimStoreIsInherited = false;
							}
							else
								if (storeRow.Cells["Similar Store"].Text.Length > 0 ||
								storeRow.Cells["Until"].Text.Length > 0)
							{
								scsp.SimStoreIsInherited = false;
								scsp.SimStoreInheritedFromNodeRID = Include.NoRID;
								if (Convert.ToBoolean(storeRow.Cells["Used Store Selector"].Value, CultureInfo.CurrentUICulture))
								{
									scsp.SimStoreRID = Convert.ToInt32(storeRow.Cells["SimilarStoreRID"].Value);
								}
								else
									if (Convert.ToBoolean(storeRow.Cells["Similar Store Changed"].Value, CultureInfo.CurrentUICulture))
									{
										if (storeRow.Cells["Similar Store"].Text.Length > 0)
										{
											bool simStoreError = false;
                                            StoreProfile sp = StoreMgmt.StoreProfile_Get(storeRow.Cells["Similar Store"].Text.Trim()); //_SAB.StoreServerSession.GetStoreProfile(storeRow.Cells["Similar Store"].Text.Trim());
											if (sp.ActiveInd)
											{
												if (sp.Key == Include.NoRID)
												{
													sp.Key = 1;
												}
												scsp.SimStoreRID = sp.Key;
											}
											else
											{
												simStoreError = true;
											}
											if (simStoreError)
											{
												MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_StoreNotFound), this.Text,
													MessageBoxButtons.OK, MessageBoxIcon.Error);
												ErrorFound = true;
											}
										}
										else
										{
											scsp.SimStoreRID = Include.NoRID;
										}
									}

								if (storeRow.Cells["Until"].Text != string.Empty)
								{
									try
									{
										scsp.SimStoreUntilDateRangeRID = Convert.ToInt32(storeRow.Cells["Until RID"].Value, CultureInfo.CurrentUICulture);
										scsp.SimStoreDisplayDate = storeRow.Cells["Until"].Text;
									}
									catch (Exception error)
									{
										exceptionMessage = error.Message + " " + _SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_MustBeNumeric);
										ErrorFound = true;
										ugSizeCurvesSimilarStore.ActiveCell = storeRow.Cells["Until RID"];
										break;
									}
								}
								else
								{
									scsp.SimStoreUntilDateRangeRID = Include.NoRID;
								}
							}
							else
							{
								scsp.SimStoreRID = Include.NoRID;
								scsp.SimStoreUntilDateRangeRID = Include.NoRID;
								scsp.SimStoreIsInherited = false;
								scsp.SimStoreInheritedFromNodeRID = Include.NoRID;
							}

							// alter change type if record does not contain any data needed to be saved
							if (scsp.SimStoreIsInherited == false &&
								scsp.SimStoreRID == Include.NoRID)
							{
								if (scsp.SimilarStoreChangeType == eChangeType.update)
								{
									scsp.SimilarStoreChangeType = eChangeType.delete;
								}
								else
									if (scsp.SimilarStoreChangeType == eChangeType.add)
									{
										scsp.SimilarStoreChangeType = eChangeType.none;
									}
							}

							if (!profileFound)
							{
								if (scsp.SimilarStoreChangeType != eChangeType.none)
								{
									_sizeCurveSimilarStoreList.Add(scsp);
								}
							}
							else
							{
								_sizeCurveSimilarStoreList.Update(scsp);
							}
						}
					}
					if (ugStoreEligibility.ActiveCell != null)
					{
						if (ErrorFound)
						{
							ugStoreEligibility.ActiveCell.Appearance.Image = ErrorImage;
							ugStoreEligibility.ActiveCell.Tag = exceptionMessage;
						}
						else
						{
							ugStoreEligibility.ActiveCell.Appearance.Image = null;
							ugStoreEligibility.ActiveCell.Tag = null;
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private void UpdateSizeOutOfStockData()
		{
			try
			{
				mcColorSizeByAttribute.UpdateData();

				if (SizeOutOfStockSizeGroupChangesMade)
				{
					if (cboSZOOSSizeGroup.SelectedValue != null)
					{
						_sizeOutOfStockProfile.SizeGrpRID = Convert.ToInt32(cboSZOOSSizeGroup.SelectedValue);
					}
					else
					{
						_sizeOutOfStockProfile.SizeGrpRID = Include.NoRID;
					}

					_sizeOutOfStockProfile.SizeGrpIsInherited = false;
				}
				else
					if (_sizeOutOfStockProfile.SizeGrpIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeOutOfStockProfile.SizeGrpRID = Include.NoRID;
					}

				if (SizeOutOfStockStoreGroupChangesMade)
				{
					if (Convert.ToInt32(cboSZOOSStoreAttribute.SelectedValue) >= 0)
					{
						_sizeOutOfStockProfile.StoreGrpRID = Convert.ToInt32(cboSZOOSStoreAttribute.SelectedValue);
					}
					else
					{
						_sizeOutOfStockProfile.StoreGrpRID = Include.NoRID;
					}

					_sizeOutOfStockProfile.StrGrpIsInherited = false;
				}
				else
					if (_sizeOutOfStockProfile.StrGrpIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeOutOfStockProfile.StoreGrpRID = Include.NoRID;
					}

				UnloadSizeOutOfStockDataSet();

				_sizeOutOfStockProfile.ChangeType = eChangeType.update;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		private void UnloadSizeOutOfStockDataSet()
		{
			try
			{
				_sizeOutOfStockProfile.dsValues.Tables["SetLevelValues"].Clear();
				
				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["SetLevel"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["SetLevelValues"].Rows.Add(row.ItemArray);
				}

				_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Clear();

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["AllColor"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["Color"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["AllColorSize"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["ColorSize"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["ColorSizeDimension"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}

				foreach (DataRow row in _sizeOutOfStockDataSet.Tables["AllColorSizeDimension"].Rows)
				{
					_sizeOutOfStockProfile.dsValues.Tables["ColorSizeValues"].Rows.Add(row.ItemArray);
				}
			}
			catch
			{
				throw;
			}
		}

		private void UpdateSizeSellThruData()
		{
			try
			{
				if (SizeSellThruChangesMade)
				{
					if (txtSSTLimit.Text.Length > 0)
					{
						_sizeSellThruProfile.SellThruLimit = Convert.ToSingle(this.txtSSTLimit.Text);
					}
					else
					{
						_sizeSellThruProfile.SellThruLimit = Include.Undefined;
					}
					_sizeSellThruProfile.SellThruLimitIsInherited = false;
				}
				else
					if (_sizeCurveToleranceProfile.ToleranceMinAvgIsInherited)	// if inherited, replace with Include.Undefined to maintain inheritence
					{
						_sizeCurveToleranceProfile.ToleranceMinAvg = Include.Undefined;
					}

				_sizeSellThruProfile.ChangeType = eChangeType.update;
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private void UpdateStockMinMaxData(int aSetRID)
		{
			try
			{
				NodeStockMinMaxProfile minMaxProfile = null;
				NodeStockMinMaxBoundaryProfile minMaxBoundaryProfile = null;
				int boundary, dateRangeRID, minimum, maximum;
				bool addSet = false;
				NodeStockMinMaxSetProfile minMaxSetProfile = (NodeStockMinMaxSetProfile) _nodeStockMinMaxesProfile.NodeSetList.FindKey(aSetRID);
				if (minMaxSetProfile == null)
				{
					minMaxSetProfile = new NodeStockMinMaxSetProfile(aSetRID);
					addSet = true;
				}
				else
				{
					minMaxSetProfile.Defaults.MinMaxList.Clear();
					minMaxSetProfile.BoundaryList.Clear();
				}

				foreach (UltraGridRow gridRow in ugStockMinMax.Rows)
				{
					boundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value);
					dateRangeRID = Include.UndefinedCalendarDateRange;
					if (gridRow.Cells["Minimum"].Text.Length > 0)
					{
						minimum = Convert.ToInt32(gridRow.Cells["Minimum"].Value);
					}
					else
					{
						minimum = int.MinValue;
					}
					if (gridRow.Cells["Maximum"].Text.Length > 0)
					{
						maximum = Convert.ToInt32(gridRow.Cells["Maximum"].Value);
					}
					else
					{
						maximum = int.MaxValue;
					}

					if (minimum != int.MinValue ||
						maximum != int.MaxValue)
					{
						_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.update;
						minMaxProfile = new NodeStockMinMaxProfile(dateRangeRID, minimum, maximum);

						if (boundary == Include.Undefined)
						{
							minMaxSetProfile.Defaults.MinMaxList.Add(minMaxProfile);
						}
						else
						{
							minMaxBoundaryProfile = new NodeStockMinMaxBoundaryProfile(boundary);
							minMaxBoundaryProfile.MinMaxList.Add(minMaxProfile);
							minMaxSetProfile.BoundaryList.Add(minMaxBoundaryProfile);
						}
					}

					if (gridRow.HasChild())
					{
						foreach (UltraGridRow childRow in gridRow.ChildBands[0].Rows)
						{
							boundary = Convert.ToInt32(childRow.Cells["Boundary"].Value);
							dateRangeRID = Convert.ToInt32(childRow.Cells["DateRangeRID"].Value);
							if (childRow.Cells["Minimum"].Text.Length > 0)
							{
								minimum = Convert.ToInt32(childRow.Cells["Minimum"].Value);
							}
							else
							{
								minimum = int.MinValue;
							}
							if (childRow.Cells["Maximum"].Text.Length > 0)
							{
								maximum = Convert.ToInt32(childRow.Cells["Maximum"].Value);
							}
							else
							{
								maximum = int.MaxValue;
							}

							if (minimum != int.MinValue ||
								maximum != int.MinValue)
							{
								minMaxProfile = new NodeStockMinMaxProfile(dateRangeRID, minimum, maximum);
								_nodeStockMinMaxesProfile.NodeStockMinMaxChangeType = eChangeType.update;
								if (boundary == Include.Undefined)
								{
									minMaxSetProfile.Defaults.MinMaxList.Add(minMaxProfile);
								}
								else
								{
									if (minMaxBoundaryProfile != null &&
										boundary != minMaxBoundaryProfile.Key)
									{
										minMaxBoundaryProfile = (NodeStockMinMaxBoundaryProfile)minMaxSetProfile.BoundaryList.FindKey(boundary);
									}
									if (minMaxBoundaryProfile == null)
									{
										minMaxBoundaryProfile = new NodeStockMinMaxBoundaryProfile(boundary);
										minMaxSetProfile.BoundaryList.Add(minMaxBoundaryProfile);
									}
									minMaxBoundaryProfile.MinMaxList.Add(minMaxProfile);
								}
							}
						}
					}
				}	
				if (addSet)
				{
					_nodeStockMinMaxesProfile.NodeSetList.Add(minMaxSetProfile);
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void UpdateCapacityData()
		{
			try
			{
				bool profileFound = false;
				bool valueFound = false;
				int storeRID;
				StoreCapacityProfile scp;

				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;

				foreach(  UltraGridRow setRow in this.ugStoreCapacity.Rows )
				{
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						if ((bool)storeRow.Cells["Updated"].Value)
						{
							storeRID = (int)storeRow.Cells["Store RID"].Value;
							if (_storeCapacityList.Contains(storeRID))
							{
								scp = (StoreCapacityProfile)_storeCapacityList.FindKey(storeRID);
								profileFound = true;
								if (scp.NewRecord || scp.StoreCapacityIsInherited)	// do not change type once set
								{
									scp.StoreCapacityChangeType = eChangeType.add;
									scp.StoreCapacityIsInherited = false;
								}
								else
								{
									scp.StoreCapacityChangeType = eChangeType.update;
								}
							}
							else
							{
								scp = new StoreCapacityProfile(storeRID);
								profileFound = false;
								scp.StoreCapacityChangeType = eChangeType.add; 
							}

                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //if (storeRow.Cells["Max Capacity"].Text.Length == 0 ||
                            //    (string)storeRow.Cells["Max Capacity"].Value == string.Empty)
                            if (Convert.IsDBNull(storeRow.Cells["Max Capacity"].Value))
                            //End TT#169
                            {
								valueFound = false;
								if (!scp.NewRecord)
								{
									scp.StoreCapacityChangeType = eChangeType.delete;
								}
							}
							else
							{
								valueFound = true;
								scp.StoreCapacity = Convert.ToInt32(storeRow.Cells["Max Capacity"].Value, CultureInfo.CurrentUICulture);
							}
					
							if (!profileFound)
							{
								if (valueFound)	// only add profile if there is a value
								{
									_storeCapacityList.Add(scp);
								}
							}
							else
							{
								if (scp.NewRecord && !valueFound)	// if it is a new record and the value deleted, remove record
								{
									_storeCapacityList.Remove(scp);
								}
								else
								{
									_storeCapacityList.Update(scp);
								}
							}
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void UpdateVelocityGradeData(ref EditMsgs em)
		{
			try
			{
				//Begin TT#505 - JScott - Velocity - Apply Min/Max
				//int index = 0;
				//// rebuild grades each time
				//_velocityGradeList.Clear();
				//this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				//this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);

				//foreach(  UltraGridRow gridRow in ugVelocityGrades.Rows )
				//{
				//    VelocityGradeProfile vgp = new VelocityGradeProfile(index);

				//    vgp.VelocityGradeChangeType = eChangeType.add;

				//    vgp.VelocityGrade = (string)gridRow.Cells["Grade"].Value;
				//    vgp.Boundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture);
				//    //				vgp.SellThruPct = Convert.ToInt32(gridRow.Cells["Sell Thru %"].Value);

				//    _velocityGradeList.Add(vgp);

				//    ++index;
				//}
				int index = 0;
				// rebuild grades each time
				_velocityGradeList.Clear();
				bool deleteMinMaxValues = true;
				this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugVelocityGrades.DisplayLayout.Bands[0].SortedColumns.Add("Boundary", true);
				foreach (UltraGridRow gridRow in ugVelocityGrades.Rows)
				{
					VelocityGradeProfile vgp = new VelocityGradeProfile(index);

					if (VelocityGradesChangesMade)
					{
						vgp.VelocityGradeChangeType = eChangeType.add;
						vgp.VelocityMinMaxChangeType = eChangeType.update;			// if change velocity grade, then update min/maxes
					}
					else
						if (VelocityMinMaxesChangesMade)
						{
							if (_velocityGradesInherited)
							{
								vgp.VelocityGradeIsInherited = true;
								vgp.VelocityMinMaxChangeType = eChangeType.add;	// if velocity grades don't exist, must add min/maxes
							}
							else
							{
								vgp.VelocityMinMaxChangeType = eChangeType.update;	// if velocity grades exist, then min/maxes are updated
							}
						}

					vgp.VelocityGrade = (string)gridRow.Cells["Grade"].Value;
					vgp.Boundary = Convert.ToInt32(gridRow.Cells["Boundary"].Value, CultureInfo.CurrentUICulture);

					if (gridRow.Cells["Min Stock"].Text != string.Empty)
					{
						vgp.VelocityMinStock = Convert.ToInt32(gridRow.Cells["Min Stock"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						vgp.VelocityMinStock = Include.Undefined;
					}

					if (gridRow.Cells["Max Stock"].Text != string.Empty)
					{
						vgp.VelocityMaxStock = Convert.ToInt32(gridRow.Cells["Max Stock"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						vgp.VelocityMaxStock = Include.Undefined;
					}

					if (gridRow.Cells["Min Ad"].Text != string.Empty)
					{
						vgp.VelocityMinAd = Convert.ToInt32(gridRow.Cells["Min Ad"].Value, CultureInfo.CurrentUICulture);
						deleteMinMaxValues = false;
					}
					else
					{
						vgp.VelocityMinAd = Include.Undefined;
					}

					_velocityGradeList.Add(vgp);

					++index;
				}

				// if all settings are undefined, delete entry so inheritance will be established
				if (deleteMinMaxValues)
				{
					foreach (VelocityGradeProfile vgp in _velocityGradeList)
					{
						vgp.VelocityMinMaxChangeType = eChangeType.delete;
					}
				}
				//End TT#505 - JScott - Velocity - Apply Min/Max
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void UpdateSellThruPctsData(ref EditMsgs em)
		{
			try
			{
				int index = 0;
				// rebuild grades each time
				_sellThruPctList.Clear();
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Clear();
				this.ugSellThruPcts.DisplayLayout.Bands[0].SortedColumns.Add("Sell Thru %", true);
			
				foreach(  UltraGridRow gridRow in ugSellThruPcts.Rows )
				{
					SellThruPctProfile stpp = new SellThruPctProfile(index);
				
					stpp.SellThruPctChangeType = eChangeType.add;
  
					stpp.SellThruPct = Convert.ToInt32(gridRow.Cells["Sell Thru %"].Value, CultureInfo.CurrentUICulture);
				
					_sellThruPctList.Add(stpp);

					++index;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void UpdateDailyPercentagesData()
		{
			try
			{
				bool profileFound = false;
				string errorMessage = null;
				int storeRID;
				Infragistics.Win.UltraWinGrid.UltraGridBand band;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreBand;
				Infragistics.Win.UltraWinGrid.UltraGridChildBand ultraGridStoreDateBand;
				StoreDailyPercentagesProfile sdpp;

				foreach(  UltraGridRow setRow in this.ugDailyPercentages.Rows )
				{
					band = setRow.Band;
					ultraGridStoreBand = setRow.ChildBands["Stores"];	// get "Stores" band
					foreach(  UltraGridRow storeRow in ultraGridStoreBand.Rows )
					{
						storeRID = (int)storeRow.Cells["Store RID"].Value;
						if (_storeDailyPercentagesList.Contains(storeRID))
						{
							sdpp = (StoreDailyPercentagesProfile)_storeDailyPercentagesList.FindKey(storeRID);
							profileFound = true;
						}
						else
						{
							sdpp = new StoreDailyPercentagesProfile(storeRID);
							sdpp.DailyPercentagesList = new DailyPercentagesList(eProfileType.StoreDailyPercentages);
							profileFound = false;
						}

						if ((bool)storeRow.Cells["Updated"].Value)
						{
							if (profileFound &&
								!sdpp.StoreDailyPercentagesIsInherited)
							{
								sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.update;  
							}
							else
							{
								sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.add; 
								sdpp.StoreDailyPercentagesIsInherited = false;
							}
	
							double convertedValue = 0;
							if (ValidDailyPercentageValue(storeRow.Cells["Total%"], ref errorMessage, ref convertedValue))
							{
								if (convertedValue > 0)
								{
									sdpp.HasDefaultValues = true;
								}
								else
								{
									sdpp.HasDefaultValues = false;
									if (sdpp.StoreDailyPercentagesDefaultChangeType == eChangeType.update)
									{
										sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.delete;
									}
                                    // Begin TT#2610 - JSmith - Daily %s delete date range
                                    else if (sdpp.StoreDailyPercentagesDefaultChangeType == eChangeType.add)
									{
										sdpp.StoreDailyPercentagesDefaultChangeType = eChangeType.none;
									}
                                    // End TT#2610 - JSmith - Daily %s delete date range
								}
							}
							if (sdpp.HasDefaultValues)
							{
                                //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                                //sdpp.Day1Default = ConvertPercentageValue(storeRow.Cells["Day1"].Text);
                                //sdpp.Day2Default = ConvertPercentageValue(storeRow.Cells["Day2"].Text);
                                //sdpp.Day3Default = ConvertPercentageValue(storeRow.Cells["Day3"].Text);
                                //sdpp.Day4Default = ConvertPercentageValue(storeRow.Cells["Day4"].Text);
                                //sdpp.Day5Default = ConvertPercentageValue(storeRow.Cells["Day5"].Text);
                                //sdpp.Day6Default = ConvertPercentageValue(storeRow.Cells["Day6"].Text);
                                //sdpp.Day7Default = ConvertPercentageValue(storeRow.Cells["Day7"].Text);
                                sdpp.Day1Default = ConvertPercentageValue(storeRow.Cells["Day1"].Value);
                                sdpp.Day2Default = ConvertPercentageValue(storeRow.Cells["Day2"].Value);
                                sdpp.Day3Default = ConvertPercentageValue(storeRow.Cells["Day3"].Value);
                                sdpp.Day4Default = ConvertPercentageValue(storeRow.Cells["Day4"].Value);
                                sdpp.Day5Default = ConvertPercentageValue(storeRow.Cells["Day5"].Value);
                                sdpp.Day6Default = ConvertPercentageValue(storeRow.Cells["Day6"].Value);
                                sdpp.Day7Default = ConvertPercentageValue(storeRow.Cells["Day7"].Value);
								//End TT#169
                            }
						}
                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        else
                        {
                            continue;
                        }
                        // End TT#2610 - JSmith - Daily %s delete date range

                        // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                        //sdpp.DailyPercentagesList.Clear();	// clear all date ranges from list
                        //foreach (DailyPercentagesProfile dpp in sdpp.DailyPercentagesList)
                        //{
                        //    dpp.DailyPercentagesChangeType = eChangeType.delete;
                        //}
                        //// End TT#2611 - JSmith - Clearing daily %s leaves a value

						ultraGridStoreDateBand = storeRow.ChildBands["StoreDates"];	// get "StoreDates" band
						foreach(  UltraGridRow storeDateRow in ultraGridStoreDateBand.Rows )
						{
							if (storeDateRow.Cells["DateRange"].Value == DBNull.Value)
							{
								continue;
							}

							DateRangeProfile DateRange = (DateRangeProfile)storeDateRow.Cells["DateRange"].Value;
                            // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                            //DailyPercentagesProfile dpp = new DailyPercentagesProfile(DateRange.Key);
                            DailyPercentagesProfile dpp = null;
                            bool newDateRange = false;
                            dpp = (DailyPercentagesProfile)sdpp.DailyPercentagesList.FindKey(DateRange.Key);
                            if (dpp == null)
                            {
                                dpp = new DailyPercentagesProfile(DateRange.Key);
                                newDateRange = true;
                            }
                            // End TT#2611 - JSmith - Clearing daily %s leaves a value
                            //BEGIN TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                            // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                            //if ((bool)storeRow.Cells["Updated"].Value)
                            //{
                            //    dpp.DailyPercentagesChangeType = eChangeType.add;
                            //}
                            //else
                            //{
                            //    dpp.DailyPercentagesChangeType = eChangeType.none;
                            //}
                            if (newDateRange)
                            {
                                dpp.DailyPercentagesChangeType = eChangeType.add;
                            }
                            else
                            {
                                dpp.DailyPercentagesChangeType = eChangeType.update;
                            }
                            // End TT#2611 - JSmith - Clearing daily %s leaves a value

                            dpp.DateRange = DateRange;

                            //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
                            //dpp.Day1 = ConvertPercentageValue(storeDateRow.Cells["Day1"].Text);
                            //dpp.Day2 = ConvertPercentageValue(storeDateRow.Cells["Day2"].Text);
                            //dpp.Day3 = ConvertPercentageValue(storeDateRow.Cells["Day3"].Text);
                            //dpp.Day4 = ConvertPercentageValue(storeDateRow.Cells["Day4"].Text);
                            //dpp.Day5 = ConvertPercentageValue(storeDateRow.Cells["Day5"].Text);
                            //dpp.Day6 = ConvertPercentageValue(storeDateRow.Cells["Day6"].Text);
                            //dpp.Day7 = ConvertPercentageValue(storeDateRow.Cells["Day7"].Text);
                            dpp.Day1 = ConvertPercentageValue(storeDateRow.Cells["Day1"].Value);
                            dpp.Day2 = ConvertPercentageValue(storeDateRow.Cells["Day2"].Value);
                            dpp.Day3 = ConvertPercentageValue(storeDateRow.Cells["Day3"].Value);
                            dpp.Day4 = ConvertPercentageValue(storeDateRow.Cells["Day4"].Value);
                            dpp.Day5 = ConvertPercentageValue(storeDateRow.Cells["Day5"].Value);
                            dpp.Day6 = ConvertPercentageValue(storeDateRow.Cells["Day6"].Value);
                            dpp.Day7 = ConvertPercentageValue(storeDateRow.Cells["Day7"].Value);
                            //End TT#169

                            //END TT#297 - MD - DOConnell - Daily %'s can be updated in Read Only mode
                            // Begin TT#2611 - JSmith - Clearing daily %s leaves a value
                            //sdpp.DailyPercentagesList.Add(dpp);
                            if (newDateRange)
                            {
                                sdpp.DailyPercentagesList.Add(dpp);
                            }
                            // End TT#2611 - JSmith - Clearing daily %s leaves a value
                        }

                        // Begin TT#2610 - JSmith - Daily %s delete date range
                        foreach (DailyPercentagesProfile dpp in sdpp.DailyPercentagesList)
                        {
                            if (dpp.DailyPercentagesChangeType == eChangeType.none)
                            {
                                dpp.DailyPercentagesChangeType = eChangeType.delete;
                            }
                        }
                        // End TT#2610 - JSmith - Daily %s delete date range

						if (!profileFound)
						{
							_storeDailyPercentagesList.Add(sdpp);
						}
						else
						{
							_storeDailyPercentagesList.Update(sdpp);
						}
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

        //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3
        private void UpdateChainSetPercentData()
        {
            try
            {
                bool profileFound = false;
                int storeRID = 0;
                int CDR_RID = 0;
                ChainSetPercentProfiles scp = null;
                if (ChainSetPercentChangesMade)
                {
                    foreach (UltraGridRow setRow in this.ugChainSetPercent.Rows)
                    {
                        for (int r = 0; r < setRow.Cells.Count; ++r)
                        {
                            string name = Convert.ToString(setRow.Cells[r].Column);
                            if (name.Contains("Updated"))
                            {
                                if (bool.TryParse(Convert.ToString(setRow.Cells[r].Value), out profileFound))
                                    if (profileFound)
                                    {

                                        if (Int32.TryParse(Convert.ToString(setRow.Cells[r - 4].Value), out storeRID))
                                            scp = (ChainSetPercentProfiles)_chainSetPercentList.FindKey(storeRID);
                                        if (Int32.TryParse(Convert.ToString(setRow.Cells[r - 1].Value), out CDR_RID))

                                            if (_chainSetPercentList.ArrayList.Count > 0)
                                            {
                                                foreach (ChainSetPercentProfiles cspp in _chainSetPercentList)
                                                {
                                                    if ((cspp.StoreGroupLevelRID == storeRID) && (cspp.TimeID == CDR_RID))
                                                    {

                                                        profileFound = true;
                                                        if (cspp.NewRecord || !cspp.ChainSetPercentIsInherited)	// do not change type once set
                                                        {
                                                            cspp.ChainSetPercentChangeType = eChangeType.update;
                                                            cspp.ChainSetPercentIsInherited = false;
                                                        }
                                                        else
                                                        {
                                                            cspp.ChainSetPercentChangeType = eChangeType.add;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        profileFound = false;
                                                        //cspp2.ChainSetPercentChangeType = eChangeType.add;
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                int yearWeek = CDR_RID;
                                                int storeGroupRID = Convert.ToInt32(setRow.Cells[r - 4].Value);
                                                // Begin TT#1719 - JSmith - Chain Set Pct:  System Overflow exception in Node Properties
                                                //int yearWeekKey = Convert.ToInt32(Convert.ToString(CDR_RID) + Convert.ToString(storeGroupRID));
                                                int yearWeekKey = Convert.ToInt32(Convert.ToString(CDR_RID - 200000) + Convert.ToString(storeGroupRID));
                                                // End TT#1719
                                                scp = new ChainSetPercentProfiles(yearWeekKey);
                                                scp.TimeID = CDR_RID;
                                                scp.NodeRID = _hnp.Key;

                                                StoreGroupListViewProfile storeGroup = (StoreGroupListViewProfile)_sizeCurvesSimilarStoreGroupList.FindKey(_groupRID);
                                                scp.StoreGroupID = storeGroup.GroupId;
                                                scp.StoreGroupRID = _groupRID;
                                                scp.StoreGroupVersion = StoreMgmt.StoreGroup_GetVersion(scp.StoreGroupRID);  // TT#1935-MD - JSmith - SVC - Node Properties- Chain Set Percent - Select Str Attribute, Date Range and type in % by week.  Select the Apply button and receive a DB Error.
                                                scp.StoreGroupLevelID = Convert.ToString(setRow.Cells[0].Value);
                                                scp.StoreGroupLevelRID = storeGroupRID;

                                                decimal pctValue;
                                                if (decimal.TryParse(Convert.ToString(setRow.Cells[r - 5].Value), out pctValue))
                                                    scp.ChainSetPercent = pctValue;
                                                scp.NewRecord = true;

                                                _chainSetPercentList.Add(scp);

                                            }
                                    }
                            }
                        }
                    }
                    UpdateChainSetPercentProfiles(0, 0);
                }

                ChainSetPercent_Populate(false);
            }
            catch (Exception exception)
            {
                HandleException(exception);
            }
        }
        //End TT#1498 - DOConnell - Chain Plan - Set Percentages Phase 3

		private void UpdateCharacteristicsData()
		{
			try
			{
				int valueRID;
				int groupRID;
				string value;
				NodeCharProfile ncp;
				_nodeCharProfileList.Clear();
				foreach (UltraGridRow characteristicRow in this.ugCharacteristics.Rows)
				{
					if (!(bool)characteristicRow.Cells["Inherited"].Value)
					{
						valueRID = Convert.ToInt32(characteristicRow.Cells["Value RID"].Value, CultureInfo.CurrentCulture);
						if (valueRID > 0)
						{
							groupRID = Convert.ToInt32(characteristicRow.Cells["Group RID"].Value, CultureInfo.CurrentCulture);
							value = Convert.ToString(characteristicRow.Cells["Value"].Text, CultureInfo.CurrentCulture);
							ncp = new NodeCharProfile(groupRID);
							ncp.ProductCharValueRID = valueRID;
							ncp.ProductCharValue = value;
							ncp.ProductCharChangeType = eChangeType.add;
							_nodeCharProfileList.Add(ncp);
						}
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

        //Begin TT#169 - JSmith - enter max of 1000 and receive 'must be integer'
        //private double ConvertPercentageValue(string aCellValue)
        //{
        //    if (aCellValue != null &&
        //        aCellValue.Length > 0)
        //    {
        //        return Convert.ToDouble(aCellValue, CultureInfo.CurrentUICulture);
        //    }
        //    else
        //    {
        //        return 0;
        //    }
        //}
        private double ConvertPercentageValue(object aCellValue)
        {
		//Begin TT#1716 - DOConnell - Daily Percentages error when not all days have values
            double retVal = 0.0;
            // Begin TT#2191 - JSmith - Daily Percentages not saving
            //if (aCellValue != null)
            //{
            //                    //return Convert.ToDouble(aCellValue, CultureInfo.CurrentUICulture);

            //    int dayVal;
            //    if (Int32.TryParse(Convert.ToString(aCellValue), out dayVal))
            //    {
            //        retVal = Convert.ToDouble(aCellValue, CultureInfo.CurrentUICulture);

            //    }
            //    //End TT#1716 - DOConnell - Daily Percentages error when not all days have values
            //}
            if (aCellValue != null &&
                aCellValue != System.DBNull.Value)
            {
                return Convert.ToDouble(aCellValue, CultureInfo.CurrentUICulture);
           }
            // End TT#2191
            return retVal;
        }
        //End TT#169

		private void tabStoreGrades_Click(object sender, System.EventArgs e)
		{
			
		}

        private void tabNodeProperties_SelectedIndexChanged(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				EditMsgs em = new EditMsgs();
				if (tabNodeProperties.SelectedTab != null &&
					tabNodeProperties.SelectedTab.Name != _currentTabPage.Name)
				{
					switch (_currentTabPage.Name)
					{
						case "tabProfile":
							break;
						case "tabStoreEligibility":
							if (EligibilityChangesMade)
							{
								if (!ValidTabStoreEligibility(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabStoreEligibility;
								}
							}
							break;
						case "tabStoreGrades":
							if (StoreGradesChangesMade || MinMaxesChangesMade)
							{
								if (!ValidTabStoreGrades(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabStoreGrades;
								}
							}
							break;
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						case "tabSizeCurves":
							switch (tabSizeCurvesProperties.SelectedTab.Name)
							{
								case "tabSizeCurvesCriteria" :

									if (SizeCurvesCriteriaChangesMade)
									{
										if (!ValidTabSizeCurveCriteria(ref em))
										{
											DoValueByValueEdits = true;
											this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
											this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesCriteria;
										}
									}
									break;

								case "tabSizeCurvesTolerance":

									if (SizeCurvesToleranceChangesMade)
									{
										if (!ValidTabSizeCurveTolerance(ref em))
										{
											DoValueByValueEdits = true;
											this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
											this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesTolerance;
										}
									}
									break;

								case "tabSizeCurvesSimilarStore":

									if (SizeCurvesSimilarStoreChangesMade)
									{
										if (!ValidTabSizeCurvesSimilarStore(ref em))
										{
										    DoValueByValueEdits = true;
										    this.tabNodeProperties.SelectedTab = this.tabSizeCurves;
										    this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesSimilarStore;
										}
									}
									break;
							}
							break;
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						case "tabSizeOutOfStock":
							switch (tabSizeOutOfStockProperties.SelectedTab.Name)
							{
								case "tabSizeOutOfStockParms":

									if (SizeOutOfStockChangesMade)
									{
										if (!ValidTabSizeOutOfStock(ref em))
										{
											DoValueByValueEdits = true;
											this.tabNodeProperties.SelectedTab = this.tabSizeOutOfStock;
											this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeOutOfStockParms;
										}
									}
									break;

								case "tabSizeSellThru":

									if (SizeSellThruChangesMade)
									{
										if (!ValidTabSizeSellThru(ref em))
										{
											DoValueByValueEdits = true;
											this.tabNodeProperties.SelectedTab = this.tabSizeOutOfStock;
											this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeSellThru;
										}
									}
									break;
							}
							break;
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
						case "tabStockMinMax":
							if (StockMinMaxChangesMade)
							{
								if (!ValidTabStockMinMax(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabStockMinMax;
								}
							}
							break;
						case "tabStoreCapacity":
							if (StoreCapacityChangesMade)
							{
								if (!ValidTabStoreCapacity(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabStoreCapacity;
								}
							}
							break;
						case "tabVelocityGrades":
							//Begin TT#505 - JScott - Velocity - Apply Min/Max
							//if (VelocityGradesChangesMade || SellThruPctsChangesMade)
							if (VelocityGradesChangesMade || VelocityMinMaxesChangesMade || SellThruPctsChangesMade)
							//End TT#505 - JScott - Velocity - Apply Min/Max
							{
								if (!ValidTabVelocityGrades(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabVelocityGrades;
								}
							}
							break;
						case "tabPurgeCriteria":
							if (PurgeChangesMade)
							{
								if (!ValidTabPurgeCriteria(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabPurgeCriteria;
								}
							}
							break;
						case "tabDailyPercentages":
							if (DailyPercentagesChangesMade)
							{
								if (!ValidTabDailyPercentages(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabDailyPercentages;
								}
							}
							break;
						case "tabCharacteristics":
							if (CharacteristicsChangesMade)
							{
								if (!ValidTabCharacteristics(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabCharacteristics;
								}
							}
							break;
                        //Begin TT#1401 - GRT - Reservation Stores
                        case "tabReservation":
                            if (ReservationChangesMade)
                            {
                                if (!ValidTabReservation(ref em))
                                {
                                    DoValueByValueEdits = true;
                                    this.tabNodeProperties.SelectedTab = this.tabReservation;
                                }
                            }
                            break;
                        //End TT#1401 - GRT - Reservation Stores
					}
				}

				if (em.EditMessages.Count > 0)
				{
					_errors = null;
					for (int i=0; i<em.EditMessages.Count; i++)
					{
						EditMsgs.Message emm = (EditMsgs.Message) em.EditMessages[i];
						AddErrorMessage(emm);
					}
					MessageBox.Show (_errors,  this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					DoValueByValueEdits = false;
					if (tabNodeProperties.SelectedTab != null)
					{
						_currentTabPage = this.tabNodeProperties.SelectedTab;
					}
					switch (_currentTabPage.Name)
					{
						case "tabStoreEligibility":
							if (!_eligibilityIsPopulated)
							{
								StoreEligibilityTab_Load();
							}
							break;
						case "tabStoreGrades":
							if (!_storeGradesIsPopulated)
							{
								StoreGradesTab_Load();
							}
							break;
						//Begin TT#155 - JScott - Add Size Curve info to Node Properties
						case "tabSizeCurves":
							switch (tabSizeCurvesProperties.SelectedTab.Name)
							{
								case "tabSizeCurvesCriteria":

									if (!_sizeCurvesInheritedCriteriaIsPopulated || !_sizeCurvesCriteriaIsPopulated)
									{
										SizeCurvesCriteriaTab_Load();
									}
									break;

								case "tabSizeCurvesTolerance":

									if (!_sizeCurvesToleranceIsPopulated)
									{
									    SizeCurvesToleranceTab_Load();
									}
									break;

								case "tabSizeCurvesSimilarStore":

									if (!_sizeCurvesSimilarStoreIsPopulated)
									{
										SizeCurvesSimilarStoreTab_Load();
									}
									break;
							}
							break;
						//End TT#155 - JScott - Add Size Curve info to Node Properties
						//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
						case "tabSizeOutOfStock":
							switch (tabSizeOutOfStockProperties.SelectedTab.Name)
							{
								case "tabSizeOutOfStockParms":

									if (!_sizeOutOfStockIsPopulated)
									{
										SizeOutOfStockTab_Load();
									}
									break;

								case "tabSizeSellThru":

									if (!_sizeSellThruIsPopulated)
									{
										SizeSellThruTab_Load();
									}
									break;
							}
							break;
						//End TT#483 - JScott - Add Size Lost Sales criteria and processing
						case "tabStockMinMax":
							if (!_stockMinMaxIsPopulated)
							{
								StockMinMaxTab_Load();
							}
							break;
						case "tabStoreCapacity":
							if (!_storeCapacityIsPopulated)
							{
								StoreCapacityTab_Load();
							}
							break;
                        //Begin TT#1401 - Reservation Stores
                        case "tabReservation":
                            if (!_reservationIsPopulated)
                            {
                                ReservationTab_Load();
                            }
                            break;
                        //End TT#1401 - Reservation Stores
						case "tabVelocityGrades":
							if (!_velocityGradesIsPopulated)
							{
								VelocityGradesTab_Load();
							}
							break;
						case "tabPurgeCriteria":
							if (!_purgeCriteriaIsPopulated)
							{
								PurgeCriteriaTab_Load();
							}
							break;
						case "tabDailyPercentages":
							if (!_dailyPercentagesIsPopulated)
							{
								DailyPercentagesTab_Load();
							}
							break;
						case "tabCharacteristics":
							if (!_characteristicsIsPopulated)
							{
								CharacteristicsTab_Load();
							}
							break;

                        case "tabChainSetPct":
                            if (!_chainSetPercentIsPopulated)
                            {
                                ChainSetPctsTab_Load();
                            }
                            break;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private void tabSizeCurvesProperties_SelectedIndexChanged(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				EditMsgs em = new EditMsgs();
				if (tabSizeCurvesProperties.SelectedTab != null &&
					tabSizeCurvesProperties.SelectedTab.Name != _currentSizeCurveTabPage.Name)
				{
					switch (_currentSizeCurveTabPage.Name)
					{
						case "tabSizeCurvesCriteria":

							if (SizeCurvesCriteriaChangesMade)
							{
								if (!ValidTabSizeCurveCriteria(ref em))
								{
									DoValueByValueEdits = true;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurves;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesCriteria;
								}
							}
							break;

						case "tabSizeCurvesTolerance":

							if (SizeCurvesToleranceChangesMade)
							{
								if (!ValidTabSizeCurveTolerance(ref em))
								{
									DoValueByValueEdits = true;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurves;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesTolerance;
								}
							}
							break;

						case "tabSizeCurvesSimilarStore":

							if (SizeCurvesSimilarStoreChangesMade)
							{
								if (!ValidTabSizeCurvesSimilarStore(ref em))
								{
									DoValueByValueEdits = true;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurves;
									this.tabSizeCurvesProperties.SelectedTab = this.tabSizeCurvesSimilarStore;
								}
							}
							break;
					}
				}

				if (em.EditMessages.Count > 0)
				{
					_errors = null;
					for (int i = 0; i < em.EditMessages.Count; i++)
					{
						EditMsgs.Message emm = (EditMsgs.Message)em.EditMessages[i];
						AddErrorMessage(emm);
					}
					MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					DoValueByValueEdits = false;
					if (tabSizeCurvesProperties.SelectedTab != null)
					{
						_currentSizeCurveTabPage = this.tabSizeCurvesProperties.SelectedTab;
					}
					switch (_currentSizeCurveTabPage.Name)
					{
						case "tabSizeCurvesCriteria":

							if (!_sizeCurvesInheritedCriteriaIsPopulated || !_sizeCurvesCriteriaIsPopulated)
							{
								SizeCurvesCriteriaTab_Load();
							}
							break;

						case "tabSizeCurvesTolerance":

							if (!_sizeCurvesToleranceIsPopulated)
							{
								SizeCurvesToleranceTab_Load();
							}
							break;

						case "tabSizeCurvesSimilarStore":

							if (!_sizeCurvesSimilarStoreIsPopulated)
							{
								SizeCurvesSimilarStoreTab_Load();
							}
							break;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}
	
		//End TT#155 - JScott - Add Size Curve info to Node Properties
		//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
		private void tabSizeOutOfStockProperties_SelectedIndexChanged(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				EditMsgs em = new EditMsgs();
				if (tabSizeOutOfStockProperties.SelectedTab != null &&
					tabSizeOutOfStockProperties.SelectedTab.Name != _currentSizeOutOfStockTabPage.Name)
				{
					switch (_currentSizeOutOfStockTabPage.Name)
					{
						case "tabSizeOutOfStockParms":

							if (SizeOutOfStockChangesMade)
							{
								if (!ValidTabSizeOutOfStock(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabSizeOutOfStock;
									this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeOutOfStockParms;
								}
							}
							break;

						case "tabSizeSellThru":

							if (SizeSellThruChangesMade)
							{
								if (!ValidTabSizeSellThru(ref em))
								{
									DoValueByValueEdits = true;
									this.tabNodeProperties.SelectedTab = this.tabSizeSellThru;
									this.tabSizeOutOfStockProperties.SelectedTab = this.tabSizeSellThru;
								}
							}
							break;
					}
				}

				if (em.EditMessages.Count > 0)
				{
					_errors = null;
					for (int i = 0; i < em.EditMessages.Count; i++)
					{
						EditMsgs.Message emm = (EditMsgs.Message)em.EditMessages[i];
						AddErrorMessage(emm);
					}
					MessageBox.Show(_errors, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
				}
				else
				{
					DoValueByValueEdits = false;
					if (tabSizeOutOfStockProperties.SelectedTab != null)
					{
						_currentSizeOutOfStockTabPage = this.tabSizeOutOfStockProperties.SelectedTab;
					}
					switch (_currentSizeOutOfStockTabPage.Name)
					{
						case "tabSizeOutOfStockParms":

							if (!_sizeOutOfStockIsPopulated)
							{
								SizeOutOfStockTab_Load();
							}
							break;

						case "tabSizeSellThru":

							if (!_sizeSellThruIsPopulated)
							{
								SizeSellThruTab_Load();
							}
							break;
					}
				}
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		//End TT#483 - JScott - Add Size Lost Sales criteria and processing
		private void txtNodeName_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void txtNodeName_DragOver(object sender, DragEventArgs e)
		{
			Image_DragOver(sender, e);
		}

		private void txtNodeName_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList;
            HierarchyNodeClipboardList hnList;
            MIDHierarchyNode node;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityNodes.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        node = (MIDHierarchyNode) cbList.ClipboardProfile.Node;
                        InitializeForm(node.HierarchyRID, ((MIDHierarchyNode)node.Parent).NodeRID, cbList.ClipboardProfile.Key,
                            node.Profile.ProfileType);
                    }
                }
                else if (e.Data.GetDataPresent(typeof(HierarchyNodeClipboardList)))
                {
                    hnList = (HierarchyNodeClipboardList)e.Data.GetData(typeof(HierarchyNodeClipboardList));
                    if (_securityNodes.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        InitializeForm(hnList.ClipboardProfile.HierarchyRID, hnList.ClipboardProfile.ParentRID,
                            hnList.ClipboardProfile.Key, hnList.ClipboardProfile.NodeType);
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void MIDcbxSEShowUsingGroupLevel_Load(object sender, System.EventArgs e)
		{
		
		}
			
		private void mnuFind_Click(object sender, System.EventArgs e)
		{
			try
			{
				if ( this._gridCol == null ) { return; }

				if ( this._frmUltraGridSearchReplace == null ) 
				{
					this._frmUltraGridSearchReplace = new frmUltraGridSearchReplace(_SAB, false);
				}

				if (this.ugStoreEligibility.Visible == true)
				{
					if (this.ugStoreEligibility.ActiveRow == null)
					{
						ugStoreEligibility.ActiveRow = ugStoreEligibility.Rows[0];
					}
					else
						if (ugStoreEligibility.ActiveRow.Band.Key != _gridBand.Key)
					{
						if (ugStoreEligibility.ActiveRow.Band.Key == "Sets")		
						{
							ugStoreEligibility.ActiveRow = ugStoreEligibility.ActiveRow.GetChild(ChildRow.First);
						}
						else
							if (ugStoreEligibility.ActiveRow.Band.Key == "Stores")		
						{
							ugStoreEligibility.ActiveRow = ugStoreEligibility.Rows[0];
						}
					}

					if (this.ugStoreEligibility.ActiveRow == null)
					{
						MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NeedSearchRow),
							this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
					else
						if (this.ugStoreEligibility.ActiveRow.Band.Columns.Exists(_gridCol.Key) )
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugStoreEligibility, _gridCol, _gridBand);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
				else
					if (this.ugStoreGrades.Visible == true)
				{
					if (this.ugStoreGrades.ActiveRow == null)
					{
						ugStoreGrades.ActiveRow = ugStoreGrades.Rows[0];
					}
					else
						if (this.ugStoreGrades.ActiveRow.Band.Columns.Exists(_gridCol.Key) )
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugStoreGrades, _gridCol.Key);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				else
					if (this.ugSizeCurvesSimilarStore.Visible == true)
				{
					if (this.ugSizeCurvesSimilarStore.ActiveRow == null)
					{
						ugSizeCurvesSimilarStore.ActiveRow = ugSizeCurvesSimilarStore.Rows[0];
					}
					else
						if (ugSizeCurvesSimilarStore.ActiveRow.Band.Key != _gridBand.Key)
					{
						if (ugSizeCurvesSimilarStore.ActiveRow.Band.Key == "Sets")		
						{
							ugSizeCurvesSimilarStore.ActiveRow = ugSizeCurvesSimilarStore.ActiveRow.GetChild(ChildRow.First);
						}
						else
							if (ugSizeCurvesSimilarStore.ActiveRow.Band.Key == "Stores")		
						{
							ugSizeCurvesSimilarStore.ActiveRow = ugSizeCurvesSimilarStore.Rows[0];
						}
					}

					if (this.ugSizeCurvesSimilarStore.ActiveRow == null)
					{
						MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NeedSearchRow),
							this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
					else
						if (this.ugSizeCurvesSimilarStore.ActiveRow.Band.Columns.Exists(_gridCol.Key))
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugSizeCurvesSimilarStore, _gridCol, _gridBand);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties
				else
					if (this.ugVelocityGrades.Visible == true)
				{
					if (this.ugVelocityGrades.ActiveRow == null)
					{
						ugVelocityGrades.ActiveRow = ugVelocityGrades.Rows[0];
					}
					else
						if (this.ugVelocityGrades.ActiveRow.Band.Columns.Exists(_gridCol.Key) )
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugVelocityGrades, _gridCol.Key);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
				else
					if (this.ugStoreCapacity.Visible == true)
				{
					// set the active row if not in band being searched
					if (this.ugStoreCapacity.ActiveRow == null)
					{
						ugStoreCapacity.ActiveRow = ugStoreCapacity.Rows[0];
					}
					else
						if (ugStoreCapacity.ActiveRow.Band.Key != _gridBand.Key)
					{
						if (ugStoreCapacity.ActiveRow.Band.Key == "Sets")		
						{
							ugStoreCapacity.ActiveRow = ugStoreCapacity.ActiveRow.GetChild(ChildRow.First);
						}
						else
							if (ugStoreCapacity.ActiveRow.Band.Key == "Stores")		
						{
							ugStoreCapacity.ActiveRow = ugStoreCapacity.Rows[0];
						}
					}
					if (this.ugStoreCapacity.ActiveRow == null)
					{
						MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NeedSearchRow),
							this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
					else
						if (this.ugStoreCapacity.ActiveRow.Band.Columns.Exists(_gridCol.Key) )
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugStoreCapacity, _gridCol, _gridBand);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
				else
					if (this.ugDailyPercentages.Visible == true)
				{
					if (this.ugDailyPercentages.ActiveRow == null)
					{
						ugDailyPercentages.ActiveRow = ugDailyPercentages.Rows[0];
					}
					else
						if (this.ugDailyPercentages.ActiveRow.Band.Columns.Exists(_gridCol.Key) )
					{
						this._frmUltraGridSearchReplace.ShowSearchReplace(this.ugDailyPercentages, _gridCol, _gridBand);
					}
					else
					{
						string message = (_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_SearchColumnNotFound));
						message = message.Replace("{0}", _gridCol.Key);
						MessageBox.Show(message, this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void mnuSortAsc_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (this.ugStoreEligibility.Visible == true)
				{
					this.ugStoreEligibility.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				else
					if (this.ugStoreGrades.Visible == true)
				{
					this.ugStoreGrades.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				else
					if (this.ugVelocityGrades.Visible == true)
				{
					this.ugVelocityGrades.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				else
					if (this.ugStoreCapacity.Visible == true)
				{
					this.ugStoreCapacity.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				else
					if (this.ugDailyPercentages.Visible == true)
				{
					this.ugDailyPercentages.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				else
					if (this.ugSizeCurvesInheritedCriteria.Visible == true ||
						this.ugSizeCurvesCriteria.Visible == true ||
						this.ugSizeCurvesSimilarStore.Visible == true)
				{
					_gridBand.SortedColumns.Clear();
					_gridBand.SortedColumns.Add(this._gridCol, false);
				}
				else
					if (this.ugSizeCurvesSimilarStore.Visible == true)
				{
					this.ugSizeCurvesSimilarStore.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties
                //Begin TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
                else
                    if (this.ugChainSetPercent.Visible == true)
                    {
                        this.ugChainSetPercent.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Clear();    //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                        this.ugChainSetPercent.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, false);
                    }
                //End TT#1498 - DOConnell - Chain Plan - Set Percentages - Phase 3
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		private void mnuSortDesc_Click(object sender, System.EventArgs e)
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				if (this.ugStoreEligibility.Visible == true)
				{
					this.ugStoreEligibility.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				else
					if (this.ugStoreGrades.Visible == true)
				{
					this.ugStoreGrades.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				else
					if (this.ugVelocityGrades.Visible == true)
				{
					this.ugVelocityGrades.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				else
					if (this.ugStoreCapacity.Visible == true)
				{
					this.ugStoreCapacity.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				else
					if (this.ugDailyPercentages.Visible == true)
				{
					this.ugDailyPercentages.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				else
					if (this.ugSizeCurvesInheritedCriteria.Visible == true ||
						this.ugSizeCurvesCriteria.Visible == true ||
						this.ugSizeCurvesSimilarStore.Visible == true)
				{
					_gridBand.SortedColumns.Clear();
					_gridBand.SortedColumns.Add(this._gridCol, true);
				}
				else
					if (this.ugSizeCurvesSimilarStore.Visible == true)
				{
					this.ugSizeCurvesSimilarStore.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
				}
				//End TT#155 - JScott - Add Size Curve info to Node Properties
            //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
                else
                    if (this.ugChainSetPercent.Visible == true)
                    {
                        this.ugChainSetPercent.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Clear();
                        this.ugChainSetPercent.DisplayLayout.Bands[_gridCol.Band.Key].SortedColumns.Add(this._gridCol, true);
                    }
            //TT#456 - MD - NodeProperties - ChainSet function errors - rbeck 
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}
											
		private void frmNodeProperties_Load(object sender, System.EventArgs e)
		{
            // Begin TT#2138 - JSmith - Open Node Properties Read Only
            //btnApply.Enabled = false;
            // End TT#2138
			//this.Dock = DockStyle.Fill;  // TT#505 - AGallagher - Velocity - Apply Min/Max (#58)
		}
			
		private void tabNodeProperties_Click(object sender, System.EventArgs e)
		{
		}

		private void ugStoreEligibility_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList;
            HierarchyNodeClipboardList hnList;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityEligibility.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        _storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, cbList.ClipboardProfile.Key, true, true);
                        StoreEligibility_Populate(true);
                        EligibilityChangesMade = true;
                        _eligibilityIsCopied = true;
                    }
                }
                else if (e.Data.GetDataPresent(typeof(HierarchyNodeClipboardList)))
                {
                    hnList = (HierarchyNodeClipboardList)e.Data.GetData(typeof(HierarchyNodeClipboardList));
                    if (_securityEligibility.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        _storeEligList = _SAB.HierarchyServerSession.GetStoreEligibilityList(_storeList, hnList.ClipboardProfile.Key, true, true);
                        StoreEligibility_Populate(true);
                        EligibilityChangesMade = true;
                        _eligibilityIsCopied = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreEligibility_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		private void ugSizeCurvesSimilarStore_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
		}

		private void ugSizeCurvesSimilarStore_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch (Exception exception)
			{
				HandleException(exception);
			}
		}

		//End TT#155 - JScott - Add Size Curve info to Node Properties
		private void ugStoreGrades_DragDrop(object sender, System.Windows.Forms.DragEventArgs e)
		{
            TreeNodeClipboardList cbList;
            HierarchyNodeClipboardList hnList;
			try
			{
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    cbList = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    if (_securityStoreGrades.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        StoreGrades_Populate(cbList.ClipboardProfile.Key, true);
                        StoreGradesChangesMade = true;
                        MinMaxesChangesMade = true;
                    }
                }
                else if (e.Data.GetDataPresent(typeof(HierarchyNodeClipboardList)))
                {
                    hnList = (HierarchyNodeClipboardList)e.Data.GetData(typeof(HierarchyNodeClipboardList));
                    if (_securityStoreGrades.IsReadOnly)
                    {
                        MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_NotAuthorized));

                    }
                    else
                    {
                        StoreGrades_Populate(hnList.ClipboardProfile.Key, true);
                        StoreGradesChangesMade = true;
                        MinMaxesChangesMade = true;
                    }
                }
			}
			catch (BadDataInClipboardException)
			{
				MessageBox.Show(_SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard),
					this.Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void ugStoreGrades_DragEnter(object sender, System.Windows.Forms.DragEventArgs e)
		{
			try
			{
				Image_DragEnter(sender, e);
				ObjectDragEnter(e);
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		override protected void BeforeClosing()
		{
			try
			{
				InfragisticsLayoutData layoutData = new InfragisticsLayoutData();
				if (_eligibilityGridBuilt && _securityEligibility.AllowUpdate)
				{
					if (!ugStoreEligibility.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.eligibilityGrid, ugStoreEligibility);
					}
				}

				if (_storeGradesGridBuilt && _securityStoreGrades.AllowUpdate)
				{
					if (!ugStoreGrades.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.storeGradeGrid, ugStoreGrades);
					}
				}

				//Begin TT#155 - JScott - Add Size Curve info to Node Properties
				if (_sizeCurvesInheritedCriteriaGridBuilt && _securitySizeCurves.AllowUpdate)
				{
					if (!ugSizeCurvesInheritedCriteria.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveInheritedCriteriaGrid, ugSizeCurvesInheritedCriteria);
					}
				}

				if (_sizeCurvesCriteriaGridBuilt && _securitySizeCurves.AllowUpdate)
				{
					if (!ugSizeCurvesCriteria.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveCriteriaGrid, ugSizeCurvesCriteria);
					}
				}

				if (_sizeCurvesSimilarStoreGridBuilt && _securitySizeCurves.AllowUpdate)
				{
					if (!ugSizeCurvesSimilarStore.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.sizeCurveSimilarStoreGrid, ugSizeCurvesSimilarStore);
					}
				}

				//End TT#155 - JScott - Add Size Curve info to Node Properties
				//Begin TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (_sizeOutOfStockGridBuilt && _securitySizeOutOfStock.AllowUpdate)
				{
					if (!mcColorSizeByAttribute.IsDisposed)
					{
						mcColorSizeByAttribute.CloseControl();
					}
				}

				//End TT#483 - JScott - Add Size Lost Sales criteria and processing
				if (_storeCapacityGridBuilt && _securityCapacity.AllowUpdate)
				{
					if (!ugStoreCapacity.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.capacityGrid, ugStoreCapacity);
					}
				}

				if (_velocityGradesGridBuilt && _securityVelocity.AllowUpdate)
				{
					if (!ugVelocityGrades.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.velocityGradeGrid, ugVelocityGrades);
					}
					if (!ugSellThruPcts.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.sellThruPctsGrid, ugSellThruPcts);
					}
				}

				if (_dailyPercentagesGridBuilt && _securityDailyPcts.AllowUpdate)
				{
					if (!ugDailyPercentages.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.dailyPercentagesGrid, ugDailyPercentages);
					}
				}

                //BEGIN TT#1401 - GRT - Reservation Stores

                //if (_reservationGridBuilt && _securityDailyPcts.AllowUpdate)
                //{
                //    if (!ugReservation.IsDisposed)
                //    {
                //        layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.dailyPercentagesGrid, ugReservation);
                //    }
                //}

                //END TT#1401 - GRT - Reservation Stores

                // Begin TT#461-MD - JSmith - Node Properties VSW tab error
                if (_reservationGridBuilt && _securityIMO.AllowUpdate)
				{
					if (!ugReservation.IsDisposed)
					{
						layoutData.InfragisticsLayout_Save(_SAB.ClientServerSession.UserRID, eLayoutID.nodePropertyVSWGrid, ugReservation);
					}
				}
                // End TT#461-MD - JSmith - Node Properties VSW tab error
            }
			catch(Exception exception)
			{
				HandleException(exception);
			}
		}

		override protected void AfterClosing()
		{
			try
			{
                // Begin TT#2222 - JSmith - 2  users in the same hierarchy node when in edit can make changes.  Lock not holding
                //if (_nodeSecurity.AllowUpdate)
                if (_nodeSecurity.AllowUpdate &&
                    _hnp.NodeLockStatus == eLockStatus.Locked)
                // End TT#2222
				{
					_SAB.HierarchyServerSession.DequeueNode(_nodeRID);
				}
				// throw event to remove node from displayed list
				if (!_changeEventThrown && !ErrorFound && _nameChanged)
				{
					NodePropertyChangeEventArgs ea = new NodePropertyChangeEventArgs(_node, _hnp);
					ea.FormClosing = true;
					if (OnNodePropertyChangeHandler != null)  // throw event to explorer to make changes
					{
						OnNodePropertyChangeHandler(this, ea);
						_nameChanged = false;
					}
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private void frmNodeProperties_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
		{
			try
			{
				if (e.KeyCode == Keys.S && e.Modifiers == Keys.Control) 
				{
					SaveChanges();
					e.Handled = true;
				}
			}
			catch( Exception exception )
			{
				HandleException(exception);
			}
		}

		private HierarchyNodeProfile GetHNProfile(int aKey)
		{
			HierarchyNodeProfile hnp = null;
			hnp = (HierarchyNodeProfile)_hnpHash[aKey];
			if (hnp == null)
			{
				hnp = SAB.HierarchyServerSession.GetNodeData(aKey, false);
				_hnpHash.Add(aKey, hnp);
			}
			return hnp;
		}

		#region IFormBase Members
		override public void ICut()
		{
			
		}

		override public void ICopy()
		{
			
		}

		override public void IPaste()
		{
			
		}	

		override public void ISave()
		{
			try
			{
				this.Cursor = Cursors.WaitCursor;
				SaveChanges();
			}		
			catch(Exception ex)
			{
				MessageBox.Show(ex.Message);
			}
			finally
			{
				this.Cursor = Cursors.Default;
			}
		}

		override public void ISaveAs()
		{
			
		}

		override public void IDelete()
		{
			
		}

		override public void IRefresh()
		{
			
		}
		
		#endregion

		private void tabNodeProperties_DragEnter(object sender, DragEventArgs e)
		{
			Image_DragEnter(sender, e);
		}

		private void tabNodeProperties_DragOver(object sender, DragEventArgs e)
		{
			Image_DragOver(sender, e);
		}

		private void ugGrid_DragOver(object sender, DragEventArgs e)
		{
			Image_DragOver(sender, e);
		}

        private void txtNodeID_KeyDown(object sender, KeyEventArgs e)
        {
            if (SAB.AllowDebugging)
            {
                if (e.KeyCode == Keys.OemQuestion && (e.Control && e.Shift))
                {
                    if (_hnp != null)
                    {
                        MessageBox.Show("Node key=" + _hnp.Key.ToString());
                    }
                    else
                    {
                        MessageBox.Show("There is no key.  Node has not been saved.");
                    }
                }
            }
        }

        private void cbStoreAttribute_DragEnter(object sender, DragEventArgs e)
        {
            Image_DragEnter(sender, e);
        }

        private void cbStoreAttribute_DragOver(object sender, DragEventArgs e)
        {
            Image_DragOver(sender, e);
        }
        //
        //  BEGIN TT#1399 - Alternate Hierarchy
        //
        private void txtApplyNodePropsFrom_TextChanged(object sender, System.EventArgs e)
        {
            //  
            //  if this is the onload event, we need to set the tag to the profile
            if (FormLoaded && !_loadingWindow)
                HierarchyChangesMade = true;
        }

        private void txtApplyNodePropsFrom_DragDrop(object sender, DragEventArgs e)
        {
            HierarchyNodeProfile inheritanceProfile = null;
            string inheritMsg;
            HierarchyChangesMade = false;
            try 
            {                
                //(MIDTextBoxTag)
                //MIDMerchandiseTextBoxTag
                bool isSuccessfull = ((MIDTextBoxTag)(((TextBox)sender).Tag)).TextBox_DragDrop(sender, e);
                if (isSuccessfull)
                {
                    HierarchyNodeProfile hnp = (HierarchyNodeProfile)((MIDTag)(((TextBox)sender).Tag)).MIDTagData;
                    //  check the types of the hierarchies we are working with
                    if (hnp.HomeHierarchyType == eHierarchyType.organizational)
                    {
                        //  update the text
                        //  update hierarchy
                        ((TextBox)sender).Text = hnp.Text;
                        ((MIDTag)((TextBox)sender).Tag).MIDTagData = hnp;
                        //((TextBox)sender).Text = hnp.HierarchyRID.ToString();
                        //  get sender profile, update inherited RID with this RID
                        _hnp.ApplyHNRIDFrom = hnp.Key;
                        //_hnp.ApplyHNRIDFrom = hnp.ApplyHNRIDFrom;
                        //_hnp.NodeInheritedFrom = hnp.NodeID;
                        HierarchyChangesMade = true;

                        InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                    }
                    else
                    {
                        ((TextBox)sender).Text = "";
                        InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                    }
                }
                else
                {
                    MessageBox.Show(SAB.ClientServerSession.Audit.GetText(eMIDTextCode.msg_BadDataInClipboard));
                }
            }
            catch (Exception exc)
            { HandleException(exc); }
            finally {}
        }

        private void txtApplyNodePropsFrom_Validated(object sender, System.EventArgs e)
        {
            //throw new System.NotImplementedException();
        }

        private void txtApplyNodePropsFrom_Validating(object sender, System.ComponentModel.CancelEventArgs e)
        {
            //throw new System.NotImplementedException();
        }

        private void txtApplyNodePropsFrom_DragEnter(object sender, DragEventArgs e)
        {
            TreeNodeClipboardList tncl = null;
            try
            {
                Image_DragOver(sender, e);
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                {
                    tncl = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    HierarchyNodeProfile hnp = _SAB.HierarchyServerSession.GetNodeData(tncl.ClipboardProfile.Key, true, true);
                    if (
                        (tncl == null) || (_hnp.isShortcut == true) || (tncl.ClipboardDataType != eProfileType.HierarchyNode) ||
                        (_hnp.HomeHierarchyType != eHierarchyType.alternate) || (hnp.HomeHierarchyType != eHierarchyType.organizational)
                        )
                    {
                        e.Effect = DragDropEffects.None;
                    }
                    else
                    {
                        e.Effect = DragDropEffects.All;
                    }
                }
            }
            catch (Exception exc)
            { HandleException(exc); }
            finally
            {
                tncl = null;
            }
        }

        private void txtApplyNodePropsFrom_DragOver(object sender, DragEventArgs e)
        {
            TreeNodeClipboardList tncl = null;
            HierarchyNodeProfile tncl_hnp = null;
            try
            {

                Image_DragOver(sender, e);
                if (e.Data.GetDataPresent(typeof(TreeNodeClipboardList)))
                    tncl = (TreeNodeClipboardList)e.Data.GetData(typeof(TreeNodeClipboardList));
                    tncl_hnp = ((MIDRetail.DataCommon.HierarchyNodeProfile)(((MIDRetail.Windows.MIDHierarchyNode)tncl.ClipboardProfile.Node).Profile));
                //  check the types of the hierarchies we are working with
                if (
                    (tncl == null) || (_hnp.isShortcut == true) || (tncl.ClipboardDataType != eProfileType.HierarchyNode) || 
                    (_hnp.HomeHierarchyType != eHierarchyType.alternate) || (tncl_hnp.HomeHierarchyType != eHierarchyType.organizational)
                    )
                {
                    e.Effect = DragDropEffects.None;
                }
                else
                {
                    e.Effect = DragDropEffects.All;
                }
           }
            catch (Exception exc)
            { HandleException(exc); }
            finally {
                tncl = null;
                tncl_hnp = null;
            }
        }

        private void txtApplyNodePropsFrom_Leave(object sender, System.EventArgs e)
        {
            //  grab user input
            //  find the profile for the entry
            //  grab the inheritence profile
            //  update the nodeinheritedfrom data
            HierarchyNodeProfile inheritanceProfile = null;
            HierarchyChangesMade = false;
            try 
            {
                inheritanceProfile = _SAB.HierarchyServerSession.GetNodeData(this.txtApplyNodePropsFrom.Text);
                // TT#1557 - GRT - Urban Alternate - added alternate node checking
                if ((inheritanceProfile != null) && (inheritanceProfile.Key != -1) && (_hnp.HomeHierarchyType == eHierarchyType.alternate))
                {
                    this.txtApplyNodePropsFrom.Text = Include.GetNodeDisplay(inheritanceProfile.DisplayOption, inheritanceProfile.NodeID,
                        inheritanceProfile.NodeName, inheritanceProfile.NodeDescription);
                    //  if the profile inherited is an org then accept it
                    if (inheritanceProfile.HomeHierarchyType == eHierarchyType.organizational)
                    {
                        ((MIDTag)this.txtApplyNodePropsFrom.Tag).MIDTagData = inheritanceProfile;
                        //  NOW changes have been made
                        HierarchyChangesMade = true;
                        InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);  // TT#4533 - JSmith - Null Reference Exception if clear Node Properties Apply Node Properties
                    }
                    else
                    {
                        HierarchyChangesMade = true;
                        _hnp.ApplyHNRIDFrom = Include.NoRID;
                        ((TextBox)sender).Tag = null;
                        ((TextBox)sender).Text = string.Empty;
                        InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                    }
                }
                else
                {
                    HierarchyChangesMade = true;
                    _hnp.ApplyHNRIDFrom = Include.NoRID;
                    // Begin TT#4533 - JSmith - Null Reference Exception if clear Node Properties Apply Node Properties
                    //this.txtApplyNodePropsFrom.Tag = null;
                    ((MIDTag)this.txtApplyNodePropsFrom.Tag).MIDTagData = null;
                    // End TT#4533 - JSmith - Null Reference Exception if clear Node Properties Apply Node Properties
                    this.txtApplyNodePropsFrom.Text = string.Empty;
                    InheritanceProvider.SetError(this.gbxApplyNodeProperties, string.Empty);
                }
            }
            catch (Exception exc)
            { HandleException(exc); }
            finally { }
        }
        //
        //  END TT#1399
        //

        //
        //  BEGIN TT#2015
        //
        private void cbxApplyInherit_CheckedChanged(object sender, System.EventArgs e)
        {
            if (FormLoaded &&
                !_processingSave &&
                !_rebuildScreen &&
                _securityNodes.AllowUpdate
                )
            {
                ChangePending = true;
                btnApply.Enabled = true;
            }
        }
        private void rbApplyChangesToLowerLevels_CheckedChanged(object sender, System.EventArgs e)
        {
            if (FormLoaded &&
                !_processingSave &&
                !_rebuildScreen &&
                _securityNodes.AllowUpdate)
            {
                this.ChangePending = true;
                btnApply.Enabled = true;
            }
        }
        //private void cbxDPInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
        //{
        //    if (FormLoaded &&
        //        !_processingSave &&
        //        !_rebuildScreen &&
        //        _securityNodes.AllowUpdate)
        //    {
        //        this.DailyPercentagesChangesMade = true;
        //    }
        //}
        //private void cbxRsrvInheritFromHigherLevel_CheckedChanged(object sender, System.EventArgs e)
        //{
        //    if (FormLoaded &&
        //        !_processingSave &&
        //        !_rebuildScreen &&
        //        _securityNodes.AllowUpdate)
        //    {
        //        this.ReservationChangesMade = true;
        //    }
        //}
        //
        //  END TT#2015
        //

        private void cbSZStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbSZStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cboOTSLevel_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cboOTSLevel_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbSEStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbSEStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbSMMStoreAttributeSet_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbSMMStoreAttributeSet_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbSMMStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbSMMStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbSCStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbSCStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbDPStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbDPStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cboSCTHighestLevel_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cboSCTHighestLevel_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cboSZOOSStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cboSZOOSStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cbCSPStoreAttribute_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cbCSPStoreAttribute_SelectionChangeCommitted(source, new EventArgs());
        }
        private void midAttributeCbx_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.midAttributeCbx_SelectionChangeCommitted(source, new EventArgs());
        }
        private void cboSZOOSSizeGroup_MIDComboBoxPropertiesChangedEvent(object source, MIDComboBoxPropertiesChangedEventArgs args)
        {
            this.cboSZOOSSizeGroup_SelectionChangeCommitted(source, new EventArgs());
        }

	}

    public class NodePropertyChangeEventArgs : EventArgs
    {
        MIDHierarchyNode _node;
        HierarchyNodeProfile _hnp;
        bool _formClosing;

        public NodePropertyChangeEventArgs(MIDHierarchyNode node, HierarchyNodeProfile hnp)
        {
            _node = node;
            _hnp = hnp;
            _formClosing = false;
        }
        public bool FormClosing
        {
            get { return _formClosing; }
            set { _formClosing = value; }
        }
        public MIDHierarchyNode Node
        {
            get { return _node; }
            set { _node = value; }
        }
        public HierarchyNodeProfile hnp
        {
            get { return _hnp; }
            set { _hnp = value; }
        }
    }

	public class HierarchyNodeConflictException : Exception
	{
	}

	public class AttributeSetTag
	{
		int _currentSetRID;
		
		public AttributeSetTag()
		{
			_currentSetRID = Include.NoRID;
		}
		public int CurrentSetRID 
		{
			get { return _currentSetRID ; }
			set { _currentSetRID = value; }
		}
	}
	//Begin TT#155 - JScott - Add Size Curve info to Node Properties

	public class MerchandiseLevelValueItem
	{
		//=======
		// FIELDS
		//=======

		private eLowLevelsType _levelType;
		private int _hierarchyRID;
		private int _levelRID;
		private int _offset;
		private string _levelName;

		//=============
		// CONSTRUCTORS
		//=============

		public MerchandiseLevelValueItem(int aOffset, string aLevelName)
		{
			_levelType = eLowLevelsType.LevelOffset;
			_hierarchyRID = Include.NoRID;
			_levelRID = Include.NoRID;
			_offset = aOffset;
			_levelName = aLevelName;
		}

		//Begin TT#155 - JScott - Add Size Curve info to Node Properties
		public MerchandiseLevelValueItem(int aHierarchyRID, string aLevelName, int aOffset)
		{
			_levelType = eLowLevelsType.LevelOffset;
			_hierarchyRID = aHierarchyRID;
			_levelRID = Include.NoRID;
			_offset = aOffset;
			_levelName = aLevelName;
		}

		//End TT#155 - JScott - Add Size Curve info to Node Properties
		public MerchandiseLevelValueItem(int aHierarchyRID, int aLevelRID, string aLevelName)
		{
			_levelType = eLowLevelsType.HierarchyLevel;
			_hierarchyRID = aHierarchyRID;
			_levelRID = aLevelRID;
			_offset = -1;
			_levelName = aLevelName;
		}

		//===========
		// PROPERTIES
		//===========

		public eLowLevelsType LevelType
		{
			get
			{
				return _levelType;
			}
			set
			{
				_levelType = value;
			}
		}

		public int HierarchyRID
		{
			get
			{
				return _hierarchyRID;
			}
			set
			{
				_hierarchyRID = value;
			}
		}

		public int LevelRID
		{
			get
			{
				return _levelRID;
			}
			set
			{
				_levelRID = value;
			}
		}

		public int Offset
		{
			get
			{
				return _offset;
			}
			set
			{
				_offset = value;
			}
		}

		public string LevelName
		{
			get
			{
				return _levelName;
			}
			set
			{
				_levelName = value;
			}
		}

		//========
		// METHODS
		//========
	}
	//End TT#155 - JScott - Add Size Curve info to Node Properties
	//Begin TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.

	public class CriteriaMerchandiseLevelHashEntry
	{
		//=======
		// FIELDS
		//=======

		private eLowLevelsType _levelType;
		private int _hierarchyRID;
		private int _levelRID;
		private int _offset;
		private string _curveName;
		private int _count;

		//=============
		// CONSTRUCTORS
		//=============

		public CriteriaMerchandiseLevelHashEntry(eLowLevelsType aLevelType, int aHierarchyRID, int aLevelRID, int aOffset, string aCurveName)
		{
			_levelType = aLevelType;
			_hierarchyRID = aHierarchyRID;
			_levelRID = aLevelRID;
			_offset = aOffset;
			_curveName = aCurveName;
			_count = 1;
		}

		//===========
		// PROPERTIES
		//===========

		public eLowLevelsType LevelType
		{
			get
			{
				return _levelType;
			}
			set
			{
				_levelType = value;
			}
		}

		public int HierarchyRID
		{
			get
			{
				return _hierarchyRID;
			}
			set
			{
				_hierarchyRID = value;
			}
		}

		public int LevelRID
		{
			get
			{
				return _levelRID;
			}
			set
			{
				_levelRID = value;
			}
		}

		public int Offset
		{
			get
			{
				return _offset;
			}
			set
			{
				_offset = value;
			}
		}

		public string CurveName
		{
			get
			{
				return _curveName;
			}
			set
			{
				_curveName = value;
			}
		}

		public int Count
		{
			get
			{
				return _count;
			}
			set
			{
				_count = value;
			}
		}

		//========
		// METHODS
		//========

		public override int GetHashCode()
		{
			return (int)_levelType + _hierarchyRID + _levelRID + _offset + _curveName.GetHashCode();
		}

		public override bool Equals(object obj)
		{
			CriteriaMerchandiseLevelHashEntry inObj;

			try
			{
				if (obj.GetType() == typeof(CriteriaMerchandiseLevelHashEntry))
				{
					inObj = (CriteriaMerchandiseLevelHashEntry)obj;

					if (inObj._levelType == _levelType && inObj._hierarchyRID == _hierarchyRID && inObj._levelRID == _levelRID &&
						inObj._offset == _offset && inObj._curveName == _curveName)
					{
						return true;
					}
					else
					{
						return false;
					}
				}
				else
				{
					return false;
				}
			}
			catch
			{
				throw;
			}
		}
	}
	//End TT#429 - JScott - Size Curve- Node Properties When requesting different size groups for the same level need a Conflict Warning.
}
