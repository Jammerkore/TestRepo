--dv =============================================
--dv Modified date: 2/18/2014
--dv Flags: REFERENCED_FROM_SQL_ONLY
--dv Description:	Deletes a tasklist, and deletes data from all its child tables
--dv History: TT#2456 - JSmith - MID Sign On Error - Client Connectivity
--dv =============================================
CREATE PROCEDURE [dbo].[SP_MID_TASKLIST_DELETE] 
	@TasklistRID AS INT,
	@debug BIT = 0
AS
BEGIN
	IF (@debug = 0)
		SET NOCOUNT ON

	DELETE
	FROM [dbo].[TASK_FORECAST_BALANCE_DETAIL] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_FORECAST_BALANCE] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_PROGRAM] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_ROLLUP] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_ALLOCATE_DETAIL] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_ALLOCATE] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_POSTING] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_FORECAST_DETAIL] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_FORECAST] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[JOB_TASKLIST_JOIN] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[SCHEDULE_JOB_JOIN] WITH (ROWLOCK)
	WHERE CURRENT_TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[USER_ITEM] WITH (ROWLOCK)
	WHERE ITEM_RID = @TasklistRID
		AND ITEM_TYPE = 46

	DELETE
	FROM [dbo].[FOLDER_JOIN] WITH (ROWLOCK)
	WHERE CHILD_ITEM_RID = @TasklistRID
		AND CHILD_ITEM_TYPE = 46

	DELETE
	FROM [dbo].[TASK_SIZE_CURVE_GENERATE_NODE] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_SIZE_CURVE_GENERATE] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK_SIZE_DAY_TO_WEEK_SUMMARY] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASK] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

	DELETE
	FROM [dbo].[TASKLIST] WITH (ROWLOCK)
	WHERE TASKLIST_RID = @TasklistRID

END
GO


