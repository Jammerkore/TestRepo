CREATE PROCEDURE [dbo].[SP_MID_MESSAGE_QUEUE_INSERT] 
	@MESSAGE_TO INT,
	@MESSAGE_FROM INT = 0,
	@MESSAGE_CODE INT,
	@MESSAGE_PROCESSING_PRIORITY INT = 5,
	@MESSAGE_DETAILS VARCHAR(5000),
	@MESSAGE_RID INT OUTPUT
AS
BEGIN
	SET NOCOUNT ON

	INSERT INTO MESSAGE_QUEUE (
		MESSAGE_DATETIME,
		MESSAGE_TO,
		MESSAGE_FROM,
		MESSAGE_CODE,
		MESSAGE_PROCESSING_PRIORITY,
		MESSAGE_DETAILS
		)
	VALUES (
		getdate(),
		@MESSAGE_TO,
		@MESSAGE_FROM,
		@MESSAGE_CODE,
		@MESSAGE_PROCESSING_PRIORITY,
		@MESSAGE_DETAILS
		)

	SELECT @MESSAGE_RID = SCOPE_IDENTITY() -- TT#3256 - JSmith - Replace @@IDENTITY with SCOPE_IDENTITY()
END
GO


