--dv =============================================
--dv Create date:	10/17/2014
--dv Description:	Reads users that have a certain node in their filter for AWS views - for delete preview
--dv =============================================
CREATE PROCEDURE [dbo].[MID_GRID_VIEW_READ_WORKSPACE_FILTER_FROM_NODE]
	@HEADER_HN_RID int,
	@FILTER_TYPE int
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @ELEMENT_GROUP_TYPE_INDEX_FOR_HEADER_MERCHANDISE INT = 17;

	SELECT DISTINCT
		au.USER_RID,
		au.USER_NAME,
		f.FILTER_NAME
	FROM FILTER_CONDITION fc
	INNER JOIN FILTER f ON f.FILTER_RID = fc.FILTER_RID
	INNER JOIN GRID_VIEW gv ON gv.WORKSPACE_FILTER_RID = fc.FILTER_RID
	INNER JOIN APPLICATION_USER au ON gv.USER_RID = au.USER_RID
	WHERE fc.ELEMENT_GROUP_TYPE_INDEX = @ELEMENT_GROUP_TYPE_INDEX_FOR_HEADER_MERCHANDISE
		AND HEADER_HN_RID = @HEADER_HN_RID
		AND f.FILTER_TYPE = @FILTER_TYPE

END
GO
