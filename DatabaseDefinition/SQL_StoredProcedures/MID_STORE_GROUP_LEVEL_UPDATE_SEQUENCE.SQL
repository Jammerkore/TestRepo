--dv =============================================
--dv Create date: 1/16/2014
--dv Description: Update store group level sequence.
--dv =============================================
CREATE PROCEDURE [dbo].[MID_STORE_GROUP_LEVEL_UPDATE_SEQUENCE]
	@SGL_RID INT,
	@SGL_VERSION INT,
	@SGL_SEQUENCE INT
AS
BEGIN
	SET NOCOUNT ON;

	--UPDATE STORE_GROUP_LEVEL
	--SET 
	--	SGL_SEQUENCE = @SGL_SEQUENCE
	--WHERE SGL_RID = @SGL_RID

	DECLARE @SGL_CUR_VERSION INT;
	SELECT @SGL_CUR_VERSION=sgl.SGL_VERSION FROM STORE_GROUP_LEVEL sgl WHERE sgl.SGL_RID=@SGL_RID;

	IF (@SGL_VERSION=@SGL_CUR_VERSION)
	BEGIN
		UPDATE STORE_GROUP_JOIN
		SET SGL_OVERRIDE_SEQUENCE = @SGL_SEQUENCE
		WHERE SGL_RID = @SGL_RID AND SGL_VERSION=@SGL_VERSION
	END
	ELSE
	BEGIN
		UPDATE STORE_GROUP_JOIN_HISTORY
		SET SGL_OVERRIDE_SEQUENCE = @SGL_SEQUENCE
		WHERE SGL_RID = @SGL_RID AND SGL_VERSION=@SGL_VERSION
	END

	SELECT @@ROWCOUNT
END
GO




