--dv =============================================
--dv Create date:	6/3/2015
--dv Description:	Updates PROC_RPT table for a process when unexpected conditions occur
--dv =============================================
CREATE PROCEDURE [dbo].[MID_PROC_RPT_UPDATE_PROCESS_AS_UNEXPECTED_TERMINATION]
	@PROCESS_ID int,
	@COMPLETION_STATUS_CODE int,
	@EXECUTION_STATUS_CODE int,
	@SUMMARY_CODE int
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @EXECUTION_STATUS_RUNNING int
	SET @EXECUTION_STATUS_RUNNING = 801602

	UPDATE PROC_HDR 
	SET 
		COMPLETION_STATUS_CODE = @COMPLETION_STATUS_CODE,
		EXECUTION_STATUS_CODE = @EXECUTION_STATUS_CODE,
		SUMMARY_CODE = @SUMMARY_CODE
	WHERE EXECUTION_STATUS_CODE = @EXECUTION_STATUS_RUNNING 
	  AND PROCESS_ID = @PROCESS_ID

	SELECT @@ROWCOUNT;

END
GO
