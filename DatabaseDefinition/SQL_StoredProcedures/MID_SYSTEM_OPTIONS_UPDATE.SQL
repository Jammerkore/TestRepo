--dv =============================================
--dv Create date:	11/26/2013
--dv Description:	Updates systems options, conditionally updates RESERVE_ST_RID
--dv Version History:
--dv	12/11/2013 TT#894-MD -jsobek -Single Client Instance System Option
--dv	12/13/2013 TT#898-MD -jsobek -Single Client User System Option
--dv	01/28/2014 TT#855-MD -jsobek -Velocity Enhancements
--dv	03/01/2014 TT#933-MD -AGallagher - Item Max vs. FWOS Max
--dv	03/19/2014 TT#3600	 -jsobek -Add a default email address on the global options screen...
--dv	02/06/2015 TT#1521-MD -jsobek -Active Directory Authentication
--dv =============================================
CREATE PROCEDURE [dbo].[MID_SYSTEM_OPTIONS_UPDATE]
	@DO_UPDATE_RESERVE_STORE bit = 0,
	@RESERVE_ST_RID int = null,
	@COMPANY_NAME varchar(50),
	@COMPANY_STREET varchar(50),
	@COMPANY_CITY varchar(30),
	@COMPANY_SP_ABBREVIATION varchar(10),
	@COMPANY_POSTAL_CODE varchar(30),
	@COMPANY_TELEPHONE varchar(30),
	@COMPANY_FAX varchar(30),
	@COMPANY_EMAIL varchar(50),
	@PRODUCT_LEVEL_DELIMITER char(1),
	@SMTP_ENABLED char(1),
	@SMTP_SERVER varchar(250),
	@SMTP_PORT int,
	@SMTP_USE_SSL char(1),
	@SMTP_USE_DEFAULT_CREDENTIALS char(1),
	@SMTP_USERNAME varchar(250),
	@SMTP_PWD varchar(50),
	@SMTP_MESSAGE_FORMAT_IN_HTML char(1),
	@SMTP_USE_OUTLOOK_CONTACTS char(1),
	@SMTP_FROM_ADDRESS varchar(250),
	@PURGE_ALLOCATIONS int,
	@STORE_DISPLAY_OPTION_ID int,
	@DEFAULT_OTS_SG_RID int,
	@DEFAULT_ALLOC_SG_RID int,
	@NEW_STORE_TIMEFRAME_BEGIN int,
	@NEW_STORE_TIMEFRAME_END int,
	@NON_COMP_STORE_TIMEFRAME_BEGIN int,
	@NON_COMP_STORE_TIMEFRAME_END int,
	@PRODUCT_LEVEL_DISPLAY_ID int,
	@DEFAULT_PCT_NEED_LIMIT float,
	@DEFAULT_BALANCE_TOLERANCE float,
	@DEFAULT_PACK_SIZE_ERROR_PCT float,
	@DEFAULT_MAX_SIZE_ERROR_PCT float,
	@DEFAULT_FILL_SIZE_HOLES_PCT float,
	@SIZE_BREAKOUT_IND char(1),
	@SIZE_NEED_IND char(1),
	@BULK_IS_DETAIL_IND char(1),
	@PROTECT_IF_HDRS_IND char(1),
	@USE_WINDOWS_LOGIN char(1),
	@STORE_GRADE_TIMEFRAME int,
	@NORMALIZE_SIZE_CURVES_IND char(1),
	@FILL_SIZES_TO_TYPE int,
	@GENERIC_PACK_ROUNDING_1ST_PACK_PCT float,
	@GENERIC_PACK_ROUNDING_NTH_PACK_PCT float,
	@ACTIVITY_MESSAGE_UPPER_LIMIT int,
	@SHIPPING_HORIZON_WEEKS int,
	@HEADER_LINK_CHARACTERISTIC int,
	@SIZE_CURVE_CHARMASK varchar(30),
	@SIZE_GROUP_CHARMASK varchar(30),
	@SIZE_ALTERNATE_CHARMASK varchar(30),
	@SIZE_CONSTRAINT_CHARMASK varchar(30),
	@ALLOW_RLSE_IF_ALL_IN_RSRV_IND char(1),
	@GENERIC_SIZE_CURVE_NAME_TYPE int,
	@NUMBER_OF_WEEKS_WITH_ZERO_SALES int,
	@MAXIMUM_CHAIN_WOS int,
	@PRORATE_CHAIN_STOCK char(1),
	@GEN_SIZE_CURVE_USING int,
	@PACK_TOLERANCE_NO_MAX_STEP_IND char(1),
	@PACK_TOLERANCE_STEPPED_IND char(1),
	@RI_EXPAND_IND char(1),
	@ALLOW_STORE_MAX_VALUE_MODIFICATION bit,
	@VSW_SIZE_CONSTRAINTS int,
	@ENABLE_VELOCITY_GRADE_OPTIONS char(1),
	@FORCE_SINGLE_CLIENT_INSTANCE char(1),
	@FORCE_SINGLE_USER_INSTANCE char(1),
	@USE_ACTIVE_DIRECTORY_AUTHENTICATION char(1),
	@USE_ACTIVE_DIRECTORY_AUTHENTICATION_WITH_DOMAIN char(1),
	@USE_BATCH_ONLY_MODE char(1),
	@CONTROL_SERVICE_DEFAULT_BATCH_ONLY_MODE_ON char(1),
	@VSW_ITEM_FWOS_MAX_IND int,
	@PRIOR_HEADER_INCLUDE_RESERVE_IND char(1),
	@DC_CARTON_ROUNDING_SG_RID int,			/* TT#1652-MD - stodd - DC Carton Rounding */
	@SPLIT_OPTION int,      				/* TT#1966-MD - AGallagher - DC Fulfillment */
	@APPLY_MINIMUMS_IND char(1),   			/* TT#1966-MD - AGallagher - DC Fulfillment */
	@PRIORITIZE_TYPE char(1),  				/* TT#1966-MD - AGallagher - DC Fulfillment */
	@HEADER_FIELD int,     					/* TT#1966-MD - AGallagher - DC Fulfillment */
	@HCG_RID int,   						/* TT#1966-MD - AGallagher - DC Fulfillment */
	@HEADERS_ORDER int,    					/* TT#1966-MD - AGallagher - DC Fulfillment */
	@STORES_ORDER int,     					/* TT#1966-MD - AGallagher - DC Fulfillment */
	@SPLIT_BY_OPTION int,      				/* TT#1966-MD - AGallagher - DC Fulfillment */
	@SPLIT_BY_RESERVE int,      			/* TT#1966-MD - AGallagher - DC Fulfillment */
	@APPLY_BY int,      						/* TT#1966-MD - AGallagher - DC Fulfillment */
	@WITHIN_DC int      						/* TT#1966-MD - AGallagher - DC Fulfillment */
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE SYSTEM_OPTIONS 
	SET 
		COMPANY_NAME = @COMPANY_NAME,
		COMPANY_STREET = @COMPANY_STREET,
		COMPANY_CITY = @COMPANY_CITY,
		COMPANY_SP_ABBREVIATION = @COMPANY_SP_ABBREVIATION,
		COMPANY_POSTAL_CODE = @COMPANY_POSTAL_CODE,
		COMPANY_TELEPHONE = @COMPANY_TELEPHONE,
		COMPANY_FAX = @COMPANY_FAX,
		COMPANY_EMAIL = @COMPANY_EMAIL,
		PRODUCT_LEVEL_DELIMITER = @PRODUCT_LEVEL_DELIMITER,
		SMTP_ENABLED = @SMTP_ENABLED,
		SMTP_SERVER = @SMTP_SERVER,
		SMTP_PORT = @SMTP_PORT,
		SMTP_USE_SSL = @SMTP_USE_SSL,
		SMTP_USE_DEFAULT_CREDENTIALS = @SMTP_USE_DEFAULT_CREDENTIALS,
		SMTP_USERNAME = @SMTP_USERNAME,
		SMTP_PWD = @SMTP_PWD,
		SMTP_MESSAGE_FORMAT_IN_HTML = @SMTP_MESSAGE_FORMAT_IN_HTML,
		SMTP_USE_OUTLOOK_CONTACTS = @SMTP_USE_OUTLOOK_CONTACTS,
		SMTP_FROM_ADDRESS = @SMTP_FROM_ADDRESS,
		PURGE_ALLOCATIONS = @PURGE_ALLOCATIONS,
        STORE_DISPLAY_OPTION_ID = @STORE_DISPLAY_OPTION_ID,
        DEFAULT_OTS_SG_RID = @DEFAULT_OTS_SG_RID,
        DEFAULT_ALLOC_SG_RID = @DEFAULT_ALLOC_SG_RID,
        NEW_STORE_TIMEFRAME_BEGIN = @NEW_STORE_TIMEFRAME_BEGIN,
        NEW_STORE_TIMEFRAME_END = @NEW_STORE_TIMEFRAME_END,
        NON_COMP_STORE_TIMEFRAME_BEGIN = @NON_COMP_STORE_TIMEFRAME_BEGIN,
        NON_COMP_STORE_TIMEFRAME_END = @NON_COMP_STORE_TIMEFRAME_END,
        PRODUCT_LEVEL_DISPLAY_ID = @PRODUCT_LEVEL_DISPLAY_ID,
        DEFAULT_PCT_NEED_LIMIT = @DEFAULT_PCT_NEED_LIMIT,
        DEFAULT_BALANCE_TOLERANCE = @DEFAULT_BALANCE_TOLERANCE,
        DEFAULT_PACK_SIZE_ERROR_PCT = @DEFAULT_PACK_SIZE_ERROR_PCT,
        DEFAULT_MAX_SIZE_ERROR_PCT = @DEFAULT_MAX_SIZE_ERROR_PCT,
        DEFAULT_FILL_SIZE_HOLES_PCT = @DEFAULT_FILL_SIZE_HOLES_PCT,
        SIZE_BREAKOUT_IND = @SIZE_BREAKOUT_IND,
		SIZE_NEED_IND = @SIZE_NEED_IND,
		BULK_IS_DETAIL_IND = @BULK_IS_DETAIL_IND,
		PROTECT_IF_HDRS_IND = @PROTECT_IF_HDRS_IND,
		USE_WINDOWS_LOGIN = @USE_WINDOWS_LOGIN,
		STORE_GRADE_TIMEFRAME = @STORE_GRADE_TIMEFRAME,
        NORMALIZE_SIZE_CURVES_IND = @NORMALIZE_SIZE_CURVES_IND,
        FILL_SIZES_TO_TYPE = @FILL_SIZES_TO_TYPE,
        GENERIC_PACK_ROUNDING_1ST_PACK_PCT = @GENERIC_PACK_ROUNDING_1ST_PACK_PCT,
        GENERIC_PACK_ROUNDING_NTH_PACK_PCT = @GENERIC_PACK_ROUNDING_NTH_PACK_PCT,
        ACTIVITY_MESSAGE_UPPER_LIMIT = @ACTIVITY_MESSAGE_UPPER_LIMIT,
		SHIPPING_HORIZON_WEEKS = @SHIPPING_HORIZON_WEEKS,
        HEADER_LINK_CHARACTERISTIC = @HEADER_LINK_CHARACTERISTIC,
        SIZE_CURVE_CHARMASK = @SIZE_CURVE_CHARMASK,
        SIZE_GROUP_CHARMASK = @SIZE_GROUP_CHARMASK,
        SIZE_ALTERNATE_CHARMASK = @SIZE_ALTERNATE_CHARMASK,
        SIZE_CONSTRAINT_CHARMASK = @SIZE_CONSTRAINT_CHARMASK,
        ALLOW_RLSE_IF_ALL_IN_RSRV_IND = @ALLOW_RLSE_IF_ALL_IN_RSRV_IND,  
        GENERIC_SIZE_CURVE_NAME_TYPE = @GENERIC_SIZE_CURVE_NAME_TYPE,          
        NUMBER_OF_WEEKS_WITH_ZERO_SALES = @NUMBER_OF_WEEKS_WITH_ZERO_SALES,
        MAXIMUM_CHAIN_WOS = @MAXIMUM_CHAIN_WOS,
		PRORATE_CHAIN_STOCK = @PRORATE_CHAIN_STOCK,
		GEN_SIZE_CURVE_USING = @GEN_SIZE_CURVE_USING,
        PACK_TOLERANCE_NO_MAX_STEP_IND = @PACK_TOLERANCE_NO_MAX_STEP_IND,
        PACK_TOLERANCE_STEPPED_IND = @PACK_TOLERANCE_STEPPED_IND,
        RI_EXPAND_IND = @RI_EXPAND_IND,
        ALLOW_STORE_MAX_VALUE_MODIFICATION = @ALLOW_STORE_MAX_VALUE_MODIFICATION,
        VSW_SIZE_CONSTRAINTS = @VSW_SIZE_CONSTRAINTS,
		ENABLE_VELOCITY_GRADE_OPTIONS = @ENABLE_VELOCITY_GRADE_OPTIONS,
		FORCE_SINGLE_CLIENT_INSTANCE = @FORCE_SINGLE_CLIENT_INSTANCE,
		FORCE_SINGLE_USER_INSTANCE = @FORCE_SINGLE_USER_INSTANCE,
		USE_ACTIVE_DIRECTORY_AUTHENTICATION = @USE_ACTIVE_DIRECTORY_AUTHENTICATION,
		USE_ACTIVE_DIRECTORY_AUTHENTICATION_WITH_DOMAIN = @USE_ACTIVE_DIRECTORY_AUTHENTICATION_WITH_DOMAIN,
		USE_BATCH_ONLY_MODE = @USE_BATCH_ONLY_MODE,
		CONTROL_SERVICE_DEFAULT_BATCH_ONLY_MODE_ON = @CONTROL_SERVICE_DEFAULT_BATCH_ONLY_MODE_ON,
		VSW_ITEM_FWOS_MAX_IND = @VSW_ITEM_FWOS_MAX_IND,
		PRIOR_HEADER_INCLUDE_RESERVE_IND = @PRIOR_HEADER_INCLUDE_RESERVE_IND,
		DC_CARTON_ROUNDING_SG_RID = @DC_CARTON_ROUNDING_SG_RID,	/* TT#1652-MD - stodd - DC Carton Rounding */
		SPLIT_OPTION = @SPLIT_OPTION,      					/* TT#1966-MD - AGallagher - DC Fulfillment */
		APPLY_MINIMUMS_IND =@APPLY_MINIMUMS_IND,   			/* TT#1966-MD - AGallagher - DC Fulfillment */
		PRIORITIZE_TYPE =@PRIORITIZE_TYPE,  				/* TT#1966-MD - AGallagher - DC Fulfillment */
		HEADER_FIELD =@HEADER_FIELD,     					/* TT#1966-MD - AGallagher - DC Fulfillment */
		HCG_RID = @HCG_RID,   								/* TT#1966-MD - AGallagher - DC Fulfillment */
		HEADERS_ORDER = @HEADERS_ORDER,    					/* TT#1966-MD - AGallagher - DC Fulfillment */
		STORES_ORDER = @STORES_ORDER,      					/* TT#1966-MD - AGallagher - DC Fulfillment */
		SPLIT_BY_OPTION = @SPLIT_BY_OPTION,      			/* TT#1966-MD - AGallagher - DC Fulfillment */
		SPLIT_BY_RESERVE = @SPLIT_BY_RESERVE,      			/* TT#1966-MD - AGallagher - DC Fulfillment */
		APPLY_BY = @APPLY_BY,      							/* TT#1966-MD - AGallagher - DC Fulfillment */
		WITHIN_DC = @WITHIN_DC      						/* TT#1966-MD - AGallagher - DC Fulfillment */

	IF (@DO_UPDATE_RESERVE_STORE = 1)
	BEGIN
		UPDATE SYSTEM_OPTIONS
		SET 
			RESERVE_ST_RID = @RESERVE_ST_RID
	END

	SELECT @@ROWCOUNT;

END
GO