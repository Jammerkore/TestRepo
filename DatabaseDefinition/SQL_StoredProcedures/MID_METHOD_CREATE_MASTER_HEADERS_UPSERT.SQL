--dv =============================================
--dv Modified date: 4/18/2017
--dv Notes:	
--dv History: TT#1966-MD - JSmith- DC Fulfillment
--dv ============================================= 

CREATE PROCEDURE [dbo].[MID_METHOD_CREATE_MASTER_HEADERS_UPSERT] 
	@METHOD_RID int, 
	@USE_SELECTED_HEADERS char(1),
	@MERCHANDISE CREATE_MASTER_HEADERS_MERCHANDISE_TYPE READONLY,
	@OVERRIDE CREATE_MASTER_HEADERS_OVERRIDE_TYPE READONLY
AS
BEGIN
	SET NOCOUNT ON;

	EXEC [dbo].[MID_METHOD_CREATE_MASTER_HEADERS_DELETE] @METHOD_RID

	INSERT INTO [dbo].[METHOD_CREATE_MASTER_HEADERS]
		(
		METHOD_RID, 
		USE_SELECTED_HEADERS
		)
	VALUES 
		(
		@METHOD_RID, 
		@USE_SELECTED_HEADERS 
		)

	INSERT INTO [dbo].[METHOD_CREATE_MASTER_HEADERS_MERCHANDISE] 
		(
		METHOD_RID,
		SEQ,
		HN_RID,
		FILTER_RID
		)
	SELECT @METHOD_RID,
	    SEQ,
		CASE 
		WHEN HN_RID = -1 THEN
			null
		ELSE 
		    HN_RID
		END,
		FILTER_RID
	FROM @MERCHANDISE

	INSERT INTO [dbo].[METHOD_CREATE_MASTER_HEADERS_OVERRIDE] 
		(
		METHOD_RID,
		SEQ,
		OVERRIDE_TYPE,
		HEADER_FIELD,
		HCG_RID,
		OVERRIDE_VALUE
		)
	SELECT @METHOD_RID,
		SEQ,
		OVERRIDE_TYPE,
		HEADER_FIELD,
		HCG_RID,
		OVERRIDE_VALUE
	FROM @OVERRIDE

	SELECT @@ROWCOUNT;

END
GO







