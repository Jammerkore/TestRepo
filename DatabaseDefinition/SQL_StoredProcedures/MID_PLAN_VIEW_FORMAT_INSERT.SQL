--dv =============================================
--dv Create date:	11/17/2020
--dv Description:	Inserts a plan view format
--dv =============================================
CREATE PROCEDURE [dbo].[MID_PLAN_VIEW_FORMAT_INSERT] 
	@VIEW_RID int,
    @PLAN_BASIS_TYPE int,
    @VARIABLE_NUMBER int,
    @QUANTITY_VARIABLE_KEY int,
    @TIME_PERIOD_TYPE int,
	@TIME_PERIOD_KEY int,
	@VARIABLE_TOTAL_KEY int,
	@WIDTH int
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS (SELECT * FROM PLAN_VIEW_FORMAT WHERE 
			VIEW_RID = @VIEW_RID 
			and PLAN_BASIS_TYPE = @PLAN_BASIS_TYPE
			and VARIABLE_NUMBER = @VARIABLE_NUMBER
			and QUANTITY_VARIABLE_KEY = @QUANTITY_VARIABLE_KEY
			and TIME_PERIOD_TYPE = @TIME_PERIOD_TYPE
			and TIME_PERIOD_KEY = @TIME_PERIOD_KEY
			and VARIABLE_TOTAL_KEY = @VARIABLE_TOTAL_KEY)
		INSERT INTO PLAN_VIEW_FORMAT
			(
			VIEW_RID,
			PLAN_BASIS_TYPE,
			VARIABLE_NUMBER,
			QUANTITY_VARIABLE_KEY,
			TIME_PERIOD_TYPE,
			TIME_PERIOD_KEY,
			VARIABLE_TOTAL_KEY,
			WIDTH
			)
		VALUES
			(
			@VIEW_RID,
			@PLAN_BASIS_TYPE,
			@VARIABLE_NUMBER,
			@QUANTITY_VARIABLE_KEY,
			@TIME_PERIOD_TYPE,
			@TIME_PERIOD_KEY,
			@VARIABLE_TOTAL_KEY,
			@WIDTH
			)
	else
		UPDATE PLAN_VIEW_FORMAT
   		   SET WIDTH = @WIDTH
		WHERE VIEW_RID = @VIEW_RID 
			and PLAN_BASIS_TYPE = @PLAN_BASIS_TYPE
			and VARIABLE_NUMBER = @VARIABLE_NUMBER
			and QUANTITY_VARIABLE_KEY = @QUANTITY_VARIABLE_KEY
			and TIME_PERIOD_TYPE = @TIME_PERIOD_TYPE
			and TIME_PERIOD_KEY = @TIME_PERIOD_KEY
			and VARIABLE_TOTAL_KEY = @VARIABLE_TOTAL_KEY


	SELECT @@ROWCOUNT;

END
GO
