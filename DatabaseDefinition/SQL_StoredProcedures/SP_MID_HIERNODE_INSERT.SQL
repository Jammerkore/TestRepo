--dv =============================================
--dv Modified date: 2/18/2014
--dv Flags: REFERENCED_FROM_SQL_ONLY
--dv History: TT#3256 - JSmith - Replace @@IDENTITY with SCOPE_IDENTITY()
--dv =============================================
CREATE PROCEDURE [dbo].[SP_MID_HIERNODE_INSERT] 
	@PH_RID INT,
	@PARENT_RID INT,
	@HOME_PH_RID INT,
	@HOME_LEVEL INT,
	@HN_TYPE INT,
	@OTS_PLANLEVEL_TYPE INT,
	@USE_BASIC_REPLENISHMENT CHAR,
	@OTS_FORECAST_LEVEL_SELECT_TYPE INT,
	@OTS_FORECAST_LEVEL_TYPE INT,
	@OTS_FORECAST_LEVEL_PH_RID INT,
	@OTS_FORECAST_LEVEL_PHL_SEQUENCE INT,
	@OTS_FORECAST_LEVEL_ANCHOR_NODE INT,
	@OTS_FORECAST_LEVEL_MASK_FIELD INT,
	@OTS_FORECAST_LEVEL_MASK VARCHAR(50),
	@VIRTUAL_IND CHAR,
	@PURPOSE INT,
	@HN_RID INT OUTPUT
AS
BEGIN
	SET NOCOUNT ON

	INSERT INTO HIERARCHY_NODE (
		HOME_PH_RID,
		HOME_LEVEL,
		HN_TYPE,
		OTS_PLANLEVEL_TYPE,
		USE_BASIC_REPLENISHMENT,
		OTS_FORECAST_LEVEL_SELECT_TYPE,
		OTS_FORECAST_LEVEL_TYPE,
		OTS_FORECAST_LEVEL_PH_RID,
		OTS_FORECAST_LEVEL_PHL_SEQUENCE,
		OTS_FORECAST_LEVEL_ANCHOR_NODE,
		OTS_FORECAST_LEVEL_MASK_FIELD,
		OTS_FORECAST_LEVEL_MASK,
		VIRTUAL_IND,
		PURPOSE,
		NODE_DELETE_IND
		)
	VALUES (
		@HOME_PH_RID,
		@HOME_LEVEL,
		@HN_TYPE,
		@OTS_PLANLEVEL_TYPE,
		@USE_BASIC_REPLENISHMENT,
		@OTS_FORECAST_LEVEL_SELECT_TYPE,
		@OTS_FORECAST_LEVEL_TYPE,
		@OTS_FORECAST_LEVEL_PH_RID,
		@OTS_FORECAST_LEVEL_PHL_SEQUENCE,
		@OTS_FORECAST_LEVEL_ANCHOR_NODE,
		@OTS_FORECAST_LEVEL_MASK_FIELD,
		@OTS_FORECAST_LEVEL_MASK,
		@VIRTUAL_IND,
		@PURPOSE,
		'0'
		)

	SELECT @HN_RID = SCOPE_IDENTITY() 

	INSERT INTO HIER_NODE_JOIN (
		PH_RID,
		PARENT_HN_RID,
		HN_RID, 
		VIRTUAL_IND, 
		NODE_DELETE_IND
		)
	VALUES (
		@PH_RID,
		@PARENT_RID,
		@HN_RID, 
		@VIRTUAL_IND, 
		'0'
		)
END
GO


