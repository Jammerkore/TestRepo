--dv =============================================
--dv Create date:	3/19/2021
--dv Description:	Inserts a plan view splitter
--dv =============================================
CREATE PROCEDURE [dbo].[MID_PLAN_VIEW_SPLITTER_INSERT] 
	@VIEW_RID int,
	@USER_RID int,
    @PLAN_SESSION_TYPE int,
    @SPLITTER_TYPE_IND char(1),
    @SPLITTER_SEQUENCE int,
	@SPLITTER_PERCENTAGE int
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS (SELECT * FROM PLAN_VIEW_SPLITTER WHERE 
			[VIEW_RID] = @VIEW_RID 
			AND [PLAN_SESSION_TYPE] = @PLAN_SESSION_TYPE
			AND [USER_RID] = @USER_RID
			AND [SPLITTER_TYPE_IND] = @SPLITTER_TYPE_IND
			AND [SPLITTER_SEQUENCE] = @SPLITTER_SEQUENCE)
		INSERT INTO PLAN_VIEW_SPLITTER
			(
			[VIEW_RID],
			[USER_RID],
			[PLAN_SESSION_TYPE],
			[SPLITTER_TYPE_IND],
			[SPLITTER_SEQUENCE],
			[SPLITTER_PERCENTAGE]
			)
		VALUES
			(
			@VIEW_RID,
			@USER_RID,
			@PLAN_SESSION_TYPE,
			@SPLITTER_TYPE_IND,
			@SPLITTER_SEQUENCE,
			@SPLITTER_PERCENTAGE
			)
	else
		UPDATE PLAN_VIEW_SPLITTER
   		   SET [SPLITTER_PERCENTAGE] = @SPLITTER_PERCENTAGE
		WHERE [VIEW_RID] = @VIEW_RID 
			AND [USER_RID] = @USER_RID
			AND [PLAN_SESSION_TYPE] = @PLAN_SESSION_TYPE
			AND [SPLITTER_TYPE_IND] = @SPLITTER_TYPE_IND
			AND [SPLITTER_SEQUENCE] = @SPLITTER_SEQUENCE


	SELECT @@ROWCOUNT;

END
GO
