--dv Create date:	9/4/2013
--dv Description:	Gets child color node data for the given base node and hierarchy
--dv =============================================
CREATE PROCEDURE [dbo].[MID_HIERARCHY_GET_CHILD_COLOR_INFO_FROM_NODE]
	@hierarchyRID int,
	@HN_RID int
AS
BEGIN

	SET NOCOUNT ON;

	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	SELECT 
		vw.*,
		COALESCE(cn.COLOR_CODE_RID,-1) COLOR_CODE_RID, 
		COALESCE(cc.COLOR_CODE_ID,' ') COLOR_CODE_ID,
		COALESCE(cc.COLOR_CODE_NAME,' ') COLOR_CODE_NAME, 
		COALESCE(cn.COLOR_DESCRIPTION,' ') COLOR_DESCRIPTION
	FROM VW_HIERARCHY_GET_DATA vw
	INNER JOIN HIER_NODE_JOIN hnj ON hnj.HN_RID = vw.HN_RID  
	INNER JOIN COLOR_NODE cn ON cn.HN_RID = vw.HN_RID
    INNER JOIN COLOR_CODE cc ON cc.COLOR_CODE_RID = cn.COLOR_CODE_RID        
	WHERE hnj.PH_RID=@hierarchyRID AND hnj.PARENT_HN_RID=@HN_RID
		
	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
END
GO
