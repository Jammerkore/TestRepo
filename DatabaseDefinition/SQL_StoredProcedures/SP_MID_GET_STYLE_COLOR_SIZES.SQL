CREATE PROCEDURE [dbo].[SP_MID_GET_STYLE_COLOR_SIZES] 
	@HN_RID INT
AS
BEGIN
	DECLARE @PH_RID INT

	SELECT @PH_RID = PH_RID
	FROM PRODUCT_HIERARCHY
	WHERE PH_TYPE = 800000

	CREATE TABLE #TEMP (
		SIZE_HN_RID INT,
		LEVEL_TYPE INT,
		VIRTUAL_IND CHAR(1),
		ACTIVE_IND CHAR(1),
		HOME_LEVEL INT,
		COLOR_HN_RID INT NULL,
		STYLE_HN_RID INT NULL,
		COLOR_CODE_RID INT NULL,
		SIZE_CODE_RID INT NULL
		)

	INSERT #TEMP (
		SIZE_HN_RID,
		LEVEL_TYPE,
		VIRTUAL_IND,
		ACTIVE_IND,
		HOME_LEVEL,
		SIZE_CODE_RID
		)
	EXEC [dbo].[SP_MID_GET_DESCENDANTS_BY_TYPE] @HN_RID,
		800204

	CREATE CLUSTERED INDEX #TEMP_SIZE_IDX ON #TEMP (SIZE_HN_RID)

	CREATE INDEX #TEMP_COLOR_IDX ON #TEMP (COLOR_HN_RID)

	UPDATE #TEMP
	SET COLOR_HN_RID = HIER_NODE_JOIN.PARENT_HN_RID
	FROM #TEMP,
		HIER_NODE_JOIN
	WHERE #TEMP.SIZE_HN_RID = HIER_NODE_JOIN.HN_RID
		AND HIER_NODE_JOIN.PH_RID = @PH_RID

	UPDATE #TEMP
	SET COLOR_CODE_RID = COLOR_NODE.COLOR_CODE_RID
	FROM #TEMP,
		COLOR_NODE
	WHERE #TEMP.COLOR_HN_RID = COLOR_NODE.HN_RID

	UPDATE #TEMP
	SET STYLE_HN_RID = HIER_NODE_JOIN.PARENT_HN_RID
	FROM #TEMP,
		HIER_NODE_JOIN
	WHERE #TEMP.COLOR_HN_RID = HIER_NODE_JOIN.HN_RID
		AND HIER_NODE_JOIN.PH_RID = @PH_RID

	SELECT STYLE_HN_RID,
		COLOR_HN_RID,
		COLOR_CODE_RID,
		SIZE_HN_RID,
		SIZE_CODE_RID,
		ACTIVE_IND
	FROM #TEMP
	WHERE COLOR_CODE_RID <> 0

	IF (
			SELECT object_id('tempdb.dbo.#TEMP')
			) > 0
		DROP TABLE #TEMP
END
GO


