CREATE PROCEDURE [dbo].[SP_MID_SIZE_INSERT] 
	@SIZE_CODE_ID VARCHAR(50),
	@SIZE_CODE_PRIMARY VARCHAR(100),
	@SIZE_CODE_SECONDARY VARCHAR(100),
	@SIZE_CODE_PRODUCT_CATEGORY VARCHAR(100),
	@SIZE_CODE_RID INT OUTPUT
AS
BEGIN
	SET NOCOUNT ON

	INSERT INTO SIZE_CODE (
		SIZE_CODE_ID,
		SIZE_CODE_PRIMARY,
		SIZE_CODE_SECONDARY,
		SIZE_CODE_PRODUCT_CATEGORY
		)
	VALUES (
		@SIZE_CODE_ID,
		@SIZE_CODE_PRIMARY,
		@SIZE_CODE_SECONDARY,
		@SIZE_CODE_PRODUCT_CATEGORY
		);

	SELECT @SIZE_CODE_RID = SCOPE_IDENTITY() -- TT#3256 - JSmith - Replace @@IDENTITY with SCOPE_IDENTITY() 

	-- add to SIZES table
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

	IF NOT EXISTS (
			SELECT *
			FROM SIZES
			WHERE SIZE_CODE_PRIMARY = @SIZE_CODE_PRIMARY
			)
	BEGIN
		INSERT INTO SIZES (SIZE_CODE_PRIMARY)
		VALUES (@SIZE_CODE_PRIMARY);
	END

	-- add to DIMENSIONS table
	IF @SIZE_CODE_SECONDARY IS NOT NULL
	BEGIN
		IF NOT EXISTS (
				SELECT *
				FROM DIMENSIONS
				WHERE SIZE_CODE_SECONDARY = @SIZE_CODE_SECONDARY
				)
		BEGIN
			INSERT INTO DIMENSIONS (SIZE_CODE_SECONDARY)
			VALUES (@SIZE_CODE_SECONDARY);
		END
	END

	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
END
GO


