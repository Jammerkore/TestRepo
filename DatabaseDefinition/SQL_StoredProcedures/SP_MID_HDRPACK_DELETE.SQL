CREATE PROCEDURE [dbo].[SP_MID_HDRPACK_DELETE] 
	@PACK_RID INT,
	@RETURN_ROWCOUNT BIT = 1
AS
BEGIN
	DELETE ASSORTMENT_MATRIX_DETAIL
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE PACK_ALLOCATION
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE PACK_RULE
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE PACK_RULE_LAYER
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE HEADER_PACK_COLOR_SIZE
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE HEADER_PACK_COLOR
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	UPDATE METHOD_RULE
	WITH (ROWLOCK)

	SET HDR_PACK_RID = NULL
	WHERE HDR_PACK_RID = @PACK_RID

	UPDATE MASTER_HEADER
	WITH (ROWLOCK)

	SET MASTER_PACK_RID = NULL
	WHERE MASTER_PACK_RID = @PACK_RID

	UPDATE MASTER_HEADER
	WITH (ROWLOCK)

	SET SUBORD_PACK_RID = NULL
	WHERE SUBORD_PACK_RID = @PACK_RID

	/* Begin TT#1966-MD - JSmith - DC Fulfillment */
	DELETE HEADER_PACK_ASSOCIATION
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	DELETE HEADER_PACK_ASSOCIATION
	WITH (ROWLOCK)
	WHERE ASSOCIATED_PACK_RID = @PACK_RID
	/* End TT#1966-MD - JSmith - DC Fulfillment */

	DELETE HEADER_PACK
	WITH (ROWLOCK)
	WHERE HDR_PACK_RID = @PACK_RID

	IF @RETURN_ROWCOUNT = 1 SELECT @@ROWCOUNT;

END
GO


