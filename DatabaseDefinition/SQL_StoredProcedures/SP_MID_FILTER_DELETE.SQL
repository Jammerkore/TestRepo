--dv =============================================
--dv Modified date: 7/15/2015
--dv Flags: REFERENCED_FROM_SQL_ONLY
--dv Description:	Retrieves active descendant and ancestor node data from a starting node
--dv History:		TT#1170-MD -jsobek -Remove Binary database objects and normalize the Filter definitions
--dv History:		TT#1437-MD -jsobek -When deleting filters, remove entries from current workspace filter table
--dv History:		TT#1677-MD -RMatelic -Need to clean FilterRID's out of the USER_ALLOCATION  & USER_PLAN tables after deleting Store Filter
--dv =============================================
CREATE PROCEDURE [dbo].[SP_MID_FILTER_DELETE] 
	@FilterRID AS INT,
	@debug BIT = 0
AS
IF (@debug = 0)
	SET NOCOUNT ON

UPDATE [dbo].[METHOD_MOD_SALES] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[WORKFLOW_STEP_OTSPLAN] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[METHOD_OVERRIDE] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[METHOD_FILL_SIZE_HOLES] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[METHOD_SIZE_BASIS_ALLOCATION] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[WORKFLOW_STEP_ALLOCATION] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[METHOD_RULE] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[FILTER_BASIS_ALLOCATION] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[WORKFLOW] WITH (ROWLOCK)
	SET STORE_FILTER_RID = NULL
	WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[USER_ALLOCATION] WITH (ROWLOCK)
	SET FILTER_RID = NULL
	WHERE FILTER_RID = @FilterRID
	
UPDATE [dbo].[USER_PLAN] WITH (ROWLOCK)
	SET FILTER_RID = NULL
	WHERE FILTER_RID = @FilterRID
	
DELETE
FROM [dbo].[FILTER_BASIS_SIZE_ALLOCATION] WITH (ROWLOCK)
WHERE STORE_FILTER_RID = @FilterRID

UPDATE [dbo].[METHOD_COPY_FORECAST] WITH (ROWLOCK)
SET STORE_FILTER_RID = NULL
WHERE STORE_FILTER_RID = @FilterRID

DELETE
FROM [dbo].[USER_CURRENT_WORKSPACE_FILTER] WITH (ROWLOCK)
WHERE FILTER_RID = @FilterRID

DELETE
FROM [dbo].[FILTER] WITH (ROWLOCK)
WHERE FILTER_RID = @FilterRID
GO


