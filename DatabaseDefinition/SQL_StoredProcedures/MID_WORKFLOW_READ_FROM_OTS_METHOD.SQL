--dv =============================================
--dv Create date: 12/06/2013
--dv Description:	Get workflow info from the OTS method.
--dv =============================================
CREATE PROCEDURE [dbo].[MID_WORKFLOW_READ_FROM_OTS_METHOD] 
	@METHOD_RID INT
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		WORKFLOW_NAME,
		WORKFLOW_DESCRIPTION,
		USER_NAME,
		CASE USER_FULLNAME
			WHEN ''
				THEN USER_NAME
			ELSE USER_FULLNAME
			END AS USER_FULLNAME,
		WORKFLOW_USER_RID
	FROM WORKFLOW W
	INNER JOIN WORKFLOW_STEP_OTSPLAN WS ON W.WORKFLOW_RID = WS.WORKFLOW_RID
	INNER JOIN METHOD M ON M.METHOD_RID = WS.METHOD_RID
	INNER JOIN APPLICATION_USER U ON U.USER_RID = W.WORKFLOW_USER_RID
	WHERE M.METHOD_RID = @METHOD_RID
END
GO



