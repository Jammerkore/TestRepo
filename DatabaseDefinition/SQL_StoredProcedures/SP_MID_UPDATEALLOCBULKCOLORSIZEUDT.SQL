--dv =============================================
--dv Modified date:	8/14/2014
--dv Description:	Updates bulk color size allocation
--dv History:		TT#1268 - MD - RMatelic - 5.4 Merge
--dv =============================================
CREATE PROCEDURE [dbo].[SP_MID_UPDATEALLOCBULKCOLORSIZEUDT] 
	(
	@Updt BULK_COLOR_SIZE_ALLOCATION_TYPE READONLY,
	@ReturnCode INT = - 100 OUTPUT,
	@debug INT = 0
	)
AS
IF @debug = 0
	SET NOCOUNT ON

INSERT INTO [dbo].[BULK_COLOR_SIZE_ALLOCATION] (
	HDR_RID,
	HDR_BC_RID,
	HDR_BCSZ_KEY,
	ST_RID,
	UNITS_ALLOCATED,
	UNITS_SHIPPED,
	UNITS_ALLOCATED_BY_AUTO,
	MINIMUM,
	MAXIMUM,
	PRIMARY_MAX,
	ALLOC_STORE_DET_AUDIT_FLAGS,
	SHIPPING_STATUS_FLAGS,
	ITEM_UNITS_ALLOCATED,
	ITEM_MINIMUM,
	ITEM_IDEAL_MINIMUM
	)
SELECT HDR_RID,
	HDR_BC_RID,
	HDR_BCSZ_KEY,
	ST_RID,
	UNITS_ALLOCATED,
	UNITS_SHIPPED,
	UNITS_ALLOCATED_BY_AUTO,
	MINIMUM,
	MAXIMUM,
	PRIMARY_MAX,
	ALLOC_STORE_DET_AUDIT_FLAGS,
	SHIPPING_STATUS_FLAGS,
	ITEM_UNITS_ALLOCATED,
	ITEM_MINIMUM,
	ITEM_IDEAL_MINIMUM
FROM @Updt
WHERE (UNITS_ALLOCATED IS NOT NULL)
   OR (UNITS_SHIPPED IS NOT NULL)
   OR (UNITS_ALLOCATED_BY_AUTO IS NOT NULL)
   OR (MINIMUM IS NOT NULL)
   OR (MAXIMUM IS NOT NULL)
   OR (PRIMARY_MAX IS NOT NULL)
   OR (ALLOC_STORE_DET_AUDIT_FLAGS IS NOT NULL AND ALLOC_STORE_DET_AUDIT_FLAGS > 0)
   OR (SHIPPING_STATUS_FLAGS IS NOT NULL AND SHIPPING_STATUS_FLAGS > 0)
   OR (ITEM_UNITS_ALLOCATED IS NOT NULL)
   OR (ITEM_MINIMUM IS NOT NULL)
   OR (ITEM_IDEAL_MINIMUM IS NOT NULL)

SET @ReturnCode = @@rowcount

RETURN @ReturnCode
GO


