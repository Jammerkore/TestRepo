--dv =============================================
--dv Create date: 2/9/2018
--dv Description:	Write Extract Control Data
--dv =============================================
CREATE PROCEDURE [dbo].[MID_EXTRACT_PLANNING_CONTROL_WRITE]
	@dt EXTRACT_PLANNING_CONTROL_TYPE READONLY
AS
BEGIN
SET NOCOUNT ON
MERGE INTO EXTRACT_PLANNING_CONTROL with (ROWLOCK) AS TARGET
USING @dt AS SOURCE
on (SOURCE.[HN_RID] = TARGET.[HN_RID] and SOURCE.[FV_RID] = TARGET.[FV_RID] and SOURCE.[TIME_ID] = TARGET.[TIME_ID] and SOURCE.[PLAN_TYPE] = TARGET.[PLAN_TYPE])
WHEN MATCHED THEN
UPDATE 
         SET TARGET.[UPDATE_DATE] = COALESCE(SOURCE.[UPDATE_DATE], TARGET.[UPDATE_DATE]),
             TARGET.[EXTRACT_DATE] = COALESCE(SOURCE.[EXTRACT_DATE], TARGET.[EXTRACT_DATE])
			 
WHEN NOT MATCHED BY TARGET THEN
INSERT (HN_RID, FV_RID, TIME_ID, PLAN_TYPE, UPDATE_DATE, EXTRACT_DATE)
VALUES ( SOURCE.[HN_RID], SOURCE.[FV_RID], SOURCE.[TIME_ID], SOURCE.[PLAN_TYPE], SOURCE.[UPDATE_DATE], SOURCE.[EXTRACT_DATE]);

END
GO


















