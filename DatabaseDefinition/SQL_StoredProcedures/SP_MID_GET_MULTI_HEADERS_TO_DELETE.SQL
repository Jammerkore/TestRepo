CREATE PROCEDURE [dbo].[SP_MID_GET_MULTI_HEADERS_TO_DELETE] 
AS
BEGIN
	SELECT HDR_RID,
		HDR_ID,
		RELEASE_DATETIME
	FROM VW_GET_HEADERS vw
	JOIN PURGE_DATES pd ON pd.HN_RID = vw.STYLE_HNRID
	WHERE vw.MultiHeader = '1'
		AND vw.ShippingComplete = '1'
		AND vw.RELEASE_DATETIME < (
			SELECT min(v)
			FROM (
				VALUES (pd.PURGE_HEADERS_RECEIPT_DATETIME),
					(pd.PURGE_HEADERS_ASN_DATETIME),
					(pd.PURGE_HEADERS_DUMMY_DATETIME),
					(pd.PURGE_HEADERS_DROPSHIP_DATETIME),
					(pd.PURGE_HEADERS_RESERVE_DATETIME),
					(pd.PURGE_HEADERS_WORKUPTOTALBUY_DATETIME),
					(pd.PURGE_HEADERS_PO_DATETIME),
					(pd.PURGE_HEADERS_VSW_DATETIME)
				) AS value(v)
			)
END
GO


