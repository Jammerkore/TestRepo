--dv =============================================
--dv Modified date: 2/18/2014
--dv Flags: REFERENCED_FROM_SQL_ONLY
--dv Description:	Decides how to best delete store rows, by comparing row counts to thresholds
--dv =============================================
CREATE PROCEDURE [dbo].[MID_STORE_REMOVAL_DECIDE_PROCESS] 
	@MINIMUM_DELETE_ROW_THRESHOLD int,
	@MAXIMUM_DELETE_ROW_THRESHOLD int,
	@DELETION_PROCESS_PERCENTAGE_THRESHOLD float
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE STORE_REMOVAL_ANALYSIS
	SET DO_DELETE_PROCESS =
		CASE WHEN ROWS_TO_DELETE_COUNT >= @MAXIMUM_DELETE_ROW_THRESHOLD THEN 0
		ELSE
			CASE WHEN ROWS_TO_DELETE_COUNT <= @MINIMUM_DELETE_ROW_THRESHOLD THEN 1
			ELSE
				CASE WHEN PERCENT_TO_DELETE <= @DELETION_PROCESS_PERCENTAGE_THRESHOLD THEN 1
				ELSE
					0
				END
			END
		END, IN_PROGRESS = 0, COMPLETED = 0

END
GO
