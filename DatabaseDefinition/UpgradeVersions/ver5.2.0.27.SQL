/*RELEASE 5.2.0.27 08-08-2013 -TT#739-MD -jsobek -Delete Stores -Store Removal Analysis */
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[STORE_REMOVAL_ANALYSIS]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
drop table [dbo].[STORE_REMOVAL_ANALYSIS]
GO
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[STORE_REMOVAL_TABLE_LIST]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
drop table [dbo].[STORE_REMOVAL_TABLE_LIST]
GO
CREATE TABLE [dbo].[STORE_REMOVAL_TABLE_LIST](
	[TABLE_LIST_ID] [int] IDENTITY(1,1) NOT NULL,
	[TABLE_NAME] [varchar](4000) NOT NULL,
	[DELETE_SEQUENCE] [int] NOT NULL,
 CONSTRAINT [PK_STORE_REMOVAL_TABLE_LIST] PRIMARY KEY CLUSTERED 
(
	[TABLE_LIST_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO


CREATE TABLE [dbo].[STORE_REMOVAL_ANALYSIS](
	[ANALYSIS_ID] [int] IDENTITY(1,1) NOT NULL,
	[TABLE_LIST_ID] [int] NOT NULL,
	[TOTAL_ROW_COUNT] [int] NOT NULL,
	[ROWS_TO_DELETE_COUNT] [int] NOT NULL,
	[ROWS_TO_COPY_COUNT]  AS ([TOTAL_ROW_COUNT]-[ROWS_TO_DELETE_COUNT]),
	[PERCENT_TO_DELETE]  AS (case when [TOTAL_ROW_COUNT]=(0) then (0) else CONVERT([float],[ROWS_TO_DELETE_COUNT],0)/CONVERT([float],[TOTAL_ROW_COUNT],0) end),
	[DO_DELETE_PROCESS] [bit] NULL,
 CONSTRAINT [PK_STORE_REMOVAL_ANALYSIS] PRIMARY KEY CLUSTERED 
(
	[ANALYSIS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [dbo].[STORE_REMOVAL_ANALYSIS]  WITH CHECK ADD  CONSTRAINT [FK_STORE_REMOVAL_ANALYSIS_STORE_REMOVAL_TABLE_LIST] FOREIGN KEY([TABLE_LIST_ID])
REFERENCES [dbo].[STORE_REMOVAL_TABLE_LIST] ([TABLE_LIST_ID])
ON DELETE CASCADE
GO

ALTER TABLE [dbo].[STORE_REMOVAL_ANALYSIS] CHECK CONSTRAINT [FK_STORE_REMOVAL_ANALYSIS_STORE_REMOVAL_TABLE_LIST]
GO

INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('VSW_REVERSE_ON_HAND', 1)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_SIZE_CURVE_BY_GROUP',2)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_INTRANSIT_REV', 3)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_IMO_REV', 4)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK9', 5)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK8', 6)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK7', 7)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK6', 8)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK5', 9)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK4', 10)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK3', 11)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK2', 12)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK1', 13)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_WEEK0', 14)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY9', 15)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY8', 16)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY7', 17)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY6', 18)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY5', 19)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY4', 20)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY3', 21)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY2', 22)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY1', 23)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_HISTORY_DAY0', 24)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_GROUP_LEVEL_JOIN', 25)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK9', 26)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK8', 27)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK7', 28)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK6', 29)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK5', 30)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK4', 31)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK3', 32)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK2', 33)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK1', 34)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK0', 35)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_FORECAST_WEEK_LOCK', 36)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_EXTERNAL_INTRANSIT', 37)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_COMMITTED', 38)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_CHAR_JOIN', 39)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_CAPACITY', 40)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('SECURITY_USER_STORE', 41)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('SECURITY_GROUP_STORE', 42)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('NODE_IMO', 43)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('METHOD_OVERRIDE_IMO', 44)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('DAILY_PERCENTAGES_DEFAULTS', 45)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('DAILY_PERCENTAGES', 46)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_STORE_EXTERNAL_INTRANSIT', 47)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('ASSORTMENT_STORE_SUMMARY', 48)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('ASSORTMENT_STORE_ELIGIBILITY', 49)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('TOTAL_ALLOCATION', 50)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('TOTAL_RULE', 51)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('DETAIL_ALLOCATION', 52)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('DETAIL_RULE', 53)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_COLOR_ALLOCATION', 54)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_COLOR_SIZE_ALLOCATION', 55)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_ALLOCATION', 56)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_COLOR_RULE', 57)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('BULK_RULE', 58)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('PACK_ALLOCATION', 59)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('PACK_RULE', 60)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_IMO', 61)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_INTRANSIT', 62)
INSERT INTO STORE_REMOVAL_TABLE_LIST (TABLE_NAME, DELETE_SEQUENCE) VALUES ('STORE_ELIGIBILITY', 63)
go
