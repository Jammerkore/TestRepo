/*RELEASE 5.4.0.02 04-07-2014 TT#1170-MD -jsobek -Remove Binary database objects and normalize the Filter definitions  */

/* Begin TT#1313-MD -jsobek -Header Filters */
--Inserting global header filter folder: FilterHeaderMainGlobalFolder = 312
DECLARE @key int
	IF NOT EXISTS(SELECT * FROM FOLDER where FOLDER_TYPE = 312)
	BEGIN 
		INSERT INTO FOLDER(USER_RID, FOLDER_ID, FOLDER_TYPE) VALUES (4, 'Global Filters', 312)
		SELECT @key = @@identity
		INSERT INTO USER_ITEM(USER_RID, ITEM_TYPE, ITEM_RID, OWNER_USER_RID) VALUES (4, 312, @key, 4)
	END
GO

--Inserting global assortment filter folder: FilterAssortmentMainGlobalFolder = 317
DECLARE @key2 int
	IF NOT EXISTS(SELECT * FROM FOLDER where FOLDER_TYPE = 317)
	BEGIN 
		INSERT INTO FOLDER(USER_RID, FOLDER_ID, FOLDER_TYPE) VALUES (4, 'Global Filters', 317)
		SELECT @key2 = @@identity
		INSERT INTO USER_ITEM(USER_RID, ITEM_TYPE, ITEM_RID, OWNER_USER_RID) VALUES (4, 317, @key2, 4)
	END
GO
/* End TT#1313-MD -jsobek -Header Filters */

UPDATE APPLICATION_TEXT SET TEXT_VALUE='Store Filters' WHERE TEXT_CODE=300250
GO
UPDATE APPLICATION_TEXT SET TEXT_VALUE='Store Filters' WHERE TEXT_CODE=842000
GO
--Clear explorer dock and explorer toolbar layouts for all users
DELETE FROM INFRAGISTICS_LAYOUTS WHERE LAYOUT_ID IN (0, 1)
GO
/* Begin TT#1313-MD -jsobek -Header Filters */
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842300, 0, 1, 840000);   --Header Filters
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842310, 0, 2, 842300);   --Header Filters Global
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842320, 0, 2, 842300);   --Header Filters User
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842300, 801160);   --Header Filters : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842300, 801161);   --        : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842300, 801162);   --        : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842300, 801163);   --        : View
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842310, 801160);   --Header Filters Global : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842310, 801161);   --       : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842310, 801162);   --       : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842310, 801163);   --       : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842320, 801160);   --Header Filters User : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842320, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842320, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842320, 801163);   --     : View
GO

INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842400, 0, 1, 840000);   --Assortment Filters
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842410, 0, 2, 842400);   --Assortment Filters Global
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(842420, 0, 2, 842400);   --Assortment Filters User
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842400, 801160);   --Assortment Filters : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842400, 801161);   --        : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842400, 801162);   --        : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842400, 801163);   --        : View
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842410, 801160);   --Assortment Filters Global : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842410, 801161);   --       : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842410, 801162);   --       : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842410, 801163);   --       : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842420, 801160);   --Assortment Filters User : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842420, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842420, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(842420, 801163);   --     : View
GO
/* End TT#1313-MD -jsobek -Header Filters */
/* Begin TT#1313-MD -jsobek -Header Filters */
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864200, 0, 1, 860000);   --Header Filter
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864210, 0, 2, 864200);   --Header Filter Folders
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864220, 0, 3, 864210);   --Header Filter Global
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864230, 0, 3, 864210);   --Header Filter User
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864200, 801160);   --Header Filter : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864200, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864200, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864200, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864210, 801160);   --Header Filter Folders : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864210, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864210, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864210, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864220, 801160);   --Header Filter Global : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864220, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864220, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864220, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864230, 801160);   --Header Filter User : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864230, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864230, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864230, 801163);   --     : View
GO

INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864300, 0, 1, 860000);   --Assortment Filter
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864310, 0, 2, 864300);   --Assortment Filter Folders
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864320, 0, 3, 864310);   --Assortment Filter Global
INSERT INTO SECURITY_FUNCTION_JOIN(FUNC_ID, FUNC_TYPE, FUNC_LEVEL, FUNC_PARENT) VALUES(864330, 0, 3, 864310);   --Assortment Filter User
GO
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864300, 801160);   --Assortment Filter : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864300, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864300, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864300, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864310, 801160);   --Assortment Filter Folders : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864310, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864310, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864310, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864320, 801160);   --Assortment Filter Global : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864320, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864320, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864320, 801163);   --     : View
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864330, 801160);   --Assortment Filter User : Full Control
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864330, 801161);   --     : Maintain
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864330, 801162);   --     : Delete
INSERT INTO SECURITY_FUNCTION_ACTIONS(FUNC_ID, ACTION_ID) VALUES(864330, 801163);   --     : View
GO

IF dbo.UDF_ColumnAlreadyExists('TASK_ALLOCATE', 'ALLOCATE_TYPE')=1
BEGIN
	ALTER TABLE TASK_ALLOCATE DROP COLUMN "ALLOCATE_TYPE"
	ALTER TABLE TASK_ALLOCATE DROP COLUMN "HEADER_ID"
	ALTER TABLE TASK_ALLOCATE DROP COLUMN "PO_ID"
END
GO
/* End TT#1313-MD -jsobek -Header Filters */

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STORE_FILTER_BASIS_AL_FK1') 
   ALTER TABLE FILTER_BASIS_ALLOCATION DROP CONSTRAINT STORE_FILTER_BASIS_AL_FK1
GO 
ALTER TABLE FILTER_BASIS_ALLOCATION ADD CONSTRAINT STORE_FILTER_BASIS_AL_FK1 FOREIGN KEY([STORE_FILTER_RID]) REFERENCES FILTER (FILTER_RID)
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'FILTER_BASIS_SIZE_AL_FK1') 
   ALTER TABLE FILTER_BASIS_SIZE_ALLOCATION DROP CONSTRAINT FILTER_BASIS_SIZE_AL_FK1
GO 
ALTER TABLE FILTER_BASIS_SIZE_ALLOCATION ADD CONSTRAINT FILTER_BASIS_SIZE_AL_FK1 FOREIGN KEY([STORE_FILTER_RID]) REFERENCES FILTER (FILTER_RID)
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STORE_FILTER_METH_COPY_FC_FK1') 
   ALTER TABLE METHOD_COPY_FORECAST DROP CONSTRAINT STORE_FILTER_METH_COPY_FC_FK1
GO 
ALTER TABLE METHOD_COPY_FORECAST ADD CONSTRAINT STORE_FILTER_METH_COPY_FC_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STORE_FILTER_METHOD_MOD_SALES_FK1') 
   ALTER TABLE METHOD_MOD_SALES DROP CONSTRAINT STORE_FILTER_METHOD_MOD_SALES_FK1
GO 
ALTER TABLE METHOD_MOD_SALES ADD CONSTRAINT STORE_FILTER_METHOD_MOD_SALES_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STORE_FILTER_METHOD_RULE_FK1') 
   ALTER TABLE METHOD_RULE DROP CONSTRAINT STORE_FILTER_METHOD_RULE_FK1
GO 
ALTER TABLE METHOD_RULE ADD CONSTRAINT STORE_FILTER_METHOD_RULE_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STORE_FILTER_WORKFLOW_FK1') 
   ALTER TABLE WORKFLOW DROP CONSTRAINT STORE_FILTER_WORKFLOW_FK1
GO 
ALTER TABLE WORKFLOW ADD CONSTRAINT STORE_FILTER_WORKFLOW_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_EXP_FK1') 
   ALTER TABLE METHOD_EXPORT DROP CONSTRAINT STR_FLTR_MTHD_EXP_FK1
GO 
ALTER TABLE METHOD_EXPORT ADD CONSTRAINT STR_FLTR_MTHD_EXP_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_FILL_SZ_HLS_FK1') 
   ALTER TABLE METHOD_FILL_SIZE_HOLES DROP CONSTRAINT STR_FLTR_MTHD_FILL_SZ_HLS_FK1
GO 
ALTER TABLE METHOD_FILL_SIZE_HOLES ADD CONSTRAINT STR_FLTR_MTHD_FILL_SZ_HLS_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_GLBL_LK_FK1') 
   ALTER TABLE METHOD_GLOBAL_LOCK DROP CONSTRAINT STR_FLTR_MTHD_GLBL_LK_FK1
GO 
ALTER TABLE METHOD_GLOBAL_LOCK ADD CONSTRAINT STR_FLTR_MTHD_GLBL_LK_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID) ON UPDATE NO ACTION ON DELETE NO ACTION 
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_GLBL_UNLK_FK1') 
   ALTER TABLE METHOD_GLOBAL_UNLOCK DROP CONSTRAINT STR_FLTR_MTHD_GLBL_UNLK_FK1
GO 
ALTER TABLE METHOD_GLOBAL_UNLOCK ADD CONSTRAINT STR_FLTR_MTHD_GLBL_UNLK_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_OVRD_FK1') 
   ALTER TABLE METHOD_OVERRIDE DROP CONSTRAINT STR_FLTR_MTHD_OVRD_FK1
GO 
ALTER TABLE METHOD_OVERRIDE ADD CONSTRAINT STR_FLTR_MTHD_OVRD_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_MTHD_SZ_BAS_ALLOC_FK1') 
   ALTER TABLE METHOD_SIZE_BASIS_ALLOCATION DROP CONSTRAINT STR_FLTR_MTHD_SZ_BAS_ALLOC_FK1
GO 
ALTER TABLE METHOD_SIZE_BASIS_ALLOCATION ADD CONSTRAINT STR_FLTR_MTHD_SZ_BAS_ALLOC_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_WORKFLOW_STEP_AL_FK1') 
   ALTER TABLE WORKFLOW_STEP_ALLOCATION DROP CONSTRAINT STR_FLTR_WORKFLOW_STEP_AL_FK1
GO 
ALTER TABLE WORKFLOW_STEP_ALLOCATION ADD CONSTRAINT STR_FLTR_WORKFLOW_STEP_AL_FK1 FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF EXISTS (SELECT name FROM sysobjects WHERE name = 'STR_FLTR_WRKFLW_STEP_FOR_FK1') 
   ALTER TABLE WORKFLOW_STEP_OTSPLAN DROP CONSTRAINT STR_FLTR_WRKFLW_STEP_FOR_FK1
GO 
ALTER TABLE WORKFLOW_STEP_OTSPLAN ADD CONSTRAINT STR_FLTR_WRKFLW_STEP_FOR_FK1  FOREIGN KEY (STORE_FILTER_RID) REFERENCES FILTER (FILTER_RID)  
GO

IF (SELECT object_id('dbo.STORE_FILTER_OBJECT')) > 0
BEGIN
	DROP TABLE STORE_FILTER_OBJECT
END
GO

IF (SELECT object_id('dbo.STORE_FILTER')) > 0
BEGIN
	DROP TABLE STORE_FILTER
END
GO

/* Begin TT#1313-MD -jsobek -Header Filters */
IF (SELECT object_id('dbo.ASRT_WRKSP_FILTER_STATUS')) > 0
BEGIN
	DROP TABLE ASRT_WRKSP_FILTER_STATUS
END
GO

IF (SELECT object_id('dbo.ASRT_WRKSP_FILTER')) > 0
BEGIN
	DROP TABLE ASRT_WRKSP_FILTER
END
GO

IF (SELECT object_id('dbo.AL_WRKSP_FILTER_STATUS')) > 0
BEGIN
	DROP TABLE AL_WRKSP_FILTER_STATUS
END
GO

IF (SELECT object_id('dbo.AL_WRKSP_FILTER_TYPES')) > 0
BEGIN
	DROP TABLE AL_WRKSP_FILTER_TYPES
END
GO

IF (SELECT object_id('dbo.AL_WRKSP_FILTER')) > 0
BEGIN
	DROP TABLE AL_WRKSP_FILTER
END
GO

IF (SELECT object_id('dbo.GRID_VIEW_FILTER_STATUS')) > 0
BEGIN
	DROP TABLE GRID_VIEW_FILTER_STATUS
END
GO

IF (SELECT object_id('dbo.GRID_VIEW_FILTER_TYPES')) > 0
BEGIN
	DROP TABLE GRID_VIEW_FILTER_TYPES
END
GO

IF (SELECT object_id('dbo.GRID_VIEW_FILTER')) > 0
BEGIN
	DROP TABLE GRID_VIEW_FILTER
END
GO

IF (SELECT object_id('dbo.IN_USE_FILTER_XREF')) > 0
BEGIN
	DROP TABLE IN_USE_FILTER_XREF
END
GO

/* End TT#1313-MD -jsobek -Header Filters */
