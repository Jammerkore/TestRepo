/*RELEASE 5.4.0.47 2-16-2015 TT#4307 -stodd - DB Upgrade issue */
IF EXISTS (SELECT GROUP_RID FROM SECURITY_GROUP_FUNCTION WHERE GROUP_RID = 1 and FUNC_ID = 810050 and ACTION_ID = 801004 and SEC_LVL_ID = 801160)
BEGIN
delete from SECURITY_GROUP_FUNCTION where GROUP_RID = 1 and FUNC_ID = 810050 and ACTION_ID = 801004 and SEC_LVL_ID = 801160
END

IF NOT EXISTS (SELECT GROUP_RID FROM SECURITY_GROUP_FUNCTION WHERE GROUP_RID = 1 and FUNC_ID = 810050 and ACTION_ID = 801160)
BEGIN

IF NOT EXISTS (SELECT GROUP_RID FROM USER_GROUP WHERE GROUP_RID = 1)
BEGIN
	DECLARE @maxRid int

	select @maxRid = MAX(GROUP_RID) from USER_GROUP
	set @maxRid = @maxRid + 1

	set IDENTITY_INSERT USER_GROUP ON
	INSERT INTO USER_GROUP(GROUP_RID, GROUP_NAME, GROUP_DESCRIPTION, GROUP_ACTIVE_IND) 
			VALUES(1, 'Administrators', 'System Administrators', 1);
	set IDENTITY_INSERT USER_GROUP OFF
	/* seed the USER_GROUP table that will allow for future static record ids */
	DBCC CHECKIDENT (USER_GROUP,reseed,@maxRid)
END

IF NOT EXISTS (SELECT GROUP_RID FROM SECURITY_GROUP_FUNCTION WHERE GROUP_RID = 1 and FUNC_ID = 810050 and ACTION_ID = 801160)
BEGIN
	INSERT INTO SECURITY_GROUP_FUNCTION VALUES (1, 810050, 801160, 801004)
END

END
GO