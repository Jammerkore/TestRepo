if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[SP_MID_ST_FOR_WK_LOCK_READ]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[SP_MID_ST_FOR_WK_LOCK_READ]
GO
 
CREATE PROCEDURE [dbo].[SP_MID_ST_FOR_WK_LOCK_READ]
@dt MID_ST_FOR_WK_READ_LOCK_TYPE READONLY
AS
SET NOCOUNT ON
       SELECT sfwl.HN_RID, sfwl.FV_RID, sfwl.TIME_ID, sfwl.ST_RID, COALESCE(sfwl.SALES_LOCK, '0') SALES_LOCK, 
          COALESCE(sfwl.SALES_REG_LOCK, '0') SALES_REG_LOCK, COALESCE(sfwl.SALES_PROMO_LOCK, '0') SALES_PROMO_LOCK, 
          COALESCE(sfwl.SALES_MKDN_LOCK, '0') SALES_MKDN_LOCK, COALESCE(sfwl.STOCK_LOCK, '0') STOCK_LOCK, 
          COALESCE(sfwl.STOCK_REG_LOCK, '0') STOCK_REG_LOCK, COALESCE(sfwl.STOCK_MKDN_LOCK, '0') STOCK_MKDN_LOCK, 
          COALESCE(sfwl.IN_STOCK_SALES_LOCK, '0') IN_STOCK_SALES_LOCK, COALESCE(sfwl.IN_STOCK_SALES_REG_LOCK, '0') IN_STOCK_SALES_REG_LOCK, 
          COALESCE(sfwl.IN_STOCK_SALES_PROMO_LOCK, '0') IN_STOCK_SALES_PROMO_LOCK, COALESCE(sfwl.IN_STOCK_SALES_MKDN_LOCK, '0') IN_STOCK_SALES_MKDN_LOCK, 
          COALESCE(sfwl.ACCUM_SELL_THRU_SALES_LOCK, '0') ACCUM_SELL_THRU_SALES_LOCK, COALESCE(sfwl.ACCUM_SELL_THRU_STOCK_LOCK, '0') ACCUM_SELL_THRU_STOCK_LOCK, 
          COALESCE(sfwl.DAYS_IN_STOCK_LOCK, '0') DAYS_IN_STOCK_LOCK, COALESCE(sfwl.RECEIVED_STOCK_LOCK, '0') RECEIVED_STOCK_LOCK
          
		FROM @dt t
	JOIN STORE_FORECAST_WEEK_LOCK sfwl with (nolock)  ON t.HN_RID = sfwl.HN_RID
		AND sfwl.FV_RID = t.FV_RID
		AND sfwl.TIME_ID = t.TIME_ID
	OPTION (MAXDOP 1)


GO


