if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[SP_MID_ST_FOR_WK_DEL_UNLK]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[SP_MID_ST_FOR_WK_DEL_UNLK]
GO
 
CREATE PROCEDURE [dbo].[SP_MID_ST_FOR_WK_DEL_UNLK]
@COMMIT_LIMIT INT,
@RECORDS_DELETED int output
AS


DELETE TOP (@COMMIT_LIMIT) STORE_FORECAST_WEEK_LOCK
          WHERE COALESCE(SALES_LOCK, 0) = 0 AND COALESCE(SALES_REG_LOCK, 0) = 0 AND COALESCE(SALES_PROMO_LOCK, 0) = 0 AND 
          COALESCE(SALES_MKDN_LOCK, 0) = 0 AND COALESCE(STOCK_LOCK, 0) = 0 AND COALESCE(STOCK_REG_LOCK, 0) = 0 AND 
          COALESCE(STOCK_MKDN_LOCK, 0) = 0 AND COALESCE(IN_STOCK_SALES_LOCK, 0) = 0 AND COALESCE(IN_STOCK_SALES_REG_LOCK, 0) = 0 AND 
          COALESCE(IN_STOCK_SALES_PROMO_LOCK, 0) = 0 AND COALESCE(IN_STOCK_SALES_MKDN_LOCK, 0) = 0 AND 
          COALESCE(ACCUM_SELL_THRU_SALES_LOCK, 0) = 0 AND COALESCE(ACCUM_SELL_THRU_STOCK_LOCK, 0) = 0 AND 
          COALESCE(DAYS_IN_STOCK_LOCK, 0) = 0 AND COALESCE(RECEIVED_STOCK_LOCK, 0) = 0
set @RECORDS_DELETED = @@rowcount


GO


