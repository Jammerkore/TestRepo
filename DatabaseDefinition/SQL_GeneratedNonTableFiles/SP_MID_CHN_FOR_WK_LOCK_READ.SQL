if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[SP_MID_CHN_FOR_WK_LOCK_READ]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[SP_MID_CHN_FOR_WK_LOCK_READ]
GO
 
CREATE PROCEDURE [dbo].[SP_MID_CHN_FOR_WK_LOCK_READ]
@dt MID_CHN_FOR_WK_READ_LOCK_TYPE READONLY
AS
SET NOCOUNT ON
       SELECT cfwl.HN_RID, cfwl.FV_RID, cfwl.TIME_ID, COALESCE(cfwl.SALES_LOCK, '0') SALES_LOCK, 
          COALESCE(cfwl.SALES_REG_LOCK, '0') SALES_REG_LOCK, COALESCE(cfwl.SALES_PROMO_LOCK, '0') SALES_PROMO_LOCK, 
          COALESCE(cfwl.SALES_MKDN_LOCK, '0') SALES_MKDN_LOCK, COALESCE(cfwl.STOCK_LOCK, '0') STOCK_LOCK, 
          COALESCE(cfwl.STOCK_REG_LOCK, '0') STOCK_REG_LOCK, COALESCE(cfwl.STOCK_MKDN_LOCK, '0') STOCK_MKDN_LOCK, 
          COALESCE(cfwl.WOS_LOCK, '0') WOS_LOCK, COALESCE(cfwl.WOS_REGPROMO_LOCK, '0') WOS_REGPROMO_LOCK
          
		FROM @dt t
	JOIN CHAIN_FORECAST_WEEK_LOCK cfwl with (nolock) ON t.HN_RID = cfwl.HN_RID
		AND cfwl.FV_RID = t.FV_RID
		AND cfwl.TIME_ID = t.TIME_ID
	OPTION (MAXDOP 1)


GO


